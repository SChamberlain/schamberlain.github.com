<p>opts_chunk$set(warning=FALSE, message=FALSE, comment=NA, cache=FALSE)</p>

<hr />

<p>name: shiny-r
layout: post
title: Shiny apps are awesome
date: 2012-12-10
author: Scott Chamberlain
tags:
- R
- RStudio
- ropensci</p>

<h2>- shiny</h2>

<p>RStudio has a new product called <code>Shiny</code> that, quoting from their website, "makes it super simple for R users like you to turn analyses into interactive web applications that anyone can use". <a href="http://www.rstudio.com/shiny/">See here</a> for more information.</p>

<p>A <code>Shiny</code> basically consists of two files: a <code>ui.r</code> file and a <code>server.r</code> file.  The <code>ui.r</code> file, as it says, provides the user interface, and the <code>server.r</code> file provides the the server logic.</p>

<p>Below is what it looks like in the wild (on a browser).</p>

<p><img src="http://schamberlain.github.com/img/shiny_ss.png" alt="center" /></p>

<p>It was pretty easy (for <a href="http://emhart.github.com/">Ted Hart of rOpenSci</a>) to build this app to demonstrate output from the <a href="http://cran.r-project.org/web/packages/rgbif/index.html"><code>ropensci rgbif</code> package</a>.</p>

<hr />

<h3>You may need to install packages first.</h3>

<div class="highlight"><pre><code class="r">install.packages<span class="p">(</span>c<span class="p">(</span><span class="s">&quot;shiny&quot;</span><span class="p">,</span> <span class="s">&quot;ggplot2&quot;</span><span class="p">,</span> <span class="s">&quot;plyr&quot;</span><span class="p">,</span> <span class="s">&quot;rgbif&quot;</span><span class="p">))</span>
</code></pre></div>


<hr />

<h3>We tried to build in making real time API calls to GBIF's servers, but the calls took too long for web speed.  So we prepare the data first, and then serve it up from saved data in a <code>.rda</code> file. Let's first prepare the data. --Well, this is what we do on the app itself, but see the next code block for</h3>

<div class="highlight"><pre><code class="r">library<span class="p">(</span>rgbif<span class="p">)</span>
splist <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;Accipiter erythronemius&quot;</span><span class="p">,</span> <span class="s">&quot;Junco hyemalis&quot;</span><span class="p">,</span> <span class="s">&quot;Aix sponsa&quot;</span><span class="p">,</span> <span class="s">&quot;Haliaeetus leucocephalus&quot;</span><span class="p">,</span> 
    <span class="s">&quot;Corvus corone&quot;</span><span class="p">,</span> <span class="s">&quot;Threskiornis molucca&quot;</span><span class="p">,</span> <span class="s">&quot;Merops malimbicus&quot;</span><span class="p">)</span>
out <span class="o">&lt;-</span> llply<span class="p">(</span>splist<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> occurrencelist<span class="p">(</span>x<span class="p">,</span> coordinatestatus <span class="o">=</span> <span class="k-Variable">T</span><span class="p">,</span> maxresults <span class="o">=</span> <span class="m">100</span><span class="p">))</span>
names<span class="p">(</span>out<span class="p">)</span> <span class="o">&lt;-</span> splist  <span class="c1"># name each data.frame with the species names</span>
setwd<span class="p">(</span><span class="s">&quot;~/ShinyApps/rgbif2&quot;</span><span class="p">)</span>  <span class="c1"># set directory</span>
save<span class="p">(</span>out<span class="p">,</span> file <span class="o">=</span> <span class="s">&quot;speciesdata.rda&quot;</span><span class="p">)</span>  <span class="c1"># save the list of data.frames into an .rda file to serve up</span>
</code></pre></div>


<hr />

<h3>Here's the server logic</h3>

<div class="highlight"><pre><code class="r">library<span class="p">(</span>shiny<span class="p">)</span>
library<span class="p">(</span>plyr<span class="p">)</span>
library<span class="p">(</span>ggplot2<span class="p">)</span>
library<span class="p">(</span>rgbif<span class="p">)</span>

<span class="c1">## Set up server output</span>
shinyServer<span class="p">(</span><span class="kr">function</span><span class="p">(</span>input<span class="p">,</span> output<span class="p">)</span> <span class="p">{</span>
    load<span class="p">(</span><span class="s">&quot;speciesdata.rda&quot;</span><span class="p">)</span>
    <span class="c1"># define function for server plot output</span>
    output<span class="o">$</span>gbifplot <span class="o">&lt;-</span> reactivePlot<span class="p">(</span><span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
        species <span class="o">&lt;-</span> input<span class="o">$</span>spec
        df <span class="o">&lt;-</span> out<span class="p">[</span>names<span class="p">(</span>out<span class="p">)</span> <span class="o">%in%</span> species<span class="p">]</span>
        print<span class="p">(</span>gbifmap<span class="p">(</span>df<span class="p">))</span>
    <span class="p">})</span>
    output<span class="o">$</span>cbt <span class="o">&lt;-</span> reactiveText<span class="p">(</span><span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">})</span>
<span class="p">})</span>
</code></pre></div>


<hr />

<h3>The user interface</h3>

<div class="highlight"><pre><code class="r">library<span class="p">(</span>shiny<span class="p">)</span>

<span class="c1"># Define UI for application that plots random distributions</span>
shinyUI<span class="p">(</span>pageWithSidebar<span class="p">(</span>headerPanel<span class="p">(</span><span class="s">&quot;rgbif example&quot;</span><span class="p">),</span> sidebarPanel<span class="p">(</span>checkboxGroupInput<span class="p">(</span><span class="s">&quot;spec&quot;</span><span class="p">,</span> 
    <span class="s">&quot;Species to map:&quot;</span><span class="p">,</span> c<span class="p">(</span><span class="sb">`Sharp shinned hawk (Accipiter erythronemius)`</span> <span class="o">=</span> <span class="s">&quot;Accipiter erythronemius&quot;</span><span class="p">,</span> 
        <span class="sb">`Dark eyed junco (Junco hyemalis)`</span> <span class="o">=</span> <span class="s">&quot;Junco hyemalis&quot;</span><span class="p">,</span> <span class="sb">`Wood duck (Aix sponsa)`</span> <span class="o">=</span> <span class="s">&quot;Aix sponsa&quot;</span><span class="p">,</span> 
        <span class="sb">`Bald eagle (Haliaeetus leucocephalus)`</span> <span class="o">=</span> <span class="s">&quot;Haliaeetus leucocephalus&quot;</span><span class="p">,</span> 
        <span class="sb">`Carrion crow (Corvus corone)`</span> <span class="o">=</span> <span class="s">&quot;Corvus corone&quot;</span><span class="p">,</span> <span class="sb">`Australian White Ibis (Threskiornis molucca)`</span> <span class="o">=</span> <span class="s">&quot;Threskiornis molucca&quot;</span><span class="p">,</span> 
        <span class="sb">`Rosy Bee-eater (Merops malimbicus)`</span> <span class="o">=</span> <span class="s">&quot;Merops malimbicus&quot;</span><span class="p">),</span> selected <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;Bald eagle (Haliaeetus leucocephalus)&quot;</span><span class="p">))),</span> 
    mainPanel<span class="p">(</span>h5<span class="p">(</span><span class="s">&quot;A map of your selected species: Please note that GBIF is queried for every selection so loading times vary&quot;</span><span class="p">),</span> 
        plotOutput<span class="p">(</span><span class="s">&quot;gbifplot&quot;</span><span class="p">))))</span>
</code></pre></div>


<hr />

<p>This should be all you need. To actually serve up the app in the web, request to be part of their beta-test of Shiny server on the web <a href="https://rstudio.wufoo.com/forms/shiny-server-beta-program/">here</a>.</p>

<p>Go play with our Shiny app <a href="http://glimmer.rstudio.com/ropensci/rgbif2/">here</a> to see the kind of visualization you can do with the <code>rgbif</code> package.</p>

<hr />

<h4>Get the .Rmd file used to create this post <a href="https://github.com/SChamberlain/scott/blob/gh-pages/_drafts/2012-12-10-shiny-r.Rmd">at my github account</a> - or <a href="https://github.com/SChamberlain/scott/blob/gh-pages/_posts/2012-12-10-shiny-r.md">.md file</a>.</h4>

<h4>Written in <a href="http://daringfireball.net/projects/markdown/">Markdown</a>, with help from <a href="http://yihui.name/knitr/">knitr</a>.</h4>
