<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    
    Recology, R/etc.
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon.ico">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0f layout-reverse">

    <header class="masthead">
      <div class="masthead-inner">
        <h1>Recology</h1>
        <!-- <h1> <a href="http://recology.info/">Recology</a></h1> -->
        <p class="lead">R/etc.</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="/"><i class="fa fa-home fa-lg"></i></a>&nbsp;
              <a href="/about"><i class="fa fa-info-circle fa-lg"></i></a>&nbsp;
              <a href="/archives"><i class="fa fa-archive fa-lg"></i></a>&nbsp;
              <a href="/rresources"><i class="fa fa-book fa-lg"></i></a>&nbsp;
              <a href="http://rforcats.net/" rel><i class="fa fa-graduation-cap fa-lg"></i></a>&nbsp;
              <a href="feed.xml"><i class="fa fa-rss fa-lg"></i></a>&nbsp;
              <a href="https://twitter.com/recology_"><i class="fa fa-twitter fa-lg"></i></a>&nbsp;
              <a href="/fork"><i class="fa fa-spinner fa-lg"></i></a>
            </li>
          </ul>
          <!-- <small><a href="https://github.com/mdo/hyde">Hyde</a> from <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</small> -->
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="posts">
  <a style="float:right;" href="/archives" data-toggle="tooltip" data-placement="bottom" title="Archives"><i class="fa fa-archive fa-lg"></i></a>
  <a style="float:right;" href="/tags"><i class="fa fa-tags fa-lg"></i></a>&nbsp;
  
  <div class="post">
    <h1>
      <a href="/2014/11/github-fun/">
        Fun with the GitHub API
      </a>
    </h1>

    <span class="post-date">26 Nov 2014</span>

    <p>Recently I&#39;ve had fun playing with the GitHub API, and here are some notes to self about this fun having.</p>

<h2>Setup</h2>

<p>Get/load packages</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">install.packages<span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;devtools&#39;</span><span class="p">,</span><span class="s">&#39;jsonlite&#39;</span><span class="p">,</span><span class="s">&#39;httr&#39;</span><span class="p">,</span><span class="s">&#39;yaml&#39;</span><span class="p">))</span>
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span><span class="s">&quot;devtools&quot;</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span><span class="s">&quot;httr&quot;</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span><span class="s">&quot;yaml&quot;</span><span class="p">)</span>
</code></pre></div>
<h2>Define a vector of package names</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r">pkgs <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;alm&quot;</span><span class="p">,</span> <span class="s">&quot;bmc&quot;</span><span class="p">,</span> <span class="s">&quot;bold&quot;</span><span class="p">,</span> <span class="s">&quot;clifro&quot;</span><span class="p">,</span> <span class="s">&quot;ecoengine&quot;</span><span class="p">,</span>
  <span class="s">&quot;elastic&quot;</span><span class="p">,</span> <span class="s">&quot;fulltext&quot;</span><span class="p">,</span> <span class="s">&quot;geonames&quot;</span><span class="p">,</span> <span class="s">&quot;gistr&quot;</span><span class="p">,</span>
  <span class="s">&quot;RNeXML&quot;</span><span class="p">,</span> <span class="s">&quot;rnoaa&quot;</span><span class="p">,</span> <span class="s">&quot;rnpn&quot;</span><span class="p">,</span> <span class="s">&quot;traits&quot;</span><span class="p">,</span> <span class="s">&quot;rplos&quot;</span><span class="p">,</span> <span class="s">&quot;rsnps&quot;</span><span class="p">,</span>
  <span class="s">&quot;rWBclimate&quot;</span><span class="p">,</span> <span class="s">&quot;solr&quot;</span><span class="p">,</span> <span class="s">&quot;spocc&quot;</span><span class="p">,</span> <span class="s">&quot;taxize&quot;</span><span class="p">,</span> <span class="s">&quot;togeojson&quot;</span><span class="p">,</span> <span class="s">&quot;treeBASE&quot;</span><span class="p">)</span>
pkgs <span class="o">&lt;-</span> <span class="kp">sort</span><span class="p">(</span>pkgs<span class="p">)</span>
</code></pre></div>
<h2>Define functions</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r">github_auth <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>appname <span class="o">=</span> <span class="kp">getOption</span><span class="p">(</span><span class="s">&quot;gh_appname&quot;</span><span class="p">),</span> key <span class="o">=</span> <span class="kp">getOption</span><span class="p">(</span><span class="s">&quot;gh_id&quot;</span><span class="p">),</span>
                        secret <span class="o">=</span> <span class="kp">getOption</span><span class="p">(</span><span class="s">&quot;gh_secret&quot;</span><span class="p">))</span> <span class="p">{</span>
  <span class="kr">if</span> <span class="p">(</span><span class="kp">is.null</span><span class="p">(</span><span class="kp">getOption</span><span class="p">(</span><span class="s">&quot;gh_token&quot;</span><span class="p">)))</span> <span class="p">{</span>
    myapp <span class="o">&lt;-</span> oauth_app<span class="p">(</span>appname<span class="p">,</span> key<span class="p">,</span> secret<span class="p">)</span>
    token <span class="o">&lt;-</span> oauth2.0_token<span class="p">(</span>oauth_endpoints<span class="p">(</span><span class="s">&quot;github&quot;</span><span class="p">),</span> myapp<span class="p">)</span>
    <span class="kp">options</span><span class="p">(</span>gh_token <span class="o">=</span> token<span class="p">)</span>
  <span class="p">}</span> <span class="kr">else</span> <span class="p">{</span>
    token <span class="o">&lt;-</span> <span class="kp">getOption</span><span class="p">(</span><span class="s">&quot;gh_token&quot;</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="kr">return</span><span class="p">(</span>token<span class="p">)</span>
<span class="p">}</span>

make_url <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> z<span class="p">)</span> <span class="p">{</span>
  <span class="kp">sprintf</span><span class="p">(</span><span class="s">&quot;https://api.github.com/repos/%s/%s/%s&quot;</span><span class="p">,</span> x<span class="p">,</span> y<span class="p">,</span> z<span class="p">)</span>
<span class="p">}</span>

process_result <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
  stop_for_status<span class="p">(</span>x<span class="p">)</span>
  <span class="kr">if</span> <span class="p">(</span><span class="o">!</span>x<span class="o">$</span>headers<span class="o">$</span><span class="sb">`content-type`</span> <span class="o">==</span> <span class="s">&quot;application/json; charset=utf-8&quot;</span><span class="p">)</span>
    <span class="kp">stop</span><span class="p">(</span><span class="s">&quot;content type mismatch&quot;</span><span class="p">)</span>
  tmp <span class="o">&lt;-</span> content<span class="p">(</span>x<span class="p">,</span> as <span class="o">=</span> <span class="s">&quot;text&quot;</span><span class="p">)</span>
  jsonlite<span class="o">::</span>fromJSON<span class="p">(</span>tmp<span class="p">,</span> flatten <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="p">}</span>

parse_file <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
  tmp <span class="o">&lt;-</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&quot;\n\\s+&quot;</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">,</span> 
              <span class="kp">paste</span><span class="p">(</span><span class="kp">vapply</span><span class="p">(</span><span class="kp">strsplit</span><span class="p">(</span>x<span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">)[[</span><span class="m">1</span><span class="p">]],</span> RCurl<span class="o">::</span>base64Decode<span class="p">,</span>
                           <span class="kt">character</span><span class="p">(</span><span class="m">1</span><span class="p">),</span> USE.NAMES <span class="o">=</span> <span class="kc">FALSE</span><span class="p">),</span> collapse <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="p">))</span>
  lines <span class="o">&lt;-</span> <span class="kp">readLines</span><span class="p">(</span><span class="kp">textConnection</span><span class="p">(</span>tmp<span class="p">))</span>
  <span class="kp">vapply</span><span class="p">(</span>lines<span class="p">,</span> <span class="kp">gsub</span><span class="p">,</span> <span class="kt">character</span><span class="p">(</span><span class="m">1</span><span class="p">),</span> pattern <span class="o">=</span> <span class="s">&quot;\\s&quot;</span><span class="p">,</span> replacement <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
         USE.NAMES <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
<span class="p">}</span>

request <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>owner <span class="o">=</span> <span class="s">&quot;ropensci&quot;</span><span class="p">,</span> repo<span class="p">,</span> file<span class="o">=</span><span class="s">&quot;DESCRIPTION&quot;</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span> <span class="p">{</span>
  req <span class="o">&lt;-</span> GET<span class="p">(</span>make_url<span class="p">(</span>owner<span class="p">,</span> repo<span class="p">,</span> <span class="kp">paste0</span><span class="p">(</span><span class="s">&quot;contents/&quot;</span><span class="p">,</span> <span class="kp">file</span><span class="p">)),</span> 
             config <span class="o">=</span> <span class="kt">c</span><span class="p">(</span>token <span class="o">=</span> github_auth<span class="p">(),</span> <span class="kc">...</span><span class="p">))</span>
  <span class="kr">if</span><span class="p">(</span>req<span class="o">$</span>status_code <span class="o">!=</span> <span class="m">200</span><span class="p">)</span> <span class="p">{</span> <span class="kc">NA</span> <span class="p">}</span> <span class="kr">else</span> <span class="p">{</span>
    cts <span class="o">&lt;-</span> process_result<span class="p">(</span>req<span class="p">)</span><span class="o">$</span>content
    parse_file<span class="p">(</span>cts<span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

has_term <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>what<span class="p">,</span> <span class="kc">...</span><span class="p">)</span> <span class="kp">any</span><span class="p">(</span><span class="kp">grepl</span><span class="p">(</span>what<span class="p">,</span> request<span class="p">(</span><span class="kc">...</span><span class="p">)))</span>
has_file <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>what<span class="p">,</span> <span class="kc">...</span><span class="p">)</span> <span class="kr">if</span><span class="p">(</span><span class="kp">all</span><span class="p">(</span><span class="kp">is.na</span><span class="p">(</span>request<span class="p">(</span>file <span class="o">=</span> what<span class="p">,</span> <span class="kc">...</span><span class="p">))))</span> <span class="kc">FALSE</span> <span class="kr">else</span> <span class="kc">TRUE</span>
</code></pre></div>
<h2>Do stuff</h2>

<p>Does a package depend on a particular package? e.g., look for <code>httr</code> in the <code>DESCRIPTION</code> file (which is the default file name in <code>request()</code> above)</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">has_term<span class="p">(</span><span class="s">&quot;httr&quot;</span><span class="p">,</span> repo<span class="o">=</span><span class="s">&quot;taxize&quot;</span><span class="p">)</span>
<span class="c1">#&gt; [1] TRUE</span>
has_term<span class="p">(</span><span class="s">&quot;maptools&quot;</span><span class="p">,</span> repo<span class="o">=</span><span class="s">&quot;taxize&quot;</span><span class="p">)</span>
<span class="c1">#&gt; [1] FALSE</span>
</code></pre></div>
<p>Do a series of R packages have a file for how to contribute <code>CONTRIBUTING.md</code>?</p>

<p>Yes</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">has_file<span class="p">(</span><span class="s">&quot;CONTRIBUTING.md&quot;</span><span class="p">,</span> repo<span class="o">=</span><span class="s">&quot;taxize&quot;</span><span class="p">)</span>
<span class="c1">#&gt; [1] TRUE</span>
</code></pre></div>
<p>Many packages</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">vapply</span><span class="p">(</span>pkgs<span class="p">,</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> has_file<span class="p">(</span><span class="s">&quot;CONTRIBUTING.md&quot;</span><span class="p">,</span> repo<span class="o">=</span>x<span class="p">),</span> <span class="kt">logical</span><span class="p">(</span><span class="m">1</span><span class="p">))</span>
<span class="c1">#&gt;        alm        bmc       bold     clifro  ecoengine    elastic </span>
<span class="c1">#&gt;      FALSE      FALSE      FALSE      FALSE      FALSE      FALSE </span>
<span class="c1">#&gt;   fulltext   geonames      gistr     RNeXML      rnoaa       rnpn </span>
<span class="c1">#&gt;       TRUE      FALSE      FALSE       TRUE       TRUE      FALSE </span>
<span class="c1">#&gt;      rplos      rsnps rWBclimate       solr      spocc     taxize </span>
<span class="c1">#&gt;      FALSE      FALSE      FALSE      FALSE       TRUE       TRUE </span>
<span class="c1">#&gt;  togeojson     traits   treeBASE </span>
<span class="c1">#&gt;      FALSE      FALSE      FALSE</span>
</code></pre></div>
<h2>Check rate limit</h2>

<p>Define function</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">rate_limit <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span><span class="kc">...</span><span class="p">)</span> <span class="p">{</span>
  token <span class="o">&lt;-</span> github_auth<span class="p">()</span>
  req <span class="o">&lt;-</span> GET<span class="p">(</span><span class="s">&quot;https://api.github.com/rate_limit&quot;</span><span class="p">,</span> config <span class="o">=</span> <span class="kt">c</span><span class="p">(</span>token <span class="o">=</span> token<span class="p">,</span> <span class="kc">...</span><span class="p">))</span>
  process_result<span class="p">(</span>req<span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Check it</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">rate_limit<span class="p">()</span>
<span class="c1">#&gt; $resources</span>
<span class="c1">#&gt; $resources$core</span>
<span class="c1">#&gt; $resources$core$limit</span>
<span class="c1">#&gt; [1] 5000</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $resources$core$remaining</span>
<span class="c1">#&gt; [1] 4925</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $resources$core$reset</span>
<span class="c1">#&gt; [1] 1417031016</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $resources$search</span>
<span class="c1">#&gt; $resources$search$limit</span>
<span class="c1">#&gt; [1] 30</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $resources$search$remaining</span>
<span class="c1">#&gt; [1] 30</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $resources$search$reset</span>
<span class="c1">#&gt; [1] 1417028069</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rate</span>
<span class="c1">#&gt; $rate$limit</span>
<span class="c1">#&gt; [1] 5000</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rate$remaining</span>
<span class="c1">#&gt; [1] 4925</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rate$reset</span>
<span class="c1">#&gt; [1] 1417031016</span>
</code></pre></div>
<p>Convert time to reset to human readable form</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">as.POSIXct</span><span class="p">(</span>rate_limit<span class="p">()</span><span class="o">$</span>rate<span class="o">$</span>reset<span class="p">,</span> origin<span class="o">=</span><span class="s">&quot;1970-01-01&quot;</span><span class="p">)</span>
<span class="c1">#&gt; [1] &quot;2014-11-26 11:43:36 PST&quot;</span>
</code></pre></div>
  </div>
  
  <div class="post">
    <h1>
      <a href="/2014/11/sofa/">
        sofa - reboot
      </a>
    </h1>

    <span class="post-date">18 Nov 2014</span>

    <p>I&#39;ve reworked <code>sofa</code> recently after someone reported a bug in the package. Since the last post on this package on 2013-06-21, there&#39;s a bunch of changes:</p>

<ul>
<li>Removed the <code>sofa_</code> prefix from all functions as it wasn&#39;t really necessary. </li>
<li>Replaced <code>rjson</code>/<code>RJSONIO</code> with <code>jsonlite</code> for JSON I/O.</li>
<li>New functions:

<ul>
<li><code>revisions()</code> - to get the revision numbers for a document.</li>
<li><code>uuids()</code> - get any number of UUIDs - e.g., if you want to set document IDs with UUIDs</li>
</ul></li>
<li>Most functions that deal with documents are prefixed with <code>doc_</code></li>
<li>Functions that deal with databases are prefixed with <code>db_</code></li>
<li>Simplified all code, reducing duplication</li>
<li>All functions take <code>cushion</code> as the first parameter, for consistency sake.</li>
<li>Changed <code>cushion()</code> function so that you can only register one cushion with each function call, 
and the function takes parameters for each element now, <code>name</code> (name of the cushion, whatever you want), <code>user</code> (user name, if applicable), <code>pwd</code> (password, if applicable), <code>type</code> (one of localhost, cloudant, or iriscouch), and <code>port</code> (if applicable).</li>
<li>Changed package license from <code>CC0</code> to <code>MIT</code></li>
</ul>

<p>There&#39;s still more to do, but I&#39;m pretty happy with the recent changes, and I hope at least some find the package useful. Also, would love people to try it out as all bugs are shallow and all that...</p>

<p>The following are a few examples of package use.</p>

<h2>Install CouchDB</h2>

<p>Instructions <a href="http://wiki.apache.org/couchdb/Installation">here</a></p>

<h2>Start CouchDB</h2>

<p>In your terminal </p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">couchdb
</code></pre></div>
<p>You can interact with your CouchDB databases as well in your browser. Navigate to <a href="http://localhost:5984/_utils">http://localhost:5984/_utils</a></p>

<h2>Install sofa</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r">install.packages<span class="p">(</span><span class="s">&quot;devtools&quot;</span><span class="p">)</span>
devtools<span class="o">::</span>install_github<span class="p">(</span><span class="s">&quot;sckott/sofa&quot;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span><span class="s">&#39;sofa&#39;</span><span class="p">)</span>
</code></pre></div>
<h2>Authenticate - Cushions</h2>

<p>As an example, here&#39;s how I set up details for connecting to my Cloudant couch:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">cushion<span class="p">(</span>name <span class="o">=</span> <span class="s">&#39;cloudant&#39;</span><span class="p">,</span> user <span class="o">=</span> <span class="s">&#39;&lt;user name&gt;&#39;</span><span class="p">,</span> pwd <span class="o">=</span> <span class="s">&#39;&lt;password&gt;&#39;</span><span class="p">,</span> type <span class="o">=</span> <span class="s">&quot;cloudant&quot;</span><span class="p">)</span>
</code></pre></div>
<p>By default there is a built-in <code>cushion</code> for localhost so you don&#39;t have to do that, unless you want to change those details, e.g., the port number. Right now cushions aren&#39;t preserved across R sessions, but working on that.</p>

<p>For example, I&#39;ll lay down a cushion for Cloudant, then I can call <code>cushions()</code> to see my cushions:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">cushion<span class="p">(</span>name <span class="o">=</span> <span class="s">&#39;cloudant&#39;</span><span class="p">,</span> user <span class="o">=</span> <span class="s">&#39;&lt;user name&gt;&#39;</span><span class="p">,</span> pwd <span class="o">=</span> <span class="s">&#39;&lt;pwd&gt;&#39;</span><span class="p">,</span> type <span class="o">=</span> <span class="s">&quot;cloudant&quot;</span><span class="p">)</span>
cushions<span class="p">()</span>
</code></pre></div>
<p>By default, if you don&#39;t provide a cushion name, you are using localhost.</p>

<h2>Ping the server</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r">ping<span class="p">()</span>
<span class="c1">#&gt; $couchdb</span>
<span class="c1">#&gt; [1] &quot;Welcome&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $uuid</span>
<span class="c1">#&gt; [1] &quot;2c10f0c6d9bd17205b692ae93cd4cf1d&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $version</span>
<span class="c1">#&gt; [1] &quot;1.6.0&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $vendor</span>
<span class="c1">#&gt; $vendor$version</span>
<span class="c1">#&gt; [1] &quot;1.6.0-1&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $vendor$name</span>
<span class="c1">#&gt; [1] &quot;Homebrew&quot;</span>
</code></pre></div>
<p>Nice, it&#39;s working.</p>

<h2>Create a new database, and list available databases</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r">db_create<span class="p">(</span>dbname<span class="o">=</span><span class="s">&#39;sofadb&#39;</span><span class="p">)</span>
<span class="c1">#&gt; $ok</span>
<span class="c1">#&gt; [1] TRUE</span>
</code></pre></div>
<p>see if its there now</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">db_list<span class="p">()</span>
<span class="c1">#&gt;  [1] &quot;_replicator&quot; &quot;_users&quot;      &quot;alm_couchdb&quot; &quot;cachecall&quot;   &quot;hello_earth&quot;</span>
<span class="c1">#&gt;  [6] &quot;leothelion&quot;  &quot;mran&quot;        &quot;mydb&quot;        &quot;newdbs&quot;      &quot;sofadb&quot;</span>
</code></pre></div>
<h2>Create documents</h2>

<p>Create a document WITH a name (uses PUT)</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">doc1 <span class="o">&lt;-</span> <span class="s">&#39;{&quot;name&quot;:&quot;sofa&quot;,&quot;beer&quot;:&quot;IPA&quot;}&#39;</span>
doc_create<span class="p">(</span>dbname<span class="o">=</span><span class="s">&quot;sofadb&quot;</span><span class="p">,</span> doc<span class="o">=</span>doc1<span class="p">,</span> docid<span class="o">=</span><span class="s">&quot;a_beer&quot;</span><span class="p">)</span>
<span class="c1">#&gt; $ok</span>
<span class="c1">#&gt; [1] TRUE</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $id</span>
<span class="c1">#&gt; [1] &quot;a_beer&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rev</span>
<span class="c1">#&gt; [1] &quot;1-a48c98c945bcc05d482bc6f938c89882&quot;</span>
</code></pre></div>
<p>Create a document WITHOUT a name (uses POST)</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">doc2 <span class="o">&lt;-</span> <span class="s">&#39;{&quot;name&quot;:&quot;sofa&quot;,&quot;icecream&quot;:&quot;rocky road&quot;}&#39;</span>
doc_create<span class="p">(</span>dbname<span class="o">=</span><span class="s">&quot;sofadb&quot;</span><span class="p">,</span> doc<span class="o">=</span>doc2<span class="p">)</span>
<span class="c1">#&gt; $ok</span>
<span class="c1">#&gt; [1] TRUE</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $id</span>
<span class="c1">#&gt; [1] &quot;c5c5c332c25cf62cc584647a81006f6d&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rev</span>
<span class="c1">#&gt; [1] &quot;1-fd0da7fcb8d3afbfc5757d065c92362c&quot;</span>
</code></pre></div>
<h2>List documents</h2>

<p>List them</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">alldocs<span class="p">(</span>dbname<span class="o">=</span><span class="s">&quot;sofadb&quot;</span><span class="p">)</span>
<span class="c1">#&gt;                                 id                              key</span>
<span class="c1">#&gt; 1                           a_beer                           a_beer</span>
<span class="c1">#&gt; 2 c5c5c332c25cf62cc584647a81006f6d c5c5c332c25cf62cc584647a81006f6d</span>
<span class="c1">#&gt;                                  rev</span>
<span class="c1">#&gt; 1 1-a48c98c945bcc05d482bc6f938c89882</span>
<span class="c1">#&gt; 2 1-fd0da7fcb8d3afbfc5757d065c92362c</span>
</code></pre></div>
<p>Optionally include the documents, returned as a list by default as it would be hard to parse an endless number of document formats. </p>
<div class="highlight"><pre><code class="language-r" data-lang="r">alldocs<span class="p">(</span>dbname<span class="o">=</span><span class="s">&quot;sofadb&quot;</span><span class="p">,</span> include_docs <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="c1">#&gt; $total_rows</span>
<span class="c1">#&gt; [1] 2</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $offset</span>
<span class="c1">#&gt; [1] 0</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows</span>
<span class="c1">#&gt; $rows[[1]]</span>
<span class="c1">#&gt; $rows[[1]]$id</span>
<span class="c1">#&gt; [1] &quot;a_beer&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[1]]$key</span>
<span class="c1">#&gt; [1] &quot;a_beer&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[1]]$value</span>
<span class="c1">#&gt; $rows[[1]]$value$rev</span>
<span class="c1">#&gt; [1] &quot;1-a48c98c945bcc05d482bc6f938c89882&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[1]]$doc</span>
<span class="c1">#&gt; $rows[[1]]$doc$`_id`</span>
<span class="c1">#&gt; [1] &quot;a_beer&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[1]]$doc$`_rev`</span>
<span class="c1">#&gt; [1] &quot;1-a48c98c945bcc05d482bc6f938c89882&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[1]]$doc$name</span>
<span class="c1">#&gt; [1] &quot;sofa&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[1]]$doc$beer</span>
<span class="c1">#&gt; [1] &quot;IPA&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[2]]</span>
<span class="c1">#&gt; $rows[[2]]$id</span>
<span class="c1">#&gt; [1] &quot;c5c5c332c25cf62cc584647a81006f6d&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[2]]$key</span>
<span class="c1">#&gt; [1] &quot;c5c5c332c25cf62cc584647a81006f6d&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[2]]$value</span>
<span class="c1">#&gt; $rows[[2]]$value$rev</span>
<span class="c1">#&gt; [1] &quot;1-fd0da7fcb8d3afbfc5757d065c92362c&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[2]]$doc</span>
<span class="c1">#&gt; $rows[[2]]$doc$`_id`</span>
<span class="c1">#&gt; [1] &quot;c5c5c332c25cf62cc584647a81006f6d&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[2]]$doc$`_rev`</span>
<span class="c1">#&gt; [1] &quot;1-fd0da7fcb8d3afbfc5757d065c92362c&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[2]]$doc$name</span>
<span class="c1">#&gt; [1] &quot;sofa&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rows[[2]]$doc$icecream</span>
<span class="c1">#&gt; [1] &quot;rocky road&quot;</span>
</code></pre></div>
<h2>Update a document</h2>

<p>Change <em>IPA</em> (india pale ale) to <em>IPL</em> (india pale lager). We need to get revisions first as we need to include revision number when we update a document.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="p">(</span>revs <span class="o">&lt;-</span> revisions<span class="p">(</span>dbname <span class="o">=</span> <span class="s">&quot;sofadb&quot;</span><span class="p">,</span> docid <span class="o">=</span> <span class="s">&quot;a_beer&quot;</span><span class="p">))</span>
<span class="c1">#&gt; [1] &quot;1-a48c98c945bcc05d482bc6f938c89882&quot;</span>
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r">newdoc <span class="o">&lt;-</span> <span class="s">&#39;{&quot;name&quot;:&quot;sofa&quot;,&quot;beer&quot;:&quot;IPL&quot;}&#39;</span>
doc_update<span class="p">(</span>dbname <span class="o">=</span> <span class="s">&quot;sofadb&quot;</span><span class="p">,</span> doc <span class="o">=</span> newdoc<span class="p">,</span> docid <span class="o">=</span> <span class="s">&quot;a_beer&quot;</span><span class="p">,</span> rev <span class="o">=</span> revs<span class="p">[</span><span class="m">1</span><span class="p">])</span>
<span class="c1">#&gt; $ok</span>
<span class="c1">#&gt; [1] TRUE</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $id</span>
<span class="c1">#&gt; [1] &quot;a_beer&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $rev</span>
<span class="c1">#&gt; [1] &quot;2-f2390eb18b8f9a870c915c6712a7f65e&quot;</span>
</code></pre></div>
<p>Should be two revisions now</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">revisions<span class="p">(</span>dbname <span class="o">=</span> <span class="s">&quot;sofadb&quot;</span><span class="p">,</span> docid <span class="o">=</span> <span class="s">&quot;a_beer&quot;</span><span class="p">)</span>
<span class="c1">#&gt; [1] &quot;2-f2390eb18b8f9a870c915c6712a7f65e&quot;</span>
<span class="c1">#&gt; [2] &quot;1-a48c98c945bcc05d482bc6f938c89882&quot;</span>
</code></pre></div>
<h2>Get headers for a document</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r">doc_head<span class="p">(</span>dbname <span class="o">=</span> <span class="s">&quot;sofadb&quot;</span><span class="p">,</span> docid <span class="o">=</span> <span class="s">&quot;a_beer&quot;</span><span class="p">)</span>
<span class="c1">#&gt; [[1]]</span>
<span class="c1">#&gt; [[1]]$status</span>
<span class="c1">#&gt; [1] 200</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$version</span>
<span class="c1">#&gt; [1] &quot;HTTP/1.1&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$headers</span>
<span class="c1">#&gt; $server</span>
<span class="c1">#&gt; [1] &quot;CouchDB/1.6.0 (Erlang OTP/17)&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $etag</span>
<span class="c1">#&gt; [1] &quot;\&quot;2-f2390eb18b8f9a870c915c6712a7f65e\&quot;&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $date</span>
<span class="c1">#&gt; [1] &quot;Tue, 18 Nov 2014 21:19:16 GMT&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`content-type`</span>
<span class="c1">#&gt; [1] &quot;application/json&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`content-length`</span>
<span class="c1">#&gt; [1] &quot;88&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`cache-control`</span>
<span class="c1">#&gt; [1] &quot;must-revalidate&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; attr(,&quot;class&quot;)</span>
<span class="c1">#&gt; [1] &quot;insensitive&quot; &quot;list&quot;</span>
</code></pre></div>
<h2>JSON vs. list</h2>

<p>Across all/most functions you can request json or list as output with the <code>as</code> parameter. </p>
<div class="highlight"><pre><code class="language-r" data-lang="r">db_list<span class="p">(</span>as <span class="o">=</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>
<span class="c1">#&gt;  [1] &quot;_replicator&quot; &quot;_users&quot;      &quot;alm_couchdb&quot; &quot;cachecall&quot;   &quot;hello_earth&quot;</span>
<span class="c1">#&gt;  [6] &quot;leothelion&quot;  &quot;mran&quot;        &quot;mydb&quot;        &quot;newdbs&quot;      &quot;sofadb&quot;</span>
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r">db_list<span class="p">(</span>as <span class="o">=</span> <span class="s">&quot;json&quot;</span><span class="p">)</span>
<span class="c1">#&gt; [1] &quot;[\&quot;_replicator\&quot;,\&quot;_users\&quot;,\&quot;alm_couchdb\&quot;,\&quot;cachecall\&quot;,\&quot;hello_earth\&quot;,\&quot;leothelion\&quot;,\&quot;mran\&quot;,\&quot;mydb\&quot;,\&quot;newdbs\&quot;,\&quot;sofadb\&quot;]\n&quot;</span>
</code></pre></div>
<h2>Curl options</h2>

<p>Across all functions you can pass in curl options. We&#39;re using <code>httr</code> internally, so you can use <code>httr</code> helper functions to make some curl options easier. Examples:</p>

<p>Verbose output</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span><span class="s">&quot;httr&quot;</span><span class="p">)</span>
db_list<span class="p">(</span>config<span class="o">=</span>verbose<span class="p">())</span>
<span class="c1">#&gt;  [1] &quot;_replicator&quot; &quot;_users&quot;      &quot;alm_couchdb&quot; &quot;cachecall&quot;   &quot;hello_earth&quot;</span>
<span class="c1">#&gt;  [6] &quot;leothelion&quot;  &quot;mran&quot;        &quot;mydb&quot;        &quot;newdbs&quot;      &quot;sofadb&quot;</span>
</code></pre></div>
<p>Progress</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">db_list<span class="p">(</span>config<span class="o">=</span>progress<span class="p">())</span>
<span class="c1">#&gt; </span>
  <span class="o">|</span>                                                                       
  <span class="o">|</span>                                                                 <span class="o">|</span>   <span class="m">0</span><span class="o">%</span>
<span class="o">  |                                                                       </span>
<span class="o">  |=================================================================| 100%</span>
<span class="c1">#&gt;  [1] &quot;_replicator&quot; &quot;_users&quot;      &quot;alm_couchdb&quot; &quot;cachecall&quot;   &quot;hello_earth&quot;</span>
<span class="c1">#&gt;  [6] &quot;leothelion&quot;  &quot;mran&quot;        &quot;mydb&quot;        &quot;newdbs&quot;      &quot;sofadb&quot;</span>
</code></pre></div>
<p>Set a timeout</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">db_list<span class="p">(</span>config<span class="o">=</span>timeout<span class="p">(</span>seconds <span class="o">=</span> <span class="m">0.001</span><span class="p">))</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; Error in function (type, msg, asError = TRUE)  : </span>
<span class="c1">#&gt;    Operation timed out after 3 milliseconds with 0 out of -1 bytes received</span>
</code></pre></div>
<h2>Full text search</h2>

<p>I&#39;m working on an R client for Elaticsearch called <code>elastic</code> - find it at <a href="https://github.com/ropensci/elastic">https://github.com/ropensci/elastic</a></p>

<p>Thinking about where to include functions to allow <code>elastic</code> and <code>sofa</code> to work together...if you have any thoughts hit up the issues. I&#39;ll probably include helper functions for CouchDB search in the <code>elastic</code> package, interfacing with the <a href="https://github.com/elasticsearch/elasticsearch-river-couchdb">CouchDB plugin for Elasticsearch</a>.</p>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2014/10/conditionality-meta-analysis/">
        Conditionality meta-analysis data
      </a>
    </h1>

    <span class="post-date">06 Oct 2014</span>

    <h2>The paper</h2>

<p>One paper from my graduate work asked most generally ~ &quot;How much does the variation in magnitudes and signs of species interaction outcomes vary?&quot;. More specifically, we wanted to know if variation differed among species interaction classes (mutualism, competition, predation), and among various &quot;gradients&quot; (space, time, etc.). To answer this question, we used a meta-analysis approach (rather than e.g., a field experiment). We <a href="http://scottchamberlain.info/publications/">published the paper</a> recently.</p>

<blockquote>
<p>p.s. I really really wish we would have put it in an open access journal...</p>
</blockquote>

<h2>The data</h2>

<p>Anyway, I&#39;m here to talk about the <strong>data</strong>. We didn&#39;t get the data up with the paper, but it is <a href="http://figshare.com/articles/Conditionality_data/1097657">up on Figshare</a> now. The files there are the following:</p>

<ul>
<li><code>coniditionality.R</code> - script used to process the data from <code>variables_prelim.csv</code></li>
<li><code>variables_prelim.csv</code> - description of variables in the preliminary data set, matches <code>conditionality_data_prelim.csv</code></li>
<li><code>variables_used.csv</code> - description of variables in the used data set, matches <code>conditionality_data_used.csv</code></li>
<li><code>conditionality_data_prelim.csv</code> - preliminary data, the raw data</li>
<li><code>conditionality_data_used.csv</code> - the data used for our paper</li>
<li><code>README.md</code> - the readme</li>
<li><code>paper_selection.csv</code> - the list of papers we went through, with remarks about paper selection</li>
</ul>

<p>Please do play with the data, publish some papers, etc, etc. It took 6 of us about 4 years to collect this data; we skimmed through ~11,000 papers on the first pass (aka. skimming through abstracts in Google Scholar and Web of Science), then decided on nearly 500 papers to get data from, and narrowed down to 247 papers for the publication mentioned above. Now, there was no funding for this, so it was sort of done in between other projects, but still, it was simply <strong>A LOT</strong> of tables to digitize, and graphs to extract data points from. <strong>Anyway</strong>, hopefully you will find this data useful :p</p>

<h2>EML</h2>

<p>I think this dataset would be a great introduction to the potential power of EML (<a href="https://knb.ecoinformatics.org/#external//emlparser/docs/index.html">Ecological Metadata Langauge</a>). At <a href="http://ropensci.org/">rOpenSci</a>, one of our team <a href="http://www.carlboettiger.info/">Carl Boettiger</a>, along with Claas-Thido Pfaff, Duncan Temple Lang, Karthik Ram, and Matt Jones, have created an R client for EML, to parse EML files and to create and publish them.</p>

<h2>What is EML?/Why EML?</h2>

<p>A demonstration is in order...</p>

<h2>Example using EML with this dataset</h2>

<h3>Install EML</h3>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span><span class="s">&quot;devtools&quot;</span><span class="p">)</span>
install.packages<span class="p">(</span><span class="s">&quot;RHTMLForms&quot;</span><span class="p">,</span> repos <span class="o">=</span> <span class="s">&quot;http://www.omegahat.org/R/&quot;</span><span class="p">,</span> type<span class="o">=</span><span class="s">&quot;source&quot;</span><span class="p">)</span>
install_github<span class="p">(</span><span class="s">&quot;ropensci/EML&quot;</span><span class="p">,</span> build<span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> dependencies<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;DEPENDS&quot;</span><span class="p">,</span> <span class="s">&quot;IMPORTS&quot;</span><span class="p">))</span>
</code></pre></div>
<p>Load <code>EML</code></p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span><span class="s">&#39;EML&#39;</span><span class="p">)</span>
</code></pre></div>
<h3>Prepare metadata</h3>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># dataset</span>
prelim_dat <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&quot;conditionality_data_prelim.csv&quot;</span><span class="p">)</span>
<span class="c1"># variable descriptions for each column</span>
prelim_vars <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&quot;variables_prelim.csv&quot;</span><span class="p">,</span> stringsAsFactors <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</code></pre></div>
<p>Get column definitions in a vector</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">col_defs <span class="o">&lt;-</span> prelim_vars<span class="o">$</span>description
</code></pre></div>
<p>Create unit definitions for each column</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">unit_defs <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>
  <span class="kt">c</span><span class="p">(</span>unit <span class="o">=</span> <span class="s">&quot;number&quot;</span><span class="p">,</span>
    bounds <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="kc">Inf</span><span class="p">)),</span>
  <span class="kt">c</span><span class="p">(</span>unit <span class="o">=</span> <span class="s">&quot;number&quot;</span><span class="p">,</span>
    bounds <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="kc">Inf</span><span class="p">)),</span>
  <span class="s">&quot;independent replicates&quot;</span><span class="p">,</span>
  <span class="kt">c</span><span class="p">(</span>unit <span class="o">=</span> <span class="s">&quot;number&quot;</span><span class="p">,</span>
    bounds <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="kc">Inf</span><span class="p">)),</span>

  <span class="kc">...</span> <span class="o">&lt;</span>CUTOFF<span class="o">&gt;</span>
<span class="p">)</span>
</code></pre></div>
<h3>Write an EML file</h3>
<div class="highlight"><pre><code class="language-r" data-lang="r">eml_write<span class="p">(</span>prelim_dat<span class="p">,</span>
          unit.defs <span class="o">=</span> unit_defs<span class="p">,</span>
          col.defs <span class="o">=</span> col_defs<span class="p">,</span>
          creator <span class="o">=</span> <span class="s">&quot;Scott Chamberlain&quot;</span><span class="p">,</span>
          contact <span class="o">=</span> <span class="s">&quot;myrmecocystus@gmail.com&quot;</span><span class="p">,</span>
          file <span class="o">=</span> <span class="s">&quot;conditionality_data_prelim_eml.xml&quot;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">## [1] &quot;conditionality_data_prelim_eml.xml&quot;
</code></pre></div>
<h3>Validate the EML file</h3>
<div class="highlight"><pre><code class="language-r" data-lang="r">eml_validate<span class="p">(</span><span class="s">&quot;conditionality_data_prelim_eml.xml&quot;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">## EML specific tests XML specific tests 
##               TRUE               TRUE
</code></pre></div>
<h3>Read data and metadata</h3>
<div class="highlight"><pre><code class="language-r" data-lang="r">gg <span class="o">&lt;-</span> eml_read<span class="p">(</span><span class="s">&quot;conditionality_data_prelim_eml.xml&quot;</span><span class="p">)</span>
eml_get<span class="p">(</span>gg<span class="p">,</span> <span class="s">&quot;contact&quot;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">## [1] &quot;myrmecocystus@gmail.com&quot;
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r">eml_get<span class="p">(</span>gg<span class="p">,</span> <span class="s">&quot;citation_info&quot;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">## Chamberlain S (2014-10-06). _metadata_.
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r">dat <span class="o">&lt;-</span> eml_get<span class="p">(</span>gg<span class="p">,</span> <span class="s">&quot;data.frame&quot;</span><span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>dat<span class="p">[,</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)])</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">##   order i indrep avg author_last  finit_1 finit_2 finit_abv co_author
## 1     1 1      a   1      Devall margaret       s        ms     Thein
## 2     2 1      a   2      Devall margaret       s        ms     Thein
## 3     3 1      a   3      Devall margaret       s        ms     Thein
## 4     4 1      a   4      Devall margaret       s        ms     Thein
## 5     5 1      a   5      Devall margaret       s        ms     Thein
## 6     6 1      a   6      Devall margaret       s        ms     Thein
##   sinit_1
## 1 leonard
## 2 leonard
## 3 leonard
## 4 leonard
## 5 leonard
## 6 leonard
</code></pre></div>
<h3>Publish</h3>

<p>We can also use the <code>EML</code> package to publish the data, here to <a href="http://figshare.com">Figshare</a>.</p>

<p>First, install <code>rfigshare</code></p>
<div class="highlight"><pre><code class="language-r" data-lang="r">install.packages<span class="p">(</span><span class="s">&quot;rfigshare&quot;</span><span class="p">)</span>
<span class="kn">library</span><span class="p">(</span><span class="s">&#39;rfigshare&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Then publish using <code>eml_publish()</code></p>
<div class="highlight"><pre><code class="language-r" data-lang="r">figid <span class="o">&lt;-</span> eml_publish<span class="p">(</span>
            file <span class="o">=</span> <span class="s">&quot;conditionality_data_prelim_eml.xml&quot;</span><span class="p">,</span>
            description <span class="o">=</span> <span class="s">&quot;EML file for Chamberlain, S.A., J.A. Rudgers, and J.L. Bronstein. 2014. How context-dependent are species interactions. Ecology Letters&quot;</span><span class="p">,</span>
            categories <span class="o">=</span> <span class="s">&quot;Ecology&quot;</span><span class="p">,</span>
            tags <span class="o">=</span> <span class="s">&quot;EML&quot;</span><span class="p">,</span>
            destination <span class="o">=</span> <span class="s">&quot;figshare&quot;</span><span class="p">,</span>
            visibility <span class="o">=</span> <span class="s">&quot;public&quot;</span><span class="p">,</span>
            title <span class="o">=</span> <span class="s">&quot;condionality data, EML&quot;</span><span class="p">)</span>
fs_make_public<span class="p">(</span>figid<span class="p">)</span>
</code></pre></div>
<p><img src="/public/img/2014-10-06-conditionality-meta-analysis/figshare_conditional.png" alt=""></p>

  </div>
  
</div>

<!-- Pagination links -->
<div class="pagination">
  
    <a href="/page9" class="older">Older</a>
  
  
    
      <a href="/page7" class="newer">Newer</a>
    
  
</div>

    </div>

    <!-- for bootstrap tooltips -->
    <script type="text/javascript">
      $("[data-toggle=\"tooltip\"]").tooltip();
    </script>

  </body>

  <footer>
  <!-- Disqus code -->
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'recology'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>

  <!-- Gaug.es Analytics -->
  <script type="text/javascript">
    var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', '4efd83a6f5a1f5158a000004');
      t.src = '//secure.gaug.es/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>
</footer>

</html>
