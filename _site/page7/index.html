<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    
    Recology, R/etc.
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <link rel="stylesheet" href="/public/css/bootstrap/css/bootstrap.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon.ico">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0f layout-reverse">

    <header class="masthead">
      <div class="masthead-inner">
        <h1>Recology</h1>
        <!-- <h1> <a href="http://recology.info/">Recology</a></h1> -->
        <p class="lead">R/etc.</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="/"><i class="fa fa-home fa-lg"></i></a>&nbsp;
              <a href="/about"><i class="fa fa-info-circle fa-lg"></i></a>&nbsp;
              <a href="/archives"><i class="fa fa-archive fa-lg"></i></a>&nbsp;
              <a href="/rresources"><i class="fa fa-book fa-lg"></i></a>&nbsp;
              <a href="http://rforcats.net/" rel><i class="fa fa-graduation-cap fa-lg"></i></a>&nbsp;
              <a href="/feed.xml"><i class="fa fa-rss fa-lg"></i></a>&nbsp;
              <a href="https://twitter.com/sckottie"><i class="fa fa-twitter fa-lg"></i></a>&nbsp;
              <a href="/fork"><i class="fa fa-spinner fa-lg"></i></a>
            </li>
          </ul>
          <!-- <small><a href="https://github.com/mdo/hyde">Hyde</a> from <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</small> -->
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="posts">
  <a style="float:right;" href="/archives" data-toggle="tooltip" data-placement="bottom" title="Archives"><i class="fa fa-archive fa-lg"></i></a>
  <a style="float:right;" href="/tags"><i class="fa fa-tags fa-lg"></i></a>&nbsp;
  
  <div class="post">
    <h1>
      <a href="/2015/06/rerddap/">
        rerddap - General purpose R client for ERDDAP servers
      </a>
    </h1>

    <span class="post-date">24 Jun 2015</span>

    <p><a href="http://upwell.pfeg.noaa.gov/erddap/information.html">ERDDAP</a> is a data server that gives you a simple, consistent way to download subsets of gridded and tabular scientific datasets in common file formats and make graphs and maps.  Besides it’s own <a href="http://upwell.pfeg.noaa.gov/erddap/rest.html">RESTful interface</a>, much of which is designed based on <a href="https://en.wikipedia.org/wiki/OPeNDAP">OPeNDAP</a>, ERDDAP can act as an OPeNDAP server and as a <a href="https://en.wikipedia.org/wiki/Web_Map_Service">WMS</a> server for gridded data.</p>

<p>ERDDAP is a powerful tool - in a world of heterogeneous data, it’s often hard to combine data and serve it through the same interface, with tools for querying/filtering/subsetting the data. That is exactly what ERDDAP does. Heterogeneous data sets often have some similarities, such as latitude/longitude data and usually a time component, but other variables vary widely.</p>

<h2 id="netcdf">NetCDF</h2>

<p><code class="highlighter-rouge">rerddap</code> supports <a href="https://en.wikipedia.org/wiki/NetCDF">NetCDF format</a>, and is the default when using the <code class="highlighter-rouge">griddap()</code> function. We use <code class="highlighter-rouge">ncdf</code> by default, but you can choose to use <code class="highlighter-rouge">ncdf4</code> instead.</p>

<h2 id="caching">Caching</h2>

<p>Data files downloaded are cached in a single hidden directory <code class="highlighter-rouge">~/.rerddap</code> on your machine. It’s hidden so that you don’t accidentally delete the data, but you can still easily delete the data if you like, open files, move them around, etc.</p>

<p>When you use <code class="highlighter-rouge">griddap()</code> or <code class="highlighter-rouge">tabledap()</code> functions, we construct a <a href="https://en.wikipedia.org/wiki/MD5#MD5_hashes">MD5 hash</a> from the base URL, and any query parameters - this way each query is separately cached. Once we have the hash, we look in <code class="highlighter-rouge">~/.rerddap</code> for a matching hash. If there’s a match we use that file on disk - if no match, we make a http request for the data to the ERDDAP server you specify.</p>

<h2 id="erddap-servers">ERDDAP servers</h2>

<p>You can get a data.frame of ERDDAP servers using the function <code class="highlighter-rouge">servers()</code>. Most I think serve some kind of NOAA data, but there are a few that aren’t NOAA data. Here are a few:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">servers</span><span class="p">())</span><span class="w">
</span><span class="c1">#&gt;                                                                                            name
#&gt; 1                                                         Marine Domain Awareness (MDA) - Italy
#&gt; 2                                                                    Marine Institute - Ireland
#&gt; 3                                                      CoastWatch Caribbean/Gulf of Mexico Node
#&gt; 4                                                                    CoastWatch West Coast Node
#&gt; 5                    NOAA IOOS CeNCOOS (Central and Northern California Ocean Observing System)
#&gt; 6 NOAA IOOS NERACOOS (Northeastern Regional Association of Coastal and Ocean Observing Systems)
#&gt;                                        url
#&gt; 1 https://bluehub.jrc.ec.europa.eu/erddap/
#&gt; 2          http://erddap.marine.ie/erddap/
#&gt; 3      http://cwcgom.aoml.noaa.gov/erddap/
#&gt; 4  http://coastwatch.pfeg.noaa.gov/erddap/
#&gt; 5    http://erddap.axiomalaska.com/erddap/
#&gt; 6          http://www.neracoos.org/erddap/
</span></code></pre>
</div>

<h2 id="install">Install</h2>

<p>From CRAN</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"rerddap"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Or development version from GitHub</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"ropensci/rerddap"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s1">'rerddap'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h2 id="search">Search</h2>

<p>First, you likely want to search for data, specifying whether to search for either <code class="highlighter-rouge">griddadp</code> or <code class="highlighter-rouge">tabledap</code> datasets. The default is <code class="highlighter-rouge">griddap</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ed_search</span><span class="p">(</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'size'</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"table"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 11 results, showing first 20 
#&gt;                                                                                         title
#&gt; 1                                                                          CalCOFI Fish Sizes
#&gt; 2                                                                        CalCOFI Larvae Sizes
#&gt; 3                Channel Islands, Kelp Forest Monitoring, Size and Frequency, Natural Habitat
#&gt; 4                                                         CalCOFI Larvae Counts Positive Tows
#&gt; 5                                                                                CalCOFI Tows
#&gt; 7                                                  OBIS - ARGOS Satellite Tracking of Animals
#&gt; 8                                                     GLOBEC NEP MOCNESS Plankton (MOC1) Data
#&gt; 9                                                 GLOBEC NEP Vertical Plankton Tow (VPT) Data
#&gt; 10                            NWFSC Observer Fixed Gear Data, off West Coast of US, 2002-2006
#&gt; 11                                 NWFSC Observer Trawl Data, off West Coast of US, 2002-2006
#&gt; 12 AN EXPERIMENTAL DATASET: Underway Sea Surface Temperature and Salinity Aboard the Oleander
#&gt;             dataset_id
#&gt; 1     erdCalCOFIfshsiz
#&gt; 2     erdCalCOFIlrvsiz
#&gt; 3       erdCinpKfmSFNH
#&gt; 4  erdCalCOFIlrvcntpos
#&gt; 5       erdCalCOFItows
#&gt; 7            aadcArgos
#&gt; 8        erdGlobecMoc1
#&gt; 9         erdGlobecVpt
#&gt; 10  nwioosObsFixed2002
#&gt; 11  nwioosObsTrawl2002
#&gt; 12            nodcPJJU
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ed_search</span><span class="p">(</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'size'</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grid"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; 6 results, showing first 20 
#&gt;                                                                                                   title
#&gt; 6                                                       NOAA Global Coral Bleaching Monitoring Products
#&gt; 13        USGS COAWST Forecast, US East Coast and Gulf of Mexico (Experimental) [time][eta_rho][xi_rho]
#&gt; 14            USGS COAWST Forecast, US East Coast and Gulf of Mexico (Experimental) [time][eta_u][xi_u]
#&gt; 15            USGS COAWST Forecast, US East Coast and Gulf of Mexico (Experimental) [time][eta_v][xi_v]
#&gt; 16 USGS COAWST Forecast, US East Coast and Gulf of Mexico (Experimental) [time][s_rho][eta_rho][xi_rho]
#&gt; 17  USGS COAWST Forecast, US East Coast and Gulf of Mexico (Experimental) [time][Nbed][eta_rho][xi_rho]
#&gt;             dataset_id
#&gt; 6             NOAA_DHW
#&gt; 13 whoi_ed12_89ce_9592
#&gt; 14 whoi_61c3_0b5d_cd61
#&gt; 15 whoi_62d0_9d64_c8ff
#&gt; 16 whoi_7dd7_db97_4bbe
#&gt; 17 whoi_a4fb_2c9c_16a7
</span></code></pre>
</div>

<p>This gives back dataset titles and identifiers - with which you should be able to get a sense for which dataset you may want to fetch.</p>

<h2 id="information">Information</h2>

<p>After searching you can get more information on a single dataset</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">info</span><span class="p">(</span><span class="s1">'whoi_62d0_9d64_c8ff'</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; &lt;ERDDAP info&gt; whoi_62d0_9d64_c8ff 
#&gt;  Dimensions (range):  
#&gt;      time: (2012-06-25T01:00:00Z, 2015-06-24T00:00:00Z) 
#&gt;      eta_v: (0, 334) 
#&gt;      xi_v: (0, 895) 
#&gt;  Variables:  
#&gt;      bedload_Vsand_01: 
#&gt;          Units: kilogram meter-1 s-1 
#&gt;      bedload_Vsand_02: 
#&gt;          Units: kilogram meter-1 s-1 
</span><span class="n">...</span><span class="w">
</span></code></pre>
</div>

<p>Which is a simple S3 list but prints out pretty, so it’s easy to quickly scan the printed output and see what you need to see to proceed. That is, in the next step you want to get the dataset, and you’ll want to specify your search using some combination of values for latitude, longitude, and time.</p>

<h2 id="griddap-gridded-data">griddap (gridded) data</h2>

<p>First, get information on a dataset to see time range, lat/long range, and variables.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">info</span><span class="p">(</span><span class="s1">'noaa_esrl_027d_0fb5_5d38'</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; &lt;ERDDAP info&gt; noaa_esrl_027d_0fb5_5d38 
#&gt;  Dimensions (range):  
#&gt;      time: (1850-01-01T00:00:00Z, 2014-05-01T00:00:00Z) 
#&gt;      latitude: (87.5, -87.5) 
#&gt;      longitude: (-177.5, 177.5) 
#&gt;  Variables:  
#&gt;      air: 
#&gt;          Range: -20.9, 19.5 
#&gt;          Units: degC
</span></code></pre>
</div>

<p>Then query for gridded data using the <code class="highlighter-rouge">griddap()</code> function</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">griddap</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w">
  </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'2012-01-01'</span><span class="p">,</span><span class="w"> </span><span class="s1">'2012-01-30'</span><span class="p">),</span><span class="w">
  </span><span class="n">latitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">),</span><span class="w">
  </span><span class="n">longitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-80</span><span class="p">,</span><span class="w"> </span><span class="m">-70</span><span class="p">)</span><span class="w">
</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; &lt;ERDDAP griddap&gt; noaa_esrl_027d_0fb5_5d38
#&gt;    Path: [~/.rerddap/648ed11e8b911b65e39eb63c8df339df.nc]
#&gt;    Last updated: [2015-05-09 08:31:10]
#&gt;    File size:    [0 mb]
#&gt;    Dimensions (dims/vars):   [3 X 1]
#&gt;    Dim names: time, latitude, longitude
#&gt;    Variable names: CRUTEM3: Surface Air Temperature Monthly Anomaly
#&gt;    data.frame (rows/columns):   [18 X 4]
#&gt;                    time latitude longitude  air
#&gt; 1  2012-01-01T00:00:00Z     22.5     -77.5   NA
#&gt; 2  2012-01-01T00:00:00Z     22.5     -77.5   NA
#&gt; 3  2012-01-01T00:00:00Z     22.5     -77.5   NA
#&gt; 4  2012-01-01T00:00:00Z     22.5     -77.5 -0.1
#&gt; 5  2012-01-01T00:00:00Z     22.5     -77.5   NA
#&gt; 6  2012-01-01T00:00:00Z     22.5     -77.5 -0.2
#&gt; 7  2012-01-01T00:00:00Z     17.5     -72.5  0.2
#&gt; 8  2012-01-01T00:00:00Z     17.5     -72.5   NA
#&gt; 9  2012-01-01T00:00:00Z     17.5     -72.5  0.3
#&gt; 10 2012-02-01T00:00:00Z     17.5     -72.5   NA
#&gt; ..                  ...      ...       ...  ...
</span></code></pre>
</div>

<p>The output of <code class="highlighter-rouge">griddap()</code> is a list that you can explore further. Get the summary</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res</span><span class="o">$</span><span class="n">summary</span><span class="w">
</span><span class="c1">#&gt; [1] "file ~/.rerddap/648ed11e8b911b65e39eb63c8df339df.nc has 3 dimensions:"
#&gt; [1] "time   Size: 2"
#&gt; [1] "latitude   Size: 3"
#&gt; [1] "longitude   Size: 3"
#&gt; [1] "------------------------"
#&gt; [1] "file ~/.rerddap/648ed11e8b911b65e39eb63c8df339df.nc has 1 variables:"
#&gt; [1] "float air[longitude,latitude,time]  Longname:CRUTEM3: Surface Air Temperature Monthly Anomaly Missval:-9.96920996838687e+36"
</span></code></pre>
</div>

<p>Or get the dimension variables (just the names of the variables for brevity here)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">summary</span><span class="o">$</span><span class="n">dim</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "time"      "latitude"  "longitude"
</span></code></pre>
</div>

<p>Get the data.frame (beware: you may want to just look at the <code class="highlighter-rouge">head</code> of the data.frame if large)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res</span><span class="o">$</span><span class="n">data</span><span class="w">
</span><span class="c1">#&gt;                    time latitude longitude   air
#&gt; 1  2012-01-01T00:00:00Z     22.5     -77.5    NA
#&gt; 2  2012-01-01T00:00:00Z     22.5     -77.5    NA
#&gt; 3  2012-01-01T00:00:00Z     22.5     -77.5    NA
#&gt; 4  2012-01-01T00:00:00Z     22.5     -77.5 -0.10
#&gt; 5  2012-01-01T00:00:00Z     22.5     -77.5    NA
#&gt; 6  2012-01-01T00:00:00Z     22.5     -77.5 -0.20
#&gt; 7  2012-01-01T00:00:00Z     17.5     -72.5  0.20
#&gt; 8  2012-01-01T00:00:00Z     17.5     -72.5    NA
#&gt; 9  2012-01-01T00:00:00Z     17.5     -72.5  0.30
#&gt; 10 2012-02-01T00:00:00Z     17.5     -72.5    NA
#&gt; 11 2012-02-01T00:00:00Z     17.5     -72.5    NA
#&gt; 12 2012-02-01T00:00:00Z     17.5     -72.5    NA
#&gt; 13 2012-02-01T00:00:00Z     12.5     -67.5  0.40
#&gt; 14 2012-02-01T00:00:00Z     12.5     -67.5    NA
#&gt; 15 2012-02-01T00:00:00Z     12.5     -67.5  0.20
#&gt; 16 2012-02-01T00:00:00Z     12.5     -67.5  0.00
#&gt; 17 2012-02-01T00:00:00Z     12.5     -67.5    NA
#&gt; 18 2012-02-01T00:00:00Z     12.5     -67.5  0.32
</span></code></pre>
</div>

<p>You can actually still explore the original netcdf summary object, e.g.,</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res</span><span class="o">$</span><span class="n">summary</span><span class="o">$</span><span class="n">dim</span><span class="o">$</span><span class="n">time</span><span class="w">
</span><span class="c1">#&gt; $name
#&gt; [1] "time"
#&gt; 
#&gt; $len
#&gt; [1] 2
#&gt; 
#&gt; $unlim
#&gt; [1] FALSE
#&gt; 
#&gt; $id
#&gt; [1] 1
#&gt; 
#&gt; $dimvarid
#&gt; [1] 1
#&gt; 
#&gt; $units
#&gt; [1] "seconds since 1970-01-01T00:00:00Z"
#&gt; 
#&gt; $vals
#&gt; [1] 1325376000 1328054400
#&gt; 
#&gt; $create_dimvar
#&gt; [1] TRUE
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "dim.ncdf"
</span></code></pre>
</div>

<h2 id="tabledap-tabular-data">tabledap (tabular) data</h2>

<p><code class="highlighter-rouge">tabledap</code> is data that is not gridded by lat/lon/time. In addition, the query interface is a bit different. Notice that you can do less than, more than, equal to type queries, but they are specified as character strings.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">info</span><span class="p">(</span><span class="s1">'erdCalCOFIfshsiz'</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; &lt;ERDDAP info&gt; erdCalCOFIfshsiz 
#&gt;  Variables:  
#&gt;      calcofi_species_code: 
#&gt;          Range: 19, 1550 
#&gt;      common_name: 
#&gt;      cruise: 
#&gt;      fish_1000m3: 
#&gt;          Units: Fish per 1,000 cubic meters of water sampled 
#&gt;      fish_count: 
#&gt;      fish_size: 
</span><span class="n">...</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tabledap</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="s1">'time&gt;=2001-07-07'</span><span class="p">,</span><span class="w"> </span><span class="s1">'time&lt;=2001-07-10'</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'longitude'</span><span class="p">,</span><span class="w"> </span><span class="s1">'latitude'</span><span class="p">,</span><span class="w"> </span><span class="s1">'fish_size'</span><span class="p">,</span><span class="w"> </span><span class="s1">'itis_tsn'</span><span class="p">,</span><span class="w"> </span><span class="s1">'scientific_name'</span><span class="p">)))</span><span class="w">
</span><span class="c1">#&gt; &lt;ERDDAP tabledap&gt; erdCalCOFIfshsiz
#&gt;    Path: [~/.rerddap/f013f9ee09bdb4184928d533e575e948.csv]
#&gt;    Last updated: [2015-05-09 08:31:21]
#&gt;    File size:    [0.03 mb]
#&gt;    Dimensions:   [558 X 5]
#&gt; 
#&gt;     longitude  latitude fish_size itis_tsn       scientific_name
#&gt; 2     -118.26    33.255      22.9   623745 Nannobrachium ritteri
#&gt; 3     -118.26    33.255      22.9   623745 Nannobrachium ritteri
#&gt; 4  -118.10667 32.738335      31.5   623625  Lipolagus ochotensis
#&gt; 5  -118.10667 32.738335      48.3   623625  Lipolagus ochotensis
#&gt; 6  -118.10667 32.738335      15.5   162221 Argyropelecus sladeni
#&gt; 7  -118.10667 32.738335      16.3   162221 Argyropelecus sladeni
#&gt; 8  -118.10667 32.738335      17.8   162221 Argyropelecus sladeni
#&gt; 9  -118.10667 32.738335      18.2   162221 Argyropelecus sladeni
#&gt; 10 -118.10667 32.738335      19.2   162221 Argyropelecus sladeni
#&gt; 11 -118.10667 32.738335      20.0   162221 Argyropelecus sladeni
#&gt; ..        ...       ...       ...      ...                   ...
</span></code></pre>
</div>

<p>Since both <code class="highlighter-rouge">griddap()</code> and <code class="highlighter-rouge">tabledap()</code> give back data.frame’s, it’s easy to do downstream manipulation. For example, we can use <code class="highlighter-rouge">dplyr</code> to filter, summarize, group, and sort:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"dplyr"</span><span class="p">)</span><span class="w">
</span><span class="n">dat</span><span class="o">$</span><span class="n">fish_size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">fish_size</span><span class="p">)</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tbl_df</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">fish_size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">30</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">scientific_name</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">mean_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">fish_size</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">mean_size</span><span class="p">))</span><span class="w">
</span><span class="n">df</span><span class="w">
</span><span class="c1">#&gt; Source: local data frame [20 x 2]
#&gt; 
#&gt;                 scientific_name mean_size
#&gt; 1       Idiacanthus antrostomus 253.00000
#&gt; 2            Stomias atriventer 189.25000
#&gt; 3            Lestidiops ringens  98.70000
#&gt; 4     Tarletonbeania crenularis  56.50000
#&gt; 5      Ceratoscopelus townsendi  53.70000
#&gt; 6     Stenobrachius leucopsarus  47.74538
#&gt; 7               Sardinops sagax  47.00000
#&gt; 8         Nannobrachium ritteri  43.30250
#&gt; 9         Bathylagoides wesethi  43.09167
#&gt; 10         Vinciguerria lucetia  42.00000
#&gt; 11       Cyclothone acclinidens  40.80000
#&gt; 12         Lipolagus ochotensis  39.72500
#&gt; 13        Leuroglossus stilbius  38.35385
#&gt; 14        Triphoturus mexicanus  38.21342
#&gt; 15                Diaphus theta  37.88571
#&gt; 16       Trachipterus altivelis  37.70000
#&gt; 17 Symbolophorus californiensis  37.66000
#&gt; 18         Nannobrachium regale  37.50000
#&gt; 19         Merluccius productus  36.61333
#&gt; 20        Argyropelecus sladeni  32.43333
</span></code></pre>
</div>

<p>Then make a cute little plot</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">reorder</span><span class="p">(</span><span class="n">scientific_name</span><span class="p">,</span><span class="w"> </span><span class="n">mean_size</span><span class="p">),</span><span class="w"> </span><span class="n">mean_size</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">theme_grey</span><span class="p">(</span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Mean Size"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Species"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/public/img/2015-06-24-rerddap/unnamed-chunk-19-1.png" alt="plot of chunk unnamed-chunk-19" /></p>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2015/06/idigbio-in-spocc/">
        iDigBio - a new data source in spocc
      </a>
    </h1>

    <span class="post-date">08 Jun 2015</span>

    <p><a href="https://www.idigbio.org/">iDigBio</a>, or <em>Integrated Digitized Biocollections</em>, collects and provides access to species occurrence data, and associated metadata (e.g., images of specimens, when provided). They collect data from <a href="https://www.idigbio.org/portal/publishers">a lot of different providers</a>. They have a nice web interface for searching, check out <a href="https://www.idigbio.org/portal/search">idigbio.org/portal/search</a>.</p>

<p><code class="highlighter-rouge">spocc</code> is a package we’ve been working on at <a href="http://ropensci.org/">rOpenSci</a> for a while now - it is a one stop shop for retrieving species ocurrence data. As new sources of species occurrence data come to our attention, and are available via a RESTful API, we incorporate them into <code class="highlighter-rouge">spocc</code>.</p>

<p>I attended last week a <a href="https://github.com/idigbio-api-hackathon/HackathonCentral/">hackathon put on by iDigBio</a>. One of the projects I worked on was integrating iDigBio into <code class="highlighter-rouge">spocc</code>.</p>

<p>With the addition of iDigBio, we now have in <code class="highlighter-rouge">spocc</code>:</p>

<ul>
  <li><a href="http://www.gbif.org/">GBIF</a></li>
  <li><a href="http://www.inaturalist.org/">iNaturalist</a></li>
  <li><a href="http://bison.usgs.ornl.gov/">USGS Bison</a></li>
  <li><a href="http://ebird.org/content/ebird/">eBird</a></li>
  <li><a href="https://ecoengine.berkeley.edu/">Ecoengine</a></li>
  <li><a href="http://vertnet.org/">Vertnet</a></li>
  <li><a href="https://www.idigbio.org/">iDigBio</a></li>
</ul>

<p>The following is a quick demo of getting iDigBio data in <code class="highlighter-rouge">spocc</code></p>

<h2 id="install">Install</h2>

<p>Get updated versions of <code class="highlighter-rouge">rgbif</code> and <code class="highlighter-rouge">ridigbio</code> first. And get <code class="highlighter-rouge">leaflet</code> to make an interactive map.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"ropensci/rgbif"</span><span class="p">,</span><span class="w"> </span><span class="s2">"iDigBio/ridigbio"</span><span class="p">,</span><span class="w"> </span><span class="s2">"rstudio/leaflet"</span><span class="p">)</span><span class="w">
</span><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"ropensci/spocc"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"spocc"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h2 id="use-ridigbio---the-r-client-for-idigbio">Use ridigbio - the R client for iDigBio</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"ridigbio"</span><span class="p">)</span><span class="w">
</span><span class="n">idig_search_records</span><span class="p">(</span><span class="n">rq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">genus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"acer"</span><span class="p">),</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;                                   uuid
#&gt; 1 00041678-5df1-4a23-ba78-8c12f60af369
#&gt; 2 00072caf-0f24-447f-b68e-a20299f6afc7
#&gt; 3 000a6b9b-0bbd-46f6-82cb-848c30c46313
#&gt; 4 001d05e0-9c86-466d-957d-e73e2ce64fbe
#&gt; 5 0022a2da-bc97-4bef-b2a5-b8a9944fc677
#&gt;                                    occurrenceid catalognumber      family
#&gt; 1 urn:uuid:b275f928-5c0d-4832-ae82-fde363d8fde1          &lt;NA&gt; sapindaceae
#&gt; 2          40428b90-27a5-11e3-8d47-005056be0003   lsu00049997   aceraceae
#&gt; 3          02ca5aae-d8ab-492f-af10-e005b96c2295        191243 sapindaceae
#&gt; 4                     urn:catalog:cas:ds:679715      ds679715 sapindaceae
#&gt; 5          b12bd651-2c6b-11e3-b3b8-180373cac83e         41898 sapindaceae
#&gt;   genus  scientificname       country stateprovince geopoint.lat
#&gt; 1  acer     acer rubrum united states      illinois         &lt;NA&gt;
#&gt; 2  acer    acer negundo united states     louisiana         &lt;NA&gt;
#&gt; 3  acer            &lt;NA&gt; united states      new york         &lt;NA&gt;
#&gt; 4  acer acer circinatum united states    california      41.8714
#&gt; 5  acer     acer rubrum united states      maryland   39.4197222
#&gt;   geopoint.lon             datecollected           collector
#&gt; 1         &lt;NA&gt; 1967-06-25T00:00:00+00:00     john e. ebinger
#&gt; 2         &lt;NA&gt; 1991-04-19T00:00:00+00:00     alan w. lievens
#&gt; 3         &lt;NA&gt;                      &lt;NA&gt; stephen f. hilfiker
#&gt; 4    -123.8503 1930-10-27T00:00:00+00:00        carl b. wolf
#&gt; 5  -77.1227778 1980-04-29T00:00:00+00:00         doweary, d.
</span></code></pre>
</div>

<h2 id="use-spocc">Use spocc</h2>

<h3 id="scientific-name-search">Scientific name search</h3>

<p>Same search as above with <code class="highlighter-rouge">ridigbio</code></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">occ</span><span class="p">(</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Acer"</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"idigbio"</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Searched: idigbio
#&gt; Occurrences - Found: 379, Returned: 5
#&gt; Search type: Scientific
#&gt;   idigbio: Acer (5)
</span></code></pre>
</div>

<h3 id="geographic-search">Geographic search</h3>

<p>iDigBio uses Elasticsearch syntax to define a geographic search, but all you need to do is give a numeric vector of length 4 defining a bounding box, and you’re good to go.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">bounds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-120</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">-100</span><span class="p">,</span><span class="w"> </span><span class="m">45</span><span class="p">)</span><span class="w">
</span><span class="n">occ</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"idigbio"</span><span class="p">,</span><span class="w"> </span><span class="n">geometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bounds</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Searched: idigbio
#&gt; Occurrences - Found: 346,737, Returned: 10
#&gt; Search type: Geometry
</span></code></pre>
</div>

<h3 id="w-or-wo-coordinates">W/ or W/O Coordinates</h3>

<p>Don’t pass <code class="highlighter-rouge">has_coords</code> (gives data w/ and w/o coordinates data)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">occ</span><span class="p">(</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Acer"</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"idigbio"</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Searched: idigbio
#&gt; Occurrences - Found: 379, Returned: 5
#&gt; Search type: Scientific
#&gt;   idigbio: Acer (5)
</span></code></pre>
</div>

<p>Only records with coordinates data</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">occ</span><span class="p">(</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Acer"</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"idigbio"</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">has_coords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Searched: idigbio
#&gt; Occurrences - Found: 16, Returned: 5
#&gt; Search type: Scientific
#&gt;   idigbio: Acer (5)
</span></code></pre>
</div>

<p>Only records without coordinates data</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">occ</span><span class="p">(</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Acer"</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"idigbio"</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">has_coords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Searched: idigbio
#&gt; Occurrences - Found: 363, Returned: 5
#&gt; Search type: Scientific
#&gt;   idigbio: Acer (5)
</span></code></pre>
</div>

<h3 id="make-an-interactive-map">Make an interactive map</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"leaflet"</span><span class="p">)</span><span class="w">
</span><span class="n">bounds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-120</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">-100</span><span class="p">,</span><span class="w"> </span><span class="m">45</span><span class="p">)</span><span class="w">
</span><span class="n">leaflet</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dat</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">addTiles</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addMarkers</span><span class="p">(</span><span class="o">~</span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="o">~</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">addRectangles</span><span class="p">(</span><span class="w">
    </span><span class="n">lng1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bounds</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">lat1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bounds</span><span class="p">[</span><span class="m">4</span><span class="p">],</span><span class="w">
    </span><span class="n">lng2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bounds</span><span class="p">[</span><span class="m">3</span><span class="p">],</span><span class="w"> </span><span class="n">lat2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bounds</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="w">
    </span><span class="n">fillColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"transparent"</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/public/img/2015-06-08-idigbio-in-spocc/plot.png" alt="image" /></p>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2015/05/openadds/">
        openadds - open addresses client
      </a>
    </h1>

    <span class="post-date">18 May 2015</span>

    <p><code class="highlighter-rouge">openadds</code> talks to <a href="http://openaddresses.io/">Openaddresses.io</a>. a run down of its things:</p>

<h2 id="install">Install</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"sckott/openadds"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"openadds"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h2 id="list-datasets">List datasets</h2>

<p>Scrapes links to datasets from the openaddresses site</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_list</span><span class="p">()</span><span class="w">
</span><span class="n">dat</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">6</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] "http://data.openaddresses.io.s3.amazonaws.com/20150511/au-tas-launceston.csv"   
#&gt; [2] "http://s3.amazonaws.com/data.openaddresses.io/20141127/au-victoria.zip"         
#&gt; [3] "http://data.openaddresses.io.s3.amazonaws.com/20150511/be-flanders.zip"         
#&gt; [4] "http://data.openaddresses.io.s3.amazonaws.com/20150417/ca-ab-calgary.zip"       
#&gt; [5] "http://data.openaddresses.io.s3.amazonaws.com/20150511/ca-ab-grande_prairie.zip"
</span></code></pre>
</div>

<h2 id="search-for-datasets">Search for datasets</h2>

<p>Uses <code class="highlighter-rouge">oa_list()</code> internally, then searches through columns requested.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">oa_search</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"us"</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ca"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Source: local data frame [68 x 5]
#&gt; 
#&gt;    country state             city  ext
#&gt; 1       us    ca san_mateo_county .zip
#&gt; 2       us    ca   alameda_county .zip
#&gt; 3       us    ca   alameda_county .zip
#&gt; 4       us    ca           amador .zip
#&gt; 5       us    ca           amador .zip
#&gt; 6       us    ca      bakersfield .zip
#&gt; 7       us    ca      bakersfield .zip
#&gt; 8       us    ca         berkeley .zip
#&gt; 9       us    ca         berkeley .zip
#&gt; 10      us    ca     butte_county .zip
#&gt; ..     ...   ...              ...  ...
#&gt; Variables not shown: url (chr)
</span></code></pre>
</div>

<h2 id="get-data">Get data</h2>

<p>Passing in a URL</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">out1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_get</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="m">5</span><span class="p">]))</span><span class="w">
</span><span class="c1">#&gt; &lt;Openaddresses data&gt; ~/.openadds/ca-ab-calgary.zip
#&gt; Dimensions [350962, 13]
#&gt; 
#&gt;    OBJECTID ADDRESS_TY                 ADDRESS    STREET_NAM STREET_TYP
#&gt; 0    757023     Parcel  249 SAGE MEADOWS CI NW  SAGE MEADOWS         CI
#&gt; 1    757022     Parcel           2506 17 ST SE            17         ST
#&gt; 2    757021     Parcel     305 EVANSPARK GD NW     EVANSPARK         GD
#&gt; 3    757020     Parcel     321 EVANSPARK GD NW     EVANSPARK         GD
#&gt; 4    757019     Parcel   204 EVANSBROOKE LD NW   EVANSBROOKE         LD
#&gt; 5    757018     Parcel   200 EVANSBROOKE LD NW   EVANSBROOKE         LD
#&gt; 6    757017     Parcel 219 HIDDEN VALLEY LD NW HIDDEN VALLEY         LD
#&gt; 7    757016     Parcel 211 HIDDEN VALLEY LD NW HIDDEN VALLEY         LD
#&gt; 8    757015     Parcel 364 HIDDEN VALLEY LD NW HIDDEN VALLEY         LD
#&gt; 9    757014     Parcel 348 HIDDEN VALLEY LD NW HIDDEN VALLEY         LD
#&gt; ..      ...        ...                     ...           ...        ...
#&gt; Variables not shown: STREET_QUA (fctr), HOUSE_NUMB (int), HOUSE_ALPH
#&gt;      (fctr), SUITE_NUMB (int), SUITE_ALPH (fctr), LONGITUDE (dbl),
#&gt;      LATITUDE (dbl), COMM_NAME (fctr)
</span></code></pre>
</div>

<p>First getting URL for dataset through <code class="highlighter-rouge">as_openadd()</code>, then passing to <code class="highlighter-rouge">oa_get()</code></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as_openadd</span><span class="p">(</span><span class="s2">"us"</span><span class="p">,</span><span class="w"> </span><span class="s2">"nm"</span><span class="p">,</span><span class="w"> </span><span class="s2">"hidalgo"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; &lt;&lt;OpenAddreses&gt;&gt; 
#&gt;   &lt;&lt;country&gt;&gt; us
#&gt;   &lt;&lt;state&gt;&gt; nm
#&gt;   &lt;&lt;city&gt;&gt; hidalgo
#&gt;   &lt;&lt;extension&gt;&gt; .csv
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">oa_get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; &lt;Openaddresses data&gt; ~/.openadds/us-nm-hidalgo.csv
#&gt; Dimensions [170659, 37]
#&gt; 
#&gt;    OBJECTID Shape ADD_NUM ADD_SUF PRE_MOD PRE_DIR PRE_TYPE         ST_NAME
#&gt; 1         1    NA     422                       S                      2ND
#&gt; 2         2    NA    1413                       S                      4TH
#&gt; 3         3    NA     412                       E                 CHAMPION
#&gt; 4         4    NA     110                       E                   SAMANO
#&gt; 5         5    NA    2608                       W          FREDDY GONZALEZ
#&gt; 6         6    NA    2604                       W          FREDDY GONZALEZ
#&gt; 7         7    NA    1123                       W                      FAY
#&gt; 8         8    NA     417                       S                      2ND
#&gt; 9         9    NA    4551                       E                    TEXAS
#&gt; 10       10    NA     810                                        DRIFTWOOD
#&gt; ..      ...   ...     ...     ...     ...     ...      ...             ...
#&gt; Variables not shown: ST_TYPE (chr), POS_DIR (chr), POS_MOD (chr), ESN
#&gt;      (int), MSAG_COMM (chr), PARCEL_ID (chr), PLACE_TYPE (chr), LANDMARK
#&gt;      (chr), BUILDING (chr), UNIT (chr), ROOM (chr), FLOOR (int), LOC_NOTES
#&gt;      (chr), ST_ALIAS (chr), FULL_ADDR (chr), ZIP (chr), POSTAL_COM (chr),
#&gt;      MUNICIPAL (chr), COUNTY (chr), STATE (chr), SOURCE (chr), REGION
#&gt;      (chr), EXCH (chr), LAT (dbl), LONG (dbl), PICTURE (chr), OA:x (dbl),
#&gt;      OA:y (dbl), OA:geom (chr)
</span></code></pre>
</div>

<h2 id="combine-multiple-datasets">Combine multiple datasets</h2>

<p><code class="highlighter-rouge">combine</code> attemps to guess lat/long and address columns, but definitely more work to do to make 
this work for most cases. Lat/long and address columns vary among every dataset - some datasets
have no lat/long data, some have no address data.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">out2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_get</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="m">32</span><span class="p">])</span><span class="w">
</span><span class="p">(</span><span class="n">alldat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_combine</span><span class="p">(</span><span class="n">out1</span><span class="p">,</span><span class="w"> </span><span class="n">out2</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; Source: local data frame [418,623 x 4]
#&gt; 
#&gt;          lon      lat                 address           dataset
#&gt; 1  -114.1303 51.17188  249 SAGE MEADOWS CI NW ca-ab-calgary.zip
#&gt; 2  -114.0190 51.03168           2506 17 ST SE ca-ab-calgary.zip
#&gt; 3  -114.1175 51.17497     305 EVANSPARK GD NW ca-ab-calgary.zip
#&gt; 4  -114.1175 51.17461     321 EVANSPARK GD NW ca-ab-calgary.zip
#&gt; 5  -114.1212 51.16268   204 EVANSBROOKE LD NW ca-ab-calgary.zip
#&gt; 6  -114.1213 51.16264   200 EVANSBROOKE LD NW ca-ab-calgary.zip
#&gt; 7  -114.1107 51.14784 219 HIDDEN VALLEY LD NW ca-ab-calgary.zip
#&gt; 8  -114.1108 51.14768 211 HIDDEN VALLEY LD NW ca-ab-calgary.zip
#&gt; 9  -114.1121 51.14780 364 HIDDEN VALLEY LD NW ca-ab-calgary.zip
#&gt; 10 -114.1117 51.14800 348 HIDDEN VALLEY LD NW ca-ab-calgary.zip
#&gt; ..       ...      ...                     ...               ...
</span></code></pre>
</div>

<h2 id="map-data">Map data</h2>

<p>Get some data</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_get</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="m">400</span><span class="p">]))</span><span class="w">
</span><span class="c1">#&gt; &lt;Openaddresses data&gt; ~/.openadds/us-ca-sonoma_county.zip
#&gt; Dimensions [217243, 5]
#&gt; 
#&gt;          LON      LAT  NUMBER          STREET POSTCODE
#&gt; 1  -122.5327 38.29779 3771  A       Cory Lane       NA
#&gt; 2  -122.5422 38.30354   18752 White Oak Drive       NA
#&gt; 3  -122.5412 38.30327   18749 White Oak Drive       NA
#&gt; 4  -122.3997 38.26122    3552       Napa Road       NA
#&gt; 5  -122.5425 38.30404    3998 White Oak Court       NA
#&gt; 6  -122.5429 38.30434    4026 White Oak Court       NA
#&gt; 7  -122.5430 38.30505    4039 White Oak Court       NA
#&gt; 8  -122.5417 38.30504    4017 White Oak Court       NA
#&gt; 9  -122.5409 38.30436   18702 White Oak Drive       NA
#&gt; 10 -122.5403 38.30392   18684 White Oak Drive       NA
#&gt; ..       ...      ...     ...             ...      ...
</span></code></pre>
</div>

<p>Make an interactive map (not all data)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"leaflet"</span><span class="p">)</span><span class="w">

</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_get</span><span class="p">(</span><span class="n">oa_search</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"us"</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"boulder"</span><span class="p">)[</span><span class="m">1</span><span class="p">,]</span><span class="o">$</span><span class="n">url</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_get</span><span class="p">(</span><span class="n">oa_search</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"us"</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gunnison"</span><span class="p">)[</span><span class="m">1</span><span class="p">,]</span><span class="o">$</span><span class="n">url</span><span class="p">)</span><span class="w">
</span><span class="n">oa_combine</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addTiles</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addCircles</span><span class="p">(</span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">lng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/public/img/2015-05-18-openadds/map.png" alt="image" /></p>

<h2 id="to-do">To do</h2>

<ul>
  <li>Surely there are many datasets that won’t work in <code class="highlighter-rouge">oa_combine()</code> - gotta go through many more.</li>
  <li>An easy viz function wrapping <code class="highlighter-rouge">leaflet</code></li>
  <li>Since you can get a lot of spatial data quickly, easy way to visualize big data, maybe marker clusters?</li>
</ul>

  </div>
  
</div>

<!-- Pagination links -->
<div class="pagination">
  
    <a href="/page8" class="older">Older</a>
  
  
    
      <a href="/page6" class="newer">Newer</a>
    
  
</div>

    </div>

    <!-- for bootstrap tooltips -->
    <script type="text/javascript">
      $("[data-toggle=\"tooltip\"]").tooltip();
    </script>

  </body>

  <footer>
  <!-- Disqus code -->
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'recology'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>

  <!-- google analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-63197374-1', 'auto');
    ga('send', 'pageview');
  </script>
</footer>

</html>
