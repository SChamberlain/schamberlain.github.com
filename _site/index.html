<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    
    Recology, R/etc.
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <link rel="stylesheet" href="/public/css/bootstrap/css/bootstrap.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon.ico">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0f layout-reverse">

    <header class="masthead">
      <div class="masthead-inner">
        <h1>Recology</h1>
        <!-- <h1> <a href="http://recology.info/">Recology</a></h1> -->
        <p class="lead">R/etc.</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="/"><i class="fa fa-home fa-lg"></i></a>&nbsp;
              <a href="/about"><i class="fa fa-info-circle fa-lg"></i></a>&nbsp;
              <a href="/archives"><i class="fa fa-archive fa-lg"></i></a>&nbsp;
              <a href="/rresources"><i class="fa fa-book fa-lg"></i></a>&nbsp;
              <a href="http://rforcats.net/" rel><i class="fa fa-graduation-cap fa-lg"></i></a>&nbsp;
              <a href="/feed.xml"><i class="fa fa-rss fa-lg"></i></a>&nbsp;
              <a href="https://twitter.com/sckottie"><i class="fa fa-twitter fa-lg"></i></a>&nbsp;
              <a href="/fork"><i class="fa fa-spinner fa-lg"></i></a>
            </li>
          </ul>
          <!-- <small><a href="https://github.com/mdo/hyde">Hyde</a> from <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</small> -->
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="posts">
  <a style="float:right;" href="/archives" data-toggle="tooltip" data-placement="bottom" title="Archives"><i class="fa fa-archive fa-lg"></i></a>
  <a style="float:right;" href="/tags"><i class="fa fa-tags fa-lg"></i></a>&nbsp;
  
  <div class="post">
    <h1>
      <a href="/2016/03/scrubr/">
        scrubr - clean species occurrence records
      </a>
    </h1>

    <span class="post-date">04 Mar 2016</span>

    <p><code>scrubr</code> is an R library for cleaning species occurrence records. It&#39;s general purpose, and has the following approach:</p>

<ul>
<li>We think using a piping workflow (<code>%&gt;%</code>) makes code easier to build up, and easier to understand. However, you don&#39;t have to use pipes in this package.</li>
<li>All inputs and outputs are data.frame&#39;s - which makes the above point easier</li>
<li>Records trimmed off due to various filters are retained as attributes, so can still be accessed for later inspection, but don&#39;t get in the way of the data.frame that gets modified for downstream use</li>
<li>User interface vs. speed: This is the kind of package that surely can get faster. However, we&#39;re focusing on the UI first, then make speed improvements down the road. </li>
<li>Since occurrence record datasets should all have columns with lat/long information, we automatically look for those columns for you. If identified, we use them, but you can supply lat/long column names manually as well.</li>
</ul>

<p>We have many packages that fetch species occurrence records from GBIF, iNaturalist, VertNet, iDigBio, Ecoengine, and more. <code>scrubr</code> fills a crucial missing niche as likely all uses of occurrence data requires cleaning of some kind. When using GBIF data via <code>rgbif</code>, that package has some utilities for cleaning data based on the issues returned with GBIF data - <code>scrubr</code> is a companion to do the rest of the cleaning.</p>

<h2>scrubr use cases</h2>

<h3>Those covered</h3>

<ul>
<li>Impossible lat/long values: e.g., latitude 75</li>
<li>Incomplete cases: one or the other of lat/long missing</li>
<li>Unlikely lat/long values: e.g., points at 0,0</li>
<li>Deduplication: try to identify duplicates, esp. when pulling data from multiple sources, e.g., can try to use occurrence IDs, if provided</li>
<li>Date based cleaning</li>
<li>Outside political boundary: User input to check for points in the wrong country, or points outside of a known country</li>
<li>Taxonomic name based cleaning: via <code>taxize</code> (one method so far)</li>
</ul>

<h3>To be covered</h3>

<ul>
<li>Political centroids: unlikely that occurrences fall exactly on these points, more likely a
default position (Draft function started, but not exported, and commented out)</li>
<li>Herbaria/Museums: many specimens may have location of the collection they are housed in</li>
<li>Habitat type filtering: e.g., fish should not be on land; marine fish should not be in fresh water</li>
<li>Check for contextually wrong values: That is, if 99 out of 100 lat/long coordinates are within the continental US, but 1 is in China, then perhaps something is wrong with that one point</li>
<li>and many more...</li>
</ul>

<p>What else do you want included? <a href="https://github.com/ropenscilabs/scrubr/issues">Open an issue in the repo</a> to chat about use cases.</p>

<h2>Install</h2>

<p>From CRAN (binaries may not be up yet, but source is)</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">install.packages<span class="p">(</span><span class="s">&quot;scrubr&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Or from GitHub</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">devtools<span class="o">::</span>install_github<span class="p">(</span><span class="s">&quot;ropenscilabs/scrubr&quot;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span><span class="s">&quot;scrubr&quot;</span><span class="p">)</span>
</code></pre></div>
<h2>dframe</h2>

<p><code>dframe()</code> is a tool to convert your data.frame to a compact <code>dplyr</code> like data.frame so that you can get a quick peek at your data each time you call a function - BUT, you don&#39;t have to use it.</p>

<p>Compare <code>mtcars</code></p>
<div class="highlight"><pre><code class="language-r" data-lang="r">mtcars
<span class="c1">#&gt;                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="c1">#&gt; Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4</span>
<span class="c1">#&gt; Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4</span>
<span class="c1">#&gt; Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="c1">#&gt; Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="c1">#&gt; Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="c1">#&gt; Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="c1">#&gt; Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4</span>
<span class="c1">#&gt; Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2</span>
<span class="c1">#&gt; Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2</span>
<span class="c1">#&gt; Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4</span>
<span class="c1">#&gt; Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4</span>
<span class="c1">#&gt; Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3</span>
<span class="c1">#&gt; Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3</span>
<span class="c1">#&gt; Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3</span>
<span class="c1">#&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4</span>
<span class="c1">#&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4</span>
<span class="c1">#&gt; Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4</span>
<span class="c1">#&gt; Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1</span>
<span class="c1">#&gt; Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2</span>
<span class="c1">#&gt; Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1</span>
<span class="c1">#&gt; Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1</span>
<span class="c1">#&gt; Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2</span>
<span class="c1">#&gt; AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2</span>
<span class="c1">#&gt; Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4</span>
<span class="c1">#&gt; Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2</span>
<span class="c1">#&gt; Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1</span>
<span class="c1">#&gt; Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2</span>
<span class="c1">#&gt; Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2</span>
<span class="c1">#&gt; Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4</span>
<span class="c1">#&gt; Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</span>
<span class="c1">#&gt; Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8</span>
<span class="c1">#&gt; Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</span>
</code></pre></div>
<p>To</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">dframe<span class="p">(</span>mtcars<span class="p">)</span>
<span class="c1">#&gt; &lt;scrubr dframe&gt;</span>
<span class="c1">#&gt; Size: 32 X 11</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt;      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span>
<span class="c1">#&gt;    (dbl) (dbl) (dbl) (dbl) (dbl) (dbl) (dbl) (dbl) (dbl) (dbl) (dbl)</span>
<span class="c1">#&gt; 1   21.0     6 160.0   110  3.90 2.620 16.46     0     1     4     4</span>
<span class="c1">#&gt; 2   21.0     6 160.0   110  3.90 2.875 17.02     0     1     4     4</span>
<span class="c1">#&gt; 3   22.8     4 108.0    93  3.85 2.320 18.61     1     1     4     1</span>
<span class="c1">#&gt; 4   21.4     6 258.0   110  3.08 3.215 19.44     1     0     3     1</span>
<span class="c1">#&gt; 5   18.7     8 360.0   175  3.15 3.440 17.02     0     0     3     2</span>
<span class="c1">#&gt; 6   18.1     6 225.0   105  2.76 3.460 20.22     1     0     3     1</span>
<span class="c1">#&gt; 7   14.3     8 360.0   245  3.21 3.570 15.84     0     0     3     4</span>
<span class="c1">#&gt; 8   24.4     4 146.7    62  3.69 3.190 20.00     1     0     4     2</span>
<span class="c1">#&gt; 9   22.8     4 140.8    95  3.92 3.150 22.90     1     0     4     2</span>
<span class="c1">#&gt; 10  19.2     6 167.6   123  3.92 3.440 18.30     1     0     4     4</span>
<span class="c1">#&gt; ..   ...   ...   ...   ...   ...   ...   ...   ...   ...   ...   ...</span>
</code></pre></div>
<h2>Coordinate based cleaning</h2>

<p>Load some sample data that comes with the package</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">data<span class="p">(</span><span class="s">&quot;sampledata1&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Remove impossible coordinates (using sample data included in the pkg)</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">dframe<span class="p">(</span>sample_data_1<span class="p">)</span> <span class="o">%&gt;%</span> coord_impossible<span class="p">()</span>
<span class="c1">#&gt; &lt;scrubr dframe&gt;</span>
<span class="c1">#&gt; Size: 1500 X 5</span>
<span class="c1">#&gt; Lat/Lon vars: latitude/longitude</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt;                name  longitude latitude                date        key</span>
<span class="c1">#&gt;               (chr)      (dbl)    (dbl)              (time)      (int)</span>
<span class="c1">#&gt; 1  Ursus americanus  -79.68283 38.36662 2015-01-14 16:36:45 1065590124</span>
<span class="c1">#&gt; 2  Ursus americanus  -82.42028 35.73304 2015-01-13 00:25:39 1065588899</span>
<span class="c1">#&gt; 3  Ursus americanus  -99.09625 23.66893 2015-02-20 23:00:00 1098894889</span>
<span class="c1">#&gt; 4  Ursus americanus  -72.77432 43.94883 2015-02-13 16:16:41 1065611122</span>
<span class="c1">#&gt; 5  Ursus americanus  -72.34617 43.86464 2015-03-01 20:20:45 1088908315</span>
<span class="c1">#&gt; 6  Ursus americanus -108.53674 32.65219 2015-03-29 17:06:54 1088932238</span>
<span class="c1">#&gt; 7  Ursus americanus -108.53691 32.65237 2015-03-29 17:12:50 1088932273</span>
<span class="c1">#&gt; 8  Ursus americanus -123.82900 40.13240 2015-03-28 23:00:00 1132403409</span>
<span class="c1">#&gt; 9  Ursus americanus  -78.25027 36.93018 2015-03-20 21:11:24 1088923534</span>
<span class="c1">#&gt; 10 Ursus americanus  -76.78671 35.53079 2015-04-05 23:00:00 1088954559</span>
<span class="c1">#&gt; ..              ...        ...      ...                 ...        ...</span>
</code></pre></div>
<p>Remove incomplete coordinates</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">dframe<span class="p">(</span>sample_data_1<span class="p">)</span> <span class="o">%&gt;%</span> coord_incomplete<span class="p">()</span>
<span class="c1">#&gt; &lt;scrubr dframe&gt;</span>
<span class="c1">#&gt; Size: 1306 X 5</span>
<span class="c1">#&gt; Lat/Lon vars: latitude/longitude</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt;                name  longitude latitude                date        key</span>
<span class="c1">#&gt;               (chr)      (dbl)    (dbl)              (time)      (int)</span>
<span class="c1">#&gt; 1  Ursus americanus  -79.68283 38.36662 2015-01-14 16:36:45 1065590124</span>
<span class="c1">#&gt; 2  Ursus americanus  -82.42028 35.73304 2015-01-13 00:25:39 1065588899</span>
<span class="c1">#&gt; 3  Ursus americanus  -99.09625 23.66893 2015-02-20 23:00:00 1098894889</span>
<span class="c1">#&gt; 4  Ursus americanus  -72.77432 43.94883 2015-02-13 16:16:41 1065611122</span>
<span class="c1">#&gt; 5  Ursus americanus  -72.34617 43.86464 2015-03-01 20:20:45 1088908315</span>
<span class="c1">#&gt; 6  Ursus americanus -108.53674 32.65219 2015-03-29 17:06:54 1088932238</span>
<span class="c1">#&gt; 7  Ursus americanus -108.53691 32.65237 2015-03-29 17:12:50 1088932273</span>
<span class="c1">#&gt; 8  Ursus americanus -123.82900 40.13240 2015-03-28 23:00:00 1132403409</span>
<span class="c1">#&gt; 9  Ursus americanus  -78.25027 36.93018 2015-03-20 21:11:24 1088923534</span>
<span class="c1">#&gt; 10 Ursus americanus  -76.78671 35.53079 2015-04-05 23:00:00 1088954559</span>
<span class="c1">#&gt; ..              ...        ...      ...                 ...        ...</span>
</code></pre></div>
<p>Remove unlikely coordinates (e.g., those at 0,0)</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">dframe<span class="p">(</span>sample_data_1<span class="p">)</span> <span class="o">%&gt;%</span> coord_unlikely<span class="p">()</span>
<span class="c1">#&gt; &lt;scrubr dframe&gt;</span>
<span class="c1">#&gt; Size: 1488 X 5</span>
<span class="c1">#&gt; Lat/Lon vars: latitude/longitude</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt;                name  longitude latitude                date        key</span>
<span class="c1">#&gt;               (chr)      (dbl)    (dbl)              (time)      (int)</span>
<span class="c1">#&gt; 1  Ursus americanus  -79.68283 38.36662 2015-01-14 16:36:45 1065590124</span>
<span class="c1">#&gt; 2  Ursus americanus  -82.42028 35.73304 2015-01-13 00:25:39 1065588899</span>
<span class="c1">#&gt; 3  Ursus americanus  -99.09625 23.66893 2015-02-20 23:00:00 1098894889</span>
<span class="c1">#&gt; 4  Ursus americanus  -72.77432 43.94883 2015-02-13 16:16:41 1065611122</span>
<span class="c1">#&gt; 5  Ursus americanus  -72.34617 43.86464 2015-03-01 20:20:45 1088908315</span>
<span class="c1">#&gt; 6  Ursus americanus -108.53674 32.65219 2015-03-29 17:06:54 1088932238</span>
<span class="c1">#&gt; 7  Ursus americanus -108.53691 32.65237 2015-03-29 17:12:50 1088932273</span>
<span class="c1">#&gt; 8  Ursus americanus -123.82900 40.13240 2015-03-28 23:00:00 1132403409</span>
<span class="c1">#&gt; 9  Ursus americanus  -78.25027 36.93018 2015-03-20 21:11:24 1088923534</span>
<span class="c1">#&gt; 10 Ursus americanus  -76.78671 35.53079 2015-04-05 23:00:00 1088954559</span>
<span class="c1">#&gt; ..              ...        ...      ...                 ...        ...</span>
</code></pre></div>
<p>Do all three</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">dframe<span class="p">(</span>sample_data_1<span class="p">)</span> <span class="o">%&gt;%</span>
  coord_impossible<span class="p">()</span> <span class="o">%&gt;%</span>
  coord_incomplete<span class="p">()</span> <span class="o">%&gt;%</span>
  coord_unlikely<span class="p">()</span>
<span class="c1">#&gt; &lt;scrubr dframe&gt;</span>
<span class="c1">#&gt; Size: 1294 X 5</span>
<span class="c1">#&gt; Lat/Lon vars: latitude/longitude</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt;                name  longitude latitude                date        key</span>
<span class="c1">#&gt;               (chr)      (dbl)    (dbl)              (time)      (int)</span>
<span class="c1">#&gt; 1  Ursus americanus  -79.68283 38.36662 2015-01-14 16:36:45 1065590124</span>
<span class="c1">#&gt; 2  Ursus americanus  -82.42028 35.73304 2015-01-13 00:25:39 1065588899</span>
<span class="c1">#&gt; 3  Ursus americanus  -99.09625 23.66893 2015-02-20 23:00:00 1098894889</span>
<span class="c1">#&gt; 4  Ursus americanus  -72.77432 43.94883 2015-02-13 16:16:41 1065611122</span>
<span class="c1">#&gt; 5  Ursus americanus  -72.34617 43.86464 2015-03-01 20:20:45 1088908315</span>
<span class="c1">#&gt; 6  Ursus americanus -108.53674 32.65219 2015-03-29 17:06:54 1088932238</span>
<span class="c1">#&gt; 7  Ursus americanus -108.53691 32.65237 2015-03-29 17:12:50 1088932273</span>
<span class="c1">#&gt; 8  Ursus americanus -123.82900 40.13240 2015-03-28 23:00:00 1132403409</span>
<span class="c1">#&gt; 9  Ursus americanus  -78.25027 36.93018 2015-03-20 21:11:24 1088923534</span>
<span class="c1">#&gt; 10 Ursus americanus  -76.78671 35.53079 2015-04-05 23:00:00 1088954559</span>
<span class="c1">#&gt; ..              ...        ...      ...                 ...        ...</span>
</code></pre></div>
<p>Do vs. don&#39;t drop bad data</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># do</span>
dframe<span class="p">(</span>sample_data_1<span class="p">)</span> <span class="o">%&gt;%</span> coord_incomplete<span class="p">(</span>drop <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">NROW</span>
<span class="c1">#&gt; [1] 1306</span>
<span class="c1"># don&#39;t</span>
dframe<span class="p">(</span>sample_data_1<span class="p">)</span> <span class="o">%&gt;%</span> coord_incomplete<span class="p">(</span>drop <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="kp">NROW</span>
<span class="c1">#&gt; [1] 1500</span>
</code></pre></div>
<h2>Deduplicate</h2>

<p>Get a smaller subset of a data.frame</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">smalldf <span class="o">&lt;-</span> sample_data_1<span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="p">,</span> <span class="p">]</span>
</code></pre></div>
<p>create a duplicate record</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">smalldf <span class="o">&lt;-</span> <span class="kp">rbind</span><span class="p">(</span>smalldf<span class="p">,</span> smalldf<span class="p">[</span><span class="m">10</span><span class="p">,])</span>
<span class="kp">row.names</span><span class="p">(</span>smalldf<span class="p">)</span> <span class="o">&lt;-</span> <span class="kc">NULL</span>
</code></pre></div>
<p>make it slightly different</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">smalldf<span class="p">[</span><span class="m">21</span><span class="p">,</span> <span class="s">&quot;key&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">1088954555</span>
<span class="kp">NROW</span><span class="p">(</span>smalldf<span class="p">)</span>
<span class="c1">#&gt; [1] 21</span>
</code></pre></div>
<p>It&#39;s 21 rows, including 1 duplicate. Do the deduplication</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="p">(</span>dp <span class="o">&lt;-</span> dframe<span class="p">(</span>smalldf<span class="p">)</span> <span class="o">%&gt;%</span> dedup<span class="p">())</span>
<span class="c1">#&gt; &lt;scrubr dframe&gt;</span>
<span class="c1">#&gt; Size: 20 X 5</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt;                name  longitude latitude                date        key</span>
<span class="c1">#&gt;               (chr)      (dbl)    (dbl)              (time)      (dbl)</span>
<span class="c1">#&gt; 1  Ursus americanus  -79.68283 38.36662 2015-01-14 16:36:45 1065590124</span>
<span class="c1">#&gt; 2  Ursus americanus  -82.42028 35.73304 2015-01-13 00:25:39 1065588899</span>
<span class="c1">#&gt; 3  Ursus americanus  -99.09625 23.66893 2015-02-20 23:00:00 1098894889</span>
<span class="c1">#&gt; 4  Ursus americanus  -72.77432 43.94883 2015-02-13 16:16:41 1065611122</span>
<span class="c1">#&gt; 5  Ursus americanus  -72.34617 43.86464 2015-03-01 20:20:45 1088908315</span>
<span class="c1">#&gt; 6  Ursus americanus -108.53674 32.65219 2015-03-29 17:06:54 1088932238</span>
<span class="c1">#&gt; 7  Ursus americanus -108.53691 32.65237 2015-03-29 17:12:50 1088932273</span>
<span class="c1">#&gt; 8  Ursus americanus -123.82900 40.13240 2015-03-28 23:00:00 1132403409</span>
<span class="c1">#&gt; 9  Ursus americanus  -78.25027 36.93018 2015-03-20 21:11:24 1088923534</span>
<span class="c1">#&gt; 10 Ursus americanus -103.30058 29.27042 2015-04-29 22:00:00 1088964797</span>
<span class="c1">#&gt; ..              ...        ...      ...                 ...        ...</span>
</code></pre></div>
<p>Now its 20 rows, duplicate removed</p>

<p>Here&#39;s the duplicates</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">attr</span><span class="p">(</span>dp<span class="p">,</span> <span class="s">&quot;dups&quot;</span><span class="p">)</span>
<span class="c1">#&gt; &lt;scrubr dframe&gt;</span>
<span class="c1">#&gt; Size: 1 X 5</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt;               name longitude latitude                date        key</span>
<span class="c1">#&gt;              (chr)     (dbl)    (dbl)              (time)      (dbl)</span>
<span class="c1">#&gt; 1 Ursus americanus -76.78671 35.53079 2015-04-05 23:00:00 1088954555</span>
</code></pre></div>
<h2>Dates</h2>

<p>Standardize/convert dates</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">df <span class="o">&lt;-</span> sample_data_1
dframe<span class="p">(</span>df<span class="p">)</span> <span class="o">%&gt;%</span> 
  date_standardize<span class="p">(</span><span class="s">&quot;%d%b%Y&quot;</span><span class="p">)</span>
<span class="c1">#&gt; &lt;scrubr dframe&gt;</span>
<span class="c1">#&gt; Size: 1500 X 5</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt;                name  longitude latitude      date        key</span>
<span class="c1">#&gt;               (chr)      (dbl)    (dbl)     (chr)      (int)</span>
<span class="c1">#&gt; 1  Ursus americanus  -79.68283 38.36662 14Jan2015 1065590124</span>
<span class="c1">#&gt; 2  Ursus americanus  -82.42028 35.73304 13Jan2015 1065588899</span>
<span class="c1">#&gt; 3  Ursus americanus  -99.09625 23.66893 20Feb2015 1098894889</span>
<span class="c1">#&gt; 4  Ursus americanus  -72.77432 43.94883 13Feb2015 1065611122</span>
<span class="c1">#&gt; 5  Ursus americanus  -72.34617 43.86464 01Mar2015 1088908315</span>
<span class="c1">#&gt; 6  Ursus americanus -108.53674 32.65219 29Mar2015 1088932238</span>
<span class="c1">#&gt; 7  Ursus americanus -108.53691 32.65237 29Mar2015 1088932273</span>
<span class="c1">#&gt; 8  Ursus americanus -123.82900 40.13240 28Mar2015 1132403409</span>
<span class="c1">#&gt; 9  Ursus americanus  -78.25027 36.93018 20Mar2015 1088923534</span>
<span class="c1">#&gt; 10 Ursus americanus  -76.78671 35.53079 05Apr2015 1088954559</span>
<span class="c1">#&gt; ..              ...        ...      ...       ...        ...</span>
</code></pre></div>
<p>Drop records without dates</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kp">NROW</span><span class="p">(</span>df<span class="p">)</span>
<span class="c1">#&gt; [1] 1500</span>
<span class="kp">NROW</span><span class="p">(</span>dframe<span class="p">(</span>df<span class="p">)</span> <span class="o">%&gt;%</span> date_missing<span class="p">())</span>
<span class="c1">#&gt; [1] 1498</span>
</code></pre></div>
<p>Create date field from other fields</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">dframe<span class="p">(</span>sample_data_2<span class="p">)</span> <span class="o">%&gt;%</span> 
  date_create<span class="p">(</span>year<span class="p">,</span> month<span class="p">,</span> day<span class="p">)</span>
<span class="c1">#&gt; &lt;scrubr dframe&gt;</span>
<span class="c1">#&gt; Size: 1500 X 8</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt;                name  longitude latitude        key  year month   day</span>
<span class="c1">#&gt;               (chr)      (dbl)    (dbl)      (int) (chr) (chr) (chr)</span>
<span class="c1">#&gt; 1  Ursus americanus  -79.68283 38.36662 1065590124  2015    01    14</span>
<span class="c1">#&gt; 2  Ursus americanus  -82.42028 35.73304 1065588899  2015    01    13</span>
<span class="c1">#&gt; 3  Ursus americanus  -99.09625 23.66893 1098894889  2015    02    20</span>
<span class="c1">#&gt; 4  Ursus americanus  -72.77432 43.94883 1065611122  2015    02    13</span>
<span class="c1">#&gt; 5  Ursus americanus  -72.34617 43.86464 1088908315  2015    03    01</span>
<span class="c1">#&gt; 6  Ursus americanus -108.53674 32.65219 1088932238  2015    03    29</span>
<span class="c1">#&gt; 7  Ursus americanus -108.53691 32.65237 1088932273  2015    03    29</span>
<span class="c1">#&gt; 8  Ursus americanus -123.82900 40.13240 1132403409  2015    03    28</span>
<span class="c1">#&gt; 9  Ursus americanus  -78.25027 36.93018 1088923534  2015    03    20</span>
<span class="c1">#&gt; 10 Ursus americanus  -76.78671 35.53079 1088954559  2015    04    05</span>
<span class="c1">#&gt; ..              ...        ...      ...        ...   ...   ...   ...</span>
<span class="c1">#&gt; Variables not shown: date (chr).</span>
</code></pre></div>
<h2>bugs and such</h2>

<p>Report them in the <a href="https://github.com/ropenscilabs/scrubr/issues">scrubr issue tracker</a></p>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2016/01/request-hello-world/">
        request - a high level HTTP client for R
      </a>
    </h1>

    <span class="post-date">05 Jan 2016</span>

    <p><code>request</code> is DSL for http requests for R, and is inspired by the CLI tool <a href="https://github.com/jakubroztocil/httpie">httpie</a>. It&#39;s built on <code>httr</code>.</p>

<p>The following were driving principles for this package:</p>

<ul>
<li>The web is increasingly a JSON world, so we assume <code>applications/json</code> by default, but give back other types if not</li>
<li>The workflow follows logically, or at least should, from, <em>hey, I got this url</em>, to <em>i need to add some options</em>, to <em>execute request</em> - and functions support piping so that you can execute functions in this order</li>
<li>Whenever possible, we transform output to data.frame&#39;s - facilitating downstream manipulation via <code>dplyr</code>, etc.</li>
<li>We do <code>GET</code> requests by default. Specify a different type if you don&#39;t want <code>GET</code>. Given <code>GET</code> by default, this client is optimized for consumption of data, rather than creating new things on servers</li>
<li>You can use non-standard evaluation to easily pass in query parameters without worrying about <code>&amp;</code>&#39;s, URL escaping, etc. (see <code>api_query()</code>)</li>
<li>Same for body params (see <code>api_body()</code>)</li>
</ul>

<p>The following is a brief demo of some of the package functionality:</p>

<h2>Install</h2>

<p>From CRAN</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">install.packages<span class="p">(</span><span class="s">&quot;request&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Or from GitHub</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">devtools<span class="o">::</span>install_github<span class="p">(</span><span class="s">&quot;sckott/request&quot;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span><span class="s">&quot;request&quot;</span><span class="p">)</span>
</code></pre></div>
<h2>Execute on last pipe</h2>

<p>When using pipes (<code>%&gt;%</code>) in <code>request</code>, we autodetect last piped command, and execute <code>http()</code> if it&#39;s the last. If not the last, the output gets passed to the next command, and so on. This feature (and <code>magrittr</code>) were done by Stefan Milton Bache.</p>

<p>This feature is really nice because a) it&#39;s one less thing you need to do, and b) you only need to care about the request itself.</p>

<p>You can escape auto-execution if you use the function <code>peep()</code>, which prints out a summary of the request you&#39;ve created, but does not execute an HTTP request.</p>

<h2>HTTP Requests</h2>

<p>A high level function <code>http()</code> wraps a lower level <code>R6</code> object <code>RequestIterator</code>, which holds a series of variables and functions to execute <code>GET</code> and <code>POST</code> requests, and will hold other HTTP verbs as well. In addition, it can hold state, which will allow us to do paging internally for you (see below). You have direct access to the <code>R6</code> object if you call <code>http_client()</code> instead of <code>http()</code>.</p>

<h2>NSE and SE</h2>

<p>Most if not all functions in <code>request</code> support non-standard evaluation (NSE) as well as standard evaluation (SE). If a function supports both, there&#39;s a version without an underscore for NSE, while a version with an underscore is for SE. For example, here, we make a HTTP request by passing a base URL, then a series of paths that get combined together. First the NSE version</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">api<span class="p">(</span><span class="s">&#39;https://api.github.com/&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  api_path<span class="p">(</span>repos<span class="p">,</span> ropensci<span class="p">,</span> rgbif<span class="p">,</span> issues<span class="p">)</span>
</code></pre></div>
<p>Then the SE version</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">api<span class="p">(</span><span class="s">&#39;https://api.github.com/&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  api_path_<span class="p">(</span><span class="s">&#39;repos&#39;</span><span class="p">,</span> <span class="s">&#39;ropensci&#39;</span><span class="p">,</span> <span class="s">&#39;rgbif&#39;</span><span class="p">,</span> <span class="s">&#39;issues&#39;</span><span class="p">)</span>
</code></pre></div>
<h2>Building API routes</h2>

<p>The first thing you&#39;ll want to do is lay out the base URL for your request. The function <code>api()</code> is your friend.</p>

<p><code>api()</code> works with full or partial URLs:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">api<span class="p">(</span><span class="s">&#39;https://api.github.com/&#39;</span><span class="p">)</span>
<span class="c1">#&gt; URL: https://api.github.com/</span>
api<span class="p">(</span><span class="s">&#39;http://api.gbif.org/v1&#39;</span><span class="p">)</span>
<span class="c1">#&gt; URL: http://api.gbif.org/v1</span>
api<span class="p">(</span><span class="s">&#39;api.gbif.org/v1&#39;</span><span class="p">)</span>
<span class="c1">#&gt; URL: api.gbif.org/v1</span>
</code></pre></div>
<p>And works with ports, full or partial</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">api<span class="p">(</span><span class="s">&#39;http://localhost:9200&#39;</span><span class="p">)</span>
<span class="c1">#&gt; URL: http://localhost:9200</span>
api<span class="p">(</span><span class="s">&#39;localhost:9200&#39;</span><span class="p">)</span>
<span class="c1">#&gt; URL: http://localhost:9200</span>
api<span class="p">(</span><span class="s">&#39;:9200&#39;</span><span class="p">)</span>
<span class="c1">#&gt; URL: http://localhost:9200</span>
api<span class="p">(</span><span class="s">&#39;9200&#39;</span><span class="p">)</span>
<span class="c1">#&gt; URL: http://localhost:9200</span>
api<span class="p">(</span><span class="s">&#39;9200/stuff&#39;</span><span class="p">)</span>
<span class="c1">#&gt; URL: http://localhost:9200/stuff</span>
</code></pre></div>
<h2>Make HTTP requests</h2>

<p>The above examples with <code>api()</code> are not passed through a pipe, so only define a URL, but don&#39;t do an HTTP request. To make an HTTP request, you can either pipe a url or partial url to e.g., <code>api()</code>, or call <code>http()</code> at the end of a string of function calls:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="s">&#39;https://api.github.com/&#39;</span> <span class="o">%&gt;%</span> api<span class="p">()</span>
<span class="c1">#&gt; $current_user_url</span>
<span class="c1">#&gt; [1] &quot;https://api.github.com/user&quot;</span>
<span class="c1">#&gt;</span>
<span class="c1">#&gt; $current_user_authorizations_html_url</span>
<span class="c1">#&gt; [1] &quot;https://github.com/settings/connections/applications{/client_id}&quot;</span>
<span class="c1">#&gt;</span>
<span class="c1">#&gt; $authorizations_url</span>
<span class="c1">#&gt; [1] &quot;https://api.github.com/authorizations&quot;</span>
<span class="c1">#&gt;</span>
<span class="c1">#&gt; $code_search_url</span>
<span class="kc">...</span>
</code></pre></div>
<p>Or</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">api<span class="p">(</span><span class="s">&#39;https://api.github.com/&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span> http<span class="p">()</span>
<span class="c1">#&gt; $current_user_url</span>
<span class="c1">#&gt; [1] &quot;https://api.github.com/user&quot;</span>
<span class="c1">#&gt;</span>
<span class="c1">#&gt; $current_user_authorizations_html_url</span>
<span class="c1">#&gt; [1] &quot;https://github.com/settings/connections/applications{/client_id}&quot;</span>
<span class="c1">#&gt;</span>
<span class="c1">#&gt; $authorizations_url</span>
<span class="c1">#&gt; [1] &quot;https://api.github.com/authorizations&quot;</span>
<span class="c1">#&gt;</span>
<span class="c1">#&gt; $code_search_url</span>
<span class="kc">...</span>
</code></pre></div>
<p><code>http()</code> is called at the end of a chain of piped commands, so no need to invoke it. However, you can if you like.</p>

<h2>Templating</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r">repo_info <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>username <span class="o">=</span> <span class="s">&#39;craigcitro&#39;</span><span class="p">,</span> repo <span class="o">=</span> <span class="s">&#39;r-travis&#39;</span><span class="p">)</span>
api<span class="p">(</span><span class="s">&#39;https://api.github.com/&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  api_template<span class="p">(</span>template <span class="o">=</span> <span class="s">&#39;repos///issues&#39;</span><span class="p">,</span> data <span class="o">=</span> repo_info<span class="p">)</span>
<span class="c1">#&gt; [[1]]</span>
<span class="c1">#&gt; [[1]]$url</span>
<span class="c1">#&gt; [1] &quot;https://api.github.com/repos/craigcitro/r-travis/issues/164&quot;</span>
<span class="c1">#&gt;</span>
<span class="c1">#&gt; [[1]]$labels_url</span>
<span class="c1">#&gt; [1] &quot;https://api.github.com/repos/craigcitro/r-travis/issues/164/labels{/name}&quot;</span>
<span class="c1">#&gt;</span>
<span class="c1">#&gt; [[1]]$comments_url</span>
<span class="c1">#&gt; [1] &quot;https://api.github.com/repos/craigcitro/r-travis/issues/164/comments&quot;</span>
<span class="c1">#&gt; ...</span>
</code></pre></div>
<h2>Set paths</h2>

<p><code>api_path()</code> adds paths to the base URL</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">api<span class="p">(</span><span class="s">&#39;https://api.github.com/&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  api_path<span class="p">(</span>repos<span class="p">,</span> ropensci<span class="p">,</span> rgbif<span class="p">,</span> issues<span class="p">)</span> <span class="o">%&gt;%</span>
  peep
<span class="c1">#&gt; &lt;http request&gt;</span>
<span class="c1">#&gt;   url: https://api.github.com/</span>
<span class="c1">#&gt;   paths: repos/ropensci/rgbif/issues</span>
<span class="c1">#&gt;   query:</span>
<span class="c1">#&gt;   body:</span>
<span class="c1">#&gt;   paging:</span>
<span class="c1">#&gt;   headers:</span>
<span class="c1">#&gt;   rate limit:</span>
<span class="c1">#&gt;   retry (n/delay (s)): /</span>
<span class="c1">#&gt;   error handler:</span>
<span class="c1">#&gt;   config:</span>
</code></pre></div>
<h2>Query</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r">api<span class="p">(</span><span class="s">&quot;http://api.plos.org/search&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  api_query<span class="p">(</span>q <span class="o">=</span> ecology<span class="p">,</span> wt <span class="o">=</span> json<span class="p">,</span> fl <span class="o">=</span> journal<span class="p">)</span> <span class="o">%&gt;%</span>
  peep
<span class="c1">#&gt; &lt;http request&gt;</span>
<span class="c1">#&gt;   url: http://api.plos.org/search</span>
<span class="c1">#&gt;   paths:</span>
<span class="c1">#&gt;   query: q=ecology, wt=json, fl=journal</span>
<span class="c1">#&gt;   body:</span>
<span class="c1">#&gt;   paging:</span>
<span class="c1">#&gt;   headers:</span>
<span class="c1">#&gt;   rate limit:</span>
<span class="c1">#&gt;   retry (n/delay (s)): /</span>
<span class="c1">#&gt;   error handler:</span>
<span class="c1">#&gt;   config:</span>
</code></pre></div>
<h2>Headers</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r">api<span class="p">(</span><span class="s">&#39;http://httpbin.org/headers&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  api_headers<span class="p">(</span><span class="sb">`X-FARGO-SEASON`</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="sb">`X-NARCOS-SEASON`</span> <span class="o">=</span> <span class="m">5</span><span class="p">)</span> <span class="o">%&gt;%</span>
  peep
<span class="c1">#&gt; &lt;http request&gt;</span>
<span class="c1">#&gt;   url: http://httpbin.org/headers</span>
<span class="c1">#&gt;   paths:</span>
<span class="c1">#&gt;   query:</span>
<span class="c1">#&gt;   body:</span>
<span class="c1">#&gt;   paging:</span>
<span class="c1">#&gt;   headers:</span>
<span class="c1">#&gt;     X-FARGO-SEASON: 3</span>
<span class="c1">#&gt;     X-NARCOS-SEASON: 5</span>
<span class="c1">#&gt;   rate limit:</span>
<span class="c1">#&gt;   retry (n/delay (s)): /</span>
<span class="c1">#&gt;   error handler:</span>
<span class="c1">#&gt;   config:</span>
</code></pre></div>
<h2>curl configuration</h2>

<p><code>httr</code> is exported in <code>request</code>, so you can use <code>httr</code> functions like <code>verbose()</code> to get verbose curl output</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">api<span class="p">(</span><span class="s">&#39;http://httpbin.org/headers&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  api_config<span class="p">(</span>verbose<span class="p">())</span>
<span class="c1">#&gt; -&gt; GET /headers HTTP/1.1</span>
<span class="c1">#&gt; -&gt; Host: httpbin.org</span>
<span class="c1">#&gt; -&gt; User-Agent: curl/7.43.0 curl/0.9.4 httr/1.0.0 request/0.1.0</span>
<span class="c1">#&gt; -&gt; Accept-Encoding: gzip, deflate</span>
<span class="c1">#&gt; -&gt; Accept: application/json, text/xml, application/xml, */*</span>
<span class="c1">#&gt; -&gt;</span>
<span class="c1">#&gt; &lt;- HTTP/1.1 200 OK</span>
<span class="c1">#&gt; &lt;- Server: nginx</span>
<span class="c1">#&gt; &lt;- Date: Sun, 03 Jan 2016 16:56:29 GMT</span>
<span class="c1">#&gt; &lt;- Content-Type: application/json</span>
<span class="c1">#&gt; &lt;- Content-Length: 227</span>
<span class="c1">#&gt; &lt;- Connection: keep-alive</span>
<span class="c1">#&gt; &lt;- Access-Control-Allow-Origin: *</span>
<span class="c1">#&gt; &lt;- Access-Control-Allow-Credentials: true</span>
<span class="c1">#&gt; &lt;-</span>
<span class="c1">#&gt; $headers</span>
<span class="c1">#&gt; $headers$Accept</span>
<span class="c1">#&gt; [1] &quot;application/json, text/xml, application/xml, */*&quot;</span>
<span class="c1">#&gt; ...</span>
</code></pre></div>
<h2>Coming soon</h2>

<p>There&#39;s a number of interesting features that should be coming soon to <code>request</code>.</p>

<ul>
<li>Paging - a paging helper will make it easy to do paing, and will attempt to handle any parameters used for paging. Some user input will be required, like what parameter names are, and how many records you want returned  <a href="https://github.com/sckott/request/issues/2">sckott/request#2</a></li>
<li>Retry - a retry helper will make it easy to retry http requests on any failure, and execute a user defined function on failure <a href="https://github.com/sckott/request/issues/6">sckott/request#6</a></li>
<li>Rate limit - a rate limit helper will add info to a set of many requests - still in early design stages <a href="https://github.com/sckott/request/issues/5">sckott/request#5</a></li>
<li>Caching - a caching helper - may use in the background the in development <a href="https://github.com/ropensci/vcr">vcr R client</a> when on CRAN or perhaps <a href="https://github.com/richfitz/storr">storr</a>  <a href="https://github.com/sckott/request/issues/4">sckott/request#4</a></li>
</ul>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2015/12/binomen-taxonomy-tools/">
        binomen - Tools for slicing and dicing taxonomic names
      </a>
    </h1>

    <span class="post-date">08 Dec 2015</span>

    <p>The first version of <code>binomen</code> is now up on <a href="https://cran.rstudio.com/web/packages/binomen">CRAN</a>. It provides various taxonomic classes for defining a single taxon, multiple taxa, and a taxonomic data.frame. It is designed as a companion to <a href="https://github.com/ropensci/taxize">taxize</a>, where you can get taxonomic data on taxonomic names from the web.</p>

<p>The classes (S3):</p>

<ul>
<li><code>taxon</code></li>
<li><code>taxonref</code></li>
<li><code>taxonrefs</code></li>
<li><code>binomial</code></li>
<li><code>grouping</code> (i.e., classification - used different term to avoid conflict with classification in <code>taxize</code>)</li>
</ul>

<p>For example, the <code>binomial</code> class is defined by a genus, epithet, authority, and optional full species name and canonical version.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">binomial<span class="p">(</span><span class="s">&quot;Poa&quot;</span><span class="p">,</span> <span class="s">&quot;annua&quot;</span><span class="p">,</span> authority<span class="o">=</span><span class="s">&quot;L.&quot;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">&lt;</span>binomial<span class="o">&gt;</span>
  genus<span class="o">:</span> Poa
  epithet<span class="o">:</span> annua
  canonical<span class="o">:</span>
  species<span class="o">:</span>
  authority<span class="o">:</span> L.
</code></pre></div>
<p>The package has a suite of functions to work on these taxonomic classes:</p>

<ul>
<li><code>gethier()</code> - get hierarchy from a <code>taxon</code> class</li>
<li><code>scatter()</code> - make each row in taxonomic data.frame (<code>taxondf</code>) a separate <code>taxon</code> object within a single <code>taxa</code> object</li>
<li><code>assemble()</code> - make a <code>taxa</code> object into a <code>taxondf</code> data.frame</li>
<li><code>pick()</code> - pick out one or more taxonomic groups</li>
<li><code>pop()</code> - pop out (drop) one or more taxonomic groups</li>
<li><code>span()</code> - pick a range between two taxonomic groups (inclusive)</li>
<li><code>strain()</code> - filter by taxonomic groups, like dplyr&#39;s filter</li>
<li><code>name()</code> - get the taxon name for each <code>taxonref</code> object</li>
<li><code>uri()</code> - get the reference uri for each <code>taxonref</code> object</li>
<li><code>rank()</code> - get the taxonomic rank for each <code>taxonref</code> object</li>
<li><code>id()</code> - get the reference uri for each <code>taxonref</code> object</li>
</ul>

<p>The approach in this package I suppose is sort of like <code>split-apply-combine</code> from <code>plyr</code>/<code>dplyr</code>, whereas this is aims to make it easy to do with taxonomic names.</p>

<h2>Install</h2>

<p>For examples below, you&#39;ll need the development version:</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">install.packages<span class="p">(</span><span class="s">&quot;binomen&quot;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span><span class="s">&quot;binomen&quot;</span><span class="p">)</span>
</code></pre></div>
<h2>Make a taxon</h2>

<p>Make a taxon object</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="p">(</span>obj <span class="o">&lt;-</span> make_taxon<span class="p">(</span>genus<span class="o">=</span><span class="s">&quot;Poa&quot;</span><span class="p">,</span> epithet<span class="o">=</span><span class="s">&quot;annua&quot;</span><span class="p">,</span> authority<span class="o">=</span><span class="s">&quot;L.&quot;</span><span class="p">,</span>
  family<span class="o">=</span><span class="s">&#39;Poaceae&#39;</span><span class="p">,</span> clazz<span class="o">=</span><span class="s">&#39;Poales&#39;</span><span class="p">,</span> kingdom<span class="o">=</span><span class="s">&#39;Plantae&#39;</span><span class="p">,</span> variety<span class="o">=</span><span class="s">&#39;annua&#39;</span><span class="p">))</span>
<span class="c1">#&gt; &lt;taxon&gt;</span>
<span class="c1">#&gt;   binomial: Poa annua</span>
<span class="c1">#&gt;   grouping: </span>
<span class="c1">#&gt;     kingdom: Plantae</span>
<span class="c1">#&gt;     clazz: Poales</span>
<span class="c1">#&gt;     family: Poaceae</span>
<span class="c1">#&gt;     genus: Poa</span>
<span class="c1">#&gt;     species: Poa annua</span>
<span class="c1">#&gt;     variety: annua</span>
</code></pre></div>
<p>Index to various parts of the object</p>

<p>The binomial</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">obj<span class="o">$</span>binomial
<span class="c1">#&gt; &lt;binomial&gt;</span>
<span class="c1">#&gt;   genus: Poa</span>
<span class="c1">#&gt;   epithet: annua</span>
<span class="c1">#&gt;   canonical: Poa annua</span>
<span class="c1">#&gt;   species: Poa annua L.</span>
<span class="c1">#&gt;   authority: L.</span>
</code></pre></div>
<p>The authority</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">obj<span class="o">$</span>binomial<span class="o">$</span>authority
<span class="c1">#&gt; [1] &quot;L.&quot;</span>
</code></pre></div>
<p>The classification</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">obj<span class="o">$</span>grouping
<span class="c1">#&gt; &lt;grouping&gt;</span>
<span class="c1">#&gt;   kingdom: Plantae</span>
<span class="c1">#&gt;   clazz: Poales</span>
<span class="c1">#&gt;   family: Poaceae</span>
<span class="c1">#&gt;   genus: Poa</span>
<span class="c1">#&gt;   species: Poa annua</span>
<span class="c1">#&gt;   variety: annua</span>
</code></pre></div>
<p>The family</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">obj<span class="o">$</span>grouping<span class="o">$</span>family
<span class="c1">#&gt; &lt;taxonref&gt;</span>
<span class="c1">#&gt;   rank: family</span>
<span class="c1">#&gt;   name: Poaceae</span>
<span class="c1">#&gt;   id: none</span>
<span class="c1">#&gt;   uri: none</span>
</code></pre></div>
<h2>Subset taxon objects</h2>

<p>Get one or more ranks via <code>pick()</code></p>
<div class="highlight"><pre><code class="language-r" data-lang="r">obj <span class="o">%&gt;%</span> pick<span class="p">(</span>family<span class="p">)</span>
<span class="c1">#&gt; &lt;taxon&gt;</span>
<span class="c1">#&gt;   binomial: Poa annua</span>
<span class="c1">#&gt;   grouping: </span>
<span class="c1">#&gt;     family: Poaceae</span>
obj <span class="o">%&gt;%</span> pick<span class="p">(</span>family<span class="p">,</span> genus<span class="p">)</span>
<span class="c1">#&gt; &lt;taxon&gt;</span>
<span class="c1">#&gt;   binomial: Poa annua</span>
<span class="c1">#&gt;   grouping: </span>
<span class="c1">#&gt;     family: Poaceae</span>
<span class="c1">#&gt;     genus: Poa</span>
</code></pre></div>
<p>Drop one or more ranks via <code>pop()</code></p>
<div class="highlight"><pre><code class="language-r" data-lang="r">obj <span class="o">%&gt;%</span> pop<span class="p">(</span>family<span class="p">)</span>
<span class="c1">#&gt; &lt;taxon&gt;</span>
<span class="c1">#&gt;   binomial: Poa annua</span>
<span class="c1">#&gt;   grouping: </span>
<span class="c1">#&gt;     kingdom: Plantae</span>
<span class="c1">#&gt;     clazz: Poales</span>
<span class="c1">#&gt;     genus: Poa</span>
<span class="c1">#&gt;     species: Poa annua</span>
<span class="c1">#&gt;     variety: annua</span>
obj <span class="o">%&gt;%</span> pop<span class="p">(</span>family<span class="p">,</span> genus<span class="p">)</span>
<span class="c1">#&gt; &lt;taxon&gt;</span>
<span class="c1">#&gt;   binomial: Poa annua</span>
<span class="c1">#&gt;   grouping: </span>
<span class="c1">#&gt;     kingdom: Plantae</span>
<span class="c1">#&gt;     clazz: Poales</span>
<span class="c1">#&gt;     species: Poa annua</span>
<span class="c1">#&gt;     variety: annua</span>
</code></pre></div>
<p>Get a range of ranks via <code>span()</code></p>
<div class="highlight"><pre><code class="language-r" data-lang="r">obj <span class="o">%&gt;%</span> span<span class="p">(</span>kingdom<span class="p">,</span> family<span class="p">)</span>
<span class="c1">#&gt; &lt;taxon&gt;</span>
<span class="c1">#&gt;   binomial: Poa annua</span>
<span class="c1">#&gt;   grouping: </span>
<span class="c1">#&gt;     kingdom: Plantae</span>
<span class="c1">#&gt;     clazz: Poales</span>
<span class="c1">#&gt;     family: Poaceae</span>
</code></pre></div>
<p>Extract classification as a <code>data.frame</code></p>
<div class="highlight"><pre><code class="language-r" data-lang="r">gethier<span class="p">(</span>obj<span class="p">)</span>
<span class="c1">#&gt;      rank      name</span>
<span class="c1">#&gt; 1 kingdom   Plantae</span>
<span class="c1">#&gt; 2   clazz    Poales</span>
<span class="c1">#&gt; 3  family   Poaceae</span>
<span class="c1">#&gt; 4   genus       Poa</span>
<span class="c1">#&gt; 5 species Poa annua</span>
<span class="c1">#&gt; 6 variety     annua</span>
</code></pre></div>
<h2>Taxonomic data.frame&#39;s</h2>

<p>Make one</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">df <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>order <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;Asterales&#39;</span><span class="p">,</span><span class="s">&#39;Asterales&#39;</span><span class="p">,</span><span class="s">&#39;Fagales&#39;</span><span class="p">,</span><span class="s">&#39;Poales&#39;</span><span class="p">,</span><span class="s">&#39;Poales&#39;</span><span class="p">,</span><span class="s">&#39;Poales&#39;</span><span class="p">),</span>
  family <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;Asteraceae&#39;</span><span class="p">,</span><span class="s">&#39;Asteraceae&#39;</span><span class="p">,</span><span class="s">&#39;Fagaceae&#39;</span><span class="p">,</span><span class="s">&#39;Poaceae&#39;</span><span class="p">,</span><span class="s">&#39;Poaceae&#39;</span><span class="p">,</span><span class="s">&#39;Poaceae&#39;</span><span class="p">),</span>
  genus <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;Helianthus&#39;</span><span class="p">,</span><span class="s">&#39;Helianthus&#39;</span><span class="p">,</span><span class="s">&#39;Quercus&#39;</span><span class="p">,</span><span class="s">&#39;Poa&#39;</span><span class="p">,</span><span class="s">&#39;Festuca&#39;</span><span class="p">,</span><span class="s">&#39;Holodiscus&#39;</span><span class="p">),</span>
  stringsAsFactors <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
<span class="p">(</span>df2 <span class="o">&lt;-</span> taxon_df<span class="p">(</span>df<span class="p">))</span>
<span class="c1">#&gt;       order     family      genus</span>
<span class="c1">#&gt; 1 Asterales Asteraceae Helianthus</span>
<span class="c1">#&gt; 2 Asterales Asteraceae Helianthus</span>
<span class="c1">#&gt; 3   Fagales   Fagaceae    Quercus</span>
<span class="c1">#&gt; 4    Poales    Poaceae        Poa</span>
<span class="c1">#&gt; 5    Poales    Poaceae    Festuca</span>
<span class="c1">#&gt; 6    Poales    Poaceae Holodiscus</span>
</code></pre></div>
<p>Parse - get rank order via <code>pick()</code></p>
<div class="highlight"><pre><code class="language-r" data-lang="r">df2 <span class="o">%&gt;%</span> pick<span class="p">(</span><span class="kp">order</span><span class="p">)</span>
<span class="c1">#&gt;       order</span>
<span class="c1">#&gt; 1 Asterales</span>
<span class="c1">#&gt; 2 Asterales</span>
<span class="c1">#&gt; 3   Fagales</span>
<span class="c1">#&gt; 4    Poales</span>
<span class="c1">#&gt; 5    Poales</span>
<span class="c1">#&gt; 6    Poales</span>
</code></pre></div>
<p>get ranks order, family, and genus via <code>pick()</code></p>
<div class="highlight"><pre><code class="language-r" data-lang="r">df2 <span class="o">%&gt;%</span> pick<span class="p">(</span><span class="kp">order</span><span class="p">,</span> family<span class="p">,</span> genus<span class="p">)</span>
<span class="c1">#&gt;       order     family      genus</span>
<span class="c1">#&gt; 1 Asterales Asteraceae Helianthus</span>
<span class="c1">#&gt; 2 Asterales Asteraceae Helianthus</span>
<span class="c1">#&gt; 3   Fagales   Fagaceae    Quercus</span>
<span class="c1">#&gt; 4    Poales    Poaceae        Poa</span>
<span class="c1">#&gt; 5    Poales    Poaceae    Festuca</span>
<span class="c1">#&gt; 6    Poales    Poaceae Holodiscus</span>
</code></pre></div>
<p>get range of names via <code>span()</code>, from rank <code>X</code> to rank <code>Y</code></p>
<div class="highlight"><pre><code class="language-r" data-lang="r">df2 <span class="o">%&gt;%</span> span<span class="p">(</span>family<span class="p">,</span> genus<span class="p">)</span>
<span class="c1">#&gt;       family      genus</span>
<span class="c1">#&gt; 1 Asteraceae Helianthus</span>
<span class="c1">#&gt; 2 Asteraceae Helianthus</span>
<span class="c1">#&gt; 3   Fagaceae    Quercus</span>
<span class="c1">#&gt; 4    Poaceae        Poa</span>
<span class="c1">#&gt; 5    Poaceae    Festuca</span>
<span class="c1">#&gt; 6    Poaceae Holodiscus</span>
</code></pre></div>
<p>Separate each row into a <code>taxon</code> class (many <code>taxon</code> objects are a <code>taxa</code> class)</p>
<div class="highlight"><pre><code class="language-r" data-lang="r">scatter<span class="p">(</span>df2<span class="p">)</span>
<span class="c1">#&gt; [[1]]</span>
<span class="c1">#&gt; &lt;taxon&gt;</span>
<span class="c1">#&gt;   binomial: Helianthus none</span>
<span class="c1">#&gt;   grouping: </span>
<span class="c1">#&gt;     order: Asterales</span>
<span class="c1">#&gt;     family: Asteraceae</span>
<span class="c1">#&gt;     genus: Helianthus</span>
<span class="c1">#&gt;     species: Helianthus none</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[2]]</span>
<span class="c1">#&gt; &lt;taxon&gt;</span>
<span class="c1">#&gt;   binomial: Helianthus none</span>
<span class="c1">#&gt;   grouping: </span>
<span class="c1">#&gt;     order: Asterales</span>
<span class="c1">#&gt;     family: Asteraceae</span>
<span class="c1">#&gt;     genus: Helianthus</span>
<span class="c1">#&gt;     species: Helianthus none</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[3]]</span>
<span class="c1">#&gt; &lt;taxon&gt;</span>
<span class="c1">#&gt;   binomial: Quercus none</span>
<span class="c1">#&gt;   grouping: </span>
<span class="c1">#&gt;     order: Fagales</span>
<span class="c1">#&gt;     family: Fagaceae</span>
<span class="c1">#&gt;     genus: Quercus</span>
<span class="c1">#&gt;     species: Quercus none</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[4]]</span>
<span class="c1">#&gt; &lt;taxon&gt;</span>
<span class="c1">#&gt;   binomial: Poa none</span>
<span class="c1">#&gt;   grouping: </span>
<span class="c1">#&gt;     order: Poales</span>
<span class="c1">#&gt;     family: Poaceae</span>
<span class="c1">#&gt;     genus: Poa</span>
<span class="c1">#&gt;     species: Poa none</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[5]]</span>
<span class="c1">#&gt; &lt;taxon&gt;</span>
<span class="c1">#&gt;   binomial: Festuca none</span>
<span class="c1">#&gt;   grouping: </span>
<span class="c1">#&gt;     order: Poales</span>
<span class="c1">#&gt;     family: Poaceae</span>
<span class="c1">#&gt;     genus: Festuca</span>
<span class="c1">#&gt;     species: Festuca none</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[6]]</span>
<span class="c1">#&gt; &lt;taxon&gt;</span>
<span class="c1">#&gt;   binomial: Holodiscus none</span>
<span class="c1">#&gt;   grouping: </span>
<span class="c1">#&gt;     order: Poales</span>
<span class="c1">#&gt;     family: Poaceae</span>
<span class="c1">#&gt;     genus: Holodiscus</span>
<span class="c1">#&gt;     species: Holodiscus none</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; attr(,&quot;class&quot;)</span>
<span class="c1">#&gt; [1] &quot;taxa&quot;</span>
</code></pre></div>
<p>And you can re-assemble a data.frame from the output of <code>scatter()</code> with <code>assemble()</code></p>
<div class="highlight"><pre><code class="language-r" data-lang="r">out <span class="o">&lt;-</span> scatter<span class="p">(</span>df2<span class="p">)</span>
assemble<span class="p">(</span>out<span class="p">)</span>
<span class="c1">#&gt;       order     family      genus         species</span>
<span class="c1">#&gt; 1 Asterales Asteraceae Helianthus Helianthus none</span>
<span class="c1">#&gt; 2 Asterales Asteraceae Helianthus Helianthus none</span>
<span class="c1">#&gt; 3   Fagales   Fagaceae    Quercus    Quercus none</span>
<span class="c1">#&gt; 4    Poales    Poaceae        Poa        Poa none</span>
<span class="c1">#&gt; 5    Poales    Poaceae    Festuca    Festuca none</span>
<span class="c1">#&gt; 6    Poales    Poaceae Holodiscus Holodiscus none</span>
</code></pre></div>
<h2>Thoughts?</h2>

<p>I&#39;m really curious what people think of <code>binomen</code>. I&#39;m not sure how useful this will be in the wild. Try it. Let me know. Thanks much :)</p>

  </div>
  
</div>

<!-- Pagination links -->
<div class="pagination">
  
    <a href="/page2" class="older">Older</a>
  
  
    <span class="previous">Newer</span>
  
</div>

    </div>

    <!-- for bootstrap tooltips -->
    <script type="text/javascript">
      $("[data-toggle=\"tooltip\"]").tooltip();
    </script>

  </body>

  <footer>
  <!-- Disqus code -->
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'recology'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>

  <!-- google analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-63197374-1', 'auto');
    ga('send', 'pageview');
  </script>
</footer>

</html>
