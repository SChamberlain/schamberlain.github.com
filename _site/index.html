<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    
    Recology, R/etc.
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <link rel="stylesheet" href="/public/css/bootstrap/css/bootstrap.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon.ico">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0f layout-reverse">

    <header class="masthead">
      <div class="masthead-inner">
        <h1>Recology</h1>
        <!-- <h1> <a href="http://recology.info/">Recology</a></h1> -->
        <p class="lead">R/etc.</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="/"><i class="fa fa-home fa-lg"></i></a>&nbsp;
              <a href="/about"><i class="fa fa-info-circle fa-lg"></i></a>&nbsp;
              <a href="/archives"><i class="fa fa-archive fa-lg"></i></a>&nbsp;
              <a href="/rresources"><i class="fa fa-book fa-lg"></i></a>&nbsp;
              <a href="http://rforcats.net/" rel><i class="fa fa-graduation-cap fa-lg"></i></a>&nbsp;
              <a href="/feed.xml"><i class="fa fa-rss fa-lg"></i></a>&nbsp;
              <a href="https://twitter.com/sckottie"><i class="fa fa-twitter fa-lg"></i></a>&nbsp;
              <a href="/fork"><i class="fa fa-spinner fa-lg"></i></a>
            </li>
          </ul>
          <!-- <small><a href="https://github.com/mdo/hyde">Hyde</a> from <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</small> -->
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="posts">
  <a style="float:right;" href="/archives" data-toggle="tooltip" data-placement="bottom" title="Archives"><i class="fa fa-archive fa-lg"></i></a>
  <a style="float:right;" href="/tags"><i class="fa fa-tags fa-lg"></i></a>&nbsp;
  
  <div class="post">
    <h1>
      <a href="/2016/06/marine-regions/">
        Marine Regions data in R
      </a>
    </h1>

    <span class="post-date">09 Jun 2016</span>

    <p>I was at a hackathon focused on Ocean Biogeographic Information System (OBIS) data back in November last year in Belgium. One project idea was to make it easier to get at data based on one or more marine regions. I was told that Marineregions.org is often used for shape files to get different regions to then do other work with.</p>

<p>During the event I started a package <a href="https://github.com/ropenscilabs/mregions">mregions</a>. Here I’ll show how to get different marine regions, then pass those outputs directly to other package(s) to query for OBIS species occurrence data, then make maps.</p>

<p>We’ll use WKT (Well-Known Text) to define spatial dimensions in this post. If
you don’t know what it is, Wikipedia to the rescue: <a href="https://en.wikipedia.org/wiki/Well-known_text">https://en.wikipedia.org/wiki/Well-known_text</a></p>

<p>A few notes before we begin:</p>

<ul>
  <li><code class="highlighter-rouge">mregions</code> will be on CRAN soon, install from github for now</li>
  <li>master version of <code class="highlighter-rouge">robis</code> lives at <code class="highlighter-rouge">iobis/robis</code>, but i use a slight changed in my fork :)</li>
</ul>

<h2 id="install">Install</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="s2">"sckott/mregions"</span><span class="p">,</span> <span class="s2">"sckott/robis"</span><span class="p">))</span>
<span class="n">install.packages</span><span class="p">(</span><span class="s2">"leaflet"</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"mregions"</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="get-list-of-place-types">Get list of place types</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">res</span> <span class="o">&lt;-</span> <span class="n">place_types</span><span class="p">()</span>
<span class="n">head</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">type</span><span class="p">)</span>
<span class="c1">#&gt; [1] "Town"                      "Arrondissement"
#&gt; [3] "Department"                "Province (administrative)"
#&gt; [5] "Country"                   "Continent"
</span></code></pre>
</div>

<h2 id="get-marineregions-records-by-place-type">Get Marineregions records by place type</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">res</span> <span class="o">&lt;-</span> <span class="n">records_by_type</span><span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="s2">"EEZ"</span><span class="p">)</span>
<span class="n">head</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="c1">#&gt;   MRGID                                            gazetteerSource
#&gt; 1  3293 Maritime Boundaries Geodatabase, Flanders Marine Institute
#&gt; 2  5668 Maritime Boundaries Geodatabase, Flanders Marine Institute
#&gt; 3  5669 Maritime Boundaries Geodatabase, Flanders Marine Institute
#&gt; 4  5670 Maritime Boundaries Geodatabase, Flanders Marine Institute
#&gt; 5  5672 Maritime Boundaries Geodatabase, Flanders Marine Institute
#&gt; 6  5673 Maritime Boundaries Geodatabase, Flanders Marine Institute
#&gt;   placeType latitude longitude minLatitude minLongitude maxLatitude
#&gt; 1       EEZ 51.46483  2.704458    51.09111     2.238118    51.87000
#&gt; 2       EEZ 53.61508  4.190675    51.26203     2.539443    55.76500
#&gt; 3       EEZ 54.55970  8.389231    53.24281     3.349999    55.91928
#&gt; 4       EEZ 40.87030 19.147094    39.63863    18.461940    41.86124
#&gt; 5       EEZ 42.94272 29.219062    41.97820    27.449580    43.74779
#&gt; 6       EEZ 43.42847 15.650844    41.62201    13.001390    45.59079
#&gt;   maxLongitude precision            preferredGazetteerName
#&gt; 1     3.364907  58302.49   Belgian Exclusive Economic Zone
#&gt; 2     7.208364 294046.10     Dutch Exclusive Economic Zone
#&gt; 3    14.750000 395845.50    German Exclusive Economic Zone
#&gt; 4    20.010030 139751.70  Albanian Exclusive Economic Zone
#&gt; 5    31.345280 186792.50 Bulgarian Exclusive Economic Zone
#&gt; 6    18.552360 313990.30  Croatian Exclusive Economic Zone
#&gt;   preferredGazetteerNameLang   status accepted
#&gt; 1                    English standard     3293
#&gt; 2                    English standard     5668
#&gt; 3                    English standard     5669
#&gt; 4                    English standard     5670
#&gt; 5                    English standard     5672
#&gt; 6                    English standard     5673
</span></code></pre>
</div>

<h2 id="get-and-search-region-names">Get and search region names</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">res</span> <span class="o">&lt;-</span> <span class="n">region_names</span><span class="p">()</span>
<span class="n">region_names_search</span><span class="p">(</span><span class="n">query</span> <span class="o">=</span> <span class="s2">"IHO"</span><span class="p">)</span>
<span class="c1">#&gt; [[1]]
#&gt; [[1]]$name
#&gt; [1] "MarineRegions:iho"
#&gt;
#&gt; [[1]]$title
#&gt; [1] "IHO Sea Areas"
#&gt;
#&gt; [[1]]$name_first
#&gt; [1] "MarineRegions"
#&gt;
#&gt; [[1]]$name_second
#&gt; [1] "iho"
#&gt;
#&gt;
#&gt; [[2]]
#&gt; [[2]]$name
#&gt; [1] "MarineRegions:iho_quadrants_20150810"
#&gt;
#&gt; [[2]]$title
#&gt; [1] "IHO quadrants (20150810)"
#&gt;
#&gt; [[2]]$name_first
#&gt; [1] "MarineRegions"
#&gt;
#&gt; [[2]]$name_second
#&gt; [1] "iho_quadrants_20150810"
#&gt;
#&gt;
#&gt; [[3]]
#&gt; [[3]]$name
#&gt; [1] "World:iosregions"
#&gt;
#&gt; [[3]]$title
#&gt; [1] "IOS Regions"
#&gt;
#&gt; [[3]]$name_first
#&gt; [1] "World"
#&gt;
#&gt; [[3]]$name_second
#&gt; [1] "iosregions"
#&gt;
#&gt;
#&gt; [[4]]
#&gt; [[4]]$name
#&gt; [1] "MarineRegions:eez_iho_union_v2"
#&gt;
#&gt; [[4]]$title
#&gt; [1] "Marineregions: the intersect of the Exclusive Economic Zones and IHO areas"
#&gt;
#&gt; [[4]]$name_first
#&gt; [1] "MarineRegions"
#&gt;
#&gt; [[4]]$name_second
#&gt; [1] "eez"
#&gt;
#&gt;
#&gt; [[5]]
#&gt; [[5]]$name
#&gt; [1] "Belgium:vl_venivon"
#&gt;
#&gt; [[5]]$title
#&gt; [1] "VEN (Flanders Ecological Network) and IVON (Integral Interrelated and Supporting Network)  areas in Flanders"
#&gt;
#&gt; [[5]]$name_first
#&gt; [1] "Belgium"
#&gt;
#&gt; [[5]]$name_second
#&gt; [1] "vl_venivon"
</span></code></pre>
</div>

<h2 id="get-a-region---geojson">Get a region - geojson</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">res</span> <span class="o">&lt;-</span> <span class="n">region_geojson</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Turkmen Exclusive Economic Zone"</span><span class="p">)</span>
<span class="n">class</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="c1">#&gt; [1] "mr_geojson"
</span><span class="n">names</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="c1">#&gt; [1] "type"          "totalFeatures" "features"      "crs"
#&gt; [5] "bbox"
</span></code></pre>
</div>

<h2 id="get-a-region---shp">Get a region - shp</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">res</span> <span class="o">&lt;-</span> <span class="n">region_shp</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Belgian Exclusive Economic Zone"</span><span class="p">)</span>
<span class="n">class</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="c1">#&gt; [1] "SpatialPolygonsDataFrame"
#&gt; attr(,"package")
#&gt; [1] "sp"
</span></code></pre>
</div>

<h2 id="get-obis-eez-id">Get OBIS EEZ ID</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">res</span> <span class="o">&lt;-</span> <span class="n">region_names</span><span class="p">()</span>
<span class="n">res</span> <span class="o">&lt;-</span> <span class="n">Filter</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">grepl</span><span class="p">(</span><span class="s2">"eez"</span><span class="p">,</span> <span class="n">x</span><span class="o">$</span><span class="n">name</span><span class="p">,</span> <span class="n">ignore.case</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">),</span> <span class="n">res</span><span class="p">)</span>
<span class="n">obis_eez_id</span><span class="p">(</span><span class="n">res</span><span class="p">[[</span><span class="m">2</span><span class="p">]]</span><span class="o">$</span><span class="n">title</span><span class="p">)</span>
<span class="c1">#&gt; [1] 84
</span></code></pre>
</div>

<h2 id="convert-to-wkt">Convert to WKT</h2>

<p>From geojson or shp. Here, geojson</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">res</span> <span class="o">&lt;-</span> <span class="n">region_geojson</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="s2">"MarineRegions:eez_33176"</span><span class="p">)</span>
<span class="n">as_wkt</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="m">5</span><span class="p">)</span>
<span class="c1">#&gt; [1] "MULTIPOLYGON (((41.573732 -1.659444, 45.891882 ... cutoff
</span></code></pre>
</div>

<h2 id="get-regions-then-obis-data">Get regions, then OBIS data</h2>

<h3 id="using-well-known-text">Using Well-Known Text</h3>

<p>Both shp and geojson data returned from <code class="highlighter-rouge">region_shp()</code> and <code class="highlighter-rouge">region_geojson()</code>, respectively, can be passed to <code class="highlighter-rouge">as_wkt()</code> to get WKT.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s1">'robis'</span><span class="p">)</span>
<span class="n">shp</span> <span class="o">&lt;-</span> <span class="n">region_shp</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Belgian Exclusive Economic Zone"</span><span class="p">)</span>
<span class="n">wkt</span> <span class="o">&lt;-</span> <span class="n">as_wkt</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
<span class="n">xx</span> <span class="o">&lt;-</span> <span class="n">occurrence</span><span class="p">(</span><span class="s2">"Abra alba"</span><span class="p">,</span> <span class="n">geometry</span> <span class="o">=</span> <span class="n">wkt</span><span class="p">)</span>
<span class="c1">#&gt;
</span><span class="n">Retrieved</span> <span class="m">695</span> <span class="n">records</span> <span class="n">of</span> <span class="m">695</span> <span class="p">(</span><span class="m">100</span><span class="o">%</span><span class="p">)</span>
<span class="n">xx</span> <span class="o">&lt;-</span> <span class="n">xx</span><span class="p">[,</span> <span class="n">c</span><span class="p">(</span><span class="s1">'scientificName'</span><span class="p">,</span> <span class="s1">'decimalLongitude'</span><span class="p">,</span> <span class="s1">'decimalLatitude'</span><span class="p">)]</span>
<span class="n">names</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s1">'scientificName'</span><span class="p">,</span> <span class="s1">'longitude'</span><span class="p">,</span> <span class="s1">'latitude'</span><span class="p">)</span>
</code></pre>
</div>

<p>Plot</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s1">'leaflet'</span><span class="p">)</span>
<span class="n">leaflet</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">addTiles</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">addCircleMarkers</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">xx</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">shp</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="/public/img/2016-06-09-marine-regions/map1.png" alt="map1" /></p>

<h3 id="using-eez-id">Using EEZ ID</h3>

<p>EEZ is a Exclusive Economic Zone</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s1">'robis'</span><span class="p">)</span>
<span class="p">(</span><span class="n">eez</span> <span class="o">&lt;-</span> <span class="n">obis_eez_id</span><span class="p">(</span><span class="s2">"Belgian Exclusive Economic Zone"</span><span class="p">))</span>
<span class="c1">#&gt; [1] 59
</span></code></pre>
</div>

<p>You currently can’t search for OBIS occurrences by EEZ ID, but hopefully soon…</p>

<h2 id="dealing-with-bigger-wkt">Dealing with bigger WKT</h2>

<p>What if you’re WKT string is super long?  It’s often a problem because some online species occurrence databases that accept WKT to search by geometry bork due to
limitations on length of URLs if your WKT string is too long (about 8000 characters,
including remainder of URL). One way to deal with it is to reduce detail - simplify.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"ateucher/rmapshaper"</span><span class="p">)</span>
</code></pre>
</div>

<p>Using <code class="highlighter-rouge">rmapshaper</code> we can simplify a spatial object, then search with that.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">shp</span> <span class="o">&lt;-</span> <span class="n">region_shp</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"Dutch Exclusive Economic Zone"</span><span class="p">)</span>
</code></pre>
</div>

<p>Visualize</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">leaflet</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">addTiles</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">shp</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="/public/img/2016-06-09-marine-regions/complex.png" alt="map2" /></p>

<p>Simplify</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"rmapshaper"</span><span class="p">)</span>
<span class="n">shp</span> <span class="o">&lt;-</span> <span class="n">ms_simplify</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
</code></pre>
</div>

<p>It’s simplified:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">leaflet</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">addTiles</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">addPolygons</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">shp</span><span class="p">)</span>
</code></pre>
</div>

<p><img src="/public/img/2016-06-09-marine-regions/simple.png" alt="map3" /></p>

<p>Convert to WKT</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">wkt</span> <span class="o">&lt;-</span> <span class="n">as_wkt</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="obis-data">OBIS data</h3>

<p>Search OBIS</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"robis"</span><span class="p">)</span>
<span class="n">dat</span> <span class="o">&lt;-</span> <span class="n">occurrence_single</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">wkt</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="m">500</span><span class="p">,</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"species"</span><span class="p">,</span> <span class="s2">"decimalLongitude"</span><span class="p">,</span> <span class="s2">"decimalLatitude"</span><span class="p">))</span>
<span class="n">head</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
<span class="c1">#&gt;               species decimalLongitude decimalLatitude
#&gt; 1  Temora longicornis         3.423300        55.39170
#&gt; 2  Temora longicornis         3.518300        55.39170
#&gt; 3 Stragularia clavata         4.190675        53.61508
#&gt; 4                &lt;NA&gt;         4.189400        53.55727
#&gt; 5   Stylonema alsidii         4.190675        53.61508
#&gt; 6                &lt;NA&gt;         4.318000        53.30720
</span></code></pre>
</div>


  </div>
  
  <div class="post">
    <h1>
      <a href="/2016/04/atomize/">
        atomize - make new packages from other packages
      </a>
    </h1>

    <span class="post-date">07 Apr 2016</span>

    <p>We (rOpenSci) just held our 3rd annual rOpenSci unconference (<a href="http://unconf16.ropensci.org/">http://unconf16.ropensci.org/</a>) in San Francisco. There were <a href="https://github.com/ropensci/unconf16/issues">a lot of ideas</a>, and lots of awesome projects from awesome people came out of the 2 day event.</p>

<p>One weird idea I had comes from looking at the Node world, where there are lots of tiny packages, instead of the often larger packages we have in the R world. One reason for tiny in Node is that of course you want a library to be tiny if running in the browser for faster load times (esp. on mobile).</p>

<p>So the idea is, what if we could separate all the functions in a package, or any particular function of your choice, into new packages, with all the internal functions and dependencies. And automatically as well, not manually.</p>

<p>So what are the use cases? I can’t imagine this being used to create stable packages to disperse to the world on CRAN, but it could be really useful for development purposes, or for R users/analysts that want lighter weight dependencies (e.g., a package with just the one function needed from a larger package).</p>

<p>This approach of course has drawbacks. The new created package is now broken apart from the original - however, beause it’s automated, you can just re-create it.</p>

<p>Another pain point would surely be with packages that have C/C++ code in them.</p>

<p>The package: <code class="highlighter-rouge">atomize</code>.</p>

<p>The package was made possible by the awesome <a href="https://github.com/MangoTheCat/functionMap">functionMap</a> package by <a href="https://github.com/gaborcsardi">Gábor Csárdi</a>, and the more well-known <code class="highlighter-rouge">devtools</code>.</p>

<p>Expect bugs, the package has no tests. Sorry :(</p>

<h2 id="installation">Installation</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"ropenscilabs/atomize"</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"atomize"</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="usage">usage</h2>

<h3 id="atomize-a-fxn-into-separate-package">atomize a fxn into separate package</h3>

<p>You can select one function, or many. Here, I’m using another package I maintain, <a href="https://github.com/ropenscilabs/rredlist">rredlist</a>, a pkg to interact with the <a href="http://apiv3.iucnredlist.org/api/v3/docs">IUCN Redlist API</a>.</p>

<p>In this example, I want a new package called <code class="highlighter-rouge">foobar</code> with just the function <code class="highlighter-rouge">rl_citation()</code>. The function <code class="highlighter-rouge">atomize::atomizer()</code> takes the path for the package to extract from, then a path for the new package, then the function names.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">atomizer</span><span class="p">(</span><span class="n">path_ref</span> <span class="o">=</span> <span class="s2">"../rredlist"</span><span class="p">,</span> <span class="n">path_new</span> <span class="o">=</span> <span class="s2">"../foobar"</span><span class="p">,</span> <span class="n">funcs</span> <span class="o">=</span> <span class="s2">"rl_citation"</span><span class="p">)</span>
</code></pre>
</div>

<p>This creates a new package in the <code class="highlighter-rouge">path_new</code> directory</p>

<h3 id="install">install</h3>

<p>Now we need to install the new package, can do easily with <code class="highlighter-rouge">devtools::install()</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install</span><span class="p">(</span><span class="s2">"../foobar"</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="load">load</h3>

<p>Then load the new package</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"foobar"</span><span class="p">)</span>
</code></pre>
</div>

<h3 id="call-function">call function</h3>

<p>Now call the function in the new package</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">foobar</span><span class="o">::</span><span class="n">rl_citation</span><span class="p">()</span>
<span class="c1">#&gt; [1] "IUCN 2015. IUCN Red List of Threatened Species. Version 2015-4 &lt;www.iucnredlist.org&gt;"
</span></code></pre>
</div>

<p>it’s identical to the same function in the old package</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">identical</span><span class="p">(</span><span class="n">rredlist</span><span class="o">::</span><span class="n">rl_citation</span><span class="p">(),</span> <span class="n">foobar</span><span class="o">::</span><span class="n">rl_citation</span><span class="p">())</span>
<span class="c1">#&gt; [1] TRUE
</span></code></pre>
</div>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2016/03/genbank-ids/">
        GenBank IDs API - get, match, swap id types
      </a>
    </h1>

    <span class="post-date">29 Mar 2016</span>

    <p>GenBank IDs, accession numbers and GI identifiers, are the two types of identifiers for entries in GenBank. (see <a href="http://www.ncbi.nlm.nih.gov/Sitemap/sequenceIDs.html">this page</a> for why there are two types of identifiers). Actually, <a href="http://www.ncbi.nlm.nih.gov/news/03-02-2016-phase-out-of-GI-numbers/">recent news</a> from NCBI is that GI identifiers will be phased out by September this year, which affects what I’ll talk about below.</p>

<p>There are a lot of sequences in GenBank. Sometimes you have identifiers and you want to check if they exist in GenBank, or want to get one type from another (accession from GI, or vice versa; although GI phase out will make this use case no longer needed), or just get a bunch of identifiers for software testing purposes perhaps.</p>

<p>Currently, the ENTREZ web services aren’t super performant or easy to use for the above use cases. Thus, I’ve built out a RESTful API for these use cases, called <a href="https://github.com/sckott/gbids">gbids</a>.</p>

<p><code class="highlighter-rouge">gbids</code> on GitHub: <a href="https://github.com/sckott/gbids">sckott/gbids</a></p>

<p>Here’s the tech stack:</p>

<ul>
  <li>API: Ruby/Sinatra</li>
  <li>Storage: MySQL</li>
  <li>Caching: Redis
    <ul>
      <li>each key cached for 3 hours</li>
    </ul>
  </li>
  <li>Server: Caddy
    <ul>
      <li>https</li>
    </ul>
  </li>
  <li>Authentication: none</li>
</ul>

<p>Will soon have a cron job update when new dump is available every Sunday, but for now we’re about a month behind the current dump of identifiers. If usage of the API picks up, I’ll know it’s worth maintaining and make sure data is up to date.</p>

<p>The base url is <a href="https://gbids.xyz">https://gbids.xyz</a>.</p>

<p>Here’s a rundown of the API routes:</p>

<ul>
  <li><code class="highlighter-rouge">/</code> re-routes to <code class="highlighter-rouge">/heartbeat</code></li>
  <li><code class="highlighter-rouge">/heartbeat</code> - list routes</li>
  <li><code class="highlighter-rouge">/acc</code> - <code class="highlighter-rouge">GET</code> - list accession ids</li>
  <li><code class="highlighter-rouge">/acc/:id,:id,...</code> - <code class="highlighter-rouge">GET</code> - submit many accession numbers, get back boolean (match or no match)</li>
  <li><code class="highlighter-rouge">/acc</code> - <code class="highlighter-rouge">POST</code></li>
  <li><code class="highlighter-rouge">/gi</code> - <code class="highlighter-rouge">GET</code> - list gi numbers</li>
  <li><code class="highlighter-rouge">/gi/:id,:id,...</code> - <code class="highlighter-rouge">GET</code> - submit many gi numbers, get back boolean (match or no match)</li>
  <li><code class="highlighter-rouge">/gi</code> - <code class="highlighter-rouge">POST</code></li>
  <li><code class="highlighter-rouge">/acc2gi/:id,:id,...</code> - <code class="highlighter-rouge">GET</code> - get gi numbers from accession numbers</li>
  <li><code class="highlighter-rouge">/acc2gi</code> - <code class="highlighter-rouge">POST</code></li>
  <li><code class="highlighter-rouge">/gi2acc/:id,:id,...</code> - <code class="highlighter-rouge">GET</code> - get accession numbers from gi numbers</li>
  <li><code class="highlighter-rouge">/gi2acc</code> - <code class="highlighter-rouge">POST</code></li>
</ul>

<p>Of course after GI identifiers are phased out, all <code class="highlighter-rouge">gi</code> routes will be removed.</p>

<p>The API docs are at <a href="http://recology.info/gbidsdocs">recology.info/gbidsdocs</a> - let me know if you have any feedback on those.</p>

<p>I also have a status page up at <a href="http://recology.info/gbidsstatus/">recology.info/gbidsstatus</a> - it’s not automated, I have to update the status manually, but I do update that page whenever I’m doing maintenance and the API will be down, or if it goes down due to any other reason.</p>

<h2 id="examples">examples</h2>

<p>Request to list accession identifiers, limit to 5</p>

<div class="highlighter-rouge"><pre class="highlight"><code>curl 'https://gbids.xyz/acc?limit=5' | jq .
{
  "matched": 692006925,
  "returned": 5,
  "data": [
    "A00002",
    "A00003",
    "X17276",
    "X60065",
    "CAA42669"
  ],
  "error": null
}
</code></pre>
</div>

<p>Request to match accession identifiers, some exist, while some do not</p>

<div class="highlighter-rouge"><pre class="highlight"><code>curl 'https://gbids.xyz/acc/AACY024124486,AACY024124483,asdfd,asdf,AACY024124476' | jq .
{
  "matched": 3,
  "returned": 5,
  "data": {
    "AACY024124486": true,
    "AACY024124483": true,
    "asdfd": false,
    "asdf": false,
    "AACY024124476": true
  },
  "error": null
}
</code></pre>
</div>

<h2 id="to-do">to do</h2>

<p>I think it’d probably be worth adding routes for getting accession from taxonomy id and vice versa since that’s something that is currently not very easy. We could use the dumped accession2taxid data from ftp://ftp.ncbi.nih.gov/pub/taxonomy/accession2taxid/</p>

<h2 id="feedback">feedback!</h2>

<p>If you think this could be potentially useful, do try it out and send any feedback. I watch logs from the API, so I’m hoping for an increase in usage so I know people find it useful.</p>

<p>Since servers aren’t free, costs add up, and if I don’t see usage pick up I’ll discontinue the service at some point. So do use it!</p>

<p>And if anyone can offer free servers, I’d gladly take advantage of that. I’ve applied for AWS research grant, but won’t hear back for a few months.</p>


  </div>
  
</div>

<!-- Pagination links -->
<div class="pagination">
  
    <a href="/page2" class="older">Older</a>
  
  
    <span class="previous">Newer</span>
  
</div>

    </div>

    <!-- for bootstrap tooltips -->
    <script type="text/javascript">
      $("[data-toggle=\"tooltip\"]").tooltip();
    </script>

  </body>

  <footer>
  <!-- Disqus code -->
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'recology'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>

  <!-- google analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-63197374-1', 'auto');
    ga('send', 'pageview');
  </script>
</footer>

</html>
