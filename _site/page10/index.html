<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    
    Recology, R/etc.
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <link rel="stylesheet" href="/public/css/bootstrap/css/bootstrap.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon.ico">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0f layout-reverse">

    <header class="masthead">
      <div class="masthead-inner">
        <h1>Recology</h1>
        <!-- <h1> <a href="http://recology.info/">Recology</a></h1> -->
        <p class="lead">R/etc.</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="/"><i class="fa fa-home fa-lg"></i></a>&nbsp;
              <a href="/about"><i class="fa fa-info-circle fa-lg"></i></a>&nbsp;
              <a href="/archives"><i class="fa fa-archive fa-lg"></i></a>&nbsp;
              <a href="/rresources"><i class="fa fa-book fa-lg"></i></a>&nbsp;
              <a href="http://rforcats.net/" rel><i class="fa fa-graduation-cap fa-lg"></i></a>&nbsp;
              <a href="/feed.xml"><i class="fa fa-rss fa-lg"></i></a>&nbsp;
              <a href="https://twitter.com/sckottie"><i class="fa fa-twitter fa-lg"></i></a>&nbsp;
              <a href="/fork"><i class="fa fa-spinner fa-lg"></i></a>
            </li>
          </ul>
          <!-- <small><a href="https://github.com/mdo/hyde">Hyde</a> from <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</small> -->
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="posts">
  <a style="float:right;" href="/archives" data-toggle="tooltip" data-placement="bottom" title="Archives"><i class="fa fa-archive fa-lg"></i></a>
  <a style="float:right;" href="/tags"><i class="fa fa-tags fa-lg"></i></a>&nbsp;
  
  <div class="post">
    <h1>
      <a href="/2015/01/geojson-topojson-io/">
        R I/O for geojson and topojson
      </a>
    </h1>

    <span class="post-date">06 Jan 2015</span>

    <p>At rOpenSci we’ve been working on an R package (<code>geojsonio</code>) to make converting R data in various formats to <a href="http://geojson.org/geojson-spec.html">geoJSON</a> and <a href="https://github.com/topojson/topojson-specification/blob/master/README.md">topoJSON</a>, and vice versa. We hope to do this one job very well, and handle all reasonable use cases.</p>

<p>Functions in this package are organized first around what you’re working with or want to get, <code>geojson</code> or <code>topojson</code>, then convert to or read from various formats:</p>

<ul>
  <li><code>geojson_list()</code>/<code>topojson_list()</code> - convert to geojson/topojson as R list format</li>
  <li><code>geojson_json()</code>/<code>topojson_json()</code> - convert to geojson/topojson as json</li>
  <li><code>geojson_read()</code><code>topojson_read()</code> - read a geojson/topojson file from file path or URL</li>
  <li><code>geojson_write()</code>/<code>topojson_write()</code> - write a geojson/topojson file locally</li>
</ul>

<p>Each of the above functions have methods for various objects/classes, including <code>numeric</code>, <code>data.frame</code>, <code>list</code>, <code>SpatialPolygons</code>, <code>SpatialPolygonsDataFrame</code>, <code>SpatialLines</code>, <code>SpatialLinesDataFrame</code>, <code>SpatialPoints</code>, <code>SpatialPointsDataFrame</code>.</p>

<h2 id="install">Install</h2>

<p>Install rgdal - in case you can’t get it installed from binary , here’s what works on a Mac.</p>

<pre><code class="language-r">install.packages("http://cran.r-project.org/src/contrib/rgdal_0.9-1.tar.gz", repos = NULL, type="source", configure.args = "--with-gdal-config=/Library/Frameworks/GDAL.framework/Versions/1.10/unix/bin/gdal-config --with-proj-include=/Library/Frameworks/PROJ.framework/unix/include --with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib")
</code></pre>

<p>Install <code>geojsonio</code></p>

<pre><code class="language-r">install.packages("devtools")
devtools::install_github("ropensci/geojsonio")
</code></pre>

<pre><code class="language-r">library("geojsonio")
</code></pre>

<h2 id="geojson">GeoJSON</h2>

<h3 id="convert-various-formats-to-geojson">Convert various formats to geojson</h3>

<p>From a <code>numeric</code> vector of length 2, as json or list</p>

<pre><code class="language-r">geojson_json(c(32.45,-99.74))
#&gt; {"type":"Point","geometry":{"type":"Point","coordinates":[32.45,-99.74]},"properties":{}}
geojson_list(c(32.45,-99.74))
#&gt; $type
#&gt; [1] "Point"
#&gt; 
#&gt; $geometry
#&gt; $geometry$type
#&gt; [1] "Point"
#&gt; 
#&gt; $geometry$coordinates
#&gt; [1]  32.45 -99.74
#&gt; 
#&gt; 
#&gt; $properties
#&gt; NULL
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "geo_list"
#&gt; attr(,"from")
#&gt; [1] "numeric"
</code></pre>

<p>From a <code>data.frame</code></p>

<pre><code class="language-r">library('maps')
data(us.cities)
geojson_json(us.cities[1:2,], lat='lat', lon='long')
#&gt; {"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Point","coordinates":[-99.74,32.45]},"properties":{"name":"Abilene TX","country.etc":"TX","pop":"113888","capital":"0"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-81.52,41.08]},"properties":{"name":"Akron OH","country.etc":"OH","pop":"206634","capital":"0"}}]}
geojson_list(us.cities[1:2,], lat='lat', lon='long')
#&gt; $type
#&gt; [1] "FeatureCollection"
#&gt; 
#&gt; $features
#&gt; $features[[1]]
#&gt; $features[[1]]$type
#&gt; [1] "Feature"
#&gt; 
#&gt; $features[[1]]$geometry
#&gt; $features[[1]]$geometry$type
#&gt; [1] "Point"
#&gt; 
#&gt; $features[[1]]$geometry$coordinates
#&gt; [1] -99.74  32.45
#&gt; 
#&gt; 
#&gt; $features[[1]]$properties
#&gt; $features[[1]]$properties$name
#&gt; [1] "Abilene TX"
#&gt; 
#&gt; $features[[1]]$properties$country.etc
#&gt; [1] "TX"
#&gt; 
#&gt; $features[[1]]$properties$pop
#&gt; [1] "113888"
#&gt; 
#&gt; $features[[1]]$properties$capital
#&gt; [1] "0"
#&gt; 
#&gt; 
#&gt; 
#&gt; $features[[2]]
#&gt; $features[[2]]$type
#&gt; [1] "Feature"
#&gt; 
#&gt; $features[[2]]$geometry
#&gt; $features[[2]]$geometry$type
#&gt; [1] "Point"
#&gt; 
#&gt; $features[[2]]$geometry$coordinates
#&gt; [1] -81.52  41.08
#&gt; 
#&gt; 
#&gt; $features[[2]]$properties
#&gt; $features[[2]]$properties$name
#&gt; [1] "Akron OH"
#&gt; 
#&gt; $features[[2]]$properties$country.etc
#&gt; [1] "OH"
#&gt; 
#&gt; $features[[2]]$properties$pop
#&gt; [1] "206634"
#&gt; 
#&gt; $features[[2]]$properties$capital
#&gt; [1] "0"
#&gt; 
#&gt; 
#&gt; 
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "geo_list"
#&gt; attr(,"from")
#&gt; [1] "data.frame"
</code></pre>

<p>From <code>SpatialPolygons</code> class</p>

<pre><code class="language-r">library('sp')
poly1 &lt;- Polygons(list(Polygon(cbind(c(-100,-90,-85,-100),
                                     c(40,50,45,40)))), "1")
poly2 &lt;- Polygons(list(Polygon(cbind(c(-90,-80,-75,-90),
                                     c(30,40,35,30)))), "2")
sp_poly &lt;- SpatialPolygons(list(poly1, poly2), 1:2)
</code></pre>

<p>to json</p>

<pre><code class="language-r">geojson_json(sp_poly)
#&gt; {"type":"Polygon","bbox":[-100,-75,30,50],"coordinates":[[[-100,40],[-90,50],[-85,45],[-100,40]],[[-90,30],[-80,40],[-75,35],[-90,30]]],"properties":{}}
</code></pre>

<p>to list</p>

<pre><code class="language-r">geojson_list(sp_poly)$coordinates[[1]]
#&gt; [[1]]
#&gt; [[1]][[1]]
#&gt; [1] -100
#&gt; 
#&gt; [[1]][[2]]
#&gt; [1] 40
#&gt; 
#&gt; 
#&gt; [[2]]
#&gt; [[2]][[1]]
#&gt; [1] -90
#&gt; 
#&gt; [[2]][[2]]
#&gt; [1] 50
#&gt; 
#&gt; 
#&gt; [[3]]
#&gt; [[3]][[1]]
#&gt; [1] -85
#&gt; 
#&gt; [[3]][[2]]
#&gt; [1] 45
#&gt; 
#&gt; 
#&gt; [[4]]
#&gt; [[4]][[1]]
#&gt; [1] -100
#&gt; 
#&gt; [[4]][[2]]
#&gt; [1] 40
</code></pre>

<h3 id="write-geojson">Write geojson</h3>

<pre><code class="language-r">library('maps')
data(us.cities)
geojson_write(us.cities[1:2,], lat='lat', lon='long')
#&gt; &lt;geojson&gt;
#&gt;   Path:       myfile.geojson
#&gt;   From class: data.frame
</code></pre>

<h3 id="read-geojson">Read geojson</h3>

<pre><code class="language-r">file &lt;- system.file("examples", "california.geojson", package = "geojsonio")
out &lt;- geojson_read(file)
#&gt; OGR data source with driver: GeoJSON 
#&gt; Source: "/Users/sacmac/Library/R/3.1/library/geojsonio/examples/california.geojson", layer: "OGRGeoJSON"
#&gt; with 1 features and 11 fields
#&gt; Feature type: wkbMultiPolygon with 2 dimensions
plot(out)
</code></pre>

<p><img src="/public/img/2015-01-06-geojson-topojson-io/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /></p>

<h2 id="topojson">TopoJSON</h2>

<h3 id="convert-to-topojson-with-node-topojson-client">Convert to TopoJSON with Node topojson client</h3>

<p>For topojson you will need Mike Bostock’s command line client. Install it by doing</p>

<pre><code>sudo npm install -g topojson
</code></pre>

<p>Download a zipped shape fileset, <a href="http://esp.cr.usgs.gov/data/little/querwisl.zip">this one</a> for distribution of <em>Quercus wislizeni</em>. Unzip the zip file to a folder. Then do (changing the path to your path)</p>

<pre><code class="language-r">topojson_write(shppath='~/Downloads/querwisl', path = "~/Downloads", projection='albers', projargs=list(rotate='[60, -35, 0]'))
#&gt; OGR data source with driver: ESRI Shapefile 
#&gt; Source: "/Users/sacmac/Downloads/querwisl", layer: "querwisl"
#&gt; with 35 features and 5 fields
#&gt; Feature type: wkbPolygon with 2 dimensions
</code></pre>

<p>Which prints progress on the conversion of the shape file. And prints the topojson CLI call, including the location of the output file, here <code>/Users/sacmac/querwisl.json</code></p>

<pre><code class="language-r">OGR data source with driver: ESRI Shapefile
Source: "/Users/sacmac/Downloads/querwisl", layer: "querwisl"
with 35 features and 5 fields
Feature type: wkbPolygon with 2 dimensions
topojson -o /Users/sacmac/querwisl.json -q 1e4 -s 0 --shapefile-encoding utf8 --projection 'd3.geo.albers().rotate([60, -35, 0])' -- /var/folders/gs/4khph0xs0436gmd2gdnwsg080000gn/T//Rtmp49APW7/querwisl.shp

bounds: -403.2554825867553 401.27189387582916 -295.798050380061 585.4214768677039 (cartesian)
pre-quantization: 0.010746817902459677 0.018416799979185387
topology: 35 arcs, 2492 points
prune: retained 35 / 35 arcs (100%)
</code></pre>

<p>You can then use this topojson file wherever. We’ll add a function soon to automagically throw this file up as a Github gist to get an interactive map.</p>

<h3 id="read-topojson">Read topojson</h3>

<p>TopoJSON</p>

<pre><code class="language-r">url &lt;- "https://raw.githubusercontent.com/shawnbot/d3-cartogram/master/data/us-states.topojson"
out &lt;- topojson_read(url)
#&gt; OGR data source with driver: GeoJSON 
#&gt; Source: "https://raw.githubusercontent.com/shawnbot/d3-cartogram/master/data/us-states.topojson", layer: "states"
#&gt; with 51 features and 2 fields
#&gt; Feature type: wkbPolygon with 2 dimensions
plot(out)
</code></pre>

<p><img src="/public/img/2015-01-06-geojson-topojson-io/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /></p>

<h2 id="use-case-play-with-us-states">Use case: Play with US states</h2>

<p>Using data from <a href="https://github.com/glynnbird/usstatesgeojson">https://github.com/glynnbird/usstatesgeojson</a></p>

<p>Get some geojson</p>

<pre><code class="language-r">library('httr')
res &lt;- GET('https://api.github.com/repos/glynnbird/usstatesgeojson/contents')
st_names &lt;- Filter(function(x) grepl("\\.geojson", x), sapply(content(res), "[[", "name"))
base &lt;- 'https://raw.githubusercontent.com/glynnbird/usstatesgeojson/master/'
st_files &lt;- paste0(base, st_names)
</code></pre>

<p>Make a faceted plot</p>

<pre><code class="language-r">library('ggplot2')
library('plyr')
st_use &lt;- st_files[7:13]
geo &lt;- lapply(st_use, geojson_read, verbose = FALSE)
df &lt;- ldply(setNames(lapply(geo, fortify), gsub("\\.geojson", "", st_names[7:13])))
ggplot(df, aes(long, lat, group = group)) +
  geom_polygon() +
  facet_wrap(~ .id, scales = "free")
</code></pre>

<p><img src="/public/img/2015-01-06-geojson-topojson-io/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" /></p>

<h2 id="maps">Maps</h2>

<p>We’re also working on <code>map_gist()</code> - to push up a geojson or topojson file as a GitHub gist (renders as an interactive map). It still needs some work…</p>

<h2 id="validate-geojson">Validate geojson</h2>

<p><a href="http://geojsonlint.com/">geojsonlint.com</a> has a nice web interface you can use to make sure you’re geoJSON is in the right format. In addition, it provides a RESTful endpoint at <code>geojsonlint.com/validate</code> to validate geoJSON. 
This was just added today in this package, and can be used from many data types.</p>

<p>Good geoJSON</p>

<pre><code class="language-r">validate('{"type": "Point", "coordinates": [-100, 80]}')
#&gt; $status
#&gt; [1] "ok"
</code></pre>

<p>Bad geoJSON</p>

<pre><code class="language-r">validate('{"type": "Rhombus", "coordinates": [[1, 2], [3, 4], [5, 6]]}')
#&gt; $message
#&gt; [1] "\"Rhombus\" is not a valid GeoJSON type."
#&gt; 
#&gt; $status
#&gt; [1] "error"
</code></pre>

<p>A file</p>

<pre><code class="language-r">file &lt;- system.file("examples", "zillow_or.geojson", package = "togeojson")
validate(x = as.location(file))
#&gt; $status
#&gt; [1] "ok"
</code></pre>

<p>A URL</p>

<pre><code class="language-r">url &lt;- "https://raw.githubusercontent.com/glynnbird/usstatesgeojson/master/california.geojson"
validate(as.location(url))
#&gt; $status
#&gt; [1] "ok"
</code></pre>

<p>From the output of <code>geojson_list()</code></p>

<pre><code class="language-r">library("maps")
data(us.cities)
x &lt;- geojson_list(us.cities[1:2,], lat='lat', lon='long')
validate(x)
#&gt; $status
#&gt; [1] "ok"
</code></pre>

<p>From SpatialPoints class</p>

<pre><code class="language-r">library("sp")
a &lt;- c(1,2,3,4,5)
b &lt;- c(3,2,5,1,4)
x &lt;- SpatialPoints(cbind(a,b))
validate(x)
#&gt; $status
#&gt; [1] "ok"
</code></pre>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2015/01/gistr-github-gists/">
        gistr - R client for GitHub gists
      </a>
    </h1>

    <span class="post-date">05 Jan 2015</span>

    <p>GitHub has this site <a href="https://gist.github.com/">https://gist.github.com/</a> in which we can share code, text, images, maps, plots, etc super easily, without having to open up a repo, etc. GitHub gists are a great way to throw up an example use case to show someone, or show code that’s throwing errors to a support person, etc. In addition, there’s API access, which means we can interact with Gists not just from their web interface, but from the command line, or any programming language. There are clients for <a href="https://github.com/mbostock/gistup">Node.js</a>, <a href="https://rubygems.org/gems/gist">Ruby</a>, <a href="https://pypi.python.org/pypi/gists/0.4.6">Python</a>, and on and on. But AFAIK there wasn’t one for R. Along with <a href="https://github.com/ramnathv">Ramnath</a> and others, we’ve been working on an R client for gists. <code>v0.1</code> is <a href="http://cran.r-project.org/web/packages/gistr/index.html">now on CRAN</a>. Below is an overview.</p>

<p>One useful thing about this package in terms of other R packages is that you can now depend on <code>gistr</code> to easily share results as Gists. For example, you can share maps as gists (via geojson, rendered as interactive map), or code, or plots, etc. That is, you don’t have to re-write an interface to Github Gists yourself. We plan on using <code>gistr</code> in a few rOpenSci packages.</p>

<h2 id="installation">Installation</h2>

<h2 id="installation-1">Installation</h2>

<p>Install from CRAN</p>

<pre><code class="language-r">install.packages("gistr")
</code></pre>

<p>Or the development version from GitHub</p>

<pre><code class="language-r">install.packages("devtools")
devtools::install_github("ropensci/gistr")
</code></pre>

<pre><code class="language-r">library("gistr")
</code></pre>

<h2 id="authentication">Authentication</h2>

<p>There are two ways to authorise <code>gistr</code> to work with your GitHub account:</p>

<ul>
  <li>Generate a personal access token (PAT) at <a href="https://help.github.com/articles/creating-an-access-token-for-command-line-use">https://help.github.com/articles/creating-an-access-token-for-command-line-use</a> and record it in the <code>GITHUB_PAT</code> envar.</li>
  <li>Interactively login into your GitHub account and authorise with OAuth.</li>
</ul>

<p>Using the PAT is recommended.</p>

<p>Using the <code>gist_auth()</code> function you can authenticate seperately first, or if you’re not authenticated, this function will run internally with each functionn call. If you have a PAT, that will be used, if not, OAuth will be used.</p>

<pre><code class="language-r">gist_auth()
</code></pre>

<h2 id="workflow">Workflow</h2>

<p>In <code>gistr</code> you can use pipes to pass outputs from one function to another. If you have used <code>dplyr</code> with pipes you can see the difference, and perhaps the utility, of this workflow over the traditional workflow in R. You can use a non-piping or a piping workflow with <code>gistr</code>. Examples below use a mix of both workflows. Here is an example of a piping wofklow (with some explanation):</p>

<pre><code class="language-r">gists(what = "minepublic")[[6]] %&gt;% # List my public gists, and index 1st
  add_files("~/alm_othersources.md") %&gt;% # Add new file to that gist
  update() # update sends a PATCH command to Gists API to add file to your gist
</code></pre>

<p>And a non-piping workflow that does the same exact thing:</p>

<pre><code class="language-r">g &lt;- gists(what = "minepublic")[[1]]
g &lt;- add_files(g, "~/alm_othersources.md")
update(g)
</code></pre>

<p>Or you could string them all together in one line (but it’s rather difficult to follow what’s going on because you have to read from the inside out)</p>

<pre><code class="language-r">update(add_files(gists(what = "minepublic")[[1]], "~/alm_othersources.md"))
</code></pre>

<h2 id="rate-limit-information">Rate limit information</h2>

<pre><code class="language-r">rate_limit()
#&gt; Rate limit: 5000
#&gt; Remaining:  4948
#&gt; Resets in:  46 minutes
</code></pre>

<h2 id="list-gists">List gists</h2>

<p>Limiting to a few results here to keep it brief</p>

<pre><code class="language-r">gists(per_page = 2)
#&gt; [[1]]
#&gt; &lt;gist&gt;575fd0342ae15f89645f
#&gt;   URL: https://gist.github.com/575fd0342ae15f89645f
#&gt;   Description: Script to disable the mouse acceleration on Ubuntu (and probably also other distributions). Read the 'usage' section.
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2015-01-04T17:41:49Z / 2015-01-04T17:41:50Z
#&gt;   Files: disable-mouse-accel.sh
#&gt; 
#&gt; [[2]]
#&gt; &lt;gist&gt;1ebff1af906f214f98cd
#&gt;   URL: https://gist.github.com/1ebff1af906f214f98cd
#&gt;   Description: Ladda
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2015-01-04T17:41:45Z / 2015-01-04T17:41:45Z
#&gt;   Files: Ladda.markdown, index.html, script.js, style.css
</code></pre>

<p>Since a certain date/time</p>

<pre><code class="language-r">gists(since='2014-05-26T00:00:00Z', per_page = 2)
#&gt; [[1]]
#&gt; &lt;gist&gt;575fd0342ae15f89645f
#&gt;   URL: https://gist.github.com/575fd0342ae15f89645f
#&gt;   Description: Script to disable the mouse acceleration on Ubuntu (and probably also other distributions). Read the 'usage' section.
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2015-01-04T17:41:49Z / 2015-01-04T17:41:50Z
#&gt;   Files: disable-mouse-accel.sh
#&gt; 
#&gt; [[2]]
#&gt; &lt;gist&gt;1ebff1af906f214f98cd
#&gt;   URL: https://gist.github.com/1ebff1af906f214f98cd
#&gt;   Description: Ladda
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2015-01-04T17:41:45Z / 2015-01-04T17:41:45Z
#&gt;   Files: Ladda.markdown, index.html, script.js, style.css
</code></pre>

<p>Request different types of gists, one of public, minepublic, mineall, or starred.</p>

<pre><code class="language-r">gists('minepublic', per_page = 2)
#&gt; [[1]]
#&gt; &lt;gist&gt;588921d4111e00551bcf
#&gt;   URL: https://gist.github.com/588921d4111e00551bcf
#&gt;   Description: 
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2015-01-04T17:33:47Z / 2015-01-04T17:33:56Z
#&gt;   Files: code.R
#&gt; 
#&gt; [[2]]
#&gt; &lt;gist&gt;54c0195ee8753c7aaf9f
#&gt;   URL: https://gist.github.com/54c0195ee8753c7aaf9f
#&gt;   Description: a new cool gist
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2015-01-04T17:33:47Z / 2015-01-04T17:33:47Z
#&gt;   Files: stuff.md
</code></pre>

<h2 id="list-a-single-gist">List a single gist</h2>

<pre><code class="language-r">gist(id = 'f1403260eb92f5dfa7e1')
#&gt; &lt;gist&gt;f1403260eb92f5dfa7e1
#&gt;   URL: https://gist.github.com/f1403260eb92f5dfa7e1
#&gt;   Description: Querying bitly from R 
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2014-10-15T20:40:12Z / 2014-10-15T21:54:29Z
#&gt;   Files: bitly_r.md
</code></pre>

<h2 id="create-gist">Create gist</h2>

<p>You can pass in files</p>

<p>First, get a file to work with</p>

<pre><code class="language-r">stuffpath &lt;- system.file("examples", "stuff.md", package = "gistr")
</code></pre>

<pre><code class="language-r">gist_create(files=stuffpath, description='a new cool gist')
</code></pre>

<pre><code class="language-r">gist_create(files=stuffpath, description='a new cool gist', browse = FALSE)
#&gt; &lt;gist&gt;aa391404638f2f368b99
#&gt;   URL: https://gist.github.com/aa391404638f2f368b99
#&gt;   Description: a new cool gist
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2015-01-04T17:42:37Z / 2015-01-04T17:42:37Z
#&gt;   Files: stuff.md
</code></pre>

<p>Or, wrap <code>gist_create()</code> around some code in your R session/IDE, like so, with just the function name, and a <code>{'</code> at the start and a <code>}'</code> at the end.</p>

<pre><code class="language-r">gist_create(code={'
x &lt;- letters
numbers &lt;- runif(8)
numbers

[1] 0.3229318 0.5933054 0.7778408 0.3898947 0.1309717 0.7501378 0.3206379 0.3379005
'}, browse=FALSE)
#&gt; &lt;gist&gt;85158117880f197df422
#&gt;   URL: https://gist.github.com/85158117880f197df422
#&gt;   Description: 
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2015-01-04T17:42:37Z / 2015-01-04T17:42:37Z
#&gt;   Files: code.R
</code></pre>

<p>You can also knit an input file before posting as a gist:</p>

<pre><code class="language-r">file &lt;- system.file("examples", "stuff.Rmd", package = "gistr")
gist_create(file, description='a new cool gist', knit=TRUE)
#&gt; &lt;gist&gt;4162b9c53479fbc298db
#&gt;   URL: https://gist.github.com/4162b9c53479fbc298db
#&gt;   Description: a new cool gist
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2014-10-27T16:07:31Z / 2014-10-27T16:07:31Z
#&gt;   Files: stuff.md
</code></pre>

<p>Or code blocks before (note that code blocks without knitr block demarcations will result in unexecuted code):</p>

<pre><code class="language-r">gist_create(code={'
x &lt;- letters
(numbers &lt;- runif(8))
'}, knit=TRUE)
#&gt; &lt;gist&gt;ec45c396dee4aa492139
#&gt;   URL: https://gist.github.com/ec45c396dee4aa492139
#&gt;   Description:
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2014-10-27T16:09:09Z / 2014-10-27T16:09:09Z
#&gt;   Files: file81720d1ceff.md
</code></pre>

<h2 id="knit-code-from-file-path-code-block-or-gist-file">knit code from file path, code block, or gist file</h2>

<p>knit a local file</p>

<pre><code class="language-r">file &lt;- system.file("examples", "stuff.Rmd", package = "gistr")
run(file, knitopts = list(quiet=TRUE)) %&gt;% gist_create(browse = FALSE)
#&gt; &lt;gist&gt;d5d86e11964c36cb4f1e
#&gt;   URL: https://gist.github.com/d5d86e11964c36cb4f1e
#&gt;   Description: 
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2015-01-04T17:42:38Z / 2015-01-04T17:42:38Z
#&gt;   Files: stuff.md
</code></pre>

<p>knit a code block (<code>knitr</code> code block notation missing, do add that in) (result not shown)</p>

<pre><code class="language-r">run({'
x &lt;- letters
(numbers &lt;- runif(8))
'}) %&gt;% gist_create
</code></pre>

<p>knit a file from a gist, has to get file first (result not shown)</p>

<pre><code class="language-r">gists('minepublic')[[1]] %&gt;% run() %&gt;% update()
</code></pre>

<h2 id="list-commits-on-a-gist">List commits on a gist</h2>

<pre><code class="language-r">gists()[[1]] %&gt;% commits()
#&gt; [[1]]
#&gt; &lt;commit&gt;
#&gt;   Version: faa7a40f4b55aa7914be7685c75d5c80731971bb
#&gt;   User: sckott
#&gt;   Commited: 2015-01-04T17:42:37Z
#&gt;   Commits [total, additions, deletions]: [5,5,0]
</code></pre>

<h2 id="star-a-gist">Star a gist</h2>

<p>Star</p>

<pre><code class="language-r">gist('7ddb9810fc99c84c65ec') %&gt;% star()
#&gt; &lt;gist&gt;7ddb9810fc99c84c65ec
#&gt;   URL: https://gist.github.com/7ddb9810fc99c84c65ec
#&gt;   Description: 
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2014-06-27T17:50:37Z / 2014-06-27T17:50:37Z
#&gt;   Files: code.R, manifest.yml, rrt_manifest.yml
</code></pre>

<p>Unstar</p>

<pre><code class="language-r">gist('7ddb9810fc99c84c65ec') %&gt;% unstar()
#&gt; &lt;gist&gt;7ddb9810fc99c84c65ec
#&gt;   URL: https://gist.github.com/7ddb9810fc99c84c65ec
#&gt;   Description: 
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2014-06-27T17:50:37Z / 2014-06-27T17:50:37Z
#&gt;   Files: code.R, manifest.yml, rrt_manifest.yml
</code></pre>

<h2 id="update-a-gist">Update a gist</h2>

<p>Add files</p>

<p>First, path to file</p>

<pre><code class="language-r">file &lt;- system.file("examples", "alm_othersources.md", package = "gistr")
</code></pre>

<pre><code class="language-r">gists(what = "minepublic")[[1]] %&gt;%
  add_files(file) %&gt;%
  update()
#&gt; &lt;gist&gt;85158117880f197df422
#&gt;   URL: https://gist.github.com/85158117880f197df422
#&gt;   Description: 
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2015-01-04T17:42:37Z / 2015-01-04T17:42:42Z
#&gt;   Files: alm_othersources.md, code.R
</code></pre>

<p>Delete files</p>

<pre><code class="language-r">gists(what = "minepublic")[[1]] %&gt;%
  delete_files(file) %&gt;%
  update()
#&gt; &lt;gist&gt;85158117880f197df422
#&gt;   URL: https://gist.github.com/85158117880f197df422
#&gt;   Description: 
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2015-01-04T17:42:37Z / 2015-01-04T17:42:42Z
#&gt;   Files: code.R
</code></pre>

<h2 id="open-a-gist-in-your-default-browser">Open a gist in your default browser</h2>

<pre><code class="language-r">gists()[[1]] %&gt;% browse()
</code></pre>

<blockquote>
  <p>Opens the gist in your default browser</p>
</blockquote>

<h2 id="get-embed-script">Get embed script</h2>

<pre><code class="language-r">gists()[[1]] %&gt;% embed()
#&gt; [1] "&lt;script src=\"https://gist.github.com/sckott/85158117880f197df422.js\"&gt;&lt;/script&gt;"
</code></pre>

<h3 id="list-forks">List forks</h3>

<p>Returns a list of <code>gist</code> objects, just like <code>gists()</code></p>

<pre><code class="language-r">gist(id='1642874') %&gt;% forks(per_page=2)
#&gt; [[1]]
#&gt; &lt;gist&gt;1642989
#&gt;   URL: https://gist.github.com/1642989
#&gt;   Description: Spline Transition
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2012-01-19T21:45:20Z / 2014-12-10T03:25:19Z
#&gt;   Files: 
#&gt; 
#&gt; [[2]]
#&gt; &lt;gist&gt;1643051
#&gt;   URL: https://gist.github.com/1643051
#&gt;   Description: Line Transition (Broken)
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2012-01-19T21:51:30Z / 2014-04-09T03:11:36Z
#&gt;   Files:
</code></pre>

<h2 id="fork-a-gist">Fork a gist</h2>

<p>Returns a <code>gist</code> object</p>

<pre><code class="language-r">g &lt;- gists()
(forked &lt;- g[[ sample(seq_along(g), 1) ]] %&gt;% fork())
#&gt; &lt;gist&gt;62b05dd4ebc2d29add15
#&gt;   URL: https://gist.github.com/62b05dd4ebc2d29add15
#&gt;   Description: Solution to level 1 in Untrusted: http://alex.nisnevich.com/untrusted/
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2015-01-04T17:42:43Z / 2015-01-04T17:42:43Z
#&gt;   Files: untrusted-lvl1-solution.js
</code></pre>

<h2 id="example-use-case">Example use case</h2>

<p><em>Working with the Mapzen Pelias geocoding API</em></p>

<p>The API is described at <a href="https://github.com/pelias/pelias">https://github.com/pelias/pelias</a>, and is still in alpha they say. The steps: get data, make a gist. The data is returned from Mapzen as geojson, so all we have to do is literally push it up to GitHub gists and we’re done b/c GitHub renders the map.</p>

<pre><code class="language-r">library('httr')
base &lt;- "http://pelias.mapzen.com/search"
res &lt;- GET(base, query = list(input = 'coffee shop', lat = 45.5, lon = -122.6))
json &lt;- content(res, as = "text")
gist_create(code = json, filename = "pelias_test.geojson")
#&gt; &lt;gist&gt;017214637bcfeb198070
#&gt;   URL: https://gist.github.com/017214637bcfeb198070
#&gt;   Description:
#&gt;   Public: TRUE
#&gt;   Created/Edited: 2014-10-28T14:42:36Z / 2014-10-28T14:42:36Z
#&gt;   Files: pelias_test.geojson
</code></pre>

<p>And here’s that gist: <a href="https://gist.github.com/sckott/017214637bcfeb198070">https://gist.github.com/sckott/017214637bcfeb198070</a></p>

<p><img src="/public/img/2015-01-05-gistr-github-gists/gistr_ss.png" alt="image" /></p>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2014/12/pytaxize-itis/">
        pytaxize - low level ITIS functions
      </a>
    </h1>

    <span class="post-date">26 Dec 2014</span>

    <p>I’ve been working on a Python port of the R package <code>taxize</code> that I maintain. It’s still early days with this Python library, I’d love to know what people think. For example, I’m giving back Pandas DataFrame’s from most functions. Does this make sense?</p>

<h2 id="installation">Installation</h2>

<pre><code>sudo pip install git+git://github.com/sckott/pytaxize.git#egg=pytaxize
</code></pre>

<p>Or <code>git clone</code> the repo down, and <code>python setup.py build &amp;&amp; python setup.py install</code></p>

<h2 id="load-library">Load library</h2>

<pre><code class="language-python">import pytaxize
</code></pre>

<h2 id="itis-ping">ITIS ping</h2>

<pre><code class="language-python">pytaxize.itis_ping()
</code></pre>

<pre><code class="language-python">'This is the ITIS Web Service, providing access to the data behind www.itis.gov. The database contains 665,266 scientific names (501,207 of them valid/accepted) and 122,735 common names.'
</code></pre>

<h2 id="get-hierarchy-down-from-tsn">Get hierarchy down from tsn</h2>

<pre><code class="language-python">pytaxize.gethierarchydownfromtsn(tsn = 161030)
</code></pre>

<pre><code class="language-python">      tsn rankName       taxonName    parentName parentTsn
0  161048    Class   Sarcopterygii  Osteichthyes    161030
1  161061    Class  Actinopterygii  Osteichthyes    161030
</code></pre>

<h2 id="get-hierarchy-up-from-tsn">Get hierarchy up from tsn</h2>

<pre><code class="language-python">pytaxize.gethierarchyupfromtsn(tsn = 37906)
</code></pre>

<pre><code class="language-python">               author  parentName parentTsn rankName taxonName    tsn
0  Gaertn. ex Schreb.  Asteraceae     35420    Genus   Liatris  37906
</code></pre>

<h2 id="get-rank-names">Get rank names</h2>

<pre><code class="language-python">pytaxize.getranknames()
</code></pre>

<pre><code class="language-python">    kingdomname rankid      rankname
0      Bacteria     10       Kingdom
1      Bacteria     20    Subkingdom
2      Bacteria     30        Phylum
3      Bacteria     40     Subphylum
4      Bacteria     50    Superclass
5      Bacteria     60         Class
6      Bacteria     70      Subclass
7      Bacteria     80    Infraclass
8      Bacteria     90    Superorder
9      Bacteria    100         Order
10     Bacteria    110      Suborder
11     Bacteria    120    Infraorder
12     Bacteria    130   Superfamily
13     Bacteria    140        Family
14     Bacteria    150     Subfamily
15     Bacteria    160         Tribe
16     Bacteria    170      Subtribe
17     Bacteria    180         Genus
18     Bacteria    190      Subgenus
19     Bacteria    220       Species
20     Bacteria    230    Subspecies
21     Protozoa     10       Kingdom
22     Protozoa     20    Subkingdom
23     Protozoa     25  Infrakingdom
24     Protozoa     30        Phylum
25     Protozoa     40     Subphylum
26     Protozoa     45   Infraphylum
27     Protozoa     47    Parvphylum
28     Protozoa     50    Superclass
29     Protozoa     60         Class
..          ...    ...           ...
150   Chromista    190      Subgenus
151   Chromista    200       Section
152   Chromista    210    Subsection
153   Chromista    220       Species
154   Chromista    230    Subspecies
155   Chromista    240       Variety
156   Chromista    250    Subvariety
157   Chromista    260          Form
158   Chromista    270       Subform
159     Archaea     10       Kingdom
160     Archaea     20    Subkingdom
161     Archaea     30        Phylum
162     Archaea     40     Subphylum
163     Archaea     50    Superclass
164     Archaea     60         Class
165     Archaea     70      Subclass
166     Archaea     80    Infraclass
167     Archaea     90    Superorder
168     Archaea    100         Order
169     Archaea    110      Suborder
170     Archaea    120    Infraorder
171     Archaea    130   Superfamily
172     Archaea    140        Family
173     Archaea    150     Subfamily
174     Archaea    160         Tribe
175     Archaea    170      Subtribe
176     Archaea    180         Genus
177     Archaea    190      Subgenus
178     Archaea    220       Species
179     Archaea    230    Subspecies
</code></pre>

<h2 id="search-by-scientific-name">Search by scientific name</h2>

<pre><code class="language-python">pytaxize.searchbyscientificname(x="Tardigrada")
</code></pre>

<pre><code class="language-python">           combinedname     tsn
0    Rotaria tardigrada   58274
1  Notommata tardigrada   58898
2   Pilargis tardigrada   65562
3            Tardigrada  155166
4      Heterotardigrada  155167
5      Arthrotardigrada  155168
6        Mesotardigrada  155358
7          Eutardigrada  155362
8   Scytodes tardigrada  866744
</code></pre>

<h2 id="get-accepted-names-from-tsn">Get accepted names from tsn</h2>

<pre><code class="language-python">pytaxize.getacceptednamesfromtsn('208527')
</code></pre>

<p>If accepted, returns the same id</p>

<pre><code class="language-python">'208527'
</code></pre>

<h2 id="more">More</h2>

<p>For the other functions see https://github.com/sckott/pytaxize/blob/master/pytaxize/itis.py</p>

  </div>
  
</div>

<!-- Pagination links -->
<div class="pagination">
  
    <a href="/page11" class="older">Older</a>
  
  
    
      <a href="/page9" class="newer">Newer</a>
    
  
</div>

    </div>

    <!-- for bootstrap tooltips -->
    <script type="text/javascript">
      $("[data-toggle=\"tooltip\"]").tooltip();
    </script>

  </body>

  <footer>
  <!-- Disqus code -->
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'recology'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>

  <!-- google analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-63197374-1', 'auto');
    ga('send', 'pageview');
  </script>
</footer>

</html>
