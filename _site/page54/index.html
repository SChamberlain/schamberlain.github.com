<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    
    Recology, R/etc.
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <link rel="stylesheet" href="/public/css/bootstrap/css/bootstrap.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon.ico">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0f layout-reverse">

    <header class="masthead">
      <div class="masthead-inner">
        <h1>Recology</h1>
        <!-- <h1> <a href="http://recology.info/">Recology</a></h1> -->
        <p class="lead">R/etc.</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="/"><i class="fa fa-home fa-lg"></i></a>&nbsp;
              <a href="/about"><i class="fa fa-info-circle fa-lg"></i></a>&nbsp;
              <a href="/archives"><i class="fa fa-archive fa-lg"></i></a>&nbsp;
              <a href="/rresources"><i class="fa fa-book fa-lg"></i></a>&nbsp;
              <a href="http://rforcats.net/" rel><i class="fa fa-graduation-cap fa-lg"></i></a>&nbsp;
              <a href="/feed.xml"><i class="fa fa-rss fa-lg"></i></a>&nbsp;
              <a href="https://twitter.com/sckottie"><i class="fa fa-twitter fa-lg"></i></a>&nbsp;
              <a href="/fork"><i class="fa fa-spinner fa-lg"></i></a>
            </li>
          </ul>
          <!-- <small><a href="https://github.com/mdo/hyde">Hyde</a> from <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</small> -->
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="posts">
  <a style="float:right;" href="/archives" data-toggle="tooltip" data-placement="bottom" title="Archives"><i class="fa fa-archive fa-lg"></i></a>
  <a style="float:right;" href="/tags"><i class="fa fa-tags fa-lg"></i></a>&nbsp;
  
  <div class="post">
    <h1>
      <a href="/2011/04/phylometa-from-r-udpate/">
        Phylometa from R - UDPATE
      </a>
    </h1>

    <span class="post-date">01 Apr 2011</span>

    <p><a href="http://r-ecology.blogspot.com/2010/12/phylogenetic-meta-analysis-in-r-using.html">A while back I posted some messy code to run Phylometa from R</a>, especially useful for processing the output data from Phylometa which is not easily done. The code is still quite messy, but it should work now. I have run the code with tens of different data sets and phylogenies so it should work. <br />&lt;div&gt;<br />&lt;/div&gt;&lt;div&gt;I fixed errors when parentheses came up against numbers in the output, and other things. You can use the code for up to 4 levels of your grouping variable. In addition, there are some lines of code to plot the effect sizes with confidence intervals, comparing random and fixed effects models and phylogenetic and traditional models. &lt;/div&gt;&lt;div&gt;<br />&lt;/div&gt;&lt;div&gt;Get the code at my website:&lt;/div&gt;&lt;div&gt;-<span class="Apple-style-span" style="color: #333333; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px; line-height: 23px;"><a href="https://gist.github.com/939970" style="border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; color: #1c9bdc; font-style: inherit; font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-decoration: underline; vertical-align: baseline;" target="_blank">phylometa_fxn.R</a></span>&lt;/div&gt;&lt;div&gt;-<span class="Apple-style-span" style="color: #333333; font-family: Georgia, 'Bitstream Charter', serif; font-size: 14px; line-height: 23px;"><a href="https://gist.github.com/939971" style="border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; color: #1c9bdc; font-style: inherit; font-weight: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-decoration: underline; vertical-align: baseline;" target="_blank">phylometa_inR_run.R</a></span>&lt;/div&gt;&lt;div&gt;- Use the first file to do the work, calling the second file using source().<br />- This new code works with Marc’s new version of Phylometa, so please update: http://lajeunesse.myweb.usf.edu/publications.html&lt;/div&gt;&lt;div&gt;<br />&lt;/div&gt;&lt;div&gt;Again, please let me know if it doesn’t work, if it’s worthless, what changes could make it better.<br /><br />Some notes on tree formatting for Phylometa. <br />1. Trees cannot have node labels - remove them (e.g., tree$node.label &lt; NULL).<br />2. Trees cannot have zero length branches. This may seem like a non-problem, but it might be for example if you have resolved polytomies and zero length branches are added to resolve the polytomy.<br />3. I think you cannot have a branch length on the root branch.<br /><br />&lt;/div&gt;</p>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2011/03/bio-oracle/">
        Bio-ORACLE
      </a>
    </h1>

    <span class="post-date">25 Mar 2011</span>

    <p><a href="http://www.oracle.ugent.be/index.html">Bio-ORACLE</a>&lt;div&gt;<br />&lt;/div&gt;&lt;div&gt;A new dataset available of geophysical, biotic and climate data. Should be fun to play with in R. &lt;/div&gt;</p>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2011/03/basic-ggplot2-network-graphs-ver2/">
        basic ggplot2 network graphs ver2
      </a>
    </h1>

    <span class="post-date">23 Mar 2011</span>

    <hr />

<p>I posted last week a simple function to plot networks using ggplot2 package. Here is version 2. I still need to work on figuring out efficient vertex placement.</p>

<p>Changes in version 2:</p>

<ul>
  <li>You have one of three options: use an igraph object, a matrix, or a dataframe (matrices will be converted to data frames within the function)</li>
  <li>If you have data on food webs similar to that provided in the Takapoto dataset provided in the NetIndices package, you can set trophic = “TRUE”, and gggraph will use the function TrophInd to assign trophic levels (the y axis value) to each vertex/node. You have to provide additional information along with this option such as what the imports and exports are, see NetIndices documentation.</li>
  <li>I added some simple error checking.</li>
  <li>if using method=”df” and trophic=”FALSE”, x axis placement of vertices is now done using the function degreex (see inside the fxn), which sorts vertices according to their degree (so the least connected species are on the left of the graph; note that species with the same degree are not stacked on the y-axis because e.g., two vertices of degree=5 would get x=3 then x=4).</li>
</ul>

<hr />

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># ggraph Version 2
</span><span class="n">require</span><span class="p">(</span><span class="n">bipartite</span><span class="p">)</span>
<span class="n">require</span><span class="p">(</span><span class="n">igraph</span><span class="p">)</span>
<span class="n">require</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># gggraph, version 3 g = an igraph graph object, a matrix, or data frame
# vplace = type of vertex placement assignment, one of rnorm, runif, etc.
# method = one of 'df' for data frame, 'mat' for matrix or 'igraph' for an
# igraph graph object trophic = TRUE or FALSE for using Netindices
# function TrophInd to determine trophic level (y value in graph)
# trophinames = columns in matrix or dataframe to use for calculating
# trophic level import = named or refereced by col# columns of matrix or
# dataframe to use for import argument of TrophInd export = named or
# refereced by col# columns of matrix or dataframe to use for export
# argument of TrophInd dead = named or refereced by col# columns of matrix
# or dataframe to use for dead argument of TrophInd
</span>
<span class="n">gggraph</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">vplace</span> <span class="o">=</span> <span class="n">rnorm</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">trophic</span> <span class="o">=</span> <span class="s2">"FALSE"</span><span class="p">,</span> <span class="n">trophinames</span><span class="p">,</span> 
    <span class="n">import</span><span class="p">,</span> <span class="n">export</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">degreex</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">degreecol</span> <span class="o">&lt;-</span> <span class="n">apply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="n">length</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">]))</span>
        <span class="n">degreerow</span> <span class="o">&lt;-</span> <span class="n">apply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="n">length</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">]))</span>
        <span class="n">degrees</span> <span class="o">&lt;-</span> <span class="n">sort</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="n">degreecol</span><span class="p">,</span> <span class="n">degreerow</span><span class="p">))</span>
        <span class="n">df</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">degrees</span><span class="p">),</span> <span class="m">1</span><span class="p">))</span>
        <span class="n">df</span><span class="o">$</span><span class="n">value</span> <span class="o">&lt;-</span> <span class="n">rownames</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span>
    <span class="p">}</span>
    <span class="c1"># require igraph
</span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">igraph</span><span class="p">))</span> 
        <span class="n">stop</span><span class="p">(</span><span class="s2">"must first install 'igraph' package."</span><span class="p">)</span>
    <span class="c1"># require ggplot2
</span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">))</span> 
        <span class="n">stop</span><span class="p">(</span><span class="s2">"must first install 'ggplot2' package."</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"df"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">class</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"matrix"</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">g</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">class</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">"data.frame"</span><span class="p">)</span> 
            <span class="n">stop</span><span class="p">(</span><span class="s2">"object must be of class 'data.frame.'"</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">trophic</span> <span class="o">==</span> <span class="s2">"FALSE"</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1"># data preparation from adjacency matrix
</span>            <span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">expand.grid</span><span class="p">(</span><span class="n">dimnames</span><span class="p">(</span><span class="n">g</span><span class="p">))[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">],</span> <span class="n">as.vector</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">g</span><span class="p">)))</span>
            <span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">temp</span><span class="p">[(</span><span class="n">temp</span><span class="p">[,</span> <span class="m">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">!</span><span class="n">is.na</span><span class="p">(</span><span class="n">temp</span><span class="p">[,</span> <span class="m">3</span><span class="p">]),</span> <span class="p">]</span>
            <span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">temp</span><span class="p">[</span><span class="n">sort.list</span><span class="p">(</span><span class="n">temp</span><span class="p">[,</span> <span class="m">1</span><span class="p">]),</span> <span class="p">]</span>
            <span class="n">g_df</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">rows</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[,</span> <span class="m">1</span><span class="p">],</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[,</span> <span class="m">2</span><span class="p">],</span> <span class="n">freqint</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[,</span> 
                <span class="m">3</span><span class="p">])</span>
            
            <span class="n">g_df</span><span class="o">$</span><span class="n">id</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">g_df</span><span class="p">[,</span> <span class="m">1</span><span class="p">])</span>
            <span class="n">g_df</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">id</span> <span class="o">=</span> <span class="n">g_df</span><span class="p">[,</span> <span class="m">4</span><span class="p">],</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">g_df</span><span class="p">[,</span> <span class="m">1</span><span class="p">],</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">g_df</span><span class="p">[,</span> 
                <span class="m">2</span><span class="p">],</span> <span class="n">freqint</span> <span class="o">=</span> <span class="n">g_df</span><span class="p">[,</span> <span class="m">3</span><span class="p">])</span>
            <span class="n">g_df_</span> <span class="o">&lt;-</span> <span class="n">melt</span><span class="p">(</span><span class="n">g_df</span><span class="p">,</span> <span class="n">id</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">))</span>
            
            <span class="n">xy_s</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">degreex</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">y</span> <span class="o">=</span> <span class="n">rnorm</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">g_df_</span><span class="o">$</span><span class="n">value</span><span class="p">))))</span>
            <span class="n">g_df_2</span> <span class="o">&lt;-</span> <span class="n">merge</span><span class="p">(</span><span class="n">g_df_</span><span class="p">,</span> <span class="n">xy_s</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s2">"value"</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">trophic</span> <span class="o">==</span> <span class="s2">"TRUE"</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1"># require NetIndices
</span>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">NetIndices</span><span class="p">))</span> 
                <span class="n">stop</span><span class="p">(</span><span class="s2">"must first install 'NetIndices' package."</span><span class="p">)</span>
            <span class="c1"># data preparation from adjacency matrix
</span>            <span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">expand.grid</span><span class="p">(</span><span class="n">dimnames</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="o">-</span><span class="n">trophinames</span><span class="p">,</span> <span class="o">-</span><span class="n">trophinames</span><span class="p">]))[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">],</span> 
                <span class="n">as.vector</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="o">-</span><span class="n">trophinames</span><span class="p">,</span> <span class="o">-</span><span class="n">trophinames</span><span class="p">])))</span>
            <span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">temp</span><span class="p">[(</span><span class="n">temp</span><span class="p">[,</span> <span class="m">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">!</span><span class="n">is.na</span><span class="p">(</span><span class="n">temp</span><span class="p">[,</span> <span class="m">3</span><span class="p">]),</span> <span class="p">]</span>
            <span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">temp</span><span class="p">[</span><span class="n">sort.list</span><span class="p">(</span><span class="n">temp</span><span class="p">[,</span> <span class="m">1</span><span class="p">]),</span> <span class="p">]</span>
            <span class="n">g_df</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">rows</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[,</span> <span class="m">1</span><span class="p">],</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[,</span> <span class="m">2</span><span class="p">],</span> <span class="n">freqint</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[,</span> 
                <span class="m">3</span><span class="p">])</span>
            
            <span class="n">g_df</span><span class="o">$</span><span class="n">id</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">g_df</span><span class="p">[,</span> <span class="m">1</span><span class="p">])</span>
            <span class="n">g_df</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">id</span> <span class="o">=</span> <span class="n">g_df</span><span class="p">[,</span> <span class="m">4</span><span class="p">],</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">g_df</span><span class="p">[,</span> <span class="m">1</span><span class="p">],</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">g_df</span><span class="p">[,</span> 
                <span class="m">2</span><span class="p">],</span> <span class="n">freqint</span> <span class="o">=</span> <span class="n">g_df</span><span class="p">[,</span> <span class="m">3</span><span class="p">])</span>
            <span class="n">g_df_</span> <span class="o">&lt;-</span> <span class="n">melt</span><span class="p">(</span><span class="n">g_df</span><span class="p">,</span> <span class="n">id</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">))</span>
            
            <span class="n">xy_s</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">g_df_</span><span class="o">$</span><span class="n">value</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="n">rnorm</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">g_df_</span><span class="o">$</span><span class="n">value</span><span class="p">))),</span> 
                <span class="n">y</span> <span class="o">=</span> <span class="n">TrophInd</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">Import</span> <span class="o">=</span> <span class="n">import</span><span class="p">,</span> <span class="n">Export</span> <span class="o">=</span> <span class="n">export</span><span class="p">)[,</span> <span class="m">1</span><span class="p">])</span>
            <span class="n">g_df_2</span> <span class="o">&lt;-</span> <span class="n">merge</span><span class="p">(</span><span class="n">g_df_</span><span class="p">,</span> <span class="n">xy_s</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s2">"value"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c1"># plotting
</span>        <span class="n">p</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">g_df_2</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="n">freqint</span><span class="p">,</span> 
            <span class="n">group</span> <span class="o">=</span> <span class="n">id</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">1.5</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">value</span><span class="p">))</span> <span class="o">+</span> 
            <span class="n">theme_bw</span><span class="p">()</span> <span class="o">+</span> <span class="n">opts</span><span class="p">(</span><span class="n">panel.grid.major</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> <span class="n">panel.grid.minor</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> 
            <span class="n">axis.text.x</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> <span class="n">axis.text.y</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> <span class="n">axis.title.x</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> 
            <span class="n">axis.title.y</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> <span class="n">axis.ticks</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> <span class="n">panel.border</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> 
            <span class="n">legend.position</span> <span class="o">=</span> <span class="s2">"none"</span><span class="p">)</span>
        
        <span class="n">p</span>  <span class="c1"># return graph
</span>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"igraph"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">class</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">"igraph"</span><span class="p">)</span> 
            <span class="n">stop</span><span class="p">(</span><span class="s2">"object must be of class 'igraph.'"</span><span class="p">)</span>
        <span class="c1"># data preparation from igraph object
</span>        <span class="n">g_</span> <span class="o">&lt;-</span> <span class="n">get.edgelist</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">g_df</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">g_</span><span class="p">)</span>
        <span class="n">g_df</span><span class="o">$</span><span class="n">id</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">g_df</span><span class="p">[,</span> <span class="m">1</span><span class="p">])</span>
        <span class="n">g_df</span> <span class="o">&lt;-</span> <span class="n">melt</span><span class="p">(</span><span class="n">g_df</span><span class="p">,</span> <span class="n">id</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
        <span class="n">xy_s</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">g_df</span><span class="o">$</span><span class="n">value</span><span class="p">),</span> <span class="n">x</span> <span class="o">=</span> <span class="n">vplace</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">g_df</span><span class="o">$</span><span class="n">value</span><span class="p">))),</span> 
            <span class="n">y</span> <span class="o">=</span> <span class="n">vplace</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">g_df</span><span class="o">$</span><span class="n">value</span><span class="p">))))</span>
        <span class="n">g_df2</span> <span class="o">&lt;-</span> <span class="n">merge</span><span class="p">(</span><span class="n">g_df</span><span class="p">,</span> <span class="n">xy_s</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s2">"value"</span><span class="p">)</span>
        
        <span class="c1"># plotting
</span>        <span class="n">p</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">g_df2</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">geom_line</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">0.3</span><span class="p">,</span> 
            <span class="n">aes</span><span class="p">(</span><span class="n">group</span> <span class="o">=</span> <span class="n">id</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="n">id</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="m">1.5</span><span class="p">,</span> 
            <span class="n">aes</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">value</span><span class="p">))</span> <span class="o">+</span> <span class="n">theme_bw</span><span class="p">()</span> <span class="o">+</span> <span class="n">opts</span><span class="p">(</span><span class="n">panel.grid.major</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> 
            <span class="n">panel.grid.minor</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> <span class="n">axis.text.x</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> <span class="n">axis.text.y</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> 
            <span class="n">axis.title.x</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> <span class="n">axis.title.y</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> <span class="n">axis.ticks</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> 
            <span class="n">panel.border</span> <span class="o">=</span> <span class="n">theme_blank</span><span class="p">(),</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="s2">"none"</span><span class="p">)</span>
        
        <span class="n">p</span>  <span class="c1"># return graph
</span>    <span class="p">}</span> <span class="k">else</span> <span class="n">stop</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"do not recognize method = \""</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="s2">"\";\nmethods are \"df\" and \"igraph\""</span><span class="p">,</span> 
        <span class="n">sep</span> <span class="o">=</span> <span class="s2">""</span><span class="p">))</span>
<span class="p">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Eg
</span><span class="n">library</span><span class="p">(</span><span class="n">NetIndices</span><span class="p">)</span>
<span class="n">data</span><span class="p">(</span><span class="n">Takapoto</span><span class="p">)</span>
<span class="n">gggraph</span><span class="p">(</span><span class="n">Takapoto</span><span class="p">,</span> <span class="n">vplace</span> <span class="o">=</span> <span class="n">rnorm</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s2">"df"</span><span class="p">,</span> <span class="n">trophic</span> <span class="o">=</span> <span class="s2">"TRUE"</span><span class="p">,</span> <span class="n">trophinames</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">8</span><span class="o">:</span><span class="m">10</span><span class="p">),</span> 
    <span class="n">import</span> <span class="o">=</span> <span class="s2">"CO2"</span><span class="p">,</span> <span class="n">export</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"CO2"</span><span class="p">,</span> <span class="s2">"Sedimentation"</span><span class="p">,</span> <span class="s2">"Grazing"</span><span class="p">))</span></code></pre></figure>

<p><img src="/public/img/gggraph1.png" alt="center" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">plants</span> <span class="o">&lt;-</span> <span class="n">round</span><span class="p">(</span><span class="n">rlnorm</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span> <span class="n">meanlog</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">sdlog</span> <span class="o">=</span> <span class="m">1</span><span class="p">))</span>
<span class="n">animals</span> <span class="o">&lt;-</span> <span class="n">round</span><span class="p">(</span><span class="n">rlnorm</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span> <span class="n">meanlog</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">sdlog</span> <span class="o">=</span> <span class="m">1</span><span class="p">))</span>
<span class="n">plants</span> <span class="o">&lt;-</span> <span class="n">plants</span> <span class="o">*</span> <span class="p">(</span><span class="m">100</span><span class="o">/</span><span class="n">sum</span><span class="p">(</span><span class="n">plants</span><span class="p">))</span>
<span class="n">animals</span> <span class="o">&lt;-</span> <span class="n">animals</span> <span class="o">*</span> <span class="p">(</span><span class="m">100</span><span class="o">/</span><span class="n">sum</span><span class="p">(</span><span class="n">animals</span><span class="p">))</span>
<span class="n">z</span> <span class="o">&lt;-</span> <span class="n">r2dtable</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">animals</span><span class="p">,</span> <span class="n">plants</span><span class="p">)</span>  <span class="c1"># if errors, rerun again until no error
</span><span class="n">z</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">z</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span>
<span class="n">rownames</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">)</span>
<span class="n">gggraph</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">vplace</span> <span class="o">=</span> <span class="n">rnorm</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s2">"df"</span><span class="p">,</span> <span class="n">trophic</span> <span class="o">=</span> <span class="s2">"FALSE"</span><span class="p">)</span></code></pre></figure>

<p><img src="/public/img/gggraph2.png" alt="center" /></p>


  </div>
  
</div>

<!-- Pagination links -->
<div class="pagination">
  
    <a href="/page55" class="older">Older</a>
  
  
    
      <a href="/page53" class="newer">Newer</a>
    
  
</div>

    </div>

    <!-- for bootstrap tooltips -->
    <script type="text/javascript">
      $("[data-toggle=\"tooltip\"]").tooltip();
    </script>

  </body>

  <footer>
  <!-- Disqus code -->
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'recology'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>

  <!-- google analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-63197374-1', 'auto');
    ga('send', 'pageview');
  </script>
</footer>

</html>
