<!DOCTYPE html>

<html>
  <head>

    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">

    <title>Recology: An exploration of using R for ecology, evolution, and open science.</title>

    <script type="text/javascript" src="http://use.typekit.com/jjw2jrj.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

    <link type="text/css" rel="stylesheet" href="/stylesheets/reset.css">
    <link type="text/css" rel="stylesheet" href="/stylesheets/screen.css">
    <link type="text/css" rel="stylesheet" href="/stylesheets/code.css">
    <link rel="alternate" type="application/atom+xml"
      title="Recology feed" href="http://feeds.feedburner.com/schamberlain" />

    <link rel="apple-touch-icon" href="/images/uo-logo.png" />
    <link rel="apple-touch-icon-precomposed" href="/images/uo-logo.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" media="screen and (resolution: 132dpi)" href="/images/uo-logo.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" media="screen and (resolution: 326dpi)" href="/images/uo-logo.png" />

    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />



  </head>
  <body class="default">

    <section id="main">

      <section id="masthead" class="group">
        <header class="group">
          <p><a href="/">Recology</a></p>
          <h1>An exploration of using R for ecology, evolution, and open science.</h1>
          <img src="/images/uo-logo.png">
        </header>
      </section>

      <section id="focus" class="group">

        <section id="content" class="group">
          <section id="posts">
  <ol>
    
    <li>
      <article class="instapaper_body">
  <header>
    <h2 class="instapaper_title"><a href="/2011/02/24/phenotypic-selection-analysis-in-r/">Phenotypic selection analysis in R</a></h2>
  </header>
  
    I have up to recently always done my phenotypic selection analyses in SAS. I finally got some code I think works to do everything SAS would do. Feedback much appreciated!<br /><br /><br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><span style="color: #666666; font-style: italic;">########################Selection analyses#############################</span><br /><a href="http://inside-r.org/r-doc/utils/install.packages"><span style="color: #003399; font-weight: bold;">install.packages</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"car"</span><span style="color: #339933;">,</span><span style="color: blue;">"reshape"</span><span style="color: #339933;">,</span><span style="color: blue;">"ggplot2"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/require"><span style="color: #003399; font-weight: bold;">require</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/car">car</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/require"><span style="color: #003399; font-weight: bold;">require</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/reshape"><span style="color: #003399; font-weight: bold;">reshape</span></a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/require"><span style="color: #003399; font-weight: bold;">require</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># Create data set</span><br />dat &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>plant = <a href="http://inside-r.org/r-doc/base/seq"><span style="color: #003399; font-weight: bold;">seq</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">100</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br /> trait1 = <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0.1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.15</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.21</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.25</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.3</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.6</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.8</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.9</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">11</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">12</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">13</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">14</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">15</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">16</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> each = <span style="color: #cc66cc;">5</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> trait2 = <a href="http://inside-r.org/r-doc/stats/runif"><span style="color: #003399; font-weight: bold;">runif</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">100</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br /> fitness = <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">5</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">20</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">50</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> each = <span style="color: #cc66cc;">20</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># Make relative fitness column</span><br />dat_ &lt;- <a href="http://inside-r.org/r-doc/base/cbind"><span style="color: #003399; font-weight: bold;">cbind</span></a><span style="color: #009900;">(</span>dat<span style="color: #339933;">,</span> dat$fitness/mean<span style="color: #009900;">(</span>dat$fitness<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span>dat_<span style="color: #009900;">)</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">5</span><span style="color: #009900;">]</span> &lt;- <span style="color: blue;">"relfitness"</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># Standardize traits</span><br />dat_ &lt;- <a href="http://inside-r.org/r-doc/base/cbind"><span style="color: #003399; font-weight: bold;">cbind</span></a><span style="color: #009900;">(</span>dat_<span style="color: #009900;">[</span><span style="color: #339933;">,</span>-<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">2</span>:<span style="color: #cc66cc;">3</span><span style="color: #009900;">)</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span> rescaler<span style="color: #009900;">(</span>dat_<span style="color: #009900;">[</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">2</span>:<span style="color: #cc66cc;">3</span><span style="color: #009900;">)</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span><span style="color: blue;">"sd"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;">####Selection differentials and correlations among traits, cor.prob uses function in functions.R file</span><br /><span style="color: #666666; font-style: italic;">############################################################################</span><br /><span style="color: #666666; font-style: italic;">####### Function for calculating correlation matrix, corrs below diagonal,</span><br /><span style="color: #666666; font-style: italic;">####### and P-values above diagonal</span><br /><span style="color: #666666; font-style: italic;">############################################################################</span><br />cor.prob &lt;- <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>X<span style="color: #339933;">,</span> dfr = <a href="http://inside-r.org/r-doc/base/nrow"><span style="color: #003399; font-weight: bold;">nrow</span></a><span style="color: #009900;">(</span>X<span style="color: #009900;">)</span> - <span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />         R &lt;- <a href="http://inside-r.org/r-doc/stats/cor"><span style="color: #003399; font-weight: bold;">cor</span></a><span style="color: #009900;">(</span>X<span style="color: #009900;">)</span><br />         above &lt;- <a href="http://inside-r.org/r-doc/base/row"><span style="color: #003399; font-weight: bold;">row</span></a><span style="color: #009900;">(</span>R<span style="color: #009900;">)</span> &lt; <a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399; font-weight: bold;">col</span></a><span style="color: #009900;">(</span>R<span style="color: #009900;">)</span><br />         r2 &lt;- R<span style="color: #009900;">[</span>above<span style="color: #009900;">]</span>^<span style="color: #cc66cc;">2</span><br />         Fstat &lt;- r2 * dfr / <span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span> - r2<span style="color: #009900;">)</span><br />         R<span style="color: #009900;">[</span>above<span style="color: #009900;">]</span> &lt;- <span style="color: #cc66cc;">1</span> - <a href="http://inside-r.org/r-doc/stats/pf"><span style="color: #003399; font-weight: bold;">pf</span></a><span style="color: #009900;">(</span>Fstat<span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> dfr<span style="color: #009900;">)</span><br />         R<br /><span style="color: #009900;">}</span> <br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># Get selection differentials and correlations among traits in one data frame</span><br />dat_seldiffs &lt;- <a href="http://inside-r.org/r-doc/stats/cov"><span style="color: #003399; font-weight: bold;">cov</span></a><span style="color: #009900;">(</span>dat_<span style="color: #009900;">[</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">3</span>:<span style="color: #cc66cc;">5</span><span style="color: #009900;">)</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># calculates sel'n differentials using cov</span><br />dat_selcorrs &lt;- cor.prob<span style="color: #009900;">(</span>dat_<span style="color: #009900;">[</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">3</span>:<span style="color: #cc66cc;">5</span><span style="color: #009900;">)</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># use P-values above diagonal for significance of sel'n differentials in dat_seldiffs</span><br />dat_seldiffs_selcorrs &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>dat_seldiffs<span style="color: #339933;">,</span> dat_selcorrs<span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># combine the two</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;">##########################################################################</span><br /><span style="color: #666666; font-style: italic;">####Selection gradients</span><br />dat_selngrad &lt;- <a href="http://inside-r.org/r-doc/stats/lm"><span style="color: #003399; font-weight: bold;">lm</span></a><span style="color: #009900;">(</span>relfitness ~ trait1 * trait2<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a> = dat_<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399; font-weight: bold;">summary</span></a><span style="color: #009900;">(</span>dat_selngrad<span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># where "Estimate" is our sel'n gradient</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;">####Check assumptions</span><br /><a href="http://inside-r.org/r-doc/stats/shapiro.test"><span style="color: #003399; font-weight: bold;">shapiro.test</span></a><span style="color: #009900;">(</span>dat_selngrad$residuals<span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># normality, bummer, non-normal</span><br /><a href="http://inside-r.org/r-doc/graphics/hist"><span style="color: #003399; font-weight: bold;">hist</span></a><span style="color: #009900;">(</span>dat_selngrad$residuals<span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># plot residuals</span><br /><a href="http://inside-r.org/packages/cran/VIF">vif</a><span style="color: #009900;">(</span>dat_selngrad<span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># check variance inflation factors (need package car), everything looks fine</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">(</span>dat_selngrad<span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># cycle through diagnostic plots</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;">############################################################################</span><br /><span style="color: #666666; font-style: italic;"># Plot data</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>dat_<span style="color: #339933;">,</span> aes<span style="color: #009900;">(</span>trait1<span style="color: #339933;">,</span> relfitness<span style="color: #009900;">)</span><span style="color: #009900;">)</span> +<br /> geom_point<span style="color: #009900;">(</span><span style="color: #009900;">)</span> +<br /> geom_smooth<span style="color: #009900;">(</span>method = <span style="color: blue;">"lm"</span><span style="color: #009900;">)</span> +<br /> labs<span style="color: #009900;">(</span>x=<span style="color: blue;">"Trait 1"</span><span style="color: #339933;">,</span>y=<span style="color: blue;">"Relative fitness"</span><span style="color: #009900;">)</span><br />ggsave<span style="color: #009900;">(</span><span style="color: blue;">"myplot.jpeg"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><br />Plot of relative fitness vs. trait 1 standardized<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-OVQl92LOmZY/TWZ8RW9lHlI/AAAAAAAAEaQ/MGB39Lyghig/s1600/myplot.jpeg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="400" src="http://2.bp.blogspot.com/-OVQl92LOmZY/TWZ8RW9lHlI/AAAAAAAAEaQ/MGB39Lyghig/s400/myplot.jpeg" width="400" /></a></div>

  
  <footer class="group">
    <p>
      
      
      
        
      
      <time pubdate datetime="2011-02-24T12:00:00-08:00">Thursday, February 24 2011</time>
      
      <a class="icon" href="http://www.instapaper.com/hello2?u=http%3A%2F%2Fschamberlain.github.com%2F%2F2011%2F02%2F24%2Fphenotypic-selection-analysis-in-r%2F&amp;title=Phenotypic%20selection%20analysis%20in%20R" rel="alternate" title="Save to Instapaper">Read Later</a>
      
    </p>
  </footer>
</article>


    </li>
    
    <li>
      <article class="instapaper_body">
  <header>
    <h2 class="instapaper_title"><a href="/2011/02/21/phylogenetic-analysis-with-the-phangorn-package-an-example/">Phylogenetic analysis with the phangorn package: an example</a></h2>
  </header>
  
    The phangorn package is a relatively new package in R for the analysis and comparison of phylogenies.&nbsp;See <a href="http://bioinformatics.oxfordjournals.org/content/27/4/592.short">here</a> for the Bioinformatics paper and <a href="http://cran.r-project.org/web/packages/phangorn/index.html">here</a> for the package.&nbsp;Here is an example of using phangorn from getting sequences to making phylogenies and visualizing them:<br /><br /><u>Getting sequences from Genbank</u><br /><br /><br /><br /><u>Multiple alignment</u><br /><br /><br /><br /><u>Maximum likelihood tree reconstruction</u><br /><br /><br /><br /><u>Visualizing trees</u><br /><br /><br /><br /><u>Visualizing trees and traits</u><br />Make fake traits:<br /><br />Visualize them on trees:<br /><u><br /></u><br /><u><br /></u><br /><u><br /></u>

  
  <footer class="group">
    <p>
      
      
      
        
      
      <time pubdate datetime="2011-02-21T12:00:00-08:00">Monday, February 21 2011</time>
      
      <a class="icon" href="http://www.instapaper.com/hello2?u=http%3A%2F%2Fschamberlain.github.com%2F%2F2011%2F02%2F21%2Fphylogenetic-analysis-with-the-phangorn-package-an-example%2F&amp;title=Phylogenetic%20analysis%20with%20the%20phangorn%20package%3A%20an%20example" rel="alternate" title="Save to Instapaper">Read Later</a>
      
    </p>
  </footer>
</article>


    </li>
    
    <li>
      <article class="instapaper_body">
  <header>
    <h2 class="instapaper_title"><a href="/2011/02/16/farmer-s-markets-data/">Farmer's markets data</a></h2>
  </header>
  
    I combined USDA data on farmer's markets in the US with population census data to get an idea of the disparity in farmers markets by state, and then also expressed per capita.<br /><br />Download USDA data <a href="http://www.ams.usda.gov/AMSv1.0/getfile?dDocName=STELPRDC5087258&amp;acct=frmrdirmkt">here</a>. The formatted file I used below is <a href="http://schamber.files.wordpress.com/2011/02/farmmarkets.xls">here</a> (in excel format, although I read into R as csv file). The census data is read from url as below.<br /><br />California has a ton of absolute number of farmer's markets, but Vermont takes the cake by far with number of markets per capita. Iowa comes in a distant second behind Vermont in markets per capita.<br /><br /><br /><br />The code:<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><span style="color: #666666; font-style: italic;">######## Farmer's Markets #############</span><br /><a href="http://inside-r.org/r-doc/base/setwd"><span style="color: #003399; font-weight: bold;">setwd</span></a><span style="color: #009900;">(</span><span style="color: blue;">"/Mac/R_stuff/Blog_etc/USDAFarmersMarkets"</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># Set to your working directory, this is where you want to call files from and write files to</span><br /><a href="http://inside-r.org/r-doc/utils/install.packages"><span style="color: #003399; font-weight: bold;">install.packages</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"ggplot2"</span><span style="color: #339933;">,</span> <span style="color: blue;">"RCurl"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>  <span style="color: #666666; font-style: italic;"># install all packags required below</span><br /><a href="http://inside-r.org/r-doc/base/require"><span style="color: #003399; font-weight: bold;">require</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># plyr is libraried along with ggplot2, as ggplot2 uses plyr (as well as package reshape) functions</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># read market data</span><br />markets &lt;- <a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399; font-weight: bold;">read.csv</span></a><span style="color: #009900;">(</span><span style="color: blue;">"farmmarkets.csv"</span><span style="color: #009900;">)</span><br />markets$state &lt;- <a href="http://inside-r.org/r-doc/base/as.factor"><span style="color: #003399; font-weight: bold;">as.factor</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/gsub"><span style="color: #003399; font-weight: bold;">gsub</span></a><span style="color: #009900;">(</span><span style="color: blue;">"Wyoming "</span><span style="color: #339933;">,</span> <span style="color: blue;">"Wyoming"</span><span style="color: #339933;">,</span> markets$LocAddState<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># there was a typo for Wyoming</span><br />markets &lt;- <a href="http://inside-r.org/r-doc/stats/na.omit"><span style="color: #003399; font-weight: bold;">na.omit</span></a><span style="color: #009900;">(</span>markets<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/utils/str"><span style="color: #003399; font-weight: bold;">str</span></a><span style="color: #009900;">(</span>markets<span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># read population census data</span><br />popcen &lt;- <a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399; font-weight: bold;">read.csv</span></a><span style="color: #009900;">(</span><span style="color: blue;">"http://www.census.gov/popest/national/files/NST_EST2009_ALLDATA.csv"</span><span style="color: #009900;">)</span><br />popcen &lt;- popcen<span style="color: #009900;">[</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">5</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">6</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">17</span><span style="color: #009900;">)</span><span style="color: #009900;">]</span><br /><a href="http://inside-r.org/r-doc/utils/str"><span style="color: #003399; font-weight: bold;">str</span></a><span style="color: #009900;">(</span>popcen<span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># summarize</span><br />markets_ &lt;- ddply<span style="color: #009900;">(</span>markets<span style="color: #339933;">,</span> .<span style="color: #009900;">(</span>state<span style="color: #009900;">)</span><span style="color: #339933;">,</span> summarise<span style="color: #339933;">,</span><br /> markets_n = <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">(</span>LocAddState<span style="color: #009900;">)</span> <br /><span style="color: #009900;">)</span><br />&nbsp;<br />markets_pop_ &lt;- <a href="http://inside-r.org/r-doc/base/merge"><span style="color: #003399; font-weight: bold;">merge</span></a><span style="color: #009900;">(</span>markets_<span style="color: #339933;">,</span> popcen<span style="color: #009900;">[</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span> by.x = <span style="color: blue;">"state"</span><span style="color: #339933;">,</span> by.y = <span style="color: blue;">"NAME"</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;"># merge two data sets</span><br />markets_pop_$marketspercap &lt;- markets_pop_$markets_n/markets_pop_$POPESTIMATE2009 <span style="color: #666666; font-style: italic;"># create column of markets per capita</span><br />markets_pop_$markets_n_st &lt;- markets_pop_$markets_n/max<span style="color: #009900;">(</span>markets_pop_$markets_n<span style="color: #009900;">)</span><br />markets_pop_$marketspercap_st &lt;- markets_pop_$marketspercap/max<span style="color: #009900;">(</span>markets_pop_$marketspercap<span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># plot</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>melt<span style="color: #009900;">(</span>markets_pop_<span style="color: #009900;">[</span><span style="color: #339933;">,</span>-<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">2</span>:<span style="color: #cc66cc;">5</span><span style="color: #009900;">)</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> aes<span style="color: #009900;">(</span>x = state<span style="color: #339933;">,</span> y = value<span style="color: #339933;">,</span> fill = variable<span style="color: #009900;">)</span><span style="color: #009900;">)</span> +<br /> geom_bar<span style="color: #009900;">(</span>position = <span style="color: blue;">"dodge"</span><span style="color: #009900;">)</span> +<br /> coord_flip<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br />ggsave<span style="color: #009900;">(</span><span style="color: blue;">"fmarkets_barplot.jpeg"</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br />Note: the x-axis here is standardized value of number of markets (markets_n_st) and number of markets per capita (marketspercap_st).<br /><a href="http://4.bp.blogspot.com/-ceVMLE6yfbk/TVyE31U6LTI/AAAAAAAAEaM/PM2LCHnLPMM/s1600/fmarkets_barplot.jpeg" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="452" src="http://4.bp.blogspot.com/-ceVMLE6yfbk/TVyE31U6LTI/AAAAAAAAEaM/PM2LCHnLPMM/s640/fmarkets_barplot.jpeg" style="cursor: move;" width="640" /></a><br /><br /><br /><div style="overflow-x: auto; overflow-y: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><span style="color: #666666; font-style: italic;"># maps</span><br />try_require<span style="color: #009900;">(</span><span style="color: blue;">"maps"</span><span style="color: #009900;">)</span><br />states &lt;- map_data<span style="color: #009900;">(</span><span style="color: blue;">"state"</span><span style="color: #009900;">)</span><br />markets_pop_$statelow &lt;- <a href="http://inside-r.org/r-doc/base/tolower"><span style="color: #003399; font-weight: bold;">tolower</span></a><span style="color: #009900;">(</span>markets_pop_$state<span style="color: #009900;">)</span><br />survey_sum_map &lt;- <a href="http://inside-r.org/r-doc/base/merge"><span style="color: #003399; font-weight: bold;">merge</span></a><span style="color: #009900;">(</span>states<span style="color: #339933;">,</span> markets_pop_<span style="color: #339933;">,</span> by.x = <span style="color: blue;">"region"</span><span style="color: #339933;">,</span> by.y = <span style="color: blue;">"statelow"</span><span style="color: #009900;">)</span><br />survey_sum_map &lt;- survey_sum_map<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/order"><span style="color: #003399; font-weight: bold;">order</span></a><span style="color: #009900;">(</span>survey_sum_map$order<span style="color: #009900;">)</span><span style="color: #339933;">,</span> <span style="color: #009900;">]</span><br /><a href="http://inside-r.org/r-doc/utils/str"><span style="color: #003399; font-weight: bold;">str</span></a><span style="color: #009900;">(</span>survey_sum_map<span style="color: #009900;">)</span><br />&nbsp;<br />qplot<span style="color: #009900;">(</span>long<span style="color: #339933;">,</span> lat<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a> = survey_sum_map<span style="color: #339933;">,</span> group = group<span style="color: #339933;">,</span> fill = markets_n<span style="color: #339933;">,</span> geom = <span style="color: blue;">"polygon"</span><span style="color: #339933;">,</span> main = <span style="color: blue;">"Total farmer's markets"</span><span style="color: #009900;">)</span> + <br /> scale_fill_gradient<span style="color: #009900;">(</span>low=<span style="color: blue;">"green"</span><span style="color: #339933;">,</span> high=<span style="color: blue;">"black"</span><span style="color: #009900;">)</span><br />ggsave<span style="color: #009900;">(</span><span style="color: blue;">"fmarkets_map_green.jpeg"</span><span style="color: #009900;">)</span> </pre></div></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a></div><div><br /></div><br /><br /><br /><a href="http://2.bp.blogspot.com/-I-Hqg4GtJs0/TVyE3I7BmYI/AAAAAAAAEaI/xNqBq4BqemI/s1600/fmarkets_map_green.jpeg" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="452" src="http://2.bp.blogspot.com/-I-Hqg4GtJs0/TVyE3I7BmYI/AAAAAAAAEaI/xNqBq4BqemI/s640/fmarkets_map_green.jpeg" style="cursor: move;" width="640" /></a><br /><br /><br /><div style="overflow-x: auto; overflow-y: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"></pre><pre class="r geshifilter-R" style="font-family: monospace; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"></pre><pre class="r geshifilter-R" style="font-family: monospace; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">qplot<span style="color: #009900;">(</span>long<span style="color: #339933;">,</span> lat<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a> = survey_sum_map<span style="color: #339933;">,</span> group = group<span style="color: #339933;">,</span> fill = marketspercap<span style="color: #339933;">,</span> geom = <span style="color: blue;">"polygon"</span><span style="color: #339933;">,</span> main = <span style="color: blue;">"Farmer's markets per person"</span><span style="color: #009900;">)</span> +<br /> scale_fill_gradient<span style="color: #009900;">(</span>low=<span style="color: blue;">"green"</span><span style="color: #339933;">,</span> high=<span style="color: blue;">"black"</span><span style="color: #009900;">)</span><br />&nbsp;<br />ggsave<span style="color: #009900;">(</span><span style="color: blue;">"fmarkerspercap_map_green.jpeg"</span><span style="color: #009900;">)</span> </pre></div></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a></div><div><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-g8zapywmu7M/TVyE2qNzFnI/AAAAAAAAEaE/yrjk5txjFgo/s1600/fmarkerspercap_map_green.jpeg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="453" src="http://4.bp.blogspot.com/-g8zapywmu7M/TVyE2qNzFnI/AAAAAAAAEaE/yrjk5txjFgo/s640/fmarkerspercap_map_green.jpeg" width="640" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-I-Hqg4GtJs0/TVyE3I7BmYI/AAAAAAAAEaI/xNqBq4BqemI/s1600/fmarkets_map_green.jpeg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><br /></a></div><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"></pre></div></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-ceVMLE6yfbk/TVyE31U6LTI/AAAAAAAAEaM/PM2LCHnLPMM/s1600/fmarkets_barplot.jpeg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><br /></a></div>

  
  <footer class="group">
    <p>
      
      
      
        
      
      <time pubdate datetime="2011-02-16T12:00:00-08:00">Wednesday, February 16 2011</time>
      
      <a class="icon" href="http://www.instapaper.com/hello2?u=http%3A%2F%2Fschamberlain.github.com%2F%2F2011%2F02%2F16%2Ffarmer-s-markets-data%2F&amp;title=Farmer's%20markets%20data" rel="alternate" title="Save to Instapaper">Read Later</a>
      
    </p>
  </footer>
</article>


    </li>
    
  </ol>

  
  <nav id="pagination">
    <ol>
      
        
      
      
      <li>
        <a href="/pagelayoutdefaulturl/page26/index.htmlcontent<section id="posts">
  <ol>
    {% for post in paginator.posts %}
    <li>
      {% include post.html %}
    </li>
    {% endfor %}
  </ol>

  {% if paginator.total_pages > 1 %}
  <nav id="pagination">
    <ol>
      {% if paginator.previous_page > 1 %}
        {% capture page_url %}page{{ page }}{% endcapture%}
      {% endif %}
      {% if paginator.previous_page %}
      <li>
        <a href="/{{ page_url }}" title="Go to previous page">
          &laquo;
        </a>
      </li>
      {% endif %}
      <li>
      {% for page in (1..paginator.total_pages) %}
      <li>
        {% if page > 1 %}
          {% capture page_url %}page{{ page }}{% endcapture%}
        {% endif %}
        {% if page == paginator.page %}
          {{ page }}
        {% else %}
          <a href="/{{ page_url }}">{{ page }}</a>
        {% endif %}
      </li>
      {% endfor %}
      {% if paginator.next_page %}
      <li>
        <a href="/page{{ paginator.next_page }}" title="Go to next page">
          &raquo;
        </a>
      </li>
      {% endif %}
    </ol>
  </nav>
  {% endif %}
</section>
" title="Go to previous page">
          &laquo;
        </a>
      </li>
      
      <li>
      
      <li>
        
        
          <a href="/pagelayoutdefaulturl/page26/index.htmlcontent<section id="posts">
  <ol>
    {% for post in paginator.posts %}
    <li>
      {% include post.html %}
    </li>
    {% endfor %}
  </ol>

  {% if paginator.total_pages > 1 %}
  <nav id="pagination">
    <ol>
      {% if paginator.previous_page > 1 %}
        {% capture page_url %}page{{ page }}{% endcapture%}
      {% endif %}
      {% if paginator.previous_page %}
      <li>
        <a href="/{{ page_url }}" title="Go to previous page">
          &laquo;
        </a>
      </li>
      {% endif %}
      <li>
      {% for page in (1..paginator.total_pages) %}
      <li>
        {% if page > 1 %}
          {% capture page_url %}page{{ page }}{% endcapture%}
        {% endif %}
        {% if page == paginator.page %}
          {{ page }}
        {% else %}
          <a href="/{{ page_url }}">{{ page }}</a>
        {% endif %}
      </li>
      {% endfor %}
      {% if paginator.next_page %}
      <li>
        <a href="/page{{ paginator.next_page }}" title="Go to next page">
          &raquo;
        </a>
      </li>
      {% endif %}
    </ol>
  </nav>
  {% endif %}
</section>
">1</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page2">2</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page3">3</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page4">4</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page5">5</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page6">6</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page7">7</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page8">8</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page9">9</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page10">10</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page11">11</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page12">12</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page13">13</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page14">14</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page15">15</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page16">16</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page17">17</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page18">18</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page19">19</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page20">20</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page21">21</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page22">22</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page23">23</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page24">24</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page25">25</a>
        
      </li>
      
      <li>
        
          
        
        
          26
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page27">27</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page28">28</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page29">29</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page30">30</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page31">31</a>
        
      </li>
      
      <li>
        
          
        
        
          <a href="/page32">32</a>
        
      </li>
      
      
      <li>
        <a href="/page27" title="Go to next page">
          &raquo;
        </a>
      </li>
      
    </ol>
  </nav>
  
</section>

        </section>

        <section id="sidebar">

          <section id="meta-col1" class="meta group">
            <aside id="about">
              <header>
                <h3>About</h3>
              </header>
              <p>
                Recology is a blog that explores using R for ecology, evolution, and open science. <a href="/about">See more.</a>
              </p>
            </aside>

            <aside>
              <header>
                <h3>Stay up to date</h3>
              </header>
              <nav>
                <ul>
                  <li class="icon rss"><a href="http://feeds.feedburner.com/schamberlain">RSS</a></li>
                  <li class="icon twitter"><a href="http://twitter.com/recology_">Twitter</a></li>
                  <li class="icon"><a href="/subscribe">More</a></li>
                </ul>
              </nav>
            </aside>

          </section>

          <section id="meta-col2" class="meta group">

            <aside id="bio">
              <header>
                <h3>The Author</h3>
              </header>
              <p>
              My name is Scott Chamberlain. I am a graduate student in ecology and evolution at <a href="http://www.rice.edu/">Rice University</a>, in the <a href="http://eeb.rice.edu/">EEB department</a>. 
              </p>
            </aside>

            <aside>
              <nav id="extra">
                <ul>
                  <li><a href="/about">About</a></li>
	              <li><a href="/research">Research</a></li>
    	          <li><a href="/publications">Publications</a></li>
    	          <li><a href="/blogs">Blogs</a></li>
    	          <li><a href="/code">Code</a></li>
    	          <li><a href="/cv">CV</a></li>
    	          <li><a href="/donors">Donors</a></li>
    	          <li><a href="/pictures">Pictures</a></li>
        	      <li><a href="/contact">Contact</a></li>
            	  <li><a href="/subscribe">Subscribe</a></li>
              	  <li><a href="/colophon">Colophon</a></li>
                </ul>
              </nav>
            </aside>

          </section>

        </section>

      </section>

      <section id="footer" class="group">
        <footer class="group">
          <nav id="site">
            <ul>
              <li><a href="/">Home</a></li>
              <li><a href="/about">About</a></li>
              <li><a href="/research">Research</a></li>
              <li><a href="/publications">Publications</a></li>
              <li><a href="/blogs">Blogs</a></li>
    	      <li><a href="/code">Code</a></li>
    	      <li><a href="/cv">CV</a></li>
    	      <li><a href="/donors">Donors</a></li>
    	      <li><a href="/pictures">Pictures</a></li>
              <li><a href="/contact">Contact</a></li>
              <li><a href="/subscribe">Subscribe</a></li>
              <li><a href="/colophon">Colophon</a></li>
            </ul>
          </nav>
          <p class="copyright">
            &copy;2011 &ndash; Scott Chamberlain
          </p>
        </footer>
      </section>

    </section>

<!--Google analytics tracking code-->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-XXXX-X']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
<!--Gaug.es tracking code-->
    
<!--Gaug.es tracking code-->
	<script type="text/javascript">
  	var _gauges = _gauges || [];
  	(function() {
    	var t   = document.createElement('script');
    	t.type  = 'text/javascript';
    	t.async = true;
    	t.id    = 'gauges-tracker';
    	t.setAttribute('data-site-id', '4efd83a6f5a1f5158a000004');
    	t.src = '//secure.gaug.es/track.js';
    	var s = document.getElementsByTagName('script')[0];
    	s.parentNode.insertBefore(t, s);
  	})();
	</script>
<!--Gaug.es tracking code-->

  </body>
</html>
