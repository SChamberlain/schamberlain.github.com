<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    
    Recology, R/etc.
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <link rel="stylesheet" href="/public/css/bootstrap/css/bootstrap.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon.ico">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0f layout-reverse">

    <header class="masthead">
      <div class="masthead-inner">
        <h1>Recology</h1>
        <!-- <h1> <a href="http://recology.info/">Recology</a></h1> -->
        <p class="lead">R/etc.</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="/"><i class="fa fa-home fa-lg"></i></a>&nbsp;
              <a href="/about"><i class="fa fa-info-circle fa-lg"></i></a>&nbsp;
              <a href="/archives"><i class="fa fa-archive fa-lg"></i></a>&nbsp;
              <a href="/rresources"><i class="fa fa-book fa-lg"></i></a>&nbsp;
              <a href="http://rforcats.net/" rel><i class="fa fa-graduation-cap fa-lg"></i></a>&nbsp;
              <a href="/feed.xml"><i class="fa fa-rss fa-lg"></i></a>&nbsp;
              <a href="https://twitter.com/sckottie"><i class="fa fa-twitter fa-lg"></i></a>&nbsp;
              <a href="/fork"><i class="fa fa-spinner fa-lg"></i></a>
            </li>
          </ul>
          <!-- <small><a href="https://github.com/mdo/hyde">Hyde</a> from <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</small> -->
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="posts">
  <a style="float:right;" href="/archives" data-toggle="tooltip" data-placement="bottom" title="Archives"><i class="fa fa-archive fa-lg"></i></a>
  <a style="float:right;" href="/tags"><i class="fa fa-tags fa-lg"></i></a>&nbsp;
  
  <div class="post">
    <h1>
      <a href="/2014/11/sofa/">
        sofa - reboot
      </a>
    </h1>

    <span class="post-date">18 Nov 2014</span>

    <p>I’ve reworked <code class="highlighter-rouge">sofa</code> recently after someone reported a bug in the package. Since the last post on this package on 2013-06-21, there’s a bunch of changes:</p>

<ul>
  <li>Removed the <code class="highlighter-rouge">sofa_</code> prefix from all functions as it wasn’t really necessary.</li>
  <li>Replaced <code class="highlighter-rouge">rjson</code>/<code class="highlighter-rouge">RJSONIO</code> with <code class="highlighter-rouge">jsonlite</code> for JSON I/O.</li>
  <li>New functions:
    <ul>
      <li><code class="highlighter-rouge">revisions()</code> - to get the revision numbers for a document.</li>
      <li><code class="highlighter-rouge">uuids()</code> - get any number of UUIDs - e.g., if you want to set document IDs with UUIDs</li>
    </ul>
  </li>
  <li>Most functions that deal with documents are prefixed with <code class="highlighter-rouge">doc_</code></li>
  <li>Functions that deal with databases are prefixed with <code class="highlighter-rouge">db_</code></li>
  <li>Simplified all code, reducing duplication</li>
  <li>All functions take <code class="highlighter-rouge">cushion</code> as the first parameter, for consistency sake.</li>
  <li>Changed <code class="highlighter-rouge">cushion()</code> function so that you can only register one cushion with each function call, 
and the function takes parameters for each element now, <code class="highlighter-rouge">name</code> (name of the cushion, whatever you want), <code class="highlighter-rouge">user</code> (user name, if applicable), <code class="highlighter-rouge">pwd</code> (password, if applicable), <code class="highlighter-rouge">type</code> (one of localhost, cloudant, or iriscouch), and <code class="highlighter-rouge">port</code> (if applicable).</li>
  <li>Changed package license from <code class="highlighter-rouge">CC0</code> to <code class="highlighter-rouge">MIT</code></li>
</ul>

<p>There’s still more to do, but I’m pretty happy with the recent changes, and I hope at least some find the package useful. Also, would love people to try it out as all bugs are shallow and all that…</p>

<p>The following are a few examples of package use.</p>

<h2 id="install-couchdb">Install CouchDB</h2>

<p>Instructions <a href="http://wiki.apache.org/couchdb/Installation">here</a></p>

<h2 id="start-couchdb">Start CouchDB</h2>

<p>In your terminal</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code>couchdb
</code></pre>
</div>

<p>You can interact with your CouchDB databases as well in your browser. Navigate to <a href="http://localhost:5984/_utils">http://localhost:5984/_utils</a></p>

<h2 id="install-sofa">Install sofa</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"devtools"</span><span class="p">)</span><span class="w">
</span><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"sckott/sofa"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s1">'sofa'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h2 id="authenticate---cushions">Authenticate - Cushions</h2>

<p>As an example, here’s how I set up details for connecting to my Cloudant couch:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">cushion</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'cloudant'</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'&lt;user name&gt;'</span><span class="p">,</span><span class="w"> </span><span class="n">pwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'&lt;password&gt;'</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cloudant"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>By default there is a built-in <code class="highlighter-rouge">cushion</code> for localhost so you don’t have to do that, unless you want to change those details, e.g., the port number. Right now cushions aren’t preserved across R sessions, but working on that.</p>

<p>For example, I’ll lay down a cushion for Cloudant, then I can call <code class="highlighter-rouge">cushions()</code> to see my cushions:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">cushion</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'cloudant'</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'&lt;user name&gt;'</span><span class="p">,</span><span class="w"> </span><span class="n">pwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'&lt;pwd&gt;'</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cloudant"</span><span class="p">)</span><span class="w">
</span><span class="n">cushions</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>By default, if you don’t provide a cushion name, you are using localhost.</p>

<h2 id="ping-the-server">Ping the server</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ping</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; $couchdb
#&gt; [1] "Welcome"
#&gt; 
#&gt; $uuid
#&gt; [1] "2c10f0c6d9bd17205b692ae93cd4cf1d"
#&gt; 
#&gt; $version
#&gt; [1] "1.6.0"
#&gt; 
#&gt; $vendor
#&gt; $vendor$version
#&gt; [1] "1.6.0-1"
#&gt; 
#&gt; $vendor$name
#&gt; [1] "Homebrew"
</span></code></pre>
</div>

<p>Nice, it’s working.</p>

<h2 id="create-a-new-database-and-list-available-databases">Create a new database, and list available databases</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">db_create</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="s1">'sofadb'</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; $ok
#&gt; [1] TRUE
</span></code></pre>
</div>

<p>see if its there now</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">db_list</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt;  [1] "_replicator" "_users"      "alm_couchdb" "cachecall"   "hello_earth"
#&gt;  [6] "leothelion"  "mran"        "mydb"        "newdbs"      "sofadb"
</span></code></pre>
</div>

<h2 id="create-documents">Create documents</h2>

<p>Create a document WITH a name (uses PUT)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">doc1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s1">'{"name":"sofa","beer":"IPA"}'</span><span class="w">
</span><span class="n">doc_create</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="s2">"sofadb"</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="o">=</span><span class="n">doc1</span><span class="p">,</span><span class="w"> </span><span class="n">docid</span><span class="o">=</span><span class="s2">"a_beer"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; $ok
#&gt; [1] TRUE
#&gt; 
#&gt; $id
#&gt; [1] "a_beer"
#&gt; 
#&gt; $rev
#&gt; [1] "1-a48c98c945bcc05d482bc6f938c89882"
</span></code></pre>
</div>

<p>Create a document WITHOUT a name (uses POST)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">doc2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s1">'{"name":"sofa","icecream":"rocky road"}'</span><span class="w">
</span><span class="n">doc_create</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="s2">"sofadb"</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="o">=</span><span class="n">doc2</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; $ok
#&gt; [1] TRUE
#&gt; 
#&gt; $id
#&gt; [1] "c5c5c332c25cf62cc584647a81006f6d"
#&gt; 
#&gt; $rev
#&gt; [1] "1-fd0da7fcb8d3afbfc5757d065c92362c"
</span></code></pre>
</div>

<h2 id="list-documents">List documents</h2>

<p>List them</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">alldocs</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="s2">"sofadb"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;                                 id                              key
#&gt; 1                           a_beer                           a_beer
#&gt; 2 c5c5c332c25cf62cc584647a81006f6d c5c5c332c25cf62cc584647a81006f6d
#&gt;                                  rev
#&gt; 1 1-a48c98c945bcc05d482bc6f938c89882
#&gt; 2 1-fd0da7fcb8d3afbfc5757d065c92362c
</span></code></pre>
</div>

<p>Optionally include the documents, returned as a list by default as it would be hard to parse an endless number of document formats.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">alldocs</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="s2">"sofadb"</span><span class="p">,</span><span class="w"> </span><span class="n">include_docs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; $total_rows
#&gt; [1] 2
#&gt; 
#&gt; $offset
#&gt; [1] 0
#&gt; 
#&gt; $rows
#&gt; $rows[[1]]
#&gt; $rows[[1]]$id
#&gt; [1] "a_beer"
#&gt; 
#&gt; $rows[[1]]$key
#&gt; [1] "a_beer"
#&gt; 
#&gt; $rows[[1]]$value
#&gt; $rows[[1]]$value$rev
#&gt; [1] "1-a48c98c945bcc05d482bc6f938c89882"
#&gt; 
#&gt; 
#&gt; $rows[[1]]$doc
#&gt; $rows[[1]]$doc$`_id`
#&gt; [1] "a_beer"
#&gt; 
#&gt; $rows[[1]]$doc$`_rev`
#&gt; [1] "1-a48c98c945bcc05d482bc6f938c89882"
#&gt; 
#&gt; $rows[[1]]$doc$name
#&gt; [1] "sofa"
#&gt; 
#&gt; $rows[[1]]$doc$beer
#&gt; [1] "IPA"
#&gt; 
#&gt; 
#&gt; 
#&gt; $rows[[2]]
#&gt; $rows[[2]]$id
#&gt; [1] "c5c5c332c25cf62cc584647a81006f6d"
#&gt; 
#&gt; $rows[[2]]$key
#&gt; [1] "c5c5c332c25cf62cc584647a81006f6d"
#&gt; 
#&gt; $rows[[2]]$value
#&gt; $rows[[2]]$value$rev
#&gt; [1] "1-fd0da7fcb8d3afbfc5757d065c92362c"
#&gt; 
#&gt; 
#&gt; $rows[[2]]$doc
#&gt; $rows[[2]]$doc$`_id`
#&gt; [1] "c5c5c332c25cf62cc584647a81006f6d"
#&gt; 
#&gt; $rows[[2]]$doc$`_rev`
#&gt; [1] "1-fd0da7fcb8d3afbfc5757d065c92362c"
#&gt; 
#&gt; $rows[[2]]$doc$name
#&gt; [1] "sofa"
#&gt; 
#&gt; $rows[[2]]$doc$icecream
#&gt; [1] "rocky road"
</span></code></pre>
</div>

<h2 id="update-a-document">Update a document</h2>

<p>Change <em>IPA</em> (india pale ale) to <em>IPL</em> (india pale lager). We need to get revisions first as we need to include revision number when we update a document.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">revs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">revisions</span><span class="p">(</span><span class="n">dbname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sofadb"</span><span class="p">,</span><span class="w"> </span><span class="n">docid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"a_beer"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; [1] "1-a48c98c945bcc05d482bc6f938c89882"
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">newdoc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s1">'{"name":"sofa","beer":"IPL"}'</span><span class="w">
</span><span class="n">doc_update</span><span class="p">(</span><span class="n">dbname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sofadb"</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newdoc</span><span class="p">,</span><span class="w"> </span><span class="n">docid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"a_beer"</span><span class="p">,</span><span class="w"> </span><span class="n">rev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">revs</span><span class="p">[</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="c1">#&gt; $ok
#&gt; [1] TRUE
#&gt; 
#&gt; $id
#&gt; [1] "a_beer"
#&gt; 
#&gt; $rev
#&gt; [1] "2-f2390eb18b8f9a870c915c6712a7f65e"
</span></code></pre>
</div>

<p>Should be two revisions now</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">revisions</span><span class="p">(</span><span class="n">dbname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sofadb"</span><span class="p">,</span><span class="w"> </span><span class="n">docid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"a_beer"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "2-f2390eb18b8f9a870c915c6712a7f65e"
#&gt; [2] "1-a48c98c945bcc05d482bc6f938c89882"
</span></code></pre>
</div>

<h2 id="get-headers-for-a-document">Get headers for a document</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">doc_head</span><span class="p">(</span><span class="n">dbname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"sofadb"</span><span class="p">,</span><span class="w"> </span><span class="n">docid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"a_beer"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [[1]]
#&gt; [[1]]$status
#&gt; [1] 200
#&gt; 
#&gt; [[1]]$version
#&gt; [1] "HTTP/1.1"
#&gt; 
#&gt; [[1]]$headers
#&gt; $server
#&gt; [1] "CouchDB/1.6.0 (Erlang OTP/17)"
#&gt; 
#&gt; $etag
#&gt; [1] "\"2-f2390eb18b8f9a870c915c6712a7f65e\""
#&gt; 
#&gt; $date
#&gt; [1] "Tue, 18 Nov 2014 21:19:16 GMT"
#&gt; 
#&gt; $`content-type`
#&gt; [1] "application/json"
#&gt; 
#&gt; $`content-length`
#&gt; [1] "88"
#&gt; 
#&gt; $`cache-control`
#&gt; [1] "must-revalidate"
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "insensitive" "list"
</span></code></pre>
</div>

<h2 id="json-vs-list">JSON vs. list</h2>

<p>Across all/most functions you can request json or list as output with the <code class="highlighter-rouge">as</code> parameter.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">db_list</span><span class="p">(</span><span class="n">as</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"list"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;  [1] "_replicator" "_users"      "alm_couchdb" "cachecall"   "hello_earth"
#&gt;  [6] "leothelion"  "mran"        "mydb"        "newdbs"      "sofadb"
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">db_list</span><span class="p">(</span><span class="n">as</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"json"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] "[\"_replicator\",\"_users\",\"alm_couchdb\",\"cachecall\",\"hello_earth\",\"leothelion\",\"mran\",\"mydb\",\"newdbs\",\"sofadb\"]\n"
</span></code></pre>
</div>

<h2 id="curl-options">Curl options</h2>

<p>Across all functions you can pass in curl options. We’re using <code class="highlighter-rouge">httr</code> internally, so you can use <code class="highlighter-rouge">httr</code> helper functions to make some curl options easier. Examples:</p>

<p>Verbose output</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"httr"</span><span class="p">)</span><span class="w">
</span><span class="n">db_list</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">verbose</span><span class="p">())</span><span class="w">
</span><span class="c1">#&gt;  [1] "_replicator" "_users"      "alm_couchdb" "cachecall"   "hello_earth"
#&gt;  [6] "leothelion"  "mran"        "mydb"        "newdbs"      "sofadb"
</span></code></pre>
</div>

<p>Progress</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">db_list</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">progress</span><span class="p">())</span><span class="w">
</span><span class="c1">#&gt; 
</span><span class="w">  </span><span class="o">|</span><span class="w">                                                                       
  </span><span class="o">|</span><span class="w">                                                                 </span><span class="o">|</span><span class="w">   </span><span class="m">0</span><span class="o">%
  |                                                                       
  |=================================================================| 100%</span><span class="w">
</span><span class="c1">#&gt;  [1] "_replicator" "_users"      "alm_couchdb" "cachecall"   "hello_earth"
#&gt;  [6] "leothelion"  "mran"        "mydb"        "newdbs"      "sofadb"
</span></code></pre>
</div>

<p>Set a timeout</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">db_list</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">timeout</span><span class="p">(</span><span class="n">seconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.001</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; 
#&gt; Error in function (type, msg, asError = TRUE)  : 
#&gt;    Operation timed out after 3 milliseconds with 0 out of -1 bytes received
</span></code></pre>
</div>

<h2 id="full-text-search">Full text search</h2>

<p>I’m working on an R client for Elaticsearch called <code class="highlighter-rouge">elastic</code> - find it at <a href="https://github.com/ropensci/elastic">https://github.com/ropensci/elastic</a></p>

<p>Thinking about where to include functions to allow <code class="highlighter-rouge">elastic</code> and <code class="highlighter-rouge">sofa</code> to work together…if you have any thoughts hit up the issues. I’ll probably include helper functions for CouchDB search in the <code class="highlighter-rouge">elastic</code> package, interfacing with the <a href="https://github.com/elasticsearch/elasticsearch-river-couchdb">CouchDB plugin for Elasticsearch</a>.</p>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2014/10/conditionality-meta-analysis/">
        Conditionality meta-analysis data
      </a>
    </h1>

    <span class="post-date">06 Oct 2014</span>

    <h2 id="the-paper">The paper</h2>

<p>One paper from my graduate work asked most generally ~ “How much does the variation in magnitudes and signs of species interaction outcomes vary?”. More specifically, we wanted to know if variation differed among species interaction classes (mutualism, competition, predation), and among various “gradients” (space, time, etc.). To answer this question, we used a meta-analysis approach (rather than e.g., a field experiment). We <a href="http://scottchamberlain.info/publications/">published the paper</a> recently.</p>

<blockquote>
  <p>p.s. I really really wish we would have put it in an open access journal…</p>
</blockquote>

<h2 id="the-data">The data</h2>

<p>Anyway, I’m here to talk about the <strong>data</strong>. We didn’t get the data up with the paper, but it is <a href="http://figshare.com/articles/Conditionality_data/1097657">up on Figshare</a> now. The files there are the following:</p>

<ul>
  <li><code class="highlighter-rouge">coniditionality.R</code> - script used to process the data from <code class="highlighter-rouge">variables_prelim.csv</code></li>
  <li><code class="highlighter-rouge">variables_prelim.csv</code> - description of variables in the preliminary data set, matches <code class="highlighter-rouge">conditionality_data_prelim.csv</code></li>
  <li><code class="highlighter-rouge">variables_used.csv</code> - description of variables in the used data set, matches <code class="highlighter-rouge">conditionality_data_used.csv</code></li>
  <li><code class="highlighter-rouge">conditionality_data_prelim.csv</code> - preliminary data, the raw data</li>
  <li><code class="highlighter-rouge">conditionality_data_used.csv</code> - the data used for our paper</li>
  <li><code class="highlighter-rouge">README.md</code> - the readme</li>
  <li><code class="highlighter-rouge">paper_selection.csv</code> - the list of papers we went through, with remarks about paper selection</li>
</ul>

<p>Please do play with the data, publish some papers, etc, etc. It took 6 of us about 4 years to collect this data; we skimmed through ~11,000 papers on the first pass (aka. skimming through abstracts in Google Scholar and Web of Science), then decided on nearly 500 papers to get data from, and narrowed down to 247 papers for the publication mentioned above. Now, there was no funding for this, so it was sort of done in between other projects, but still, it was simply <strong>A LOT</strong> of tables to digitize, and graphs to extract data points from. <strong>Anyway</strong>, hopefully you will find this data useful :p</p>

<h2 id="eml">EML</h2>

<p>I think this dataset would be a great introduction to the potential power of EML (<a href="https://knb.ecoinformatics.org/#external//emlparser/docs/index.html">Ecological Metadata Langauge</a>). At <a href="http://ropensci.org/">rOpenSci</a>, one of our team <a href="http://www.carlboettiger.info/">Carl Boettiger</a>, along with Claas-Thido Pfaff, Duncan Temple Lang, Karthik Ram, and Matt Jones, have created an R client for EML, to parse EML files and to create and publish them.</p>

<h2 id="what-is-emlwhy-eml">What is EML?/Why EML?</h2>

<p>A demonstration is in order…</p>

<h2 id="example-using-eml-with-this-dataset">Example using EML with this dataset</h2>

<h3 id="install-eml">Install EML</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"devtools"</span><span class="p">)</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"RHTMLForms"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://www.omegahat.org/R/"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"source"</span><span class="p">)</span><span class="w">
</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"ropensci/EML"</span><span class="p">,</span><span class="w"> </span><span class="n">build</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">dependencies</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"DEPENDS"</span><span class="p">,</span><span class="w"> </span><span class="s2">"IMPORTS"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p>Load <code class="highlighter-rouge">EML</code></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s1">'EML'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="prepare-metadata">Prepare metadata</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># dataset
</span><span class="n">prelim_dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"conditionality_data_prelim.csv"</span><span class="p">)</span><span class="w">
</span><span class="c1"># variable descriptions for each column
</span><span class="n">prelim_vars</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"variables_prelim.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Get column definitions in a vector</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">col_defs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">prelim_vars</span><span class="o">$</span><span class="n">description</span><span class="w">
</span></code></pre>
</div>

<p>Create unit definitions for each column</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">unit_defs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span><span class="w">
    </span><span class="n">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="kc">Inf</span><span class="p">)),</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span><span class="w">
    </span><span class="n">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="kc">Inf</span><span class="p">)),</span><span class="w">
  </span><span class="s2">"independent replicates"</span><span class="p">,</span><span class="w">
  </span><span class="nf">c</span><span class="p">(</span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span><span class="w">
    </span><span class="n">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="kc">Inf</span><span class="p">)),</span><span class="w">

  </span><span class="n">...</span><span class="w"> </span><span class="o">&lt;</span><span class="n">CUTOFF</span><span class="o">&gt;</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="write-an-eml-file">Write an EML file</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">eml_write</span><span class="p">(</span><span class="n">prelim_dat</span><span class="p">,</span><span class="w">
          </span><span class="n">unit.defs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit_defs</span><span class="p">,</span><span class="w">
          </span><span class="n">col.defs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_defs</span><span class="p">,</span><span class="w">
          </span><span class="n">creator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Scott Chamberlain"</span><span class="p">,</span><span class="w">
          </span><span class="n">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myrmecocystus@gmail.com"</span><span class="p">,</span><span class="w">
          </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"conditionality_data_prelim_eml.xml"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] "conditionality_data_prelim_eml.xml"
</code></pre>
</div>

<h3 id="validate-the-eml-file">Validate the EML file</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">eml_validate</span><span class="p">(</span><span class="s2">"conditionality_data_prelim_eml.xml"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## EML specific tests XML specific tests 
##               TRUE               TRUE
</code></pre>
</div>

<h3 id="read-data-and-metadata">Read data and metadata</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">gg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eml_read</span><span class="p">(</span><span class="s2">"conditionality_data_prelim_eml.xml"</span><span class="p">)</span><span class="w">
</span><span class="n">eml_get</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span><span class="w"> </span><span class="s2">"contact"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] "myrmecocystus@gmail.com"
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">eml_get</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span><span class="w"> </span><span class="s2">"citation_info"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Chamberlain S (2014-10-06). _metadata_.
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eml_get</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span><span class="w"> </span><span class="s2">"data.frame"</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">dat</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)])</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##   order i indrep avg author_last  finit_1 finit_2 finit_abv co_author
## 1     1 1      a   1      Devall margaret       s        ms     Thein
## 2     2 1      a   2      Devall margaret       s        ms     Thein
## 3     3 1      a   3      Devall margaret       s        ms     Thein
## 4     4 1      a   4      Devall margaret       s        ms     Thein
## 5     5 1      a   5      Devall margaret       s        ms     Thein
## 6     6 1      a   6      Devall margaret       s        ms     Thein
##   sinit_1
## 1 leonard
## 2 leonard
## 3 leonard
## 4 leonard
## 5 leonard
## 6 leonard
</code></pre>
</div>

<h3 id="publish">Publish</h3>

<p>We can also use the <code class="highlighter-rouge">EML</code> package to publish the data, here to <a href="http://figshare.com">Figshare</a>.</p>

<p>First, install <code class="highlighter-rouge">rfigshare</code></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"rfigshare"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s1">'rfigshare'</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Then publish using <code class="highlighter-rouge">eml_publish()</code></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">figid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eml_publish</span><span class="p">(</span><span class="w">
            </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"conditionality_data_prelim_eml.xml"</span><span class="p">,</span><span class="w">
            </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"EML file for Chamberlain, S.A., J.A. Rudgers, and J.L. Bronstein. 2014. How context-dependent are species interactions. Ecology Letters"</span><span class="p">,</span><span class="w">
            </span><span class="n">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Ecology"</span><span class="p">,</span><span class="w">
            </span><span class="n">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"EML"</span><span class="p">,</span><span class="w">
            </span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"figshare"</span><span class="p">,</span><span class="w">
            </span><span class="n">visibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"public"</span><span class="p">,</span><span class="w">
            </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"condionality data, EML"</span><span class="p">)</span><span class="w">
</span><span class="n">fs_make_public</span><span class="p">(</span><span class="n">figid</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/public/img/2014-10-06-conditionality-meta-analysis/figshare_conditional.png" alt="" /></p>


  </div>
  
  <div class="post">
    <h1>
      <a href="/2014/08/rsunlight/">
        rsunlight - R client for Sunlight Labs APIs
      </a>
    </h1>

    <span class="post-date">11 Aug 2014</span>

    <p>My <a href="http://recology.info/2014/05/rsunlight/">last blog post on this package</a> was so long ago the package wrapped both New York Times APIs and Sunlight Labs APIs and the package was called <code class="highlighter-rouge">govdat</code>. I split that package up into <code class="highlighter-rouge">rsunlight</code> for Sunlight Labs APIs and <code class="highlighter-rouge">rtimes</code> for some New York Times APIs. <code class="highlighter-rouge">rtimes</code> is <a href="https://github.com/ropengov/rtimes">in development at Github</a>.</p>

<p>We’ve updated the package to include four sets of functions, one set for each of four Sunlight Labs APIs (with a separate prefix for each API):</p>

<ul>
  <li>Congress API (<code class="highlighter-rouge">cg_</code>)</li>
  <li>Open States API (<code class="highlighter-rouge">os_</code>)</li>
  <li>Capitol Words API (<code class="highlighter-rouge">cw_</code>)</li>
  <li>Influence Explorer API (<code class="highlighter-rouge">ie_</code>)</li>
</ul>

<p>Then there are many methods for each API.</p>

<h2 id="rsunlight-intro">rsunlight intro</h2>

<h3 id="installation">Installation</h3>

<p>First, installation</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"ropengov/rsunlight"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Load the library</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"rsunlight"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="congress-api">Congress API</h3>

<p>Search for Fed level bills that include the term <em>health care</em> in them.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cg_bills</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s1">'health care'</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">results</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">])</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##          nicknames congress last_version_on sponsor_id
## 1        obamacare      111      2010-08-25    S000749
## 2 obamacare, ppaca      111      2010-08-25    R000053
## 3             NULL      113      2013-10-09    K000220
## 4             NULL      111      2009-01-06    I000056
## 5             NULL      112      2011-01-05    I000056
## 6             NULL      111      2009-05-05    D000197
</code></pre>
</div>

<p>Search for bills that have the two terms <em>transparency</em> and <em>accountability</em> within 5 words of each other in the bill.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cg_bills</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s1">'transparency accountability'</span><span class="o">~</span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">results</span><span class="p">[,</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">])</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##   congress last_version_on sponsor_id
## 1      111      2009-01-15    R000435
## 2      113      2013-07-17    R000595
## 3      112      2011-12-08    R000435
## 4      113      2013-09-19    R000435
## 5      112      2011-11-10    R000595
## 6      113      2013-07-23    C000560
##                                       urls.govtrack
## 1   http://www.govtrack.us/congress/bills/111/hr557
## 2  https://www.govtrack.us/congress/bills/113/s1313
## 3  http://www.govtrack.us/congress/bills/112/hr2829
## 4 https://www.govtrack.us/congress/bills/113/hr3155
## 5   http://www.govtrack.us/congress/bills/112/s1848
## 6  https://www.govtrack.us/congress/bills/113/s1347
##                                 urls.opencongress
## 1  http://www.opencongress.org/bill/111-h557/show
## 2      http://www.opencongress.org/bill/s1313-113
## 3 http://www.opencongress.org/bill/112-h2829/show
## 4     http://www.opencongress.org/bill/hr3155-113
## 5 http://www.opencongress.org/bill/112-s1848/show
## 6      http://www.opencongress.org/bill/s1347-113
##                                          urls.congress
## 1   http://beta.congress.gov/bill/111th/house-bill/557
## 2 http://beta.congress.gov/bill/113th/senate-bill/1313
## 3  http://beta.congress.gov/bill/112th/house-bill/2829
## 4  http://beta.congress.gov/bill/113th/house-bill/3155
## 5 http://beta.congress.gov/bill/112th/senate-bill/1848
## 6 http://beta.congress.gov/bill/113th/senate-bill/1347
</code></pre>
</div>

<h3 id="open-states-api">Open States API</h3>

<p>Search State Bills, in this case search for the term <em>agriculture</em> in Texas.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">os_billsearch</span><span class="p">(</span><span class="n">terms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'agriculture'</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'tx'</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##                                                                                                                                                 title
## 1 Relating to authorizing the issuance of revenue bonds to fund capital projects at public institutions of higher education; making an appropriation.
## 2                          Relating to authorizing the issuance of revenue bonds to fund capital projects at public institutions of higher education.
## 3                          Relating to authorizing the issuance of revenue bonds to fund capital projects at public institutions of higher education.
## 4                          Relating to authorizing the issuance of revenue bonds to fund capital projects at public institutions of higher education.
## 5 Relating to authorizing the issuance of revenue bonds to fund capital projects at public institutions of higher education; making an appropriation.
## 6                                Relating to access to certain facilities by search and rescue dogs and their handlers; providing a criminal penalty.
##            created_at          updated_at          id chamber state
## 1 2013-08-01 03:33:40 2013-08-07 03:10:10 TXB00034894   upper    tx
## 2 2013-08-01 03:33:38 2013-08-02 03:20:14 TXB00034893   upper    tx
## 3 2013-07-21 03:03:53 2013-07-28 03:28:30 TXB00034814   upper    tx
## 4 2013-07-03 02:44:03 2013-07-14 03:00:31 TXB00034514   upper    tx
## 5 2013-06-16 03:48:13 2013-06-23 04:02:49 TXB00033988   upper    tx
## 6 2013-03-03 04:47:26 2013-07-01 21:25:36 TXB00027556   upper    tx
##   session type
## 1     833 bill
## 2     833 bill
## 3     832 bill
## 4     832 bill
## 5     831 bill
## 6      83 bill
##                                                                             subjects
## 1                                   Commerce, Education, Budget, Spending, and Taxes
## 2                                   Commerce, Education, Budget, Spending, and Taxes
## 3                                   Commerce, Education, Budget, Spending, and Taxes
## 4                                   Commerce, Education, Budget, Spending, and Taxes
## 5                                   Commerce, Education, Budget, Spending, and Taxes
## 6 Commerce, Business and Consumers, Animal Rights and Wildlife Issues, Health, Crime
##   bill_id
## 1    SB 3
## 2   SB 10
## 3   SB 40
## 4    SB 6
## 5   SB 44
## 6 SB 1010
</code></pre>
</div>

<p>Search for legislators in California (<em>ca</em>) and in the democratic party</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">os_legislatorsearch</span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ca'</span><span class="p">,</span><span class="w"> </span><span class="n">party</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'democratic'</span><span class="p">,</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'full_name'</span><span class="p">,</span><span class="s1">'+capitol_office.phone'</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##            phone        id       full_name
## 1 (916) 319-2014 CAL000058   Nancy Skinner
## 2 (916) 319-2015 CAL000059   Joan Buchanan
## 3 (916) 319-2022 CAL000084       Paul Fong
## 4 (916) 319-2046 CAL000089      John Pérez
## 5 (916) 319-2080 CAL000098 V. Manuel Pérez
## 6 (916) 319-2001 CAL000101  Wesley Chesbro
</code></pre>
</div>

<p>Now you can call each representative, yay!</p>

<h3 id="capitol-words-api">Capitol Words API</h3>

<p>Search for phrase <em>climate change</em> used by politicians between September 5th and 16th, 2011:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">cw_text</span><span class="p">(</span><span class="n">phrase</span><span class="o">=</span><span class="s1">'climate change'</span><span class="p">,</span><span class="w"> </span><span class="n">start_date</span><span class="o">=</span><span class="s1">'2011-09-05'</span><span class="p">,</span><span class="w"> </span><span class="n">end_date</span><span class="o">=</span><span class="s1">'2011-09-16'</span><span class="p">,</span><span class="w"> </span><span class="n">party</span><span class="o">=</span><span class="s1">'D'</span><span class="p">)[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'speaker_last'</span><span class="p">,</span><span class="s1">'origin_url'</span><span class="p">)])</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##   speaker_last
## 1      Tsongas
## 2       Inslee
## 3        Costa
## 4        Boxer
## 5       Durbin
## 6        Boxer
##                                                                                   origin_url
## 1 http://origin.www.gpo.gov/fdsys/pkg/CREC-2011-09-14/html/CREC-2011-09-14-pt1-PgH6149-5.htm
## 2   http://origin.www.gpo.gov/fdsys/pkg/CREC-2011-09-15/html/CREC-2011-09-15-pt1-PgH6186.htm
## 3 http://origin.www.gpo.gov/fdsys/pkg/CREC-2011-09-13/html/CREC-2011-09-13-pt1-PgE1609-2.htm
## 4   http://origin.www.gpo.gov/fdsys/pkg/CREC-2011-09-15/html/CREC-2011-09-15-pt1-PgS5650.htm
## 5   http://origin.www.gpo.gov/fdsys/pkg/CREC-2011-09-13/html/CREC-2011-09-13-pt1-PgS5510.htm
## 6 http://origin.www.gpo.gov/fdsys/pkg/CREC-2011-09-13/html/CREC-2011-09-13-pt1-PgS5513-2.htm
</code></pre>
</div>

<p>Plot mentions of the term <em>climate change</em> over time for Democrats vs. Republicans</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s1">'ggplot2'</span><span class="p">)</span><span class="w">
</span><span class="n">dat_d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cw_timeseries</span><span class="p">(</span><span class="n">phrase</span><span class="o">=</span><span class="s1">'climate change'</span><span class="p">,</span><span class="w"> </span><span class="n">party</span><span class="o">=</span><span class="s2">"D"</span><span class="p">)</span><span class="w">
</span><span class="n">dat_d</span><span class="o">$</span><span class="n">party</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">"D"</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">dat_d</span><span class="p">))</span><span class="w">
</span><span class="n">dat_r</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cw_timeseries</span><span class="p">(</span><span class="n">phrase</span><span class="o">=</span><span class="s1">'climate change'</span><span class="p">,</span><span class="w"> </span><span class="n">party</span><span class="o">=</span><span class="s2">"R"</span><span class="p">)</span><span class="w">
</span><span class="n">dat_r</span><span class="o">$</span><span class="n">party</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">"R"</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">dat_r</span><span class="p">))</span><span class="w">
</span><span class="n">dat_both</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">dat_d</span><span class="p">,</span><span class="w"> </span><span class="n">dat_r</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">dat_both</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">party</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">theme_grey</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="s2">"red"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="/public/img/2014-08-11-rsunlight/unnamed-chunk-9.png" alt="plot of chunk unnamed-chunk-9" /></p>

<h3 id="influence-explorer-api">Influence Explorer API</h3>

<p>Search for contributions of equal to or more than <code class="highlighter-rouge">$20,000,000</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ie_contr</span><span class="p">(</span><span class="n">amount</span><span class="o">=</span><span class="s1">'&gt;|20000000'</span><span class="p">)[,</span><span class="nf">c</span><span class="p">(</span><span class="s1">'amount'</span><span class="p">,</span><span class="s1">'recipient_name'</span><span class="p">,</span><span class="s1">'contributor_name'</span><span class="p">)]</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##         amount
## 1  25177212.00
## 2  20000000.00
## 3  20000000.00
## 4  20000000.00
## 5  20000000.00
## 6  20000000.00
## 7  50000000.00
## 8  34000000.00
## 9  28000000.00
## 10 20000000.00
##                                                   recipient_name
## 1                                       Republican National Cmte
## 2  CALIFORNIANS TO CLOSE THE OUT-OF-STATE CORPORATE TAX LOOPHOLE
## 3                                                   WHITMAN, MEG
## 4                                                   WHITMAN, MEG
## 5                                                   WHITMAN, MEG
## 6                                                   WHITMAN, MEG
## 7                                         GOLISANO, B THOMAS (G)
## 8                                         GOLISANO, B THOMAS (G)
## 9                                         GOLISANO, B THOMAS (G)
## 10                                        GOLISANO, B THOMAS (G)
##           contributor_name
## 1           Romney Victory
## 2         STEYER, THOMAS F
## 3  WHITMAN, MARGARET (MEG)
## 4  WHITMAN, MARGARET (MEG)
## 5  WHITMAN, MARGARET (MEG)
## 6  WHITMAN, MARGARET (MEG)
## 7       GOLISANO, B THOMAS
## 8       GOLISANO, B THOMAS
## 9       GOLISANO, B THOMAS
## 10      GOLISANO, B THOMAS
</code></pre>
</div>

<p>Top industries, by contributions given. <em>UNKOWN</em> is a very influential industry. Of course <em>law firms</em> are high up there, as well as <em>real estate</em>. I’m sure <em>oil and gas</em> is embarrased that they’re contributing less than <em>pulic sector unions</em>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ie_industries</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'top_ind'</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="o">=</span><span class="m">10</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##       count        amount                               id
## 1  14919818 3825359507.21 cdb3f500a3f74179bb4a5eb8b2932fa6
## 2   3600761 2787678962.95 f50cf984a2e3477c8167d32e2b14e052
## 3    329906 1717649914.58 9cac88377c3b400e89c2d6762e3f28f6
## 4   1386613 1707457092.04 7500030dffe24844aa467a75f7aedfd1
## 5    774496 1563637586.57 0af3f418f426497e8bbf916bfc074ebc
## 6    546367 1389220855.35 52e5d4c6c0fa47c3bdb199a28f96d434
## 7   2134350 1384221307.53 a05a0d06f6814b31bece35a81fcb40c7
## 8   1003850  986588892.83 8ada0fc2d6994f2ab06c7e025dff2284
## 9    567082  775241387.17 52766c4910a846f2813a1dda212b7027
## 10   151006  706747646.35 13718be68388456d9b6e8db753f06e72
##    should_show_entity                    name
## 1                TRUE                 UNKNOWN
## 2                TRUE       LAWYERS/LAW FIRMS
## 3                TRUE  CANDIDATE SELF-FINANCE
## 4                TRUE             REAL ESTATE
## 5                TRUE SECURITIES &amp; INVESTMENT
## 6                TRUE    PUBLIC SECTOR UNIONS
## 7                TRUE    HEALTH PROFESSIONALS
## 8                TRUE               INSURANCE
## 9                TRUE               OIL &amp; GAS
## 10               TRUE        CASINOS/GAMBLING
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res</span><span class="o">$</span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">amount</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">reorder</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">),</span><span class="w"> </span><span class="n">amount</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">dollar</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_grey</span><span class="p">(</span><span class="n">base_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/public/img/2014-08-11-rsunlight/unnamed-chunk-11.png" alt="plot of chunk unnamed-chunk-11" /></p>

<hr />

<h2 id="feedback">Feedback</h2>

<p>Please do use <code class="highlighter-rouge">rsunlight</code>, and let us know what you want fixed, new features, etc.</p>

<h2 id="still-to-come">Still to come:</h2>

<ul>
  <li>Functions to visualize data from each API. You can do this yourself, but a few functions will be created to help those that are new to R.</li>
  <li>Vectorize functions so that you can give many inputs to a function instead of a single input.</li>
  <li>test suite: embarrasingly, there is no test suite yet, boo me.</li>
  <li>I plan to push <code class="highlighter-rouge">rsunlight</code> to CRAN soon as <code class="highlighter-rouge">v0.3</code></li>
</ul>

  </div>
  
</div>

<!-- Pagination links -->
<div class="pagination">
  
    <a href="/page18" class="older">Older</a>
  
  
    
      <a href="/page16" class="newer">Newer</a>
    
  
</div>

    </div>

    <!-- for bootstrap tooltips -->
    <script type="text/javascript">
      $("[data-toggle=\"tooltip\"]").tooltip();
    </script>

  </body>

  <footer>
  <!-- Disqus code -->
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'recology'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>

  <!-- google analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-63197374-1', 'auto');
    ga('send', 'pageview');
  </script>
</footer>

</html>
