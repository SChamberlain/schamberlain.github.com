<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    
    Recology, R ecology
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon.ico">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0f layout-reverse">

    <header class="masthead">
      <div class="masthead-inner">
        <h1>Recology</h1>
        <!-- <h1> <a href="http://recology.info/">Recology</a></h1> -->
        <p class="lead">R/etc.</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="/"><i class="fa fa-home fa-lg"></i></a>&nbsp;
              <a href="/about"><i class="fa fa-info-circle fa-lg"></i></a>&nbsp;
              <a href="/archives"><i class="fa fa-archive fa-lg"></i></a>&nbsp;
              <a href="/rresources"><i class="fa fa-book fa-lg"></i></a>&nbsp;
              <a href="http://rforcats.net/" rel><i class="fa fa-graduation-cap fa-lg"></i></a>&nbsp;
              <a href="http://feeds.feedburner.com/github/wpna"><i class="fa fa-rss fa-lg"></i></a>&nbsp;
              <a href="https://twitter.com/recology_"><i class="fa fa-twitter fa-lg"></i></a>&nbsp;
              <a href="/fork"><i class="fa fa-spinner fa-lg"></i></a>
            </li>
          </ul>
          <!-- <small><a href="https://github.com/mdo/hyde">Hyde</a> from <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</small> -->
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="posts">
  <a style="float:right;" href="/archives" data-toggle="tooltip" data-placement="bottom" title="Archives"><i class="fa fa-archive fa-lg"></i></a>
  <a style="float:right;" href="/tags"><i class="fa fa-tags fa-lg"></i></a>&nbsp;
  
  <div class="post">
    <h1>
      <a href="/2012/12/taxize/">
        One R package for all your taxonomic needs
      </a>
    </h1>

    <span class="post-date">06 Dec 2012</span>

    <p>UPDATE: there were some errors in the tests for <code>taxize</code>, so the binaries aren't avaiable yet. You can install from source though, see below.</p>

<p>Getting taxonomic information for the set of species you are studying can be a pain in the ass. You have to manually type, or paste in, your species one-by-one. Or, if you are lucky, there is a web service in which you can upload a list of species. Encyclopedia of Life (EOL) has a service where you can do this <a href="http://gni.globalnames.org/parsers/new">here</a>. But is this reproducible? No.</p>

<p>Getting your taxonomic information for your species can now be done programatically in R. Do you want to get taxonomic information from ITIS. We got that. Tropicos? We got that too. uBio? No worries, we got that. What about theplantlist.org? Yep, got that. Encyclopedia of Life? Indeed. What about getting sequence data for a taxon? Oh hell yeah, you can get sequences available for a taxon across all genes, or get all records for a taxon for a specific gene.</p>

<p>Of course this is all possible because these data providers have open APIs so that we can facilitate your computer talking to their database. Fun!</p>

<p>Why get your taxonomic data programatically? Because it's 1) faster than by hand in web sites/looking up in books, 2) reproducible, especially if you share your code (damnit!), and 3) you can easily mash up your new taxonomic data to get sequences to build a phylogeny, etc.</p>

<p>I'll give a few examples of using <code>taxize</code> based around use cases, that is, stuff someone might actually do instead of what particular functions do.</p>

<hr />

<h3>Install packages.  You can get from CRAN or GitHub.</h3>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># install.packages(&quot;ritis&quot;) # uncomment if not already installed</span>
<span class="c1"># install_github(&#39;taxize_&#39;, &#39;ropensci&#39;) # uncomment if not already installed</span>
<span class="c1"># install.packages(&quot;taxize&quot;, type=&quot;source&quot;) # uncomment if not already installed</span>
<span class="kn">library</span><span class="p">(</span>ritis<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>taxize<span class="p">)</span></code></pre></div>


<hr />

<h3>Attach family names to a list of species.</h3>

<h4>I often have a list of species that I studied and simply want to get their family names to, for example, make a table for the paper I'm writing.</h4>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># For one species</span>
itis_name<span class="p">(</span>query <span class="o">=</span> <span class="s">&quot;Poa annua&quot;</span><span class="p">,</span> get <span class="o">=</span> <span class="s">&quot;family&quot;</span><span class="p">)</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">Retrieving data for species &#39; Poa annua &#39;</code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">[1] &quot;Poaceae&quot;</code></pre></div>




<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># For many species</span>
species <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Poa annua&quot;</span><span class="p">,</span> <span class="s">&quot;Abies procera&quot;</span><span class="p">,</span> <span class="s">&quot;Helianthus annuus&quot;</span><span class="p">,</span> <span class="s">&quot;Coffea arabica&quot;</span><span class="p">)</span>
famnames <span class="o">&lt;-</span> <span class="kp">sapply</span><span class="p">(</span>species<span class="p">,</span> itis_name<span class="p">,</span> get <span class="o">=</span> <span class="s">&quot;family&quot;</span><span class="p">,</span> USE.NAMES <span class="o">=</span> <span class="bp">F</span><span class="p">)</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">Retrieving data for species &#39; Poa annua &#39;</code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">Retrieving data for species &#39; Abies procera &#39;</code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">Retrieving data for species &#39; Helianthus annuus &#39;</code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">Retrieving data for species &#39; Coffea arabica &#39;</code></pre></div>




<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kt">data.frame</span><span class="p">(</span>species <span class="o">=</span> species<span class="p">,</span> family <span class="o">=</span> famnames<span class="p">)</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">species     family
1         Poa annua    Poaceae
2     Abies procera   Pinaceae
3 Helianthus annuus Asteraceae
4    Coffea arabica  Rubiaceae</code></pre></div>


<hr />

<h3>Resolve taxonomic names.</h3>

<h4>This is a common use case for ecologists/evolutionary biologists, or at least should be. That is, species names you have for your own data, or when using other's data, could be old names - and if you need the newest names for your species list, how can you make this as painless as possible? You can query taxonomic data from many different sources with <code>taxize</code>.</h4>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># The iPlantCollaborative provides access via API to their taxonomic name</span>
<span class="c1"># resolution service (TNRS)</span>
mynames <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;shorea robusta&quot;</span><span class="p">,</span> <span class="s">&quot;pandanus patina&quot;</span><span class="p">,</span> <span class="s">&quot;oryza sativa&quot;</span><span class="p">,</span> <span class="s">&quot;durio zibethinus&quot;</span><span class="p">,</span> 
    <span class="s">&quot;rubus ulmifolius&quot;</span><span class="p">,</span> <span class="s">&quot;asclepias curassavica&quot;</span><span class="p">,</span> <span class="s">&quot;pistacia lentiscus&quot;</span><span class="p">)</span>
iplant_tnrsmatch<span class="p">(</span>retrieve <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> taxnames <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;helianthus annuus&quot;</span><span class="p">,</span> <span class="s">&quot;acacia&quot;</span><span class="p">,</span> 
    <span class="s">&quot;gossypium&quot;</span><span class="p">),</span> output <span class="o">=</span> <span class="s">&quot;names&quot;</span><span class="p">)</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">AcceptedName   MatchFam MatchGenus MatchScore    Accept?
1 Helianthus annuus Asteraceae Helianthus          1 No opinion
2            Acacia   Fabaceae     Acacia          1 No opinion
3                                  Acacia          1 No opinion
4         Gossypium  Malvaceae  Gossypium          1 No opinion
     SubmittedNames
1 helianthus annuus
2            acacia
3            acacia
4         gossypium</code></pre></div>




<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># The global names resolver is another attempt at this, hitting many</span>
<span class="c1"># different data sources</span>
gnr_resolve<span class="p">(</span>names <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Helianthus annuus&quot;</span><span class="p">,</span> <span class="s">&quot;Homo sapiens&quot;</span><span class="p">),</span> returndf <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">data_source_id    submitted_name       name_string score
1               4 Helianthus annuus Helianthus annuus 0.988
3              10 Helianthus annuus Helianthus annuus 0.988
5              12 Helianthus annuus Helianthus annuus 0.988
8             110 Helianthus annuus Helianthus annuus 0.988
11            159 Helianthus annuus Helianthus annuus 0.988
13            166 Helianthus annuus Helianthus annuus 0.988
15            169 Helianthus annuus Helianthus annuus 0.988
2               4      Homo sapiens      Homo sapiens 0.988
4              10      Homo sapiens      Homo sapiens 0.988
6              12      Homo sapiens      Homo sapiens 0.988
7             107      Homo sapiens      Homo sapiens 0.988
9             122      Homo sapiens      Homo sapiens 0.988
10            123      Homo sapiens      Homo sapiens 0.988
12            159      Homo sapiens      Homo sapiens 0.988
14            168      Homo sapiens      Homo sapiens 0.988
16            169      Homo sapiens      Homo sapiens 0.988
                     title
1                     NCBI
3                 Freebase
5                      EOL
8     Illinois Wildflowers
11                 CU*STAR
13                   nlbif
15           uBio NameBank
2                     NCBI
4                 Freebase
6                      EOL
7                AskNature
9                 BioPedia
10                   AnAge
12                 CU*STAR
14 Index to Organism Names
16           uBio NameBank</code></pre></div>




<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># We can hit the Plantminer API too</span>
plants <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Myrcia lingua&quot;</span><span class="p">,</span> <span class="s">&quot;Myrcia bella&quot;</span><span class="p">,</span> <span class="s">&quot;Ocotea pulchella&quot;</span><span class="p">,</span> <span class="s">&quot;Miconia&quot;</span><span class="p">,</span> 
    <span class="s">&quot;Coffea arabica var. amarella&quot;</span><span class="p">,</span> <span class="s">&quot;Bleh&quot;</span><span class="p">)</span>
plantminer<span class="p">(</span>plants<span class="p">)</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">Myrcia lingua 
Myrcia bella 
Ocotea pulchella 
Miconia 
Coffea arabica var. amarella 
Bleh</code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">fam   genus                    sp             author
1       Myrtaceae  Myrcia                lingua   (O. Berg) Mattos
2       Myrtaceae  Myrcia                 bella           Cambess.
3       Lauraceae  Ocotea             pulchella (Nees &amp; Mart.) Mez
4 Melastomataceae Miconia                    NA        Ruiz &amp; Pav.
5       Rubiaceae  Coffea arabica var. amarella        A. Froehner
6              NA    Bleh                    NA                 NA
            source source.id   status confidence suggestion       database
1              TRO 100227036       NA         NA         NA       Tropicos
2             WCSP    131057 Accepted          H         NA The Plant List
3 WCSP (in review)    989758 Accepted          M         NA The Plant List
4              TRO  40018467       NA         NA         NA       Tropicos
5              TRO 100170231       NA         NA         NA       Tropicos
6               NA        NA       NA         NA       Baea             NA</code></pre></div>




<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># We made a light wrapper around the Taxonstand package to search</span>
<span class="c1"># Theplantlist.org too</span>
splist <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Heliathus annuus&quot;</span><span class="p">,</span> <span class="s">&quot;Abies procera&quot;</span><span class="p">,</span> <span class="s">&quot;Poa annua&quot;</span><span class="p">,</span> <span class="s">&quot;Platanus occidentalis&quot;</span><span class="p">,</span> 
    <span class="s">&quot;Carex abrupta&quot;</span><span class="p">,</span> <span class="s">&quot;Arctostaphylos canescens&quot;</span><span class="p">,</span> <span class="s">&quot;Ocimum basilicum&quot;</span><span class="p">,</span> <span class="s">&quot;Vicia faba&quot;</span><span class="p">,</span> 
    <span class="s">&quot;Quercus kelloggii&quot;</span><span class="p">,</span> <span class="s">&quot;Lactuca serriola&quot;</span><span class="p">)</span>
tpl_search<span class="p">(</span>taxon <span class="o">=</span> splist<span class="p">)</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">Genus      Species Infraspecific Plant.Name.Index
1       Heliathus       annuus                          FALSE
2           Abies      procera                           TRUE
3             Poa        annua                           TRUE
4        Platanus occidentalis                           TRUE
5           Carex      abrupta                           TRUE
6  Arctostaphylos    canescens                           TRUE
7          Ocimum    basilicum                           TRUE
8           Vicia         faba                           TRUE
9         Quercus    kelloggii                           TRUE
10        Lactuca     serriola                           TRUE
   Taxonomic.status      Family      New.Genus  New.Species
1                                    Heliathus       annuus
2          Accepted    Pinaceae          Abies      procera
3          Accepted     Poaceae            Poa        annua
4          Accepted Platanaceae       Platanus occidentalis
5          Accepted  Cyperaceae          Carex      abrupta
6          Accepted   Ericaceae Arctostaphylos    canescens
7          Accepted   Lamiaceae         Ocimum    basilicum
8          Accepted Leguminosae          Vicia         faba
9          Accepted    Fagaceae        Quercus    kelloggii
10         Accepted  Compositae        Lactuca     serriola
   New.Infraspecific Authority  Typo WFormat
1                              FALSE   FALSE
2                       Rehder FALSE   FALSE
3                           L. FALSE   FALSE
4                           L. FALSE   FALSE
5               &lt;NA&gt;     Mack. FALSE   FALSE
6                       Eastw. FALSE   FALSE
7                           L. FALSE   FALSE
8                           L. FALSE   FALSE
9               &lt;NA&gt;     Newb. FALSE   FALSE
10                          L. FALSE   FALSE</code></pre></div>


<hr />

<h3>Taxonomic hierarchies</h3>

<h4>I often want the full taxonomic hierarchy for a set of species. That is, give me the family, order, class, etc. for my list of species. There are two different easy ways to do this with <code>taxize</code>. The first example uses EOL.</h4>

<hr />

<h4>Using EOL.</h4>

<div class="highlight"><pre><code class="language-r" data-lang="r">pageid <span class="o">&lt;-</span> eol_search<span class="p">(</span><span class="s">&quot;Quercus douglasii&quot;</span><span class="p">)</span><span class="o">$</span>id<span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="c1"># first need to search for the taxon&#39;s page on EOL</span>
out <span class="o">&lt;-</span> eol_pages<span class="p">(</span>taxonconceptID <span class="o">=</span> pageid<span class="p">)</span>  <span class="c1"># then we nee to get the taxon ID used by EOL</span>

<span class="c1"># Notice that there are multiple different sources you can pull the</span>
<span class="c1"># hierarchy from. Note even that you can get the hierarchy from the ITIS</span>
<span class="c1"># service via this EOL API.</span>
out</code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">identifier                 scientificName
1   46203061 Quercus douglasii Hook. &amp; Arn.
2   48373995 Quercus douglasii Hook. &amp; Arn.
                                  nameAccordingTo sourceIdentfier
1  Integrated Taxonomic Information System (ITIS)           19322
2 Species 2000 &amp; ITIS Catalogue of Life: May 2012         9723391
  taxonRank
1   Species
2   Species</code></pre></div>




<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Then the hierarchy!</span>
eol_hierarchy<span class="p">(</span>out<span class="p">[</span>out<span class="o">$</span>nameAccordingTo <span class="o">==</span> <span class="s">&quot;Species 2000 &amp; ITIS Catalogue of Life: May 2012&quot;</span><span class="p">,</span> 
    <span class="s">&quot;identifier&quot;</span><span class="p">])</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">sourceIdentifier  taxonID parentNameUsageID taxonConceptID
1         11017504 48276627                 0            281
2         11017505 48276628          48276627            282
3         11017506 48276629          48276628            283
4         11022500 48373354          48276629           4184
5         11025284 48373677          48373354           4197
  scientificName taxonRank
1        Plantae   kingdom
2  Magnoliophyta    phylum
3  Magnoliopsida     class
4        Fagales     order
5       Fagaceae    family</code></pre></div>




<div class="highlight"><pre><code class="language-r" data-lang="r">eol_hierarchy<span class="p">(</span>out<span class="p">[</span>out<span class="o">$</span>nameAccordingTo <span class="o">==</span> <span class="s">&quot;Integrated Taxonomic Information System (ITIS)&quot;</span><span class="p">,</span> 
    <span class="s">&quot;identifier&quot;</span><span class="p">])</span>  <span class="c1"># and from ITIS, slightly different than ITIS output below, which includes taxa all the way down.</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">sourceIdentifier  taxonID parentNameUsageID taxonConceptID
1            202422 46150613                 0            281
2            846492 46159776          46150613        8654492
3            846494 46161961          46159776       28818077
4            846496 46167532          46161961           4494
5            846504 46169010          46167532       28825126
6            846505 46169011          46169010            282
7             18063 46169012          46169011            283
8            846548 46202954          46169012       28859070
9             19273 46202955          46202954           4184
10            19275 46203022          46202955           4197
    scientificName     taxonRank
1          Plantae       kingdom
2   Viridaeplantae    subkingdom
3     Streptophyta  infrakingdom
4     Tracheophyta      division
5  Spermatophytina   subdivision
6     Angiospermae infradivision
7    Magnoliopsida         class
8          Rosanae    superorder
9          Fagales         order
10        Fagaceae        family</code></pre></div>


<hr />

<h4>And getting a taxonomic hierarchy using ITIS.</h4>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># First, get the taxonomic serial number (TSN) that ITIS uses</span>
mytsn <span class="o">&lt;-</span> get_tsn<span class="p">(</span><span class="s">&quot;Quercus douglasii&quot;</span><span class="p">,</span> <span class="s">&quot;sciname&quot;</span><span class="p">)</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">Retrieving data for species &#39; Quercus douglasii &#39;</code></pre></div>




<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Get the full taxonomic hierarchy for a taxon from the TSN</span>
itis<span class="p">(</span>mytsn<span class="p">,</span> <span class="s">&quot;getfullhierarchyfromtsn&quot;</span><span class="p">)</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">$`1`
        parentName parentTsn      rankName         taxonName    tsn
1                                  Kingdom           Plantae 202422
2          Plantae    202422    Subkingdom    Viridaeplantae 846492
3   Viridaeplantae    846492  Infrakingdom      Streptophyta 846494
4     Streptophyta    846494      Division      Tracheophyta 846496
5     Tracheophyta    846496   Subdivision   Spermatophytina 846504
6  Spermatophytina    846504 Infradivision      Angiospermae 846505
7     Angiospermae    846505         Class     Magnoliopsida  18063
8    Magnoliopsida     18063    Superorder           Rosanae 846548
9          Rosanae    846548         Order           Fagales  19273
10         Fagales     19273        Family          Fagaceae  19275
11        Fagaceae     19275         Genus           Quercus  19276
12         Quercus     19276       Species Quercus douglasii  19322</code></pre></div>




<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># But this can be even easier!</span>
classification<span class="p">(</span>get_tsn<span class="p">(</span><span class="s">&quot;Quercus douglasii&quot;</span><span class="p">))</span>  <span class="c1"># Boom!</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">Retrieving data for species &#39; Quercus douglasii &#39;</code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">$`1`
        parentName parentTsn      rankName         taxonName    tsn
1                                  Kingdom           Plantae 202422
2          Plantae    202422    Subkingdom    Viridaeplantae 846492
3   Viridaeplantae    846492  Infrakingdom      Streptophyta 846494
4     Streptophyta    846494      Division      Tracheophyta 846496
5     Tracheophyta    846496   Subdivision   Spermatophytina 846504
6  Spermatophytina    846504 Infradivision      Angiospermae 846505
7     Angiospermae    846505         Class     Magnoliopsida  18063
8    Magnoliopsida     18063    Superorder           Rosanae 846548
9          Rosanae    846548         Order           Fagales  19273
10         Fagales     19273        Family          Fagaceae  19275
11        Fagaceae     19275         Genus           Quercus  19276
12         Quercus     19276       Species Quercus douglasii  19322</code></pre></div>




<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># You can also do this easy-peasy route to a taxonomic hierarchy using</span>
<span class="c1"># uBio</span>
classification<span class="p">(</span>get_uid<span class="p">(</span><span class="s">&quot;Ornithorhynchus anatinus&quot;</span><span class="p">))</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">$`1`
       ScientificName         Rank    UID
1  cellular organisms      no rank 131567
2           Eukaryota superkingdom   2759
3        Opisthokonta      no rank  33154
4             Metazoa      kingdom  33208
5           Eumetazoa      no rank   6072
6           Bilateria      no rank  33213
7           Coelomata      no rank  33316
8       Deuterostomia      no rank  33511
9            Chordata       phylum   7711
10           Craniata    subphylum  89593
11         Vertebrata      no rank   7742
12      Gnathostomata   superclass   7776
13         Teleostomi      no rank 117570
14       Euteleostomi      no rank 117571
15      Sarcopterygii      no rank   8287
16          Tetrapoda      no rank  32523
17            Amniota      no rank  32524
18           Mammalia        class  40674
19        Prototheria      no rank   9254
20        Monotremata        order   9255
21  Ornithorhynchidae       family   9256
22    Ornithorhynchus        genus   9257</code></pre></div>


<hr />

<h3>Sequences?</h3>

<h4>While you are at doing taxonomic stuff, you often wonder "hmmm, I wonder if there are any sequence data available for my species?" So, you can use <code>get_seqs</code> to search for specific genes for a species, and <code>get_genes_avail</code> to find out what genes are available for a certain species. These functions search for data on <a href="http://www.ncbi.nlm.nih.gov/">NCBI</a>.</h4>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Get sequences (sequence is provied in output, but hiding here for</span>
<span class="c1"># brevity). What&#39;s nice about this is that it gets the longest sequence</span>
<span class="c1"># avaialable for the gene you searched for, and if there isn&#39;t anything</span>
<span class="c1"># available, it lets you get a sequence from a congener if you set</span>
<span class="c1"># getrelated=TRUE. The last column in the output data.frame also tells you</span>
<span class="c1"># what species the sequence is from.</span>
out <span class="o">&lt;-</span> get_seqs<span class="p">(</span>taxon_name <span class="o">=</span> <span class="s">&quot;Acipenser brevirostrum&quot;</span><span class="p">,</span> gene <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;5S rRNA&quot;</span><span class="p">),</span> 
    seqrange <span class="o">=</span> <span class="s">&quot;1:3000&quot;</span><span class="p">,</span> getrelated <span class="o">=</span> <span class="bp">T</span><span class="p">,</span> writetodf <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
out<span class="p">[,</span> <span class="o">!</span><span class="kp">names</span><span class="p">(</span>out<span class="p">)</span> <span class="o">%in%</span> <span class="s">&quot;sequence&quot;</span><span class="p">]</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">taxon                                         gene_desc
1 Acipenser brevirostrum Acipenser brevirostrum 5S rRNA gene, clone BRE92A
     gi_no     acc_no length                 spused
1 60417159 AJ745069.1    121 Acipenser brevirostrum</code></pre></div>




<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Search for available sequences</span>
out <span class="o">&lt;-</span> get_genes_avail<span class="p">(</span>taxon_name <span class="o">=</span> <span class="s">&quot;Umbra limi&quot;</span><span class="p">,</span> seqrange <span class="o">=</span> <span class="s">&quot;1:2000&quot;</span><span class="p">,</span> getrelated <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>
out<span class="p">[</span><span class="kp">grep</span><span class="p">(</span><span class="s">&quot;RAG1&quot;</span><span class="p">,</span> out<span class="o">$</span>genesavail<span class="p">,</span> ignore.case <span class="o">=</span> <span class="bp">T</span><span class="p">),</span> <span class="p">]</span>  <span class="c1"># does the string &#39;RAG1&#39; exist in any of the gene names</span></code></pre></div>




<div class="highlight"><pre><code class="language-text" data-lang="text">spused length
414 Umbra limi    732
427 Umbra limi    959
434 Umbra limi   1631
                                                                            genesavail
414 isolate UlimA recombinase activating protein 1 (rag1) gene, exon 3 and partial cds
427           recombination-activating protein 1 (RAG1) gene, intron 2 and partial cds
434                        recombination-activating protein 1 (RAG1) gene, partial cds
    predicted
414  JX190826
427  AY459526
434  AY380548</code></pre></div>


<hr />

<h4>Get the .Rmd file used to create this post <a href="https://github.com/sckott/sckott.github.io/tree/master/_drafts/2012-12-06-taxize.Rmd">at my github account</a> - or <a href="https://github.com/sckott/sckott.github.io/tree/master/_posts/2012-12-06-taxize.md">.md file</a>.</h4>

<h4>Written in <a href="http://daringfireball.net/projects/markdown/">Markdown</a>, with help from <a href="http://yihui.name/knitr/">knitr</a>.</h4>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2012/11/altecology/">
        Altecology, a call to unconference action
      </a>
    </h1>

    <span class="post-date">15 Nov 2012</span>

    <p>Note: This post is cross-posted on Sandra Chung's blog <a href="http://sandrachung.com/">here</a>.</p>

<hr />

<h3>The rise of the unconference</h3>

<p>The Ecological Society of America meeting is holding its <a href="http://www.esa.org/minneapolis/">98th annual meeting</a> next year in Minneapolis, MN. Several thousand students and professionals in ecological science and education will gather to hear and read the latest work and ideas in ecology in the familiar poster and lecture formats that are the core of every major scientific conference. But a subset of these people will get a taste of something a little bit different: an unconference within the conference.</p>

<p>The most important difference between traditional science conferences and the unconference format is that it prioritizes human interaction. Often the best and most important parts of science meetings are the interactions between talks, next to posters, and at the end of the day over drinks. These connections pave the way for collaborations and friendships that nourish our professional and personal lives with shared opportunities, camaraderie and support.</p>

<p>In recognition of the increasing relative importance of the “meeting” part of a science meeting, the unconference format emphasizes interaction over presentation. It attempts to engage participants to the maximum extent reasonable in discussion and doing. <a href="http://scienceonline.com/">Science Online</a> is a good example of this unconference format, in which the session topics are typically decided on democratically by the conference attendees (partly before arrival, partly on arrival), and you vote with your feet by going to and leaving sessions as you desire.</p>

<hr />

<h3>Ecology is changing</h3>

<p>Ecology is now adopting some of the same online and social tools that are already accelerating innovation in computing and other science disciplines. Ecologists, ecology students and educators are asking many of the same basic questions they have always asked: What should we be doing? How do we do it better and faster? Social media, open source software, open science, altmetrics, crowdsourcing, crowdfunding, data visualization, data sharing, alternative peer review, and an increasing emphasis on more and better communication and collaboration are just some of the newer tools being put forth to help address those questions in the 21st century.</p>

<p>Social media is rapidly becoming more common in ecologists’ toolkits to disseminate news of their new papers, communicate about research and research tools, and even filter the deluge of publications. Tools like blogs, Twitter and Facebook are filling the communication gaps between annual meetings and adding a new layer of conversation and connection to conferences and classrooms.</p>

<p>Social media, in turn, is connecting scientists directly to people besides their immediate colleagues who appreciate the impact of their work and want it to continue. The crowdfunding movement - exemplified by Kickstarter - has spurred similar alternative science funding projects such as SciFund. #SciFund project has shown that social media engagement increases donations to crowdfunded research (<a href="http://jecology.libsyn.com/interview-with-jarrett-byrnes-on-science-crowdfunding">interview with Jarrett Byrnes</a>).</p>

<p>In addition, we are in the era of big data, and <a href="http://www.neoninc.org/news/big-data-part-i">this includes ecology</a>. To deal with this “data deluge”, ecologists increasingly want to learn how to manage, share, retrieve, use, and visualize data. There are new tools for all of these tasks - we need to aid each other in learning them. Online and offline communities are coalescing around the development and dissemination of these tools for the benefit of ecological science, and they are meeting face-to-face at our ecological unconference.</p>

<p>Science in general is becoming increasingly complex and calling for larger and larger collaborations. This growth in turn is spurring a drive toward more openness and transparency within the culture of science. The more collaborative and complex scientific study becomes, the more scientists depend upon each other to do good work that we can all build upon with confidence. The often unstated assumption about ecology, and all of science, is that research findings are reproducible; but that assumption is quite shaky given the increasing number of retractions (see the <a href="http://retractionwatch.wordpress.com/">Retraction Watch blog</a>) and findings that much research is not reproducible (see media coverage <a href="http://www.nature.com/nature/journal/v483/n7391/full/483531a.html">here</a> and <a href="http://www.reuters.com/article/2012/03/28/us-science-cancer-idUSBRE82R12P20120328">here</a>).</p>

<p>A recent initiative seeks to facilitate attempts to reproduce research: <a href="https://www.scienceexchange.com/reproducibility">The Reproducibility Initiative</a>. Jarrett Byrnes <a href="http://www.slideshare.net/JarrettByrnes/taking-the-ecological-conversation-online">spoke at #ESA2012</a> of how transparent, online discourse enhances our ability to discuss and improve our work and the work of our peers, both before and after publication.</p>

<p>Much of the ecological science community shares one or both of these goals: to do the best possible science, and to do it in a way that is most useful and accessible to colleagues and to society at large. The goal of this year’s ecological unconference is to introduce as many people as possible to resources - both tools and people - that can help all of us achieve those goals, on our own, or together.</p>

<p>One way we as ecologists can quickly make our research more reproducible is the way we write. By simply using tools that make reproducing what we have done easy to do, we can avoid retracted papers, failed drugs, and ruined careers.</p>

<hr />

<h3>What are you proposing?</h3>

<p>We originally thought about a separate event from ESA itself, modeled after <a href="http://scienceonline.com/">Science Online</a>, incorporating a variety of topics. However, we thought testing the waters for this sort of non-traditional unconference format would be better in 2013. We are gathering ideas from the community (see “How do I make my voice heard?” below). The ideas on the wiki that get the most traction, and have 1-2 champions that are willing to see the idea through and lead the workshop at ESA will be turned in to proposals for ESA workshops. In addition, we will be submitting a proposal for an Ignite session at ESA. To summarise, we will be running:</p>

<ul>
<li>A few workshops (at lunch hours, and half-day). Topics may include:

<ul>
<li>Data sharing</li>
<li>Data visualization</li>
<li>Data management</li>
<li>Alternatives to academia</li>
<li>Blogging</li>
<li>Social media</li>
<li>Reproducible science writing</li>
</ul>
</li>
<li>One Ignite session on “Tools for better/faster science”. See more about Ignite sessions <a href="http://www.esa.org/minneapolis/ignite.php">here</a>.</li>
<li>A “tweetup” event to socialize in a more relaxed atmosphere</li>
</ul>


<p>These will all be loosely aggregated under the <a href="https://twitter.com/search/realtime?q=%23AltEcology">#AltEcology</a> hashtag.</p>

<hr />

<h3>How do I make my voice heard?</h3>

<p>We have set up a wiki in which anyone can contribute. Please share your ideas and voice your support for existing ones at the wiki <a href="http://ecologyunconference.wikispaces.com/">here</a>.  You can just throw ideas out there, or even propose new workshops and nominate people to lead them. We’re currently moving to transform existing ideas into ESA workshop and Ignite proposals to meet the <a href="http://www.esa.org/minneapolis/workshop.php">November 29 deadline</a>, but we’ll be incorporating input from the wiki right up to the meeting itself in August 2013.</p>

<hr />

<h3>Get in touch</h3>

<p>If you have any questions/comments, let us know in the comments section below, tweet us (Sandra: <a href="https://twitter.com/sandramchung">@sandramchung</a>, Scott: <a href="https://twitter.com/recology_">@recology_</a>), or email (<a href="mailto:sandra.m.chung@gmail.com">Sandra</a>, <a href="mailto:myrmecocystus@gmail.com">Scott</a>).</p>

<hr />

<h4>Get the .md file used to create this post <a href="https://github.com/sckott/sckott.github.io/tree/master/_posts/2012-11-15-altecology.md">at my github account</a>.  Written in <a href="http://daringfireball.net/projects/markdown/">Markdown</a>, with help from <a href="http://yihui.name/knitr/">knitr</a>.</h4>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2012/10/R2G2-package/">
        Displaying Your Data in Google Earth Using R2G2
      </a>
    </h1>

    <span class="post-date">24 Oct 2012</span>

    <p>Have you ever wanted to easily visualize your ecology data in <a href="http://earth.google.com">Google Earth</a>?  <a href="http://cran.r-project.org/web/packages/R2G2/index.html">R2G2</a> is a new package for R, available via <a href="http://cran.r-project.org/">R CRAN</a> and formally described in <a href="http://onlinelibrary.wiley.com/doi/10.1111/1755-0998.12012/abstract">this Molecular Ecology Resources article</a>, which provides a user-friendly bridge between R and the Google Earth interface.  Here, we will provide a brief introduction to the package, including a short tutorial, and then encourage you to try it out with your own data!</p>

<p><a href="http://barkerlab.net/nils.html">Nils Arrigo</a>, with some help from <a href="http://portal.environment.arizona.edu/students/profiles/loren-albert">Loren Albert</a>, <a href="http://barkerlab.net/mike.html">Mike Barker</a>, and Pascal Mickelson (one of the contributors to <a href="http://sckott.github.io/about.html">Recology</a>), has created a set of R tools to generate KML files to view data with geographic components.  Instead of just telling you what the tools can do, though, we will show you a couple of examples using publically available data.  Note: a number of individual files are linked to throughout the tutorial below, but just in case you would rather download all the tutorial files in one go, have at it (<a href="/public/img/R2G2tutorial/R2G2tutorial.zip">tutorial zip file</a>).</p>

<p>Among the basic tools in <a href="http://cran.r-project.org/web/packages/R2G2/index.html">R2G2</a> is the ability to place features—like dots, shapes, or images (including plots you produced in R)— that represent discrete observations at specific geographical locations.  For example, in the figure below, we show the migratory path of a particular turkey vulture in autumn of three successive years (red = 2009; blue = 2010; green = 2011).</p>

<div align="center">
<img src="/public/img/R2G2tutorial/Vulture_Path.jpg" alt="Google Earth image with three successive years of a particular turkey vulture's migration" width="800"><br>
<small>Google Earth imagery showing migratory path of a particular turkey vulture in 2009, 2010, and 2011.</small>
</div>


<p></p>

<p>We use the <em>PolyLines2GE</em> function that is part of <a href="http://cran.r-project.org/web/packages/R2G2/index.html">R2G2</a> to create line segments between the geographical coordinates which have been obtained from a turkey vulture tagged with a transponder (data accessed via the <a href="http://movebank.org/">Movebank Data Repository</a> and is from the <a href="http://movebank.org/movebank/#page%3Dstudies%2Cpath%3Dstudy481458">Turkey Vulture Acopian Center USA GPS</a>).  The <em>PolyLines2GE</em> function looks like the following:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">PolyLines2GE<span class="p">(</span>coords <span class="o">=</span> vulture_path<span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">],</span>  
            nesting <span class="o">=</span> vulture_path<span class="p">[,</span><span class="m">1</span><span class="p">],</span>  
            colors <span class="o">=</span> <span class="s">&quot;auto&quot;</span><span class="p">,</span>  
            goo <span class="o">=</span> <span class="s">&quot;Vulture_Path.kml&quot;</span><span class="p">,</span>  
            maxAlt <span class="o">=</span> <span class="m">1e4</span><span class="p">,</span>  
            fill <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>  
            closepoly <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>  
            lwd <span class="o">=</span> <span class="m">2</span><span class="p">,</span>  
            extrude <span class="o">=</span> <span class="m">0</span><span class="p">)</span></code></pre></div>


<p>It expects to receive an array ("coords") containing latitude and longitude coordinates in decimal degrees. Additionally, each individual coordinate has a flag associated with it ("nesting") so that each data series can be distinguished.  Illustrating what you need is easier than explaining:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">nesting longitude latitude
1   long1A      lat1A
1   long1B      lat1B
1   long1C      lat1C
2   long2A      lat2A
2   long2B      lat2B
3   long3A      lat3A
3   long3B      lat3B
3   long3C      lat3C</code></pre></div>


<p>Feeding the columns of this array to the function results in three differently colored lines:  the first would connect the coordinates 1A-1B-1C, while the second would connect 2A-2B, and the third would connect 3A-3B-3C.  The only other user-defined input that is strictly necessary is the output file name ("Vulture_Path.kml" in this case).  The other options—which allow you control of the appearance of the lines and of the altitude at which your line displays in Google Earth—have reasonable defaults that are well-documented in the function definition itself.  Check out this example in Google Earth <a href="/public/img/R2G2tutorial/Vulture_Path.kml">by downloading the KML file</a>.  Alternatively, <a href="/public/img/R2G2tutorial/Vulture_Path.R">download the annotated R script</a> and generate the KML file for yourself.</p>

<p>Now, let's say you wanted to get a sense of the range and abundance of two congeneric species.  In this second example, we use the <em>Hist2GE</em> function to create a histogram—overlaid on the surface of the earth—which shows the species distribution of <em>Mimulus lewisii</em> (red) and <em>Mimulus nasutus</em> (blue) in North America.</p>

<div align="center">
<img src="/public/img/R2G2tutorial/Mimulus_Distribution.jpg" alt="Google Earth image showing the distribution of Mimulus in North America" width="800"><br>
<small>Google Earth imagery showing the species distribution of <em>Mimulus lewisii</em> and <em>Mimulus nasutus</em></small>
</div>


<p></p>

<p>As you might expect, each polygon represents an occurrence of the species in question, while the height of the polygon represents the abundance of the species at that geographic location.  Species occurring within a particular distance of each other have been grouped together for the histogram.  For this example, we retrieve data from the <a href="http://data.gbif.org/">GBIF</a> database from within R (see the example code for how that is done).  Inputs to the Hist2GE function are:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">Hist2GE<span class="p">(</span>coords <span class="o">=</span> MyCompleteData<span class="p">[,</span> <span class="m">8</span><span class="o">:</span><span class="m">7</span><span class="p">],</span>  
        species <span class="o">=</span> MyCompleteData<span class="p">[,</span> <span class="m">1</span><span class="p">],</span>  
        grid <span class="o">=</span> grid10000<span class="p">,</span>  
        goo <span class="o">=</span> <span class="s">&quot;Mimulus&quot;</span><span class="p">,</span>  
        nedges <span class="o">=</span> <span class="m">6</span><span class="p">,</span>  
        orient <span class="o">=</span> <span class="m">45</span><span class="p">,</span>  
        maxAlt <span class="o">=</span> <span class="m">1e4</span><span class="p">)</span></code></pre></div>


<p>As in the first example, the function expects to receive an array containing the longitude and latitude ("coords"), a vector distinguishing individual observations ("species"), and an output file name ("goo").  In this case, however, we also need to specify the size of the grid we will use to group observations together to construct the histogram.  Several pre-defined grid sizes are included in the package to do this grouping; these all cover large geographic areas and therefore must account for the curvature of the earth.  Here is a list of these pre-defined grids:</p>

<table border="1">
    <tr><th>Grid Name</th><th>Approximate Area of Grid Division </th></tr>
    <tr><td>grid20000</td><td>25,500 sq. km</td></tr>
    <tr><td>grid10000</td><td>51,000 sq. km</td></tr>
    <tr><td>grid5000</td><td>102,000 sq. km</td></tr>
    <tr><td>grid500</td><td>1,020,000 sq. km</td></tr>
    <tr><td>grid50</td><td>10,200,000 sq. km</td></tr>
</table>


<p></p>

<p>For smaller geographic areas (less than 25,000 square kilometers, or an area of about 158 km per side), you can customize the grid size by specifying the bounds of your region of interest in decimal degrees, as well as the coarseness of the grid within that region.  While it is possible to use this custom grid definition for larger sizes, beware that not all areas defined thusly will be of equal size due to the earth's curvature (obviously the bigger you go, the worse it gets...).  Finally, you again have control over the display parameters of the histogram.  In particular, the maximum altitude ("maxAlt") controls how high the tallest bar in the histogram will go.  Here is <a href="/public/img/R2G2tutorial/Mimulus_Distribution.kml">the resulting KML file</a>, as well as <a href="/public/img/R2G2tutorial/Mimulus_Distribution.R">the annotated R script</a> so you can further explore the example.</p>

<p>More complex visual representations are also possible using <a href="http://cran.r-project.org/web/packages/R2G2/index.html">R2G2</a>.  For instance, you can also create contour plots or phylogenies overlaid directly on the surface of the earth.  We included a couple examples of this type in <a href="http://onlinelibrary.wiley.com/doi/10.1111/1755-0998.12012/abstract">our Molecular Ecology Resources article</a>, and if the response seems good, we may post a follow up tutorial showing how we went about creating those examples.</p>

<p>It is our sincere hope that you will use the tools in <a href="http://cran.r-project.org/web/packages/R2G2/index.html">R2G2</a> to more effectively visualize the geographical aspects of your data.  In particular, we are excited about the potential for incorporating <a href="http://cran.r-project.org/web/packages/R2G2/index.html">R2G2</a> into data analysis pipelines connecting analysis in R with data visualization and exploration in Google Earth.  Ultimately, the inclusion of KML files as supplementary materials to journal articles should also enrich one's understanding of the data being presented!</p>

<p><big><b>Note:  If you make something cool using <a href="http://cran.r-project.org/web/packages/R2G2/index.html">R2G2</a>, please post a link to your KML file in the comments; we would love to see!</b></big></p>

<p>Citation information for <a href="http://cran.r-project.org/web/packages/R2G2/index.html">R2G2</a>:<br/>
<em>Arrigo, N., Albert, L. P., Mickelson, P. G. and Barker, M. S. (2012), Quantitative visualization of biological data in Google Earth using R2G2, an R CRAN package. Molecular Ecology Resources. doi: 10.1111/1755-0998.12012</em></p>

  </div>
  
</div>

<!-- Pagination links -->
<div class="pagination">
  
    <a href="/page18" class="older">Older</a>
  
  
    
      <a href="/page16" class="newer">Newer</a>
    
  
</div>

    </div>

    <!-- for bootstrap tooltips -->
    <script type="text/javascript">
      $("[data-toggle=\"tooltip\"]").tooltip();
    </script>

  </body>

  <footer>
  <!-- Disqus code -->
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'recology'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>

  <!-- Gaug.es Analytics -->
  <script type="text/javascript">
    var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', '4efd83a6f5a1f5158a000004');
      t.src = '//secure.gaug.es/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>
</footer>

</html>
