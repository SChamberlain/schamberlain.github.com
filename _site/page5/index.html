<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    
    Recology, R/etc.
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <link rel="stylesheet" href="/public/css/bootstrap/css/bootstrap.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon.ico">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0f layout-reverse">

    <header class="masthead">
      <div class="masthead-inner">
        <h1>Recology</h1>
        <!-- <h1> <a href="http://recology.info/">Recology</a></h1> -->
        <p class="lead">R/etc.</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="/"><i class="fa fa-home fa-lg"></i></a>&nbsp;
              <a href="/about"><i class="fa fa-info-circle fa-lg"></i></a>&nbsp;
              <a href="/archives"><i class="fa fa-archive fa-lg"></i></a>&nbsp;
              <a href="/rresources"><i class="fa fa-book fa-lg"></i></a>&nbsp;
              <a href="http://rforcats.net/" rel><i class="fa fa-graduation-cap fa-lg"></i></a>&nbsp;
              <a href="/feed.xml"><i class="fa fa-rss fa-lg"></i></a>&nbsp;
              <a href="https://twitter.com/sckottie"><i class="fa fa-twitter fa-lg"></i></a>&nbsp;
              <a href="/fork"><i class="fa fa-spinner fa-lg"></i></a>
            </li>
          </ul>
          <!-- <small><a href="https://github.com/mdo/hyde">Hyde</a> from <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</small> -->
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="posts">
  <a style="float:right;" href="/archives" data-toggle="tooltip" data-placement="bottom" title="Archives"><i class="fa fa-archive fa-lg"></i></a>
  <a style="float:right;" href="/tags"><i class="fa fa-tags fa-lg"></i></a>&nbsp;
  
  <div class="post">
    <h1>
      <a href="/2015/09/oai-client/">
        oai - an OAI-PMH client
      </a>
    </h1>

    <span class="post-date">11 Sep 2015</span>

    <p><code class="highlighter-rouge">oai</code> is a general purpose client to work with any ‘OAI-PMH’ service. The ‘OAI-PMH’ protocol is described at <a href="http://www.openarchives.org/OAI/openarchivesprotocol.html">http://www.openarchives.org/OAI/openarchivesprotocol.html</a>. The main functions follow the OAI-PMH verbs:</p>

<ul>
  <li><code class="highlighter-rouge">GetRecord</code></li>
  <li><code class="highlighter-rouge">Identify</code></li>
  <li><code class="highlighter-rouge">ListIdentifiers</code></li>
  <li><code class="highlighter-rouge">ListMetadataFormats</code></li>
  <li><code class="highlighter-rouge">ListRecords</code></li>
  <li><code class="highlighter-rouge">ListSets</code></li>
</ul>

<p>The repo is at <a href="https://github.com/sckott/oai">https://github.com/sckott/oai</a></p>

<p>I will be using this in a number of packages I maintain that use OAI-PMH data services. If you try it, let me know what you think.</p>

<p>This package is heading to rOpenSci soon: <a href="https://github.com/ropensci/onboarding/issues/19">https://github.com/ropensci/onboarding/issues/19</a></p>

<p>Here’s a few usage examples:</p>

<h2 id="install">Install</h2>

<p>Is on CRAN now, but binaries may not be available yet.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"oai"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Or install development version from GitHub</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"sckott/oai"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Load <code class="highlighter-rouge">oai</code></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"oai"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h2 id="identify">Identify</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">id</span><span class="p">(</span><span class="s2">"http://oai.datacite.org/oai"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   repositoryName                     baseURL protocolVersion
#&gt; 1   DataCite MDS http://oai.datacite.org/oai             2.0
#&gt;           adminEmail    earliestDatestamp deletedRecord
#&gt; 1 admin@datacite.org 2011-01-01T00:00:00Z    persistent
#&gt;            granularity compression compression.1
#&gt; 1 YYYY-MM-DDThh:mm:ssZ        gzip       deflate
#&gt;                                      description
#&gt; 1 oaioai.datacite.org:oai:oai.datacite.org:12425
</span></code></pre>
</div>

<h2 id="listidentifiers">ListIdentifiers</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">list_identifiers</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'2011-05-01T'</span><span class="p">,</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'2011-09-01T'</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; &lt;ListRecords&gt; 925 X 6 
#&gt; 
#&gt;                    identifier            datestamp setSpec setSpec.1
#&gt; 1  oai:oai.datacite.org:32153 2011-06-08T08:57:11Z     TIB  TIB.WDCC
#&gt; 2  oai:oai.datacite.org:32200 2011-06-20T08:12:41Z     TIB TIB.DAGST
#&gt; 3  oai:oai.datacite.org:32220 2011-06-28T14:11:08Z     TIB TIB.DAGST
#&gt; 4  oai:oai.datacite.org:32241 2011-06-30T13:24:45Z     TIB TIB.DAGST
#&gt; 5  oai:oai.datacite.org:32255 2011-07-01T12:09:24Z     TIB TIB.DAGST
#&gt; 6  oai:oai.datacite.org:32282 2011-07-05T09:08:10Z     TIB TIB.DAGST
#&gt; 7  oai:oai.datacite.org:32309 2011-07-06T12:30:54Z     TIB TIB.DAGST
#&gt; 8  oai:oai.datacite.org:32310 2011-07-06T12:42:32Z     TIB TIB.DAGST
#&gt; 9  oai:oai.datacite.org:32325 2011-07-07T11:17:46Z     TIB TIB.DAGST
#&gt; 10 oai:oai.datacite.org:32326 2011-07-07T11:18:47Z     TIB TIB.DAGST
#&gt; ..                        ...                  ...     ...       ...
#&gt; Variables not shown: setSpec.2 (chr), setSpec.3 (chr)
</span></code></pre>
</div>

<h2 id="count-identifiers">Count Identifiers</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">count_identifiers</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt;                           url   count
#&gt; 1 http://oai.datacite.org/oai 6350706
</span></code></pre>
</div>

<h2 id="listrecords">ListRecords</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">list_records</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'2011-05-01T'</span><span class="p">,</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'2011-08-15T'</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; &lt;ListRecords&gt; 126 X 46 
#&gt; 
#&gt;                    identifier            datestamp setSpec setSpec.1
#&gt; 1  oai:oai.datacite.org:32153 2011-06-08T08:57:11Z     TIB  TIB.WDCC
#&gt; 2  oai:oai.datacite.org:32200 2011-06-20T08:12:41Z     TIB TIB.DAGST
#&gt; 3  oai:oai.datacite.org:32220 2011-06-28T14:11:08Z     TIB TIB.DAGST
#&gt; 4  oai:oai.datacite.org:32241 2011-06-30T13:24:45Z     TIB TIB.DAGST
#&gt; 5  oai:oai.datacite.org:32255 2011-07-01T12:09:24Z     TIB TIB.DAGST
#&gt; 6  oai:oai.datacite.org:32282 2011-07-05T09:08:10Z     TIB TIB.DAGST
#&gt; 7  oai:oai.datacite.org:32309 2011-07-06T12:30:54Z     TIB TIB.DAGST
#&gt; 8  oai:oai.datacite.org:32310 2011-07-06T12:42:32Z     TIB TIB.DAGST
#&gt; 9  oai:oai.datacite.org:32325 2011-07-07T11:17:46Z     TIB TIB.DAGST
#&gt; 10 oai:oai.datacite.org:32326 2011-07-07T11:18:47Z     TIB TIB.DAGST
#&gt; ..                        ...                  ...     ...       ...
#&gt; Variables not shown: title (chr), creator (chr), creator.1 (chr),
#&gt;      creator.2 (chr), creator.3 (chr), creator.4 (chr), creator.5 (chr),
#&gt;      creator.6 (chr), creator.7 (chr), publisher (chr), date (chr),
#&gt;      identifier.2 (chr), identifier.1 (chr), subject (chr), description
#&gt;      (chr), description.1 (chr), contributor (chr), language (chr), type
#&gt;      (chr), type.1 (chr), format (chr), format.1 (chr), rights (chr),
#&gt;      subject.1 (chr), relation (chr), subject.2 (chr), subject.3 (chr),
#&gt;      subject.4 (chr), setSpec.2 (chr), setSpec.3 (chr), format.2 (chr),
#&gt;      subject.5 (chr), subject.6 (chr), subject.7 (chr), description.2
#&gt;      (chr), description.3 (chr), description.4 (chr), description.5 (chr),
#&gt;      title.1 (chr), relation.1 (chr), relation.2 (chr), contributor.1
#&gt;      (chr)
</span></code></pre>
</div>

<h2 id="getrecords">GetRecords</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">get_records</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"oai:oai.datacite.org:32255"</span><span class="p">,</span><span class="w"> </span><span class="s2">"oai:oai.datacite.org:32325"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; &lt;GetRecord&gt; 2 X 23 
#&gt; 
#&gt;                   identifier            datestamp setSpec setSpec.1
#&gt; 1 oai:oai.datacite.org:32255 2011-07-01T12:09:24Z     TIB TIB.DAGST
#&gt; 2 oai:oai.datacite.org:32325 2011-07-07T11:17:46Z     TIB TIB.DAGST
#&gt; Variables not shown: title (chr), creator (chr), creator.1 (chr),
#&gt;      creator.2 (chr), creator.3 (chr), publisher (chr), date (chr),
#&gt;      identifier.1 (chr), subject (chr), subject.1 (chr), description
#&gt;      (chr), description.1 (chr), contributor (chr), language (chr), type
#&gt;      (chr), type.1 (chr), format (chr), format.1 (chr), rights (chr)
</span></code></pre>
</div>

<h2 id="list-metadataformats">List MetadataFormats</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">list_metadataformats</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"oai:oai.datacite.org:32348"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; $`oai:oai.datacite.org:32348`
#&gt;   metadataPrefix
#&gt; 1         oai_dc
#&gt; 2       datacite
#&gt; 3   oai_datacite
#&gt;                                                        schema
#&gt; 1              http://www.openarchives.org/OAI/2.0/oai_dc.xsd
#&gt; 2 http://schema.datacite.org/meta/nonexistant/nonexistant.xsd
#&gt; 3              http://schema.datacite.org/oai/oai-1.0/oai.xsd
#&gt;                             metadataNamespace
#&gt; 1 http://www.openarchives.org/OAI/2.0/oai_dc/
#&gt; 2      http://datacite.org/schema/nonexistant
#&gt; 3     http://schema.datacite.org/oai/oai-1.0/
</span></code></pre>
</div>

<h2 id="list-sets">List Sets</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">list_sets</span><span class="p">(</span><span class="s2">"http://oai.datacite.org/oai"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; &lt;ListSets&gt; 1227 X 2 
#&gt; 
#&gt;                     setSpec
#&gt; 1                REFQUALITY
#&gt; 2                      ANDS
#&gt; 3           ANDS.REFQUALITY
#&gt; 4             ANDS.CENTRE-1
#&gt; 5  ANDS.CENTRE-1.REFQUALITY
#&gt; 6             ANDS.CENTRE-2
#&gt; 7  ANDS.CENTRE-2.REFQUALITY
#&gt; 8             ANDS.CENTRE-3
#&gt; 9  ANDS.CENTRE-3.REFQUALITY
#&gt; 10            ANDS.CENTRE-5
#&gt; ..                      ...
#&gt; Variables not shown: setName (chr)
</span></code></pre>
</div>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2015/08/full-text/">
        fulltext - a package to help you mine text
      </a>
    </h1>

    <span class="post-date">07 Aug 2015</span>

    <p>Finally, we got <code class="highlighter-rouge">fulltext</code> up on CRAN - our first commit was <a href="https://github.com/ropensci/fulltext/commit/2d4f7e270040b2c8914853113073fc4d3134445e">May last year</a>. <code class="highlighter-rouge">fulltext</code> is a package to facilitate text mining. It focuses on open access journals. This package makes it easier to search for articles, download those articles in full text if available, convert pdf format to plain text, and extract text chunks for vizualization/analysis. We are planning to add bits for analysis in future versions. We’ve been working on this package for a while now. It has a lot of moving parts and package dependencies, so it took a while to get a first useable version.</p>

<p>The tasks facilitated by <code class="highlighter-rouge">fulltext</code> in bullet form:</p>

<ul>
  <li>Search - search for articles</li>
  <li>Retrieve - get full text</li>
  <li>Convert - convert from format X to Y</li>
  <li>Text - if needed, get text from pdfs/etc.</li>
  <li>Extract - pull out the bits of articles that you want</li>
</ul>

<p>I won’t be surprised if users uncover a lot of bugs in this package given the huge number of publishers/journals users want to get literature data from, and the surely wide diversity of use cases. But I thought it was important to get out a first version to get feedback on the user interface, and gather use cases.</p>

<p>We hope that this package can help bring text-mining to the masses - making it easy for anyone to do do, not just text-mining experts.</p>

<p>If you have any feedback, please do get in touch in the issue tracker for <code class="highlighter-rouge">fulltext</code> at https://github.com/ropensci/fulltext/issues - If you have use case thoughts, the <a href="https://discuss.ropensci.org/">rOpenSci discussion forum</a> might be a good place to go.</p>

<p>Let’s kick the tires, shall we?</p>

<h2 id="install">Install</h2>

<p>Will be on CRAN soon, not as of AM PDT on 2015-08-07.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"fulltext"</span><span class="p">)</span><span class="w">
</span><span class="c1"># if binaries not avail. yet on your favorite CRAN mirror
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"https://cran.rstudio.com/src/contrib/fulltext_0.1.0.tar.gz"</span><span class="p">,</span><span class="w"> </span><span class="n">repos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"source"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Or install development version from GitHub</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"ropensci/fulltext"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Load <code class="highlighter-rouge">fulltext</code></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"fulltext"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h2 id="search-for-articles">Search for articles</h2>

<p>Currently, there are hooks for searching for articles from PLOS, BMC, Crossref, Entrez, arXiv, and BioRxiv. We’ll add more in the future, but that does cover a lot of articles, especially given inclusion of Crossref (which mints most DOIs) and Entrez (which houses PMC and Pubmed).</p>

<p>An example: Search for the term <em>ecology</em> in PLOS journals.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">res1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ft_search</span><span class="p">(</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ecology'</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'plos'</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; Query:
#&gt;   [ecology] 
#&gt; Found:
#&gt;   [PLoS: 28589; BMC: 0; Crossref: 0; Entrez: 0; arxiv: 0; biorxiv: 0] 
#&gt; Returned:
#&gt;   [PLoS: 10; BMC: 0; Crossref: 0; Entrez: 0; arxiv: 0; biorxiv: 0]
</span></code></pre>
</div>

<p>Each publisher/search-engine has a slot with metadata and data, saying how many articles were found and how many were returned. We can dig into what PLOS gave us:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res1</span><span class="o">$</span><span class="n">plos</span><span class="w">
</span><span class="c1">#&gt; Query: [ecology] 
#&gt; Records found, returned: [28589, 10] 
#&gt; License: [CC-BY] 
#&gt;                                                         id
#&gt; 1                             10.1371/journal.pone.0059813
#&gt; 2                             10.1371/journal.pone.0001248
#&gt; 3  10.1371/annotation/69333ae7-757a-4651-831c-f28c5eb02120
#&gt; 4                             10.1371/journal.pone.0080763
#&gt; 5                             10.1371/journal.pone.0102437
#&gt; 6                             10.1371/journal.pone.0017342
#&gt; 7                             10.1371/journal.pone.0091497
#&gt; 8                             10.1371/journal.pone.0092931
#&gt; 9  10.1371/annotation/28ac6052-4f87-4b88-a817-0cd5743e83d6
#&gt; 10                            10.1371/journal.pcbi.1003594
</span></code></pre>
</div>

<p>For each of the data sources to search on you can pass in additional options (basically, you can use the query parameters in the functions that hit each service). Here, we can modify our search to PLOS by requesting a particular set of fields with the <code class="highlighter-rouge">fl</code> parameter (PLOS uses a Solr backed search engine, and <code class="highlighter-rouge">fl</code> is short for <code class="highlighter-rouge">fields</code> in Solr land):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ft_search</span><span class="p">(</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ecology'</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'plos'</span><span class="p">,</span><span class="w"> </span><span class="n">plosopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
   </span><span class="n">fl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span><span class="s1">'author'</span><span class="p">,</span><span class="s1">'eissn'</span><span class="p">,</span><span class="s1">'journal'</span><span class="p">,</span><span class="s1">'counter_total_all'</span><span class="p">,</span><span class="s1">'alm_twitterCount'</span><span class="p">)))</span><span class="w">
</span><span class="c1">#&gt; Query:
#&gt;   [ecology] 
#&gt; Found:
#&gt;   [PLoS: 28589; BMC: 0; Crossref: 0; Entrez: 0; arxiv: 0; biorxiv: 0] 
#&gt; Returned:
#&gt;   [PLoS: 10; BMC: 0; Crossref: 0; Entrez: 0; arxiv: 0; biorxiv: 0]
</span></code></pre>
</div>

<blockquote>
  <p>Note that PLOS is a bit unique in allowing you to request specific parts of articles. Other sources in ft_search() don’t let you do that.</p>
</blockquote>

<h2 id="get-full-text">Get full text</h2>

<p>After you’ve found the set of articles you want to get full text for, we can use the results from <code class="highlighter-rouge">ft_search()</code> to grab full text. <code class="highlighter-rouge">ft_get()</code> accepts a character vector of list of DOIs (or PMC IDs if fetching from Entrez), or the output of <code class="highlighter-rouge">ft_search()</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ft_get</span><span class="p">(</span><span class="n">res1</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; [Docs] 8 
#&gt; [Source] R session  
#&gt; [IDs] 10.1371/journal.pone.0059813 10.1371/journal.pone.0001248
#&gt;      10.1371/journal.pone.0080763 10.1371/journal.pone.0102437
#&gt;      10.1371/journal.pone.0017342 10.1371/journal.pone.0091497
#&gt;      10.1371/journal.pone.0092931 10.1371/journal.pcbi.1003594 ...
</span></code></pre>
</div>

<p>We got eight articles in full text in the result. We didn’t get 10, even though 10 were returned from <code class="highlighter-rouge">ft_search()</code> because PLOS often returns records for annotations, that is, comments on articles, which we auto-seive out within <code class="highlighter-rouge">ft_get()</code>.</p>

<p>Dig in to the PLOS data</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">out</span><span class="o">$</span><span class="n">plos</span><span class="w">
</span><span class="c1">#&gt; $found
#&gt; [1] 8
#&gt; 
#&gt; $dois
#&gt; [1] "10.1371/journal.pone.0059813" "10.1371/journal.pone.0001248"
#&gt; [3] "10.1371/journal.pone.0080763" "10.1371/journal.pone.0102437"
#&gt; [5] "10.1371/journal.pone.0017342" "10.1371/journal.pone.0091497"
#&gt; [7] "10.1371/journal.pone.0092931" "10.1371/journal.pcbi.1003594"
#&gt; 
#&gt; $data
#&gt; $data$backend
#&gt; NULL
#&gt; 
#&gt; $data$path
#&gt; [1] "session"
#&gt; 
#&gt; $data$data
#&gt; 8 full-text articles retrieved 
#&gt; Min. Length: 3828 - Max. Length: 104702 
#&gt; DOIs: 10.1371/journal.pone.0059813 10.1371/journal.pone.0001248
#&gt;   10.1371/journal.pone.0080763 10.1371/journal.pone.0102437
#&gt;   10.1371/journal.pone.0017342 10.1371/journal.pone.0091497
#&gt;   10.1371/journal.pone.0092931 10.1371/journal.pcbi.1003594 ... 
#&gt; 
#&gt; NOTE: extract xml strings like output['&lt;doi&gt;']
#&gt; 
#&gt; $opts
#&gt; $opts$doi
#&gt; [1] "10.1371/journal.pone.0059813" "10.1371/journal.pone.0001248"
#&gt; [3] "10.1371/journal.pone.0080763" "10.1371/journal.pone.0102437"
#&gt; [5] "10.1371/journal.pone.0017342" "10.1371/journal.pone.0091497"
#&gt; [7] "10.1371/journal.pone.0092931" "10.1371/journal.pcbi.1003594"
#&gt; 
#&gt; $opts$callopts
#&gt; list()
</span></code></pre>
</div>

<p>Dig in further to get to one of the articles in XML format</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"xml2"</span><span class="p">)</span><span class="w">
</span><span class="n">xml2</span><span class="o">::</span><span class="n">read_xml</span><span class="p">(</span><span class="n">out</span><span class="o">$</span><span class="n">plos</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">`10.1371/journal.pone.0059813`</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; {xml_document}
#&gt; &lt;article&gt;
#&gt; [1] &lt;front&gt;\n&lt;journal-meta&gt;\n&lt;journal-id journal-id-type="nlm-ta"&gt;PLoS O ...
#&gt; [2] &lt;body&gt;\n  &lt;sec id="s1"&gt;\n&lt;title&gt;Introduction&lt;/title&gt;\n&lt;p&gt;Ecologists  ...
#&gt; [3] &lt;back&gt;\n&lt;ack&gt;\n&lt;p&gt;Curtis Flather, Mark Burgman, Leon Blaustein, Yaac ...
</span></code></pre>
</div>

<p>Now with the xml, you can dig into whatever you like, e.g., using <code class="highlighter-rouge">xml2</code> or <code class="highlighter-rouge">rvest</code>.</p>

<h2 id="extract-text-from-pdfs">Extract text from pdfs</h2>

<p>Ideally for text mining you have access to XML or other text based formats. However, sometimes you only have access to PDFs. In this case you want to extract text from PDFs. <code class="highlighter-rouge">fulltext</code> can help with that.</p>

<p>You can extract from any pdf from a file path, like:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">path</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">system.file</span><span class="p">(</span><span class="s2">"examples"</span><span class="p">,</span><span class="w"> </span><span class="s2">"example1.pdf"</span><span class="p">,</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fulltext"</span><span class="p">)</span><span class="w">
</span><span class="n">ft_extract</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; &lt;document&gt;/Library/Frameworks/R.framework/Versions/3.2/Resources/library/fulltext/examples/example1.pdf
#&gt;   Pages: 18
#&gt;   Title: Suffering and mental health among older people living in nursing homes---a mixed-methods study
#&gt;   Producer: pdfTeX-1.40.10
#&gt;   Creation date: 2015-07-17
</span></code></pre>
</div>

<p>Let’s search for articles from arXiv, a preprint service. Here, get pdf from an article with ID <code class="highlighter-rouge">cond-mat/9309029</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ft_get</span><span class="p">(</span><span class="s1">'cond-mat/9309029'</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"arxiv"</span><span class="p">)</span><span class="w">
</span><span class="n">res2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ft_extract</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w">
</span><span class="n">res2</span><span class="o">$</span><span class="n">arxiv</span><span class="o">$</span><span class="n">data</span><span class="w">
</span><span class="c1">#&gt; $backend
#&gt; NULL
#&gt; 
#&gt; $path
#&gt; $path$`cond-mat/9309029`
#&gt; [1] "~/.fulltext/cond-mat_9309029.pdf"
#&gt; 
#&gt; 
#&gt; $data
#&gt; $data[[1]]
#&gt; &lt;document&gt;/Users/sacmac/.fulltext/cond-mat_9309029.pdf
#&gt;   Pages: 14
#&gt;   Title: arXiv:cond-mat/9309029v8  26 Jan 1994
#&gt;   Producer: GPL Ghostscript SVN PRE-RELEASE 8.62
#&gt;   Creation date: 2008-02-06
</span></code></pre>
</div>

<p>And a short snippet of the full text</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res2</span><span class="o">$</span><span class="n">arxiv</span><span class="o">$</span><span class="n">data</span><span class="o">$</span><span class="n">data</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">data</span><span class="w">
</span><span class="c1">#&gt; "arXiv:cond-mat/9309029v8 26 Jan 1994, , FERMILAB-PUB-93/15-T March 1993, Revised:
#&gt; January 1994, The Thermodynamics and Economics of Waste, Dallas C. Kennedy, Research
#&gt; Associate, Fermi National Accelerator Laboratory, P.O. Box 500 MS106, Batavia, Illinois
#&gt; 60510 USA, Abstract, The increasingly relevant problem of natural resource use and
#&gt; waste production, disposal, and reuse is examined from several viewpoints: economic,
#&gt; technical, and thermodynamic. Alternative economies are studied, with emphasis on
#&gt; recycling of waste to close the natural resource cycle. The physical nature of human
#&gt; economies and constraints on recycling and energy efficiency are stated in terms
#&gt; ..."
</span></code></pre>
</div>

<h2 id="extract-text-chunks">Extract text chunks</h2>

<p>We have a few functions to help you pull out certain parts of an article. For example, perhaps you want to get just the authors from your articles, or just the abstracts.</p>

<p>Here, we’ll search for some PLOS articles, then get their full text, then extract various parts of each article with <code class="highlighter-rouge">chunks()</code>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ft_search</span><span class="p">(</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ecology"</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"plos"</span><span class="p">)</span><span class="w">
</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ft_get</span><span class="p">(</span><span class="n">res</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; [Docs] 8 
#&gt; [Source] R session  
#&gt; [IDs] 10.1371/journal.pone.0059813 10.1371/journal.pone.0001248
#&gt;      10.1371/journal.pone.0080763 10.1371/journal.pone.0102437
#&gt;      10.1371/journal.pone.0017342 10.1371/journal.pone.0091497
#&gt;      10.1371/journal.pone.0092931 10.1371/journal.pcbi.1003594 ...
</span></code></pre>
</div>

<p>Extract DOIs</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">chunks</span><span class="p">(</span><span class="s2">"doi"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; $plos
#&gt; $plos$`10.1371/journal.pone.0059813`
#&gt; $plos$`10.1371/journal.pone.0059813`$doi
#&gt; [1] "10.1371/journal.pone.0059813"
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0001248`
#&gt; $plos$`10.1371/journal.pone.0001248`$doi
#&gt; [1] "10.1371/journal.pone.0001248"
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0080763`
#&gt; $plos$`10.1371/journal.pone.0080763`$doi
#&gt; [1] "10.1371/journal.pone.0080763"
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0102437`
#&gt; $plos$`10.1371/journal.pone.0102437`$doi
#&gt; [1] "10.1371/journal.pone.0102437"
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0017342`
#&gt; $plos$`10.1371/journal.pone.0017342`$doi
#&gt; [1] "10.1371/journal.pone.0017342"
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0091497`
#&gt; $plos$`10.1371/journal.pone.0091497`$doi
#&gt; [1] "10.1371/journal.pone.0091497"
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0092931`
#&gt; $plos$`10.1371/journal.pone.0092931`$doi
#&gt; [1] "10.1371/journal.pone.0092931"
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pcbi.1003594`
#&gt; $plos$`10.1371/journal.pcbi.1003594`$doi
#&gt; [1] "10.1371/journal.pcbi.1003594"
</span></code></pre>
</div>

<p>Extract DOIs and categories</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">chunks</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"doi"</span><span class="p">,</span><span class="s2">"categories"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; $plos
#&gt; $plos$`10.1371/journal.pone.0059813`
#&gt; $plos$`10.1371/journal.pone.0059813`$doi
#&gt; [1] "10.1371/journal.pone.0059813"
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0059813`$categories
#&gt;  [1] "Research Article"                 "Biology"                         
#&gt;  [3] "Ecology"                          "Community ecology"               
#&gt;  [5] "Species interactions"             "Science policy"                  
#&gt;  [7] "Research assessment"              "Research monitoring"             
#&gt;  [9] "Research funding"                 "Government funding of science"   
#&gt; [11] "Research laboratories"            "Science policy and economics"    
#&gt; [13] "Science and technology workforce" "Careers in research"             
#&gt; [15] "Social and behavioral sciences"   "Sociology"                       
#&gt; [17] "Sociology of knowledge"          
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0001248`
#&gt; $plos$`10.1371/journal.pone.0001248`$doi
#&gt; [1] "10.1371/journal.pone.0001248"
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0001248`$categories
#&gt; [1] "Research Article"             "Ecology"                     
#&gt; [3] "Ecology/Ecosystem Ecology"    "Ecology/Evolutionary Ecology"
#&gt; [5] "Ecology/Theoretical Ecology" 
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0080763`
#&gt; $plos$`10.1371/journal.pone.0080763`$doi
#&gt; [1] "10.1371/journal.pone.0080763"
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0080763`$categories
#&gt;  [1] "Research Article"     "Biology"              "Ecology"             
#&gt;  [4] "Autecology"           "Behavioral ecology"   "Community ecology"   
#&gt;  [7] "Evolutionary ecology" "Population ecology"   "Evolutionary biology"
#&gt; [10] "Behavioral ecology"   "Evolutionary ecology" "Population biology"  
#&gt; [13] "Population ecology"  
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0102437`
#&gt; $plos$`10.1371/journal.pone.0102437`$doi
#&gt; [1] "10.1371/journal.pone.0102437"
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0102437`$categories
#&gt;  [1] "Research Article"                  
#&gt;  [2] "Biology and life sciences"         
#&gt;  [3] "Biogeography"                      
#&gt;  [4] "Ecology"                           
#&gt;  [5] "Ecosystems"                        
#&gt;  [6] "Ecosystem engineering"             
#&gt;  [7] "Ecosystem functioning"             
#&gt;  [8] "Industrial ecology"                
#&gt;  [9] "Spatial and landscape ecology"     
#&gt; [10] "Urban ecology"                     
#&gt; [11] "Computer and information sciences" 
#&gt; [12] "Geoinformatics"                    
#&gt; [13] "Spatial analysis"                  
#&gt; [14] "Earth sciences"                    
#&gt; [15] "Geography"                         
#&gt; [16] "Human geography"                   
#&gt; [17] "Cultural geography"                
#&gt; [18] "Social geography"                  
#&gt; [19] "Ecology and environmental sciences"
#&gt; [20] "Conservation science"              
#&gt; [21] "Environmental protection"          
#&gt; [22] "Nature-society interactions"       
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0017342`
#&gt; $plos$`10.1371/journal.pone.0017342`$doi
#&gt; [1] "10.1371/journal.pone.0017342"
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0017342`$categories
#&gt;  [1] "Research Article"     "Biology"              "Ecology"             
#&gt;  [4] "Community ecology"    "Community assembly"   "Community structure" 
#&gt;  [7] "Niche construction"   "Ecological metrics"   "Species diversity"   
#&gt; [10] "Species richness"     "Biodiversity"         "Biogeography"        
#&gt; [13] "Population ecology"   "Mathematics"          "Statistics"          
#&gt; [16] "Biostatistics"        "Statistical theories" "Ecology"             
#&gt; [19] "Mathematics"         
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0091497`
#&gt; $plos$`10.1371/journal.pone.0091497`$doi
#&gt; [1] "10.1371/journal.pone.0091497"
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0091497`$categories
#&gt; [1] "Correction"
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0092931`
#&gt; $plos$`10.1371/journal.pone.0092931`$doi
#&gt; [1] "10.1371/journal.pone.0092931"
#&gt; 
#&gt; $plos$`10.1371/journal.pone.0092931`$categories
#&gt; [1] "Correction"
#&gt; 
#&gt; 
#&gt; $plos$`10.1371/journal.pcbi.1003594`
#&gt; $plos$`10.1371/journal.pcbi.1003594`$doi
#&gt; [1] "10.1371/journal.pcbi.1003594"
#&gt; 
#&gt; $plos$`10.1371/journal.pcbi.1003594`$categories
#&gt; [1] "Research Article"          "Biology and life sciences"
#&gt; [3] "Computational biology"     "Microbiology"             
#&gt; [5] "Theoretical biology"
</span></code></pre>
</div>

<p><code class="highlighter-rouge">tabularize</code> attempts to help you put the data that comes out of <code class="highlighter-rouge">chunks()</code> in to a <code class="highlighter-rouge">data.frame</code>, that we all know and love.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">chunks</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"doi"</span><span class="p">,</span><span class="w"> </span><span class="s2">"history"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tabularize</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; $plos
#&gt;                            doi history.received history.accepted
#&gt; 1 10.1371/journal.pone.0059813       2012-09-16       2013-02-19
#&gt; 2 10.1371/journal.pone.0001248       2007-07-02       2007-11-06
#&gt; 3 10.1371/journal.pone.0080763       2013-08-15       2013-10-16
#&gt; 4 10.1371/journal.pone.0102437       2013-11-27       2014-06-19
#&gt; 5 10.1371/journal.pone.0017342       2010-08-24       2011-01-31
#&gt; 6 10.1371/journal.pone.0091497             &lt;NA&gt;             &lt;NA&gt;
#&gt; 7 10.1371/journal.pone.0092931             &lt;NA&gt;             &lt;NA&gt;
#&gt; 8 10.1371/journal.pcbi.1003594       2014-01-09       2014-03-14
</span></code></pre>
</div>

<h2 id="bring-it-all-together">Bring it all together</h2>

<p>With the pieces above, let’s see what it looks like all in one go. Here, we’ll search for articles on <em>climate change</em>, then visualize word usage in those articles.</p>

<h3 id="search">Search</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ft_search</span><span class="p">(</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'climate change'</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'plos'</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; Query:
#&gt;   [climate change] 
#&gt; Found:
#&gt;   [PLoS: 11737; BMC: 0; Crossref: 0; Entrez: 0; arxiv: 0; biorxiv: 0] 
#&gt; Returned:
#&gt;   [PLoS: 100; BMC: 0; Crossref: 0; Entrez: 0; arxiv: 0; biorxiv: 0]
</span></code></pre>
</div>

<h3 id="get-full-text-1">Get full text</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">texts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ft_get</span><span class="p">(</span><span class="n">out</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; [Docs] 99 
#&gt; [Source] R session  
#&gt; [IDs] 10.1371/journal.pone.0054839 10.1371/journal.pone.0045683
#&gt;      10.1371/journal.pone.0050182 10.1371/journal.pone.0118489
#&gt;      10.1371/journal.pone.0053646 10.1371/journal.pone.0015103
#&gt;      10.1371/journal.pone.0008320 10.1371/journal.pmed.1001227
#&gt;      10.1371/journal.pmed.1001374 10.1371/journal.pone.0097480 ...
</span></code></pre>
</div>

<p>Because PLOS returns XML, we don’t need to do a PDF extraction step. However, if we got full text from arXiv or bioRxiv, we’d need to extract from PDFs first.</p>

<h3 id="pull-out-chunks">Pull out chunks</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">abs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">texts</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">chunks</span><span class="p">(</span><span class="s2">"abstract"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Let’s pull out just the text</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">abs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">abs</span><span class="o">$</span><span class="n">plos</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">paste0</span><span class="p">(</span><span class="n">z</span><span class="o">$</span><span class="n">abstract</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" "</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre>
</div>

<h3 id="analyze">Analyze</h3>

<p>Using the <code class="highlighter-rouge">tm</code> package, we can analyze our articles</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"tm"</span><span class="p">)</span><span class="w">
</span><span class="n">corp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">VCorpus</span><span class="p">(</span><span class="n">VectorSource</span><span class="p">(</span><span class="n">abs</span><span class="p">))</span><span class="w">
</span><span class="c1"># remove stop words, strip whitespace, remove punctuation
</span><span class="n">corp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tm_map</span><span class="p">(</span><span class="n">corp</span><span class="p">,</span><span class="w"> </span><span class="n">removeWords</span><span class="p">,</span><span class="w"> </span><span class="n">stopwords</span><span class="p">(</span><span class="s2">"english"</span><span class="p">))</span><span class="w">
</span><span class="n">corp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tm_map</span><span class="p">(</span><span class="n">corp</span><span class="p">,</span><span class="w"> </span><span class="n">stripWhitespace</span><span class="p">)</span><span class="w">
</span><span class="n">corp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tm_map</span><span class="p">(</span><span class="n">corp</span><span class="p">,</span><span class="w"> </span><span class="n">removePunctuation</span><span class="p">)</span><span class="w">
</span><span class="c1"># Make a term document matrix
</span><span class="n">tdm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">TermDocumentMatrix</span><span class="p">(</span><span class="n">corp</span><span class="p">)</span><span class="w">
</span><span class="c1"># remove sparse terms
</span><span class="n">tdm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">removeSparseTerms</span><span class="p">(</span><span class="n">tdm</span><span class="p">,</span><span class="w"> </span><span class="n">sparse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w">
</span><span class="c1"># get data
</span><span class="n">rs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">tdm</span><span class="p">))</span><span class="w">
</span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">rs</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unname</span><span class="p">(</span><span class="n">rs</span><span class="p">),</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h3 id="visualize">Visualize</h3>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">reorder</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Count"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Word"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/public/img/2015-08-07-full-text/unnamed-chunk-23-1.png" alt="plot of chunk unnamed-chunk-23" /></p>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2015/07/weather-data-with-rnoaa/">
        rnoaa - Weather data in R
      </a>
    </h1>

    <span class="post-date">07 Jul 2015</span>

    <p>NOAA provides a lot of weather data, across many different websites under different project names. The R package <code class="highlighter-rouge">rnoaa</code> accesses many of these, including:</p>

<ul>
  <li>NOAA NCDC climate data, using the <a href="http://www.ncdc.noaa.gov/cdo-web/webservices/v2">NCDC API version 2</a></li>
  <li><a href="ftp://ftp.ncdc.noaa.gov/pub/data/ghcn/daily/">GHCND FTP data</a></li>
  <li><a href="ftp://ftp.ncdc.noaa.gov/pub/data/noaa/">ISD FTP data</a></li>
  <li>Severe weather data docs are at <a href="http://www.ncdc.noaa.gov/swdiws/">http://www.ncdc.noaa.gov/swdiws/</a></li>
  <li><a href="ftp://sidads.colorado.edu/DATASETS/NOAA/G02135/shapefiles">Sea ice data</a></li>
  <li><a href="http://www.ndbc.noaa.gov/">NOAA buoy data</a></li>
  <li>Tornadoes! Data from the <a href="http://www.spc.noaa.gov/gis/svrgis/">NOAA Storm Prediction Center</a></li>
  <li>HOMR - Historical Observing Metadata Repository - from <a href="http://www.ncdc.noaa.gov/homr/api">NOAA NCDC</a></li>
  <li>Storm data - from the <a href="http://www.ncdc.noaa.gov/ibtracs/index.php?name=wmo-data">International Best Track Archive for Climate Stewardship (IBTrACS)</a></li>
</ul>

<p><code class="highlighter-rouge">rnoaa</code> used to provide access to <a href="http://upwell.pfeg.noaa.gov/erddap/index.html">ERDDAP servers</a>, but a separate package <a href="https://github.com/ropensci/rerddap">rerddap</a> focuses on just those data sources.</p>

<p>We focus on getting you the data, so there’s very little in <code class="highlighter-rouge">rnoaa</code> for visualizing, statistics, etc.</p>

<h2 id="installation">Installation</h2>

<p>The newest version should be on CRAN in the next few days. In the meantime, let’s install from GitHub</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"ropensci/rnoaa"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"rnoaa"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>There’s an example using the <code class="highlighter-rouge">lawn</code>, <code class="highlighter-rouge">sp</code>, and <code class="highlighter-rouge">dplyr</code> packages. If you want to try those, install like</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"lawn"</span><span class="p">,</span><span class="w"> </span><span class="s2">"dplyr"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sp"</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<h2 id="ncdc">NCDC</h2>

<ul>
  <li>NCDC = National Climatic Data Center</li>
  <li>Data comes from a RESTful API described at <a href="http://www.ncdc.noaa.gov/cdo-web/webservices/v2">http://www.ncdc.noaa.gov/cdo-web/webservices/v2</a></li>
</ul>

<p>This web service requires an API key - get one at <a href="http://www.ncdc.noaa.gov/cdo-web/token">http://www.ncdc.noaa.gov/cdo-web/token</a> if you don’t already have one. NCDC provides access to many different datasets:</p>

<table>
<thead>
<tr class="header">
<th align="left">Dataset</th>
<th align="left">Description</th>
<th align="left">Start date</th>
<th align="left">End date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ANNUAL</td>
<td align="left">Annual Summaries</td>
<td align="left">1831-02-01</td>
<td align="left">2013-11-01</td>
</tr>
<tr class="even">
<td align="left">GHCND</td>
<td align="left">Daily Summaries</td>
<td align="left">1763-01-01</td>
<td align="left">2014-03-15</td>
</tr>
<tr class="odd">
<td align="left">GHCNDMS</td>
<td align="left">Monthly Summaries</td>
<td align="left">1763-01-01</td>
<td align="left">2014-01-01</td>
</tr>
<tr class="even">
<td align="left">NORMAL_ANN</td>
<td align="left">Normals Annual/Seasonal</td>
<td align="left">2010-01-01</td>
<td align="left">2010-01-01</td>
</tr>
<tr class="odd">
<td align="left">NORMAL_DLY</td>
<td align="left">Normals Daily</td>
<td align="left">2010-01-01</td>
<td align="left">2010-12-31</td>
</tr>
<tr class="even">
<td align="left">NORMAL_HLY</td>
<td align="left">Normals Hourly</td>
<td align="left">2010-01-01</td>
<td align="left">2010-12-31</td>
</tr>
<tr class="odd">
<td align="left">NORMAL_MLY</td>
<td align="left">Normals Monthly</td>
<td align="left">2010-01-01</td>
<td align="left">2010-12-01</td>
</tr>
<tr class="even">
<td align="left">PRECIP_15</td>
<td align="left">Precipitation 15 Minute</td>
<td align="left">1970-05-12</td>
<td align="left">2013-03-01</td>
</tr>
<tr class="odd">
<td align="left">PRECIP_HLY</td>
<td align="left">Precipitation Hourly</td>
<td align="left">1900-01-01</td>
<td align="left">2013-03-01</td>
</tr>
<tr class="even">
<td align="left">NEXRAD2</td>
<td align="left">Nexrad Level II</td>
<td align="left">1991-06-05</td>
<td align="left">2014-03-14</td>
</tr>
<tr class="odd">
<td align="left">NEXRAD3</td>
<td align="left">Nexrad Level III</td>
<td align="left">1994-05-20</td>
<td align="left">2014-03-11</td>
</tr>
</tbody>
</table>

<p>The main function to get data from NCDC is <code class="highlighter-rouge">ncdc()</code>. <code class="highlighter-rouge">datasetid</code>, <code class="highlighter-rouge">startdate</code>, and <code class="highlighter-rouge">enddate</code> are required parameters. A quick example, here getting data from the GHCND dataset, from a particular station, and from Oct 1st 2013 to Dec 12th 2013:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ncdc</span><span class="p">(</span><span class="n">datasetid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'GHCND'</span><span class="p">,</span><span class="w"> </span><span class="n">stationid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'GHCND:USW00014895'</span><span class="p">,</span><span class="w"> </span><span class="n">startdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'2013-10-01'</span><span class="p">,</span><span class="w">
   </span><span class="n">enddate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'2013-12-01'</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; $meta
#&gt; $meta$totalCount
#&gt; [1] 697
#&gt; 
#&gt; $meta$pageCount
#&gt; [1] 25
#&gt; 
#&gt; $meta$offset
#&gt; [1] 1
#&gt; 
#&gt; 
#&gt; $data
#&gt; Source: local data frame [25 x 8]
#&gt; 
#&gt;                   date datatype           station value fl_m fl_q fl_so
#&gt; 1  2013-10-01T00:00:00     AWND GHCND:USW00014895    29               W
#&gt; 2  2013-10-01T00:00:00     PRCP GHCND:USW00014895     0               W
#&gt; 3  2013-10-01T00:00:00     SNOW GHCND:USW00014895     0               W
#&gt; 4  2013-10-01T00:00:00     SNWD GHCND:USW00014895     0               W
#&gt; 5  2013-10-01T00:00:00     TAVG GHCND:USW00014895   179    H          S
#&gt; 6  2013-10-01T00:00:00     TMAX GHCND:USW00014895   250               W
#&gt; 7  2013-10-01T00:00:00     TMIN GHCND:USW00014895   133               W
#&gt; 8  2013-10-01T00:00:00     WDF2 GHCND:USW00014895   210               W
#&gt; 9  2013-10-01T00:00:00     WDF5 GHCND:USW00014895   230               W
#&gt; 10 2013-10-01T00:00:00     WSF2 GHCND:USW00014895    76               W
#&gt; ..                 ...      ...               ...   ...  ...  ...   ...
#&gt; Variables not shown: fl_t (chr)
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "ncdc_data"
</span></code></pre>
</div>

<p>You probably won’t know what station you want data from off hand though, so you can first search for  stations, in this example using a bounding box that defines a rectangular area near Seattle</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"lawn"</span><span class="p">)</span><span class="w">
</span><span class="n">lawn_bbox_polygon</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">-122.2047</span><span class="p">,</span><span class="w"> </span><span class="m">47.5204</span><span class="p">,</span><span class="w"> </span><span class="m">-122.1065</span><span class="p">,</span><span class="w"> </span><span class="m">47.6139</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">view</span><span class="w">
</span></code></pre>
</div>

<p><img src="/public/img/2015-07-07-weather-data-with-rnoaa/lawnplot.png" alt="lawnplot" /></p>

<p>We’ll search within that bounding box for weather stations.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ncdc_stations</span><span class="p">(</span><span class="n">extent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">47.5204</span><span class="p">,</span><span class="w"> </span><span class="m">-122.2047</span><span class="p">,</span><span class="w"> </span><span class="m">47.6139</span><span class="p">,</span><span class="w"> </span><span class="m">-122.1065</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; $meta
#&gt; $meta$totalCount
#&gt; [1] 9
#&gt; 
#&gt; $meta$pageCount
#&gt; [1] 25
#&gt; 
#&gt; $meta$offset
#&gt; [1] 1
#&gt; 
#&gt; 
#&gt; $data
#&gt; Source: local data frame [9 x 9]
#&gt; 
#&gt;   elevation    mindate    maxdate latitude                         name
#&gt; 1     199.6 2008-06-01 2015-06-29  47.5503      EASTGATE 1.7 SSW, WA US
#&gt; 2     240.8 2010-05-01 2015-07-05  47.5604       EASTGATE 1.1 SW, WA US
#&gt; 3      85.6 2008-07-01 2015-07-05  47.5916        BELLEVUE 0.8 S, WA US
#&gt; 4     104.2 2008-06-01 2015-07-05  47.5211 NEWPORT HILLS 1.9 SSE, WA US
#&gt; 5      58.5 2008-08-01 2009-04-12  47.6138      BELLEVUE 2.3 ENE, WA US
#&gt; 6     199.9 2008-06-01 2009-11-22  47.5465   NEWPORT HILLS 1.4 E, WA US
#&gt; 7      27.1 2008-07-01 2015-07-05  47.6046        BELLEVUE 1.8 W, WA US
#&gt; 8     159.4 2008-11-01 2015-07-05  47.5694      BELLEVUE 2.3 SSE, WA US
#&gt; 9      82.3 2008-12-01 2010-09-17  47.6095       BELLEVUE 0.6 NE, WA US
#&gt; Variables not shown: datacoverage (dbl), id (chr), elevationUnit (chr),
#&gt;   longitude (dbl)
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "ncdc_stations"
</span></code></pre>
</div>

<p>And there are 9 found. We could then use their station ids (e.g., <code class="highlighter-rouge">GHCND:US1WAKG0024</code>) to search for data using <code class="highlighter-rouge">ncdc()</code>, or search for what kind of data that station has with <code class="highlighter-rouge">ncdc_datasets()</code>, or other functions.</p>

<h2 id="ghcnd">GHCND</h2>

<ul>
  <li>GHCND = Global Historical Climatology Network Daily (Data)</li>
  <li>Data comes from an FTP server</li>
</ul>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"dplyr"</span><span class="p">)</span><span class="w">
</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ghcnd</span><span class="p">(</span><span class="n">stationid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"AGE00147704"</span><span class="p">)</span><span class="w">
</span><span class="n">dat</span><span class="o">$</span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">element</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"PRCP"</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1909</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;            id year month element VALUE1 MFLAG1 QFLAG1 SFLAG1 VALUE2 MFLAG2
#&gt; 1 AGE00147704 1909    11    PRCP  -9999     NA                -9999     NA
#&gt; 2 AGE00147704 1909    12    PRCP     23     NA             E      0     NA
#&gt;   QFLAG2 SFLAG2 VALUE3 MFLAG3 QFLAG3 SFLAG3 VALUE4 MFLAG4 QFLAG4 SFLAG4
#&gt; 1                -9999     NA                -9999     NA              
#&gt; 2             E      0     NA             E      0     NA             E
#&gt;   VALUE5 MFLAG5 QFLAG5 SFLAG5 VALUE6 MFLAG6 QFLAG6 SFLAG6 VALUE7 MFLAG7
#&gt; 1  -9999     NA                -9999     NA                -9999     NA
#&gt; 2      0     NA             E      0     NA             E      0     NA
#&gt;   QFLAG7 SFLAG7 VALUE8 MFLAG8 QFLAG8 SFLAG8 VALUE9 MFLAG9 QFLAG9 SFLAG9
#&gt; 1     NA         -9999     NA                -9999     NA              
#&gt; 2     NA      E    250     NA             E     75     NA             E
#&gt;   VALUE10 MFLAG10 QFLAG10 SFLAG10 VALUE11 MFLAG11 QFLAG11 SFLAG11 VALUE12
#&gt; 1   -9999      NA                   -9999      NA                   -9999
#&gt; 2     131      NA               E       0      NA               E       0
#&gt;   MFLAG12 QFLAG12 SFLAG12 VALUE13 MFLAG13 QFLAG13 SFLAG13 VALUE14 MFLAG14
#&gt; 1      NA                   -9999      NA                   -9999      NA
#&gt; 2      NA               E       0      NA               E       0      NA
#&gt;   QFLAG14 SFLAG14 VALUE15 MFLAG15 QFLAG15 SFLAG15 VALUE16 MFLAG16 QFLAG16
#&gt; 1                   -9999      NA                   -9999      NA        
#&gt; 2               E       0      NA               E       0      NA        
#&gt;   SFLAG16 VALUE17 MFLAG17 QFLAG17 SFLAG17 VALUE18 MFLAG18 QFLAG18 SFLAG18
#&gt; 1           -9999      NA                   -9999      NA                
#&gt; 2       E       0      NA               E       0      NA               E
#&gt;   VALUE19 MFLAG19 QFLAG19 SFLAG19 VALUE20 MFLAG20 QFLAG20 SFLAG20 VALUE21
#&gt; 1   -9999      NA      NA           -9999      NA      NA           -9999
#&gt; 2       0      NA      NA       E       0      NA      NA       E       0
#&gt;   MFLAG21 QFLAG21 SFLAG21 VALUE22 MFLAG22 QFLAG22 SFLAG22 VALUE23 MFLAG23
#&gt; 1      NA                   -9999      NA                      22      NA
#&gt; 2      NA               E       0      NA               E       0      NA
#&gt;   QFLAG23 SFLAG23 VALUE24 MFLAG24 QFLAG24 SFLAG24 VALUE25 MFLAG25 QFLAG25
#&gt; 1      NA       E       9      NA      NA       E       5      NA      NA
#&gt; 2      NA       E       0      NA      NA       E       0      NA      NA
#&gt;   SFLAG25 VALUE26 MFLAG26 QFLAG26 SFLAG26 VALUE27 MFLAG27 QFLAG27 SFLAG27
#&gt; 1       E       0      NA               E      86      NA      NA       E
#&gt; 2       E       0      NA               E       0      NA      NA       E
#&gt;   VALUE28 MFLAG28 QFLAG28 SFLAG28 VALUE29 MFLAG29 QFLAG29 SFLAG29 VALUE30
#&gt; 1       0      NA      NA       E      28      NA      NA       E       0
#&gt; 2       0      NA      NA       E       0      NA      NA       E       0
#&gt;   MFLAG30 QFLAG30 SFLAG30 VALUE31 MFLAG31 QFLAG31 SFLAG31
#&gt; 1      NA               E   -9999      NA      NA        
#&gt; 2      NA               E      57      NA      NA       E
</span></code></pre>
</div>

<p>You can also get to datasets by searching by station id, date min, date max, and variable. E.g.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ghcnd_search</span><span class="p">(</span><span class="s2">"AGE00147704"</span><span class="p">,</span><span class="w"> </span><span class="n">var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PRCP"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; $prcp
#&gt; Source: local data frame [9,803 x 6]
#&gt; 
#&gt;             id  prcp       date mflag qflag sflag
#&gt; 1  AGE00147704 -9999 1909-11-01    NA            
#&gt; 2  AGE00147704    23 1909-12-01    NA           E
#&gt; 3  AGE00147704    81 1910-01-01    NA           E
#&gt; 4  AGE00147704     0 1910-02-01    NA           E
#&gt; 5  AGE00147704    18 1910-03-01    NA           E
#&gt; 6  AGE00147704     0 1910-04-01    NA           E
#&gt; 7  AGE00147704   223 1910-05-01    NA           E
#&gt; 8  AGE00147704     0 1910-06-01    NA           E
#&gt; 9  AGE00147704     0 1910-07-01    NA           E
#&gt; 10 AGE00147704     0 1910-08-01    NA           E
#&gt; ..         ...   ...        ...   ...   ...   ...
</span></code></pre>
</div>

<h2 id="isd">ISD</h2>

<ul>
  <li>ISD = Integrated Surface Database</li>
  <li>Data comes from an FTP server</li>
</ul>

<p>You’ll likely first want to run <code class="highlighter-rouge">isd_stations()</code> to get list of stations</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">stations</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">isd_stations</span><span class="p">()</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">stations</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;   usaf  wban station_name ctry state icao lat lon elev_m    begin      end
#&gt; 1 7005 99999   CWOS 07005                  NA  NA     NA 20120127 20120127
#&gt; 2 7011 99999   CWOS 07011                  NA  NA     NA 20111025 20121129
#&gt; 3 7018 99999   WXPOD 7018                   0   0   7018 20110309 20130730
#&gt; 4 7025 99999   CWOS 07025                  NA  NA     NA 20120127 20120127
#&gt; 5 7026 99999   WXPOD 7026   AF              0   0   7026 20120713 20141120
#&gt; 6 7034 99999   CWOS 07034                  NA  NA     NA 20121024 20121106
</span></code></pre>
</div>

<p>Then get data from particular stations, like</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">isd</span><span class="p">(</span><span class="n">usaf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"011490"</span><span class="p">,</span><span class="w"> </span><span class="n">wban</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"99999"</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1986</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; &lt;ISD Data&gt;
#&gt; Size: 1328 X 85
#&gt; 
#&gt;    total_chars usaf_station wban_station     date time date_flag latitude
#&gt; 1           50        11490        99999 19860101    0         4    66267
#&gt; 2          123        11490        99999 19860101  600         4    66267
#&gt; 3           50        11490        99999 19860101 1200         4    66267
#&gt; 4           94        11490        99999 19860101 1800         4    66267
#&gt; 5           50        11490        99999 19860102    0         4    66267
#&gt; 6          123        11490        99999 19860102  600         4    66267
#&gt; 7           50        11490        99999 19860102 1200         4    66267
#&gt; 8           94        11490        99999 19860102 1800         4    66267
#&gt; 9           50        11490        99999 19860103    0         4    66267
#&gt; 10         123        11490        99999 19860103  600         4    66267
#&gt; ..         ...          ...          ...      ...  ...       ...      ...
#&gt; Variables not shown: longitude (int), type_code (chr), elevation (int),
#&gt;      call_letter (int), quality (chr), wind_direction (int),
#&gt;      wind_direction_quality (int), wind_code (chr), wind_speed (int),
#&gt;      wind_speed_quality (int), ceiling_height (int),
#&gt;      ceiling_height_quality (int), ceiling_height_determination (chr),
#&gt;      ceiling_height_cavok (chr), visibility_distance (int),
#&gt;      visibility_distance_quality (int), visibility_code (chr),
#&gt;      visibility_code_quality (int), temperature (int), temperature_quality
#&gt;      (int), temperature_dewpoint (int), temperature_dewpoint_quality
#&gt;      (int), air_pressure (int), air_pressure_quality (int),
#&gt;      AG1.precipitation (chr), AG1.discrepancy (int), AG1.est_water_depth
#&gt;      (int), GF1.sky_condition (chr), GF1.coverage (int),
#&gt;      GF1.opaque_coverage (int), GF1.coverage_quality (int),
#&gt;      GF1.lowest_cover (int), GF1.lowest_cover_quality (int),
#&gt;      GF1.low_cloud_genus (int), GF1.low_cloud_genus_quality (int),
#&gt;      GF1.lowest_cloud_base_height (int),
#&gt;      GF1.lowest_cloud_base_height_quality (int), GF1.mid_cloud_genus
#&gt;      (int), GF1.mid_cloud_genus_quality (int), GF1.high_cloud_genus (int),
#&gt;      GF1.high_cloud_genus_quality (int), MD1.atmospheric_change (chr),
#&gt;      MD1.tendency (int), MD1.tendency_quality (int), MD1.three_hr (int),
#&gt;      MD1.three_hr_quality (int), MD1.twentyfour_hr (int),
#&gt;      MD1.twentyfour_hr_quality (int), REM.remarks (chr), REM.identifier
#&gt;      (chr), REM.length_quantity (int), REM.comment (chr), KA1.extreme_temp
#&gt;      (chr), KA1.period_quantity (int), KA1.max_min (chr), KA1.temp (int),
#&gt;      KA1.temp_quality (int), AY1.manual_occurrence (chr),
#&gt;      AY1.condition_code (int), AY1.condition_quality (int), AY1.period
#&gt;      (int), AY1.period_quality (int), AY2.manual_occurrence (chr),
#&gt;      AY2.condition_code (int), AY2.condition_quality (int), AY2.period
#&gt;      (int), AY2.period_quality (int), MW1.first_weather_reported (chr),
#&gt;      MW1.condition (int), MW1.condition_quality (int),
#&gt;      EQD.observation_identifier (chr), EQD.observation_text (int),
#&gt;      EQD.reason_code (int), EQD.parameter (chr),
#&gt;      EQD.observation_identifier.1 (chr), EQD.observation_text.1 (int),
#&gt;      EQD.reason_code.1 (int), EQD.parameter.1 (chr)
</span></code></pre>
</div>

<h2 id="severe-weather">Severe weather</h2>

<ul>
  <li>SWDI = Severe Weather Data Inventory</li>
  <li>From the SWDI site</li>
</ul>

<blockquote>
  <p>The Severe Weather Data Inventory (SWDI) is an integrated database of severe weather records for the United States. The records in SWDI come from a variety of sources in the NCDC archive.</p>
</blockquote>

<p>The <code class="highlighter-rouge">swdi()</code> function allows you to get data in xml, csv, shp, or kmz format. You can get data from many different datasets:</p>

<ul>
  <li>nx3tvs NEXRAD Level-3 Tornado Vortex Signatures (point)</li>
  <li>nx3meso NEXRAD Level-3 Mesocyclone Signatures (point)</li>
  <li>nx3hail NEXRAD Level-3 Hail Signatures (point)</li>
  <li>nx3structure NEXRAD Level-3 Storm Cell Structure Information (point)</li>
  <li>plsr Preliminary Local Storm Reports (point)</li>
  <li>warn Severe Thunderstorm, Tornado, Flash Flood and Special Marine warnings (polygon)</li>
  <li>nldn Lightning strikes from Vaisala (.gov and .mil ONLY) (point)</li>
</ul>

<p>An example: Get all <code class="highlighter-rouge">plsr</code> within the bounding box (-91,30,-90,31)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">swdi</span><span class="p">(</span><span class="n">dataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'plsr'</span><span class="p">,</span><span class="w"> </span><span class="n">startdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'20060505'</span><span class="p">,</span><span class="w"> </span><span class="n">enddate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'20060510'</span><span class="p">,</span><span class="w">
</span><span class="n">bbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-91</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="m">-90</span><span class="p">,</span><span class="w"> </span><span class="m">31</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; $meta
#&gt; $meta$totalCount
#&gt; numeric(0)
#&gt; 
#&gt; $meta$totalTimeInSeconds
#&gt; [1] 0
#&gt; 
#&gt; 
#&gt; $data
#&gt; Source: local data frame [5 x 8]
#&gt; 
#&gt;                  ztime     id        event magnitude            city
#&gt; 1 2006-05-09T02:20:00Z 427540         HAIL         1    5 E KENTWOOD
#&gt; 2 2006-05-09T02:40:00Z 427536         HAIL         1    MOUNT HERMAN
#&gt; 3 2006-05-09T02:40:00Z 427537 TSTM WND DMG     -9999    MOUNT HERMAN
#&gt; 4 2006-05-09T03:00:00Z 427199         HAIL         0     FRANKLINTON
#&gt; 5 2006-05-09T03:17:00Z 427200      TORNADO     -9999 5 S FRANKLINTON
#&gt; Variables not shown: county (chr), state (chr), source (chr)
#&gt; 
#&gt; $shape
#&gt;                  shape
#&gt; 1 POINT (-90.43 30.93)
#&gt; 2  POINT (-90.3 30.96)
#&gt; 3  POINT (-90.3 30.96)
#&gt; 4 POINT (-90.14 30.85)
#&gt; 5 POINT (-90.14 30.78)
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "swdi"
</span></code></pre>
</div>

<h2 id="sea-ice">Sea ice</h2>

<p>The <code class="highlighter-rouge">seaice()</code> function simply grabs shape files that describe sea ice cover at the Northa and South poles, and can be useful for examining change through time in sea ice cover, among other things.</p>

<p>An example: Plot sea ice cover for April 1990 for the North pole.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">urls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seaiceeurls</span><span class="p">(</span><span class="n">mo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Apr'</span><span class="p">,</span><span class="w"> </span><span class="n">pole</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'N'</span><span class="p">,</span><span class="w"> </span><span class="n">yr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1990</span><span class="p">)</span><span class="w">
</span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seaice</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="s1">'ggplot2'</span><span class="p">)</span><span class="w">
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_polygon</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">theme_ice</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="/public/img/2015-07-07-weather-data-with-rnoaa/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" /></p>

<h2 id="buoys">Buoys</h2>

<ul>
  <li>Get NOAA buoy data from the National Buoy Data Center</li>
</ul>

<p>Using buoy data requires the <code class="highlighter-rouge">ncdf</code> package. Make sure you have that installed, like <code class="highlighter-rouge">install.packages("ncdf")</code>. <code class="highlighter-rouge">buoy()</code> and <code class="highlighter-rouge">buoys()</code> will fail if you don’t have <code class="highlighter-rouge">ncdf</code> installed.</p>

<p><code class="highlighter-rouge">buoys()</code> - Get available buoys given a dataset name</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">buoys</span><span class="p">(</span><span class="n">dataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'cwind'</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt;      id
#&gt; 1 41001
#&gt; 2 41002
#&gt; 3 41004
#&gt; 4 41006
#&gt; 5 41008
#&gt; 6 41009
#&gt;                                                                       url
#&gt; 1 http://dods.ndbc.noaa.gov/thredds/catalog/data/cwind/41001/catalog.html
#&gt; 2 http://dods.ndbc.noaa.gov/thredds/catalog/data/cwind/41002/catalog.html
#&gt; 3 http://dods.ndbc.noaa.gov/thredds/catalog/data/cwind/41004/catalog.html
#&gt; 4 http://dods.ndbc.noaa.gov/thredds/catalog/data/cwind/41006/catalog.html
#&gt; 5 http://dods.ndbc.noaa.gov/thredds/catalog/data/cwind/41008/catalog.html
#&gt; 6 http://dods.ndbc.noaa.gov/thredds/catalog/data/cwind/41009/catalog.html
</span></code></pre>
</div>

<p><code class="highlighter-rouge">buoy()</code> - Get data for a buoy - if no year or datatype specified, we get the first file</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">buoy</span><span class="p">(</span><span class="n">dataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'cwind'</span><span class="p">,</span><span class="w"> </span><span class="n">buoyid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">46085</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Dimensions (rows/cols): [33486 X 5] 
#&gt; 2 variables: [wind_dir, wind_spd] 
#&gt; 
#&gt;                    time latitude longitude wind_dir wind_spd
#&gt; 1  2007-05-05T02:00:00Z   55.855  -142.559      331      2.8
#&gt; 2  2007-05-05T02:10:00Z   55.855  -142.559      328      2.6
#&gt; 3  2007-05-05T02:20:00Z   55.855  -142.559      329      2.2
#&gt; 4  2007-05-05T02:30:00Z   55.855  -142.559      356      2.1
#&gt; 5  2007-05-05T02:40:00Z   55.855  -142.559      360      1.5
#&gt; 6  2007-05-05T02:50:00Z   55.855  -142.559       10      1.9
#&gt; 7  2007-05-05T03:00:00Z   55.855  -142.559       10      2.2
#&gt; 8  2007-05-05T03:10:00Z   55.855  -142.559       14      2.2
#&gt; 9  2007-05-05T03:20:00Z   55.855  -142.559       16      2.1
#&gt; 10 2007-05-05T03:30:00Z   55.855  -142.559       22      1.6
#&gt; ..                  ...      ...       ...      ...      ...
</span></code></pre>
</div>

<h2 id="tornadoes">Tornadoes</h2>

<p>The function <code class="highlighter-rouge">tornadoes()</code> gets tornado data from <a href="http://www.spc.noaa.gov/gis/svrgis/">http://www.spc.noaa.gov/gis/svrgis/</a>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">shp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tornadoes</span><span class="p">()</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s1">'sp'</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/public/img/2015-07-07-weather-data-with-rnoaa/tornadoes.png" alt="tornadoes" /></p>

<h2 id="historical-observing-metadata-repository">Historical Observing Metadata Repository</h2>

<ul>
  <li>HOMR = Historical Observing Metadata Repository</li>
  <li>Data from RESTful API at <a href="http://www.ncdc.noaa.gov/homr/api">http://www.ncdc.noaa.gov/homr/api</a></li>
</ul>

<p><code class="highlighter-rouge">homr_definitions()</code> gets you definitions and metadata for datasets</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">homr_definitions</span><span class="p">())</span><span class="w">
</span><span class="c1">#&gt; Source: local data frame [6 x 7]
#&gt; 
#&gt;   defType  abbr                fullName    displayName
#&gt; 1     ids GHCND        GHCND IDENTIFIER       GHCND ID
#&gt; 2     ids  COOP             COOP NUMBER        COOP ID
#&gt; 3     ids  WBAN             WBAN NUMBER        WBAN ID
#&gt; 4     ids   FAA FAA LOCATION IDENTIFIER         FAA ID
#&gt; 5     ids  ICAO                 ICAO ID        ICAO ID
#&gt; 6     ids TRANS          TRANSMITTAL ID Transmittal ID
#&gt; Variables not shown: description (chr), cssaName (chr), ghcndName (chr)
</span></code></pre>
</div>

<p><code class="highlighter-rouge">homr()</code> gets you metadata for stations given query parameters. In this example, search for data for the state of Delaware</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">homr</span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'DE'</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="c1"># the stations
#&gt;  [1] "10001871" "10100162" "10100164" "10100166" "20004155" "20004158"
#&gt;  [7] "20004160" "20004162" "20004163" "20004168" "20004171" "20004176"
#&gt; [13] "20004178" "20004179" "20004180" "20004182" "20004184" "20004185"
#&gt; [19] "30001831" "30017384" "30020917" "30021161" "30021998" "30022674"
#&gt; [25] "30026770" "30027455" "30032423" "30032685" "30034222" "30039554"
#&gt; [31] "30043742" "30046662" "30046814" "30051475" "30057217" "30063570"
#&gt; [37] "30064900" "30065901" "30067636" "30069663" "30075067" "30077378"
#&gt; [43] "30077857" "30077923" "30077988" "30079088" "30079240" "30082430"
#&gt; [49] "30084216" "30084262" "30084537" "30084796" "30094582" "30094639"
#&gt; [55] "30094664" "30094670" "30094683" "30094730" "30094806" "30094830"
#&gt; [61] "30094917" "30094931" "30094936" "30094991"
</span></code></pre>
</div>

<p>You can index to each one to get more data</p>

<h2 id="storms">Storms</h2>

<ul>
  <li>Data from: International Best Track Archive for Climate Stewardship (IBTrACS)</li>
  <li>Data comes from an FTP server</li>
</ul>

<p>Flat files (csv’s) are served up as well as shp files. In this example, plot storm data for the year 1940</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="p">(</span><span class="n">res3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">storm_shp</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1940</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; &lt;NOAA Storm Shp Files&gt;
#&gt; Path: ~/.rnoaa/storms/year/Year.1940.ibtracs_all_points.v03r06.shp
#&gt; Basin: &lt;NA&gt;
#&gt; Storm: &lt;NA&gt;
#&gt; Year: 1940
#&gt; Type: points
</span><span class="n">res3shp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">storm_shp_read</span><span class="p">(</span><span class="n">res3</span><span class="p">)</span><span class="w">
</span><span class="n">sp</span><span class="o">::</span><span class="n">plot</span><span class="p">(</span><span class="n">res3shp</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/public/img/2015-07-07-weather-data-with-rnoaa/unnamed-chunk-19-1.png" alt="plot of chunk unnamed-chunk-19" /></p>

  </div>
  
</div>

<!-- Pagination links -->
<div class="pagination">
  
    <a href="/page6" class="older">Older</a>
  
  
    
      <a href="/page4" class="newer">Newer</a>
    
  
</div>

    </div>

    <!-- for bootstrap tooltips -->
    <script type="text/javascript">
      $("[data-toggle=\"tooltip\"]").tooltip();
    </script>

  </body>

  <footer>
  <!-- Disqus code -->
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'recology'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>

  <!-- google analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-63197374-1', 'auto');
    ga('send', 'pageview');
  </script>
</footer>

</html>
