<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    
    Recology, R ecology
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">
  

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.png">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0f layout-reverse">

    <header class="masthead">
      <div class="masthead-inner">
        <h1>Recology</h1>
        <!-- <h1> <a href="http://recology.info/">Recology</a></h1> -->
        <p class="lead">R & science</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="/"><i class="fa fa-home fa-lg"></i></a>&nbsp;
              <a href="/about"><i class="fa fa-info-circle fa-lg"></i></a>&nbsp;
              <a href="/rresources"><i class="fa fa-book fa-lg"></i></a>&nbsp;
              <a href="http://feeds.feedburner.com/github/wpna"><i class="fa fa-rss fa-lg"></i></a>&nbsp;
              <a href="https://twitter.com/recology_"><i class="fa fa-twitter fa-lg"></i></a>&nbsp;
              <a href="https://alpha.app.net/intent/follow/?user_id=@recology_"><i class="fa fa-font fa-lg"></i></a>
              <a href="/fork"><i class="fa fa-spinner fa-lg"></i></a>
            </li>
          </ul>
          <small><a href="https://github.com/mdo/hyde">Hyde</a> from <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</small>
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1>
      <a href="/2013/02/14/common-tree/">
        Getting a simple tree via NCBI
      </a>
    </h1>

    <span class="post-date">14 Feb 2013</span>

    <p>I was just at the <a href="http://www.evoio.org/wiki/Phylotastic">Phylotastic hackathon</a> in Tucson, AZ at the <a href="http://www.iplantcollaborative.org/">iPlant</a> facilities at the UofA.</p>

<p>A problem that needs to be solved is getting the incrasingly vast phylogenetic information to folks not comfortable building their own phylogenies. <a href="http://phylodiversity.net/phylomatic/">Phylomatic</a> has made this super easy for people that want plant phylogenies (at least 250 or so papers have used and cited Phylomatic in their papers) - however, there are few options for those that want phylogenies for other taxonomic groups.</p>

<p>One cool tool that was brought up was the <a href="http://www.ncbi.nlm.nih.gov/Taxonomy/CommonTree/wwwcmt.cgi">Common Tree</a> service provided by NCBI. <a href="http://www.ncbi.nlm.nih.gov/Taxonomy/CommonTree/cmthelp.html">Here's</a> some help on the service. Unlike Phylomatic, Common Tree is purely based off of taxonomic relationships (A and B are both in the C family, so are sisters), not an actual phylogeny as Phylomatic is based on.</p>

<p>But how do you use Common Tree?</p>

<hr />

<h3>Get a species list</h3>

<p>Grab the taxon list from my github account <a href="https://raw.github.com/sckott/sckott.github.com/master/public/img/species.txt">here</a></p>

<h3>Go to the site</h3>

<p>Go to the Common Tree site <a href="http://www.ncbi.nlm.nih.gov/Taxonomy/CommonTree/wwwcmt.cgi">here</a></p>

<h3>Choose file</h3>

<p>Hit the "choose file" button, then select the <code>species.txt</code> file you downloaded in the first step.</p>

<h3>Add the species list to make the tree</h3>

<p>Then hit "add from file", and you got a "tree"</p>

<p><img src="https://raw.github.com/sckott/sckott.github.com/master/public/img/ncbi.png" alt="image" /></p>

<h2>Download</h2>

<p>You can download the tree in a variety of formats, including a .phy file</p>

<p><img src="https://raw.github.com/sckott/sckott.github.com/master/public/img/ncbi2.png" alt="image" /></p>

<h2>Plot the tree on your machine</h2>

<p>Make a tree, in R for me</p>

<div class="highlight"><pre><code class="r"><span class="c1"># install.packages(&#39;ape&#39;) # install if you don&#39;t have ape</span>
library<span class="p">(</span>ape<span class="p">)</span>

<span class="c1"># Read the tree in. YOu get the tree back with alot of newlines (\n) -</span>
<span class="c1"># can easily take these out with a good text editor.</span>
tree <span class="o">&lt;-</span> read.tree<span class="p">(</span>text <span class="o">=</span> <span class="s">&quot;(Lampetra:4,((((((Umbra:4,((Lota:4,Microgadus:4)Gadiformes:4,((Culaea:4,Apeltes:4,Pungitius:4,Gasterosteus:4)Gasterosteidae:4,(Morone:4,(Ambloplites:4,Micropterus:4,Lepomis:4)Centrarchidae:4,(Sander:4,Perca:4)Percidae:4)Percoidei:4,Cottus:4)Percomorpha:4)Holacanthopterygii:4)Neognathi:4,(((Prosopium:4,Coregonus:4)Coregoninae:4,(Salvelinus:4,Salmo:4,Oncorhynchus:4)Salmoninae:4)Salmonidae:4,Osmerus:4)Protacanthopterygii:4)Euteleostei:4,(Alosa:4,(Ameiurus:4,(Catostomus:4,(Semotilus:4,Rhinichthys:4,Margariscus:4,Couesius:4,Pimephales:4,Luxilus:4,Notemigonus:4,Notropis:4,Carassius:4)Cyprinidae:4)Cypriniformes:4)Otophysi:4)Otocephala:4)Clupeocephala:4,Anguilla:4)Elopocephala:4,Acipenser:4)Actinopteri:4,Scyliorhinus:4)Gnathostomata:4)Vertebrata:4;&quot;</span><span class="p">)</span>

<span class="c1"># stretch the branches so tips line up</span>
tree2 <span class="o">&lt;-</span> compute.brlen<span class="p">(</span>tree<span class="p">,</span> method <span class="o">=</span> <span class="s">&quot;Grafen&quot;</span><span class="p">)</span>

<span class="c1"># Plot the tree</span>
plot<span class="p">(</span>tree2<span class="p">,</span> no.margin <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> cex <span class="o">=</span> <span class="m">0.7</span><span class="p">)</span>
</code></pre></div>


<h3>w00p, there it is...</h3>

<p><img src="https://raw.github.com/sckott/sckott.github.com/master/public/img/ncbi_tree.png" alt="image4" /></p>

<hr />

<h3>And the answer is <em>NO</em> to the question: Is there an API for Common Tree?</h3>

<hr />

<h4>Get the .Rmd file used to create this post <a href="https://github.com/sckott/sckott.github.io/tree/master/_drafts/2013-02-14-common-tree.Rmd">at my github account</a> - or <a href="https://github.com/sckott/sckott.github.io/tree/master/_posts/2013-02-14-common-tree.md">.md file</a>.</h4>

<h4>Written in <a href="http://daringfireball.net/projects/markdown/">Markdown</a>, with help from <a href="http://yihui.name/knitr/">knitr</a>.</h4>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2013/01/26/ifttt-test/">
        testing ifttt recipe, ignore
      </a>
    </h1>

    <span class="post-date">26 Jan 2013</span>

    <p>testing ifttt recipe</p>

  </div>
  
  <div class="post">
    <h1>
      <a href="/2013/01/26/api-token/">
        Waiting for an API request to complete
      </a>
    </h1>

    <span class="post-date">26 Jan 2013</span>

    <h3>Dealing with API tokens in R</h3>

<p>In <a href="http://sckott.github.io/2013/01/tnrs-use-case/">my previous post</a> I showed an example of calling the Phylotastic taxonomic name resolution API <code>Taxosaurus</code> <a href="http://api.phylotastic.org/tnrs">here</a>.  When you query their API they give you a token which you use later to retrieve the result (see examples on their page above). However, you don't know when the query will be done, so how do we know when to send the query to rerieve the data?</p>

<hr />

<p>As the time this takes depends on how big the query is and other things, we don't know when we can get the result. I struggled with this for a bit, but then settled on using a while loop.</p>

<hr />

<p>So what does this look like?  Basically we just keep sending the request for data until we get it.</p>

<div class="highlight"><pre><code class="r">iter <span class="o">&lt;-</span> <span class="m">0</span>  <span class="c1"># make an iterator so each time we call</span>
output <span class="o">&lt;-</span> list<span class="p">()</span>  <span class="c1"># make an empty list to put data into</span>
timeout <span class="o">&lt;-</span> <span class="s">&quot;wait&quot;</span>
<span class="kr">while</span> <span class="p">(</span>timeout <span class="o">==</span> <span class="s">&quot;wait&quot;</span><span class="p">)</span> <span class="p">{</span>
    iter <span class="o">&lt;-</span> iter <span class="o">+</span> <span class="m">1</span>  <span class="c1"># increase the iterator each time</span>
    temp <span class="o">&lt;-</span> fromJSON<span class="p">(</span>getURL<span class="p">(</span>retrieve<span class="p">))</span>  <span class="c1"># send the request and parse the JSON</span>
    <span class="kr">if</span> <span class="p">(</span>grepl<span class="p">(</span><span class="s">&quot;is still being processed&quot;</span><span class="p">,</span> temp<span class="p">[</span><span class="s">&quot;message&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="p">{</span>
        timeout <span class="o">&lt;-</span> <span class="s">&quot;wait&quot;</span>
    <span class="p">}</span> <span class="kr">else</span> <span class="p">{</span>
        output<span class="p">[[</span>iter<span class="p">]]</span> <span class="o">&lt;-</span> temp  <span class="c1"># put result from query in the list</span>
        timeout <span class="o">&lt;-</span> <span class="s">&quot;done&quot;</span>  <span class="c1"># we got the result so timeout is now done, making the while loop stop</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<hr />

<h4>Get the .Rmd file used to create this post <a href="https://github.com/sckott/sckott.github.io/tree/master/_drafts/2013-01-26-api-token.Rmd">at my github account</a> - or <a href="https://github.com/sckott/sckott.github.io/tree/master/_posts/2013-01-26-api-token.md">.md file</a>.</h4>

<h4>Written in <a href="http://daringfireball.net/projects/markdown/">Markdown</a>, with help from <a href="http://yihui.name/knitr/">knitr</a>.</h4>

  </div>
  
</div>

<!-- Pagination links -->
<div class="pagination">
  
    <a href="/page10" class="older">Older</a>
  
  
    
      <a href="/page8" class="newer">Newer</a>
    
  
</div>
    </div>

  </body>

  <footer>  
  <!-- Disqus code -->
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'recology'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>

  <!-- Gaug.es Analytics -->
  <script type="text/javascript">
    var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', '4efd83a6f5a1f5158a000004');
      t.src = '//secure.gaug.es/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>
</footer>      
</html>