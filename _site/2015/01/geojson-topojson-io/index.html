<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <title>
    R I/O for geojson and topojson &middot; 
    Recology, R/etc.
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

  <link rel="stylesheet" href="/public/css/bootstrap/css/bootstrap.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/favicon.ico">
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css" rel="stylesheet">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-0f layout-reverse">

    <header class="masthead">
      <div class="masthead-inner">
        <h1>Recology</h1>
        <!-- <h1> <a href="http://recology.info/">Recology</a></h1> -->
        <p class="lead">R/etc.</p>

        <div class="colophon">
          <ul class="colophon-links">
            <li>
              <a href="/"><i class="fa fa-home fa-lg"></i></a>&nbsp;
              <a href="/about"><i class="fa fa-info-circle fa-lg"></i></a>&nbsp;
              <a href="/archives"><i class="fa fa-archive fa-lg"></i></a>&nbsp;
              <a href="/rresources"><i class="fa fa-book fa-lg"></i></a>&nbsp;
              <a href="http://rforcats.net/" rel><i class="fa fa-graduation-cap fa-lg"></i></a>&nbsp;
              <a href="/feed.xml"><i class="fa fa-rss fa-lg"></i></a>&nbsp;
              <a href="https://twitter.com/sckottie"><i class="fa fa-twitter fa-lg"></i></a>&nbsp;
              <a href="/fork"><i class="fa fa-spinner fa-lg"></i></a>
            </li>
          </ul>
          <!-- <small><a href="https://github.com/mdo/hyde">Hyde</a> from <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</small> -->
        </div>
      </div>
    </header>

    <div class="content container">
      <div class="post">
  <h1>R I/O for geojson and topojson</h1><a style="float:right;" href="/archives"><i class="fa fa-archive fa-lg"></i></a>&nbsp;<a style="float:right;" href="/tags"><i class="fa fa-tags fa-lg"></i></a>
  <span class="post-date">06 Jan 2015</span>
  <i class="fa fa-tags fa-large"></i>&nbsp;
     <a href="/tags/R" class="badge" rel="tooltip" data-placement="bottom" title="View posts tagged with &quot;R&quot;"><span class="blog_tag">R</span></a>   <a href="/tags/geospatial" class="badge" rel="tooltip" data-placement="bottom" title="View posts tagged with &quot;geospatial&quot;"><span class="blog_tag">geospatial</span></a>   <a href="/tags/spatial" class="badge" rel="tooltip" data-placement="bottom" title="View posts tagged with &quot;spatial&quot;"><span class="blog_tag">spatial</span></a>   <a href="/tags/geojson" class="badge" rel="tooltip" data-placement="bottom" title="View posts tagged with &quot;geojson&quot;"><span class="blog_tag">geojson</span></a>   <a href="/tags/topojson" class="badge" rel="tooltip" data-placement="bottom" title="View posts tagged with &quot;topojson&quot;"><span class="blog_tag">topojson</span></a>   <br>
  <!-- <i class="fa fa-code fa-large"></i>&nbsp;Source: <a href="https://github.com/sckott/sckott.github.com/tree/master/_drafts/2015-01-06-geojson-topojson-io.Rmd">.Rmd</a> -->
  <i class="fa fa-code fa-large"></i>&nbsp;Source: <a href="https://github.com/sckott/sckott.github.com/tree/master/_drafts/2015-01-06-geojson-topojson-io.Rmd">.Rmd/.md</a>
  <br><br>
  <p>At rOpenSci we’ve been working on an R package (<code>geojsonio</code>) to make converting R data in various formats to <a href="http://geojson.org/geojson-spec.html">geoJSON</a> and <a href="https://github.com/topojson/topojson-specification/blob/master/README.md">topoJSON</a>, and vice versa. We hope to do this one job very well, and handle all reasonable use cases.</p>

<p>Functions in this package are organized first around what you’re working with or want to get, <code>geojson</code> or <code>topojson</code>, then convert to or read from various formats:</p>

<ul>
  <li><code>geojson_list()</code>/<code>topojson_list()</code> - convert to geojson/topojson as R list format</li>
  <li><code>geojson_json()</code>/<code>topojson_json()</code> - convert to geojson/topojson as json</li>
  <li><code>geojson_read()</code><code>topojson_read()</code> - read a geojson/topojson file from file path or URL</li>
  <li><code>geojson_write()</code>/<code>topojson_write()</code> - write a geojson/topojson file locally</li>
</ul>

<p>Each of the above functions have methods for various objects/classes, including <code>numeric</code>, <code>data.frame</code>, <code>list</code>, <code>SpatialPolygons</code>, <code>SpatialPolygonsDataFrame</code>, <code>SpatialLines</code>, <code>SpatialLinesDataFrame</code>, <code>SpatialPoints</code>, <code>SpatialPointsDataFrame</code>.</p>

<h2 id="install">Install</h2>

<p>Install rgdal - in case you can’t get it installed from binary , here’s what works on a Mac.</p>

<pre><code class="language-r">install.packages("http://cran.r-project.org/src/contrib/rgdal_0.9-1.tar.gz", repos = NULL, type="source", configure.args = "--with-gdal-config=/Library/Frameworks/GDAL.framework/Versions/1.10/unix/bin/gdal-config --with-proj-include=/Library/Frameworks/PROJ.framework/unix/include --with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib")
</code></pre>

<p>Install <code>geojsonio</code></p>

<pre><code class="language-r">install.packages("devtools")
devtools::install_github("ropensci/geojsonio")
</code></pre>

<pre><code class="language-r">library("geojsonio")
</code></pre>

<h2 id="geojson">GeoJSON</h2>

<h3 id="convert-various-formats-to-geojson">Convert various formats to geojson</h3>

<p>From a <code>numeric</code> vector of length 2, as json or list</p>

<pre><code class="language-r">geojson_json(c(32.45,-99.74))
#&gt; {"type":"Point","geometry":{"type":"Point","coordinates":[32.45,-99.74]},"properties":{}}
geojson_list(c(32.45,-99.74))
#&gt; $type
#&gt; [1] "Point"
#&gt; 
#&gt; $geometry
#&gt; $geometry$type
#&gt; [1] "Point"
#&gt; 
#&gt; $geometry$coordinates
#&gt; [1]  32.45 -99.74
#&gt; 
#&gt; 
#&gt; $properties
#&gt; NULL
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "geo_list"
#&gt; attr(,"from")
#&gt; [1] "numeric"
</code></pre>

<p>From a <code>data.frame</code></p>

<pre><code class="language-r">library('maps')
data(us.cities)
geojson_json(us.cities[1:2,], lat='lat', lon='long')
#&gt; {"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"Point","coordinates":[-99.74,32.45]},"properties":{"name":"Abilene TX","country.etc":"TX","pop":"113888","capital":"0"}},{"type":"Feature","geometry":{"type":"Point","coordinates":[-81.52,41.08]},"properties":{"name":"Akron OH","country.etc":"OH","pop":"206634","capital":"0"}}]}
geojson_list(us.cities[1:2,], lat='lat', lon='long')
#&gt; $type
#&gt; [1] "FeatureCollection"
#&gt; 
#&gt; $features
#&gt; $features[[1]]
#&gt; $features[[1]]$type
#&gt; [1] "Feature"
#&gt; 
#&gt; $features[[1]]$geometry
#&gt; $features[[1]]$geometry$type
#&gt; [1] "Point"
#&gt; 
#&gt; $features[[1]]$geometry$coordinates
#&gt; [1] -99.74  32.45
#&gt; 
#&gt; 
#&gt; $features[[1]]$properties
#&gt; $features[[1]]$properties$name
#&gt; [1] "Abilene TX"
#&gt; 
#&gt; $features[[1]]$properties$country.etc
#&gt; [1] "TX"
#&gt; 
#&gt; $features[[1]]$properties$pop
#&gt; [1] "113888"
#&gt; 
#&gt; $features[[1]]$properties$capital
#&gt; [1] "0"
#&gt; 
#&gt; 
#&gt; 
#&gt; $features[[2]]
#&gt; $features[[2]]$type
#&gt; [1] "Feature"
#&gt; 
#&gt; $features[[2]]$geometry
#&gt; $features[[2]]$geometry$type
#&gt; [1] "Point"
#&gt; 
#&gt; $features[[2]]$geometry$coordinates
#&gt; [1] -81.52  41.08
#&gt; 
#&gt; 
#&gt; $features[[2]]$properties
#&gt; $features[[2]]$properties$name
#&gt; [1] "Akron OH"
#&gt; 
#&gt; $features[[2]]$properties$country.etc
#&gt; [1] "OH"
#&gt; 
#&gt; $features[[2]]$properties$pop
#&gt; [1] "206634"
#&gt; 
#&gt; $features[[2]]$properties$capital
#&gt; [1] "0"
#&gt; 
#&gt; 
#&gt; 
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "geo_list"
#&gt; attr(,"from")
#&gt; [1] "data.frame"
</code></pre>

<p>From <code>SpatialPolygons</code> class</p>

<pre><code class="language-r">library('sp')
poly1 &lt;- Polygons(list(Polygon(cbind(c(-100,-90,-85,-100),
                                     c(40,50,45,40)))), "1")
poly2 &lt;- Polygons(list(Polygon(cbind(c(-90,-80,-75,-90),
                                     c(30,40,35,30)))), "2")
sp_poly &lt;- SpatialPolygons(list(poly1, poly2), 1:2)
</code></pre>

<p>to json</p>

<pre><code class="language-r">geojson_json(sp_poly)
#&gt; {"type":"Polygon","bbox":[-100,-75,30,50],"coordinates":[[[-100,40],[-90,50],[-85,45],[-100,40]],[[-90,30],[-80,40],[-75,35],[-90,30]]],"properties":{}}
</code></pre>

<p>to list</p>

<pre><code class="language-r">geojson_list(sp_poly)$coordinates[[1]]
#&gt; [[1]]
#&gt; [[1]][[1]]
#&gt; [1] -100
#&gt; 
#&gt; [[1]][[2]]
#&gt; [1] 40
#&gt; 
#&gt; 
#&gt; [[2]]
#&gt; [[2]][[1]]
#&gt; [1] -90
#&gt; 
#&gt; [[2]][[2]]
#&gt; [1] 50
#&gt; 
#&gt; 
#&gt; [[3]]
#&gt; [[3]][[1]]
#&gt; [1] -85
#&gt; 
#&gt; [[3]][[2]]
#&gt; [1] 45
#&gt; 
#&gt; 
#&gt; [[4]]
#&gt; [[4]][[1]]
#&gt; [1] -100
#&gt; 
#&gt; [[4]][[2]]
#&gt; [1] 40
</code></pre>

<h3 id="write-geojson">Write geojson</h3>

<pre><code class="language-r">library('maps')
data(us.cities)
geojson_write(us.cities[1:2,], lat='lat', lon='long')
#&gt; &lt;geojson&gt;
#&gt;   Path:       myfile.geojson
#&gt;   From class: data.frame
</code></pre>

<h3 id="read-geojson">Read geojson</h3>

<pre><code class="language-r">file &lt;- system.file("examples", "california.geojson", package = "geojsonio")
out &lt;- geojson_read(file)
#&gt; OGR data source with driver: GeoJSON 
#&gt; Source: "/Users/sacmac/Library/R/3.1/library/geojsonio/examples/california.geojson", layer: "OGRGeoJSON"
#&gt; with 1 features and 11 fields
#&gt; Feature type: wkbMultiPolygon with 2 dimensions
plot(out)
</code></pre>

<p><img src="/public/img/2015-01-06-geojson-topojson-io/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /></p>

<h2 id="topojson">TopoJSON</h2>

<h3 id="convert-to-topojson-with-node-topojson-client">Convert to TopoJSON with Node topojson client</h3>

<p>For topojson you will need Mike Bostock’s command line client. Install it by doing</p>

<pre><code>sudo npm install -g topojson
</code></pre>

<p>Download a zipped shape fileset, <a href="http://esp.cr.usgs.gov/data/little/querwisl.zip">this one</a> for distribution of <em>Quercus wislizeni</em>. Unzip the zip file to a folder. Then do (changing the path to your path)</p>

<pre><code class="language-r">topojson_write(shppath='~/Downloads/querwisl', path = "~/Downloads", projection='albers', projargs=list(rotate='[60, -35, 0]'))
#&gt; OGR data source with driver: ESRI Shapefile 
#&gt; Source: "/Users/sacmac/Downloads/querwisl", layer: "querwisl"
#&gt; with 35 features and 5 fields
#&gt; Feature type: wkbPolygon with 2 dimensions
</code></pre>

<p>Which prints progress on the conversion of the shape file. And prints the topojson CLI call, including the location of the output file, here <code>/Users/sacmac/querwisl.json</code></p>

<pre><code class="language-r">OGR data source with driver: ESRI Shapefile
Source: "/Users/sacmac/Downloads/querwisl", layer: "querwisl"
with 35 features and 5 fields
Feature type: wkbPolygon with 2 dimensions
topojson -o /Users/sacmac/querwisl.json -q 1e4 -s 0 --shapefile-encoding utf8 --projection 'd3.geo.albers().rotate([60, -35, 0])' -- /var/folders/gs/4khph0xs0436gmd2gdnwsg080000gn/T//Rtmp49APW7/querwisl.shp

bounds: -403.2554825867553 401.27189387582916 -295.798050380061 585.4214768677039 (cartesian)
pre-quantization: 0.010746817902459677 0.018416799979185387
topology: 35 arcs, 2492 points
prune: retained 35 / 35 arcs (100%)
</code></pre>

<p>You can then use this topojson file wherever. We’ll add a function soon to automagically throw this file up as a Github gist to get an interactive map.</p>

<h3 id="read-topojson">Read topojson</h3>

<p>TopoJSON</p>

<pre><code class="language-r">url &lt;- "https://raw.githubusercontent.com/shawnbot/d3-cartogram/master/data/us-states.topojson"
out &lt;- topojson_read(url)
#&gt; OGR data source with driver: GeoJSON 
#&gt; Source: "https://raw.githubusercontent.com/shawnbot/d3-cartogram/master/data/us-states.topojson", layer: "states"
#&gt; with 51 features and 2 fields
#&gt; Feature type: wkbPolygon with 2 dimensions
plot(out)
</code></pre>

<p><img src="/public/img/2015-01-06-geojson-topojson-io/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /></p>

<h2 id="use-case-play-with-us-states">Use case: Play with US states</h2>

<p>Using data from <a href="https://github.com/glynnbird/usstatesgeojson">https://github.com/glynnbird/usstatesgeojson</a></p>

<p>Get some geojson</p>

<pre><code class="language-r">library('httr')
res &lt;- GET('https://api.github.com/repos/glynnbird/usstatesgeojson/contents')
st_names &lt;- Filter(function(x) grepl("\\.geojson", x), sapply(content(res), "[[", "name"))
base &lt;- 'https://raw.githubusercontent.com/glynnbird/usstatesgeojson/master/'
st_files &lt;- paste0(base, st_names)
</code></pre>

<p>Make a faceted plot</p>

<pre><code class="language-r">library('ggplot2')
library('plyr')
st_use &lt;- st_files[7:13]
geo &lt;- lapply(st_use, geojson_read, verbose = FALSE)
df &lt;- ldply(setNames(lapply(geo, fortify), gsub("\\.geojson", "", st_names[7:13])))
ggplot(df, aes(long, lat, group = group)) +
  geom_polygon() +
  facet_wrap(~ .id, scales = "free")
</code></pre>

<p><img src="/public/img/2015-01-06-geojson-topojson-io/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" /></p>

<h2 id="maps">Maps</h2>

<p>We’re also working on <code>map_gist()</code> - to push up a geojson or topojson file as a GitHub gist (renders as an interactive map). It still needs some work…</p>

<h2 id="validate-geojson">Validate geojson</h2>

<p><a href="http://geojsonlint.com/">geojsonlint.com</a> has a nice web interface you can use to make sure you’re geoJSON is in the right format. In addition, it provides a RESTful endpoint at <code>geojsonlint.com/validate</code> to validate geoJSON. 
This was just added today in this package, and can be used from many data types.</p>

<p>Good geoJSON</p>

<pre><code class="language-r">validate('{"type": "Point", "coordinates": [-100, 80]}')
#&gt; $status
#&gt; [1] "ok"
</code></pre>

<p>Bad geoJSON</p>

<pre><code class="language-r">validate('{"type": "Rhombus", "coordinates": [[1, 2], [3, 4], [5, 6]]}')
#&gt; $message
#&gt; [1] "\"Rhombus\" is not a valid GeoJSON type."
#&gt; 
#&gt; $status
#&gt; [1] "error"
</code></pre>

<p>A file</p>

<pre><code class="language-r">file &lt;- system.file("examples", "zillow_or.geojson", package = "togeojson")
validate(x = as.location(file))
#&gt; $status
#&gt; [1] "ok"
</code></pre>

<p>A URL</p>

<pre><code class="language-r">url &lt;- "https://raw.githubusercontent.com/glynnbird/usstatesgeojson/master/california.geojson"
validate(as.location(url))
#&gt; $status
#&gt; [1] "ok"
</code></pre>

<p>From the output of <code>geojson_list()</code></p>

<pre><code class="language-r">library("maps")
data(us.cities)
x &lt;- geojson_list(us.cities[1:2,], lat='lat', lon='long')
validate(x)
#&gt; $status
#&gt; [1] "ok"
</code></pre>

<p>From SpatialPoints class</p>

<pre><code class="language-r">library("sp")
a &lt;- c(1,2,3,4,5)
b &lt;- c(3,2,5,1,4)
x &lt;- SpatialPoints(cbind(a,b))
validate(x)
#&gt; $status
#&gt; [1] "ok"
</code></pre>

</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'coffeehaus'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<!-- <div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2016/03/scrubr/">
            scrubr - clean species occurrence records
            <small>04 Mar 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2016/01/request-hello-world/">
            request - a high level HTTP client for R
            <small>05 Jan 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/12/binomen-taxonomy-tools/">
            binomen - Tools for slicing and dicing taxonomic names
            <small>08 Dec 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>
 -->

    </div>

    <!-- for bootstrap tooltips -->
    <script type="text/javascript">
      $("[data-toggle=\"tooltip\"]").tooltip();
    </script>

  </body>

  <footer>
  <!-- Disqus code -->
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'recology'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
  </script>

  <!-- google analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-63197374-1', 'auto');
    ga('send', 'pageview');
  </script>
</footer>

</html>
