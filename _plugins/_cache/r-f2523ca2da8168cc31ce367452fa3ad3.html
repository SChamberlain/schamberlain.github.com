<div class="highlight"><pre><code class="r">library<span class="p">(</span>XML<span class="p">)</span>
library<span class="p">(</span>RCurl<span class="p">)</span>

token <span class="o">&lt;-</span> <span class="s">&quot;characters&quot;</span>  <span class="c1"># define a iterator, also used for gettingn the resumptionToken</span>
nameslist <span class="o">&lt;-</span> list<span class="p">()</span>  <span class="c1"># define empty list to put joural titles in to</span>
<span class="kr">while</span> <span class="p">(</span>is.character<span class="p">(</span>token<span class="p">)</span> <span class="o">==</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="p">{</span>
    baseurl <span class="o">&lt;-</span> <span class="s">&quot;http://oai.crossref.org/OAIHandler?verb=ListSets&quot;</span>
    <span class="kr">if</span> <span class="p">(</span>token <span class="o">==</span> <span class="s">&quot;characters&quot;</span><span class="p">)</span> <span class="p">{</span>
        tok2 <span class="o">&lt;-</span> <span class="kc">NULL</span>
    <span class="p">}</span> <span class="kr">else</span> <span class="p">{</span>
        tok2 <span class="o">&lt;-</span> paste<span class="p">(</span><span class="s">&quot;&amp;resumptionToken=&quot;</span><span class="p">,</span> token<span class="p">,</span> sep <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    query <span class="o">&lt;-</span> paste<span class="p">(</span>baseurl<span class="p">,</span> tok2<span class="p">,</span> sep <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
    crsets <span class="o">&lt;-</span> xmlToList<span class="p">(</span>xmlParse<span class="p">(</span>getURL<span class="p">(</span>query<span class="p">)))</span>
    names <span class="o">&lt;-</span> as.character<span class="p">(</span>sapply<span class="p">(</span>crsets<span class="p">[[</span><span class="m">4</span><span class="p">]],</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> x<span class="p">[[</span><span class="s">&quot;setName&quot;</span><span class="p">]]))</span>
    nameslist<span class="p">[[</span>token<span class="p">]]</span> <span class="o">&lt;-</span> names
    <span class="kr">if</span> <span class="p">(</span>class<span class="p">(</span>try<span class="p">(</span>crsets<span class="p">[[</span><span class="m">2</span><span class="p">]]$</span><span class="m">.</span>attrs<span class="p">[[</span><span class="s">&quot;resumptionToken&quot;</span><span class="p">]]))</span> <span class="o">==</span> <span class="s">&quot;try-error&quot;</span><span class="p">)</span> <span class="p">{</span>
        stop<span class="p">(</span><span class="s">&quot;no more data&quot;</span><span class="p">)</span>
    <span class="p">}</span> <span class="kr">else</span> token <span class="o">&lt;-</span> crsets<span class="p">[[</span><span class="m">2</span><span class="p">]]$</span><span class="m">.</span>attrs<span class="p">[[</span><span class="s">&quot;resumptionToken&quot;</span><span class="p">]]</span>
<span class="p">}</span>
</code></pre>
</div>
