I"Ç<h3 id="dealing-with-api-tokens-in-r">Dealing with API tokens in R</h3>

<p>In <a href="http://sckott.github.io/2013/01/tnrs-use-case/">my previous post</a> I showed an example of calling the Phylotastic taxonomic name resolution API <code class="highlighter-rouge">Taxosaurus</code> <a href="http://api.phylotastic.org/tnrs">here</a>.  When you query their API they give you a token which you use later to retrieve the result (see examples on their page above). However, you donâ€™t know when the query will be done, so how do we know when to send the query to rerieve the data?</p>

<hr />

<p>As the time this takes depends on how big the query is and other things, we donâ€™t know when we can get the result. I struggled with this for a bit, but then settled on using a while loop.</p>

<hr />

<p>So what does this look like?  Basically we just keep sending the request for data until we get it.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">iter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">  </span><span class="c1"># make an iterator so each time we call</span><span class="w">
</span><span class="n">output</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span><span class="w">  </span><span class="c1"># make an empty list to put data into</span><span class="w">
</span><span class="n">timeout</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"wait"</span><span class="w">
</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">timeout</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"wait"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">iter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># increase the iterator each time</span><span class="w">
    </span><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fromJSON</span><span class="p">(</span><span class="n">getURL</span><span class="p">(</span><span class="n">retrieve</span><span class="p">))</span><span class="w">  </span><span class="c1"># send the request and parse the JSON</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"is still being processed"</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="p">[</span><span class="s2">"message"</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">timeout</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"wait"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">output</span><span class="p">[[</span><span class="n">iter</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp</span><span class="w">  </span><span class="c1"># put result from query in the list</span><span class="w">
        </span><span class="n">timeout</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"done"</span><span class="w">  </span><span class="c1"># we got the result so timeout is now done, making the while loop stop</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<hr />

<h4 id="get-the-rmd-file-used-to-create-this-post-at-my-github-account---or-md-file">Get the .Rmd file used to create this post <a href="https://github.com/sckott/sckott.github.com/tree/master/_drafts/2013-01-26-api-token.Rmd">at my github account</a> - or <a href="https://github.com/sckott/sckott.github.com/tree/master/_posts/2013-01-26-api-token.md">.md file</a>.</h4>

<h4 id="written-in-markdown-with-help-from-knitr">Written in <a href="http://daringfireball.net/projects/markdown/">Markdown</a>, with help from <a href="http://yihui.name/knitr/">knitr</a>.</h4>
:ET