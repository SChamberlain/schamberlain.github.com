I"Ön<p>I was listening to a Bike Shed podcast <a href="http://bikeshed.fm/189">episode 189, ‚ÄúIt‚Äôs Gonna Work, Definitely, No Problems Whatsoever‚Äù</a>, and starting at 27:44 there was a conversation about exception handling. Specifically it was about exception handling in control flow when doing web API requests. This topic piqued my interest straight away as I do a lot of API stuff (making and wrapping).</p>

<p>The part of the conversation that I want to address is their conclusion that exceptions in control flow are an anti-pattern. Seems this is a general pattern in programming languages, e.g., this <a href="https://softwareengineering.stackexchange.com/a/189225/329940">SO thread</a>. But on the contrary there are some languages in which exceptions in control flow are considered normal behavior; e.g., Python (<a href="https://softwareengineering.stackexchange.com/a/318542/329940">this</a>, <a href="https://softwareengineering.stackexchange.com/a/351121/329940">this</a>).</p>

<p>My first reaction to this was one of vehement disagreement because in my experience wrapping web APIs raising exceptions on HTTP status codes of 400 and 500 series is the norm, in at least R and Ruby. They argued that there are better ways of handling these cases. After a whg with my gut reaction.</p>

<p>Let‚Äôs take a step back first and look at some concepts before diving further into this.
ile I thought maybe the topic is worth thinking harder about rather than goin</p>
<h2 id="control-flow">control flow</h2>

<p><a href="https://en.wikipedia.org/wiki/Control_flow">Control flow</a> in programming is</p>

<blockquote>
  <p>the order in which individual statements ‚Ä¶ are executed or evaluated ‚Ä¶ a control flow statement is a statement, the execution of which results in a choice being made as to which of two or more paths to follow.</p>
</blockquote>

<p><a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Control.html">Control flow in R</a> has an overview of control flow in R. Control flow constructs in R include <code class="highlighter-rouge">if/else</code>, <code class="highlighter-rouge">for</code>, <code class="highlighter-rouge">while</code>, <code class="highlighter-rouge">repeat</code>, <code class="highlighter-rouge">break</code>, <code class="highlighter-rouge">next</code>.</p>

<h2 id="exceptions">exceptions</h2>

<p>Exceptions are</p>

<blockquote>
  <p>anomalous or exceptional conditions requiring special processing - often changing the normal flow of program execution (source: <a href="https://en.wikipedia.org/wiki/Exception_handling">wikiex</a>)</p>
</blockquote>

<p>In R, exception handling can be done with <code class="highlighter-rouge">try</code>, <code class="highlighter-rouge">tryCatch</code>, <code class="highlighter-rouge">withCallingHandlers</code> and others. Often <code class="highlighter-rouge">warning()</code> is used to signal to the user what happened, but does not stop execution, and can be suppressed with <code class="highlighter-rouge">suppressWarnings()</code>. To stop execution, <code class="highlighter-rouge">stop()</code> is used.</p>

<p><br /></p>

<h2 id="back-to-web-api-exceptions-and-control-flow-in-r">back to web API exceptions and control flow in R</h2>

<p>Note the word <strong>exceptional</strong> above in our definition of exceptions. The BikeShed pod hosts were surprised to see exceptions raised with bad API requests because they didn‚Äôt think a bad API request was <strong>exceptional</strong>, but rather an expected result given certain conditions (e.g., an HTTP 400 series client error means the client did something wrong and perhaps the server gave back a useful error message to help fix the request).</p>

<p>They observed that most Ruby API wrappers did have the behavior of raising an exception on a 400/500 series API status, but they disagreed with this approach.</p>

<p>In R world, most API wrappers in my experience also follow the pattern of raising an exception stopping the code flow on a 400/500 series HTTP error.
<!-- (the exception to this rule that I've used in some of my packages is when there is a common use case to iterate over A LOT of inputs, in which stopping execution would be painful) --></p>

<p>What would it look like to not stop code execution flow when 400/500 series errors are returned from web API requests? What would need to change from the current setup? How would users be affected?</p>

<p>A typical R function that makes a web API request looks like the following:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">crul</span><span class="o">::</span><span class="n">HttpClient</span><span class="o">$</span><span class="n">new</span><span class="p">(</span><span class="s2">"https://httpbin.org"</span><span class="p">)</span><span class="w">
  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="o">$</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w">
  </span><span class="n">res</span><span class="o">$</span><span class="n">raise_for_status</span><span class="p">()</span><span class="w">
  </span><span class="n">res</span><span class="o">$</span><span class="n">parse</span><span class="p">(</span><span class="s2">"UTF-8"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>On a successful request all is good and we get back the JSON payload</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">foo</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"get"</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">apple</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pink lady"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; [1] "{\n  \"args\": {\n    \"\": \"pink lady\"\n  }, ...</span><span class="w">
</span></code></pre></div></div>

<p>When there is a 400/500 series code the line <code class="highlighter-rouge">res$raise_for_status()</code> throws an error, stopping execution</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">foo</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"status/400"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Error: Bad Request (HTTP 400)</span><span class="w">
</span></code></pre></div></div>

<p>Instead of raising an error we could throw a warning and proceed to the next step</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">crul</span><span class="o">::</span><span class="n">HttpClient</span><span class="o">$</span><span class="n">new</span><span class="p">(</span><span class="s2">"https://httpbin.org"</span><span class="p">)</span><span class="w">
  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="o">$</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">status_code</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">400</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">warning</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"HTTP %s %s"</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">status_code</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">status_http</span><span class="p">()</span><span class="o">$</span><span class="n">explanation</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">res</span><span class="o">$</span><span class="n">parse</span><span class="p">(</span><span class="s2">"UTF-8"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bar</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"status/400"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; [1] ""</span><span class="w">
</span><span class="c1">#&gt; Warning message:</span><span class="w">
</span><span class="c1">#&gt; In bar(path = "status/400") :</span><span class="w">
</span><span class="c1">#&gt;  HTTP 400 Bad request syntax or unsupported method</span><span class="w">
</span></code></pre></div></div>

<p>This is fine, but there‚Äôs a few scenarios in which this will be problematic:</p>

<ol>
  <li>Many APIs <strong>DO NOT</strong> return the same content-type on a 400 series error, and even more common on 500 series errors. In fact, often JSON APIs return an HTML error page, which may or may not contain a meaningul message, instead of the same content type as a successful response (e.g., JSON).</li>
  <li>Rather then simply parsing the response <code class="highlighter-rouge">res$parse("UTF-8")</code>, the downstream code may be more complex (e.g., selecting particular fields/keys), and may fail out (and in R, this often means useless error messages for the user).</li>
</ol>

<p>If we take their advice and don‚Äôt fail out on 400/500 series codes, what would that look like? One could do something like:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hello_world</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">crul</span><span class="o">::</span><span class="n">HttpClient</span><span class="o">$</span><span class="n">new</span><span class="p">(</span><span class="s2">"https://httpbin.org"</span><span class="p">)</span><span class="w">
  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="o">$</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">status_code</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">400</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">warning</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"HTTP %s %s"</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">status_code</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">status_http</span><span class="p">()</span><span class="o">$</span><span class="n">explanation</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">res</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>We still get the warning on an error</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hello_world</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"status/400"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Warning message:</span><span class="w">
</span><span class="c1">#&gt; In hello_world(path = "status/400") :</span><span class="w">
</span><span class="c1">#&gt;   HTTP 400 Bad request syntax or unsupported method</span><span class="w">
</span></code></pre></div></div>

<p>But also we return the response object (<code class="highlighter-rouge">HttpResponse</code> from the <code class="highlighter-rouge">crul</code> package in this case):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#&gt; &lt;crul response&gt;</span><span class="w">
</span><span class="c1">#&gt;   url: https://httpbin.org/status/400</span><span class="w">
</span><span class="c1">#&gt;   request_headers:</span><span class="w">
</span><span class="c1">#&gt;     User-Agent: libcurl/7.54.0 r-curl/3.3 crul/0.7.0</span><span class="w">
</span><span class="c1">#&gt;     Accept-Encoding: gzip, deflate</span><span class="w">
</span><span class="c1">#&gt;     Accept: application/json, text/xml, application/xml, */*</span><span class="w">
</span><span class="c1">#&gt;   response_headers:</span><span class="w">
</span><span class="c1">#&gt;     status: HTTP/1.1 400 BAD REQUEST</span><span class="w">
</span><span class="c1">#&gt;     access-control-allow-credentials: true</span><span class="w">
</span><span class="c1">#&gt;     access-control-allow-origin: *</span><span class="w">
</span><span class="c1">#&gt;     content-type: text/html; charset=utf-8</span><span class="w">
</span><span class="c1">#&gt;     date: Mon, 04 Mar 2019 17:49:39 GMT</span><span class="w">
</span><span class="c1">#&gt;     server: nginx</span><span class="w">
</span><span class="c1">#&gt;     content-length: 0</span><span class="w">
</span><span class="c1">#&gt;     connection: keep-alive</span><span class="w">
</span><span class="c1">#&gt;   status: 400</span><span class="w">
</span></code></pre></div></div>

<p>Now the user can explore the response body, response headers, etc. and decide on their own what to do instead of the function failing out and returning nothing.</p>

<p>This approach is fine if your users are more advanced, but most packages/libraries are probably trying to give back a data object that users are familiar with. In R, that is clearly the data.frame. When there is a 400/500 series error, one option is to return an empty data.frame and throw a warning about the error, hopefully with enough information for the user to fix the request. This is probably best for naive users, but any package has some more advanced users that would benefit from more information; and more information will help a naive user + the maintainer debug a problem easier.</p>

<p>The next more complicated option would be a list that can have the same format regardless of errors or not:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">func</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hello_world</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"status/400"</span><span class="p">)</span><span class="w">
  </span><span class="n">mssg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"HTTP %s %s"</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">status_code</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">status_http</span><span class="p">()</span><span class="o">$</span><span class="n">explanation</span><span class="p">)</span><span class="w">
  </span><span class="nf">list</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">$</span><span class="n">parse</span><span class="p">(</span><span class="s2">"UTF-8"</span><span class="p">),</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mssg</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>gives</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">func</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; $data</span><span class="w">
</span><span class="c1">#&gt; [1] ""</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $error</span><span class="w">
</span><span class="c1">#&gt; [1] "HTTP 400 Bad request syntax or unsupported method"</span><span class="w">
</span></code></pre></div></div>

<p>Or possibly something more complex where you can build in accessors to make it easy to get data the user expects, but also dig into the HTTP response object itself if needed:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Response</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">R6</span><span class="o">::</span><span class="n">R6Class</span><span class="p">(</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
  </span><span class="n">public</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w">
    </span><span class="n">initialize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="n">self</span><span class="o">$</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">resp</span><span class="p">,</span><span class="w">
    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="n">self</span><span class="o">$</span><span class="n">x</span><span class="o">$</span><span class="n">parse</span><span class="p">(</span><span class="s2">"UTF-8"</span><span class="p">),</span><span class="w">
    </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"HTTP %s %s"</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="o">$</span><span class="n">x</span><span class="o">$</span><span class="n">status_code</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="o">$</span><span class="n">x</span><span class="o">$</span><span class="n">status_http</span><span class="p">()</span><span class="o">$</span><span class="n">explanation</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span><span class="n">myfunc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hello_world</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"status/400"</span><span class="p">)</span><span class="w">
  </span><span class="n">Response</span><span class="o">$</span><span class="n">new</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Which gives:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">myfunc</span><span class="p">()</span><span class="w">
</span><span class="c1"># the HTTP message</span><span class="w">
</span><span class="n">out</span><span class="o">$</span><span class="n">error</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; [1] "HTTP 400 Bad request syntax or unsupported method"</span><span class="w">
</span><span class="c1"># the response body, parsed</span><span class="w">
</span><span class="n">out</span><span class="o">$</span><span class="n">data</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; [1] ""</span><span class="w">
</span><span class="c1"># the full HTTP response object</span><span class="w">
</span><span class="n">out</span><span class="o">$</span><span class="n">x</span><span class="w">
</span></code></pre></div></div>

<h2 id="what-about-users-handling-exceptions-on-their-side">what about users handling exceptions on their side?</h2>

<p>If one sticks swith erroring out of excecution flow with 400/500 series errors, the user can still handle it on their end. For example, if they are using a function in a loop/appply type call, they can use <code class="highlighter-rouge">tryCatch</code> or similar and check for an error and proceed one of two or more ways depending on the error or successful request. Of course this assumes that the user knows how to do this.</p>

<p>Additionally, this means that each user will handle errors in different ways, possibly making mistakes in the process - arguing for the developer of the package to handle exceptions instead.</p>

<h2 id="its-too-complex-just-fail-out">it‚Äôs too complex, just fail out</h2>

<p>One reason I like to fail out on 400/500 series errors in my packages is that there is often significant data munging of the response. Failing out makes my life easier as I don‚Äôt have to worry about what to do with HTTP responses that fail. In the world I run in of smallish APIs for science/research, API failure behavior often is not very good; it‚Äôs typically unpredictable, changes from time to time, and failure response bodies are often just their HTML failure page, leading to brittle code for parsing that HTML as that HTML can change often. It‚Äôd be great if every API was as good as Github‚Äôs for example, but we‚Äôll never be in that place.</p>

<h2 id="performance-considerations">performance considerations</h2>

<p>In reading about exceptions in control flow, there‚Äôs a common thread about performance (e.g., <a href="https://stackoverflow.com/questions/13835817/are-exceptions-in-c-really-slow">c++</a>, <a href="https://simonecarletti.com/blog/2010/01/how-slow-are-ruby-exceptions/">Ruby 1</a>, <a href="https://www.honeybadger.io/blog/benchmarking-exceptions-in-ruby-yep-theyre-slow/">Ruby 2</a>). That is, if throwing exceptions is a slow procedure, that‚Äôs one reason to avoid them. But if exceptions aren‚Äôt slow then that‚Äôs not a great argument for avoiding them.</p>

<p>I haven‚Äôt seen anything on performance an exceptions in R, though I‚Äôm sure there‚Äôs something out there.</p>

<p>Even if exceptions are a slowish procedure, there is an argument to be made that failing early also saves time; that is, if you get a 400/500 series error you aren‚Äôt then spending time with downstream processing of the response. However, then the user has less information. Trade-offs all the way down.</p>

<h2 id="conclusion">conclusion</h2>

<p>I‚Äôm not sure if I‚Äôll change anything in packages I maintain or not. I‚Äôll keep thinking about this and ask around to gauge others opinions on this. Part of me wants to follow the avoid exceptions path, but I worry about two things. First, the complexity increases for me as the developer. If I don‚Äôt fail out, then I have to deal with parsing somehow every response. It‚Äôs not as simple as giving back the HTTP response; I ideally want to give users a data structure they are familiar with, i.e., a data.frame. Second, for the user, if I give back a list or an <code class="highlighter-rouge">R6</code> object, that increases complexity on their side. Is the benefit of more information worth the cost of more complexity for the user? I‚Äôve no idea.</p>

:ET