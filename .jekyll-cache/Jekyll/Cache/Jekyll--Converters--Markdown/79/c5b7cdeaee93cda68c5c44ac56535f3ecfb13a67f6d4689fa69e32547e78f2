I"œF<p>Inspired by <code class="highlighter-rouge">httpie</code>, a Python command line client as a sort of drop in replacement for <code class="highlighter-rouge">curl</code>, I am playing around with something similar-ish in R, at least in spirit. I started a little R pkg called <code class="highlighter-rouge">httsnap</code> with the following ideas:</p>

<ul>
  <li>The web is increasingly a JSON world, so set <code class="highlighter-rouge">content-type</code> and <code class="highlighter-rouge">accept</code> headers to <code class="highlighter-rouge">applications/json</code> by default</li>
  <li>The workflow follows logically, or at least should, from, <em>hey, I got this url</em>, to <em>i need to add some options</em>, to <em>execute request</em></li>
  <li>Whenever possible, transform output to data.frameâ€™s - facilitating downstream manipulation via <code class="highlighter-rouge">dplyr</code>, etc.</li>
  <li>Do <code class="highlighter-rouge">GET</code> requests by default. Specify a different type if you donâ€™t want <code class="highlighter-rouge">GET</code>. Some functionality does GET by default, though in some cases you need to specify GET</li>
  <li>You can use non-standard evaluation to easily pass in query parameters without worrying about <code class="highlighter-rouge">&amp;</code>â€™s, URL escaping, etc. (see <code class="highlighter-rouge">Query()</code>)</li>
  <li>Same for body params (see <code class="highlighter-rouge">Body()</code>)</li>
</ul>

<h2 id="install">Install</h2>

<p>Install and load <code class="highlighter-rouge">httsnap</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"sckott/httsnap"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"httsnap"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"dplyr"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="functions-so-far">Functions so far</h2>

<ul>
  <li><code class="highlighter-rouge">Get</code> - GET request</li>
  <li><code class="highlighter-rouge">Query</code> - add query parameters</li>
  <li><code class="highlighter-rouge">Authenticate</code> - add authentication details</li>
  <li><code class="highlighter-rouge">Progress</code> - add progress bar</li>
  <li><code class="highlighter-rouge">Timeout</code> - add a timeout</li>
  <li><code class="highlighter-rouge">User_agent</code> - add a user agent</li>
  <li><code class="highlighter-rouge">Verbose</code> - give verbose output</li>
  <li><code class="highlighter-rouge">Body</code> - add a body</li>
  <li><code class="highlighter-rouge">h</code> - add headers by key-value pair</li>
</ul>

<p>These are named to avoid conflict with <code class="highlighter-rouge">httr</code></p>

<h2 id="intro">Intro</h2>

<p>A simple <code class="highlighter-rouge">GET</code> request</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"http://httpbin.org/get"</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">Get</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; $args</span><span class="w">
</span><span class="c1">#&gt; named list()</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $headers</span><span class="w">
</span><span class="c1">#&gt; $headers$Accept</span><span class="w">
</span><span class="c1">#&gt; [1] "application/json, text/xml, application/xml, */*"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $headers$`Accept-Encoding`</span><span class="w">
</span><span class="c1">#&gt; [1] "gzip"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $headers$Host</span><span class="w">
</span><span class="c1">#&gt; [1] "httpbin.org"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $headers$`User-Agent`</span><span class="w">
</span><span class="c1">#&gt; [1] "curl/7.37.1 Rcurl/1.95.4.1 httr/0.6.1 httsnap/0.0.2.99"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $origin</span><span class="w">
</span><span class="c1">#&gt; [1] "24.21.209.71"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $url</span><span class="w">
</span><span class="c1">#&gt; [1] "http://httpbin.org/get"</span><span class="w">
</span></code></pre></div></div>

<p>Youâ€™ll notice that <code class="highlighter-rouge">Get()</code> doesnâ€™t just get the response, but also checks for whether it was a good response (the HTTP status code), and extracts the data.</p>

<p>Or you can just pass the URL into the function itself</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Get</span><span class="p">(</span><span class="s2">"http://httpbin.org/get"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; $args</span><span class="w">
</span><span class="c1">#&gt; named list()</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $headers</span><span class="w">
</span><span class="c1">#&gt; $headers$Accept</span><span class="w">
</span><span class="c1">#&gt; [1] "application/json, text/xml, application/xml, */*"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $headers$`Accept-Encoding`</span><span class="w">
</span><span class="c1">#&gt; [1] "gzip"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $headers$Host</span><span class="w">
</span><span class="c1">#&gt; [1] "httpbin.org"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $headers$`User-Agent`</span><span class="w">
</span><span class="c1">#&gt; [1] "curl/7.37.1 Rcurl/1.95.4.1 httr/0.6.1 httsnap/0.0.2.99"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $origin</span><span class="w">
</span><span class="c1">#&gt; [1] "24.21.209.71"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $url</span><span class="w">
</span><span class="c1">#&gt; [1] "http://httpbin.org/get"</span><span class="w">
</span></code></pre></div></div>

<p>You can buid up options by calling functions via pipes, and see what the options look like</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"http://httpbin.org/get"</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">Progress</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">Verbose</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; &lt;http request&gt; </span><span class="w">
</span><span class="c1">#&gt;   url: http://httpbin.org/get</span><span class="w">
</span><span class="c1">#&gt;   config: </span><span class="w">
</span><span class="c1">#&gt; Config: </span><span class="w">
</span><span class="c1">#&gt; List of 4</span><span class="w">
</span><span class="c1">#&gt;  $ noprogress      :FALSE</span><span class="w">
</span><span class="c1">#&gt;  $ progressfunction:function (...)  </span><span class="w">
</span><span class="c1">#&gt;  $ debugfunction   :function (...)  </span><span class="w">
</span><span class="c1">#&gt;  $ verbose         :TRUE</span><span class="w">
</span></code></pre></div></div>

<p>Then execute the GET request when youâ€™re ready</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"http://httpbin.org/get"</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">Progress</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">Verbose</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">Get</span><span class="p">()</span><span class="w">
</span><span class="c1">#&gt; $args</span><span class="w">
</span><span class="c1">#&gt; named list()</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $headers</span><span class="w">
</span><span class="c1">#&gt; $headers$Accept</span><span class="w">
</span><span class="c1">#&gt; [1] "application/json, text/xml, application/xml, */*"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $headers$`Accept-Encoding`</span><span class="w">
</span><span class="c1">#&gt; [1] "gzip"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $headers$Host</span><span class="w">
</span><span class="c1">#&gt; [1] "httpbin.org"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $headers$`User-Agent`</span><span class="w">
</span><span class="c1">#&gt; [1] "curl/7.37.1 Rcurl/1.95.4.1 httr/0.6.1 httsnap/0.0.2.99"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $origin</span><span class="w">
</span><span class="c1">#&gt; [1] "24.21.209.71"</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt; $url</span><span class="w">
</span><span class="c1">#&gt; [1] "http://httpbin.org/get"</span><span class="w">
</span></code></pre></div></div>

<h2 id="example-1">Example 1</h2>

<p>Get scholarly article metadata from the Crossref API</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"http://api.crossref.org/works"</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">Query</span><span class="p">(</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ecology"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">.</span><span class="o">$</span><span class="n">message</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">.</span><span class="o">$</span><span class="n">items</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">DOI</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">publisher</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt;                            DOI                title</span><span class="w">
</span><span class="c1">#&gt; 1          10.4996/fireecology         Fire Ecology</span><span class="w">
</span><span class="c1">#&gt; 2              10.5402/ecology         ISRN Ecology</span><span class="w">
</span><span class="c1">#&gt; 3                 10.1155/8641         ISRN Ecology</span><span class="w">
</span><span class="c1">#&gt; 4      10.1111/(issn)1526-100x  Restoration Ecology</span><span class="w">
</span><span class="c1">#&gt; 5        10.1007/248.1432-184x    Microbial Ecology</span><span class="w">
</span><span class="c1">#&gt; 6      10.1007/10144.1438-390x   Population Ecology</span><span class="w">
</span><span class="c1">#&gt; 7      10.1007/10452.1573-5125      Aquatic Ecology</span><span class="w">
</span><span class="c1">#&gt; 8      10.1007/10682.1573-8477 Evolutionary Ecology</span><span class="w">
</span><span class="c1">#&gt; 9      10.1007/10745.1572-9915        Human Ecology</span><span class="w">
</span><span class="c1">#&gt; 10     10.1007/10980.1572-9761    Landscape Ecology</span><span class="w">
</span><span class="c1">#&gt; 11     10.1007/11258.1573-5052        Plant Ecology</span><span class="w">
</span><span class="c1">#&gt; 12     10.1007/12080.1874-1746  Theoretical Ecology</span><span class="w">
</span><span class="c1">#&gt; 13     10.1111/(issn)1442-9993      Austral Ecology</span><span class="w">
</span><span class="c1">#&gt; 14     10.1111/(issn)1439-0485       Marine Ecology</span><span class="w">
</span><span class="c1">#&gt; 15     10.1111/(issn)1365-2435   Functional Ecology</span><span class="w">
</span><span class="c1">#&gt; 16     10.1111/(issn)1365-294x    Molecular Ecology</span><span class="w">
</span><span class="c1">#&gt; 17     10.1111/(issn)1461-0248      Ecology Letters</span><span class="w">
</span><span class="c1">#&gt; 18   10.1002/9780470979365.ch7  Behavioural Ecology</span><span class="w">
</span><span class="c1">#&gt; 19 10.1111/fec.2007.21.issue-5                     </span><span class="w">
</span><span class="c1">#&gt; 20     10.1111/rec.0.0.issue-0                     </span><span class="w">
</span><span class="c1">#&gt;                            publisher</span><span class="w">
</span><span class="c1">#&gt; 1       Association for Fire Ecology</span><span class="w">
</span><span class="c1">#&gt; 2     Hindawi Publishing Corporation</span><span class="w">
</span><span class="c1">#&gt; 3     Hindawi Publishing Corporation</span><span class="w">
</span><span class="c1">#&gt; 4                    Wiley-Blackwell</span><span class="w">
</span><span class="c1">#&gt; 5  Springer Science + Business Media</span><span class="w">
</span><span class="c1">#&gt; 6  Springer Science + Business Media</span><span class="w">
</span><span class="c1">#&gt; 7  Springer Science + Business Media</span><span class="w">
</span><span class="c1">#&gt; 8  Springer Science + Business Media</span><span class="w">
</span><span class="c1">#&gt; 9  Springer Science + Business Media</span><span class="w">
</span><span class="c1">#&gt; 10 Springer Science + Business Media</span><span class="w">
</span><span class="c1">#&gt; 11 Springer Science + Business Media</span><span class="w">
</span><span class="c1">#&gt; 12 Springer Science + Business Media</span><span class="w">
</span><span class="c1">#&gt; 13                   Wiley-Blackwell</span><span class="w">
</span><span class="c1">#&gt; 14                   Wiley-Blackwell</span><span class="w">
</span><span class="c1">#&gt; 15                   Wiley-Blackwell</span><span class="w">
</span><span class="c1">#&gt; 16                   Wiley-Blackwell</span><span class="w">
</span><span class="c1">#&gt; 17                   Wiley-Blackwell</span><span class="w">
</span><span class="c1">#&gt; 18                   Wiley-Blackwell</span><span class="w">
</span><span class="c1">#&gt; 19                   Wiley-Blackwell</span><span class="w">
</span><span class="c1">#&gt; 20                   Wiley-Blackwell</span><span class="w">
</span></code></pre></div></div>

<h2 id="example-2">Example 2</h2>

<p>Get Public Library of Science article metadata via their API, make a histogram of number of tweets for each article</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"http://api.plos.org/search"</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">Query</span><span class="p">(</span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"*:*"</span><span class="p">,</span><span class="w"> </span><span class="n">wt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"json"</span><span class="p">,</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> 
        </span><span class="n">fl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"id,journal,alm_twitterCount"</span><span class="p">,</span><span class="w">  
        </span><span class="n">fq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'alm_twitterCount:[100 TO 10000]'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">.</span><span class="o">$</span><span class="n">response</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">.</span><span class="o">$</span><span class="n">docs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">.</span><span class="o">$</span><span class="n">alm_twitterCount</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">hist</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="/public/img/2015-04-29-the-new-way/unnamed-chunk-9-1.png" alt="image" /></p>

<h2 id="notes">Notes</h2>

<p>Okay, so this isnâ€™t drastically different from what <code class="highlighter-rouge">httr</code> already does, but its early days.</p>
:ET