I"›H<p><code class="highlighter-rouge">openadds</code> talks to <a href="http://openaddresses.io/">Openaddresses.io</a>. a run down of its things:</p>

<h2 id="install">Install</h2>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"sckott/openadds"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"openadds"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h2 id="list-datasets">List datasets</h2>

<p>Scrapes links to datasets from the openaddresses site</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_list</span><span class="p">()</span><span class="w">
</span><span class="n">dat</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">6</span><span class="p">]</span><span class="w">
</span><span class="c1">#&gt; [1] "http://data.openaddresses.io.s3.amazonaws.com/20150511/au-tas-launceston.csv"   </span><span class="w">
</span><span class="c1">#&gt; [2] "http://s3.amazonaws.com/data.openaddresses.io/20141127/au-victoria.zip"         </span><span class="w">
</span><span class="c1">#&gt; [3] "http://data.openaddresses.io.s3.amazonaws.com/20150511/be-flanders.zip"         </span><span class="w">
</span><span class="c1">#&gt; [4] "http://data.openaddresses.io.s3.amazonaws.com/20150417/ca-ab-calgary.zip"       </span><span class="w">
</span><span class="c1">#&gt; [5] "http://data.openaddresses.io.s3.amazonaws.com/20150511/ca-ab-grande_prairie.zip"</span><span class="w">
</span></code></pre></div></div>

<h2 id="search-for-datasets">Search for datasets</h2>

<p>Uses <code class="highlighter-rouge">oa_list()</code> internally, then searches through columns requested.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">oa_search</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"us"</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ca"</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; Source: local data frame [68 x 5]</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt;    country state             city  ext</span><span class="w">
</span><span class="c1">#&gt; 1       us    ca san_mateo_county .zip</span><span class="w">
</span><span class="c1">#&gt; 2       us    ca   alameda_county .zip</span><span class="w">
</span><span class="c1">#&gt; 3       us    ca   alameda_county .zip</span><span class="w">
</span><span class="c1">#&gt; 4       us    ca           amador .zip</span><span class="w">
</span><span class="c1">#&gt; 5       us    ca           amador .zip</span><span class="w">
</span><span class="c1">#&gt; 6       us    ca      bakersfield .zip</span><span class="w">
</span><span class="c1">#&gt; 7       us    ca      bakersfield .zip</span><span class="w">
</span><span class="c1">#&gt; 8       us    ca         berkeley .zip</span><span class="w">
</span><span class="c1">#&gt; 9       us    ca         berkeley .zip</span><span class="w">
</span><span class="c1">#&gt; 10      us    ca     butte_county .zip</span><span class="w">
</span><span class="c1">#&gt; ..     ...   ...              ...  ...</span><span class="w">
</span><span class="c1">#&gt; Variables not shown: url (chr)</span><span class="w">
</span></code></pre></div></div>

<h2 id="get-data">Get data</h2>

<p>Passing in a URL</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">out1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_get</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="m">5</span><span class="p">]))</span><span class="w">
</span><span class="c1">#&gt; &lt;Openaddresses data&gt; ~/.openadds/ca-ab-calgary.zip</span><span class="w">
</span><span class="c1">#&gt; Dimensions [350962, 13]</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt;    OBJECTID ADDRESS_TY                 ADDRESS    STREET_NAM STREET_TYP</span><span class="w">
</span><span class="c1">#&gt; 0    757023     Parcel  249 SAGE MEADOWS CI NW  SAGE MEADOWS         CI</span><span class="w">
</span><span class="c1">#&gt; 1    757022     Parcel           2506 17 ST SE            17         ST</span><span class="w">
</span><span class="c1">#&gt; 2    757021     Parcel     305 EVANSPARK GD NW     EVANSPARK         GD</span><span class="w">
</span><span class="c1">#&gt; 3    757020     Parcel     321 EVANSPARK GD NW     EVANSPARK         GD</span><span class="w">
</span><span class="c1">#&gt; 4    757019     Parcel   204 EVANSBROOKE LD NW   EVANSBROOKE         LD</span><span class="w">
</span><span class="c1">#&gt; 5    757018     Parcel   200 EVANSBROOKE LD NW   EVANSBROOKE         LD</span><span class="w">
</span><span class="c1">#&gt; 6    757017     Parcel 219 HIDDEN VALLEY LD NW HIDDEN VALLEY         LD</span><span class="w">
</span><span class="c1">#&gt; 7    757016     Parcel 211 HIDDEN VALLEY LD NW HIDDEN VALLEY         LD</span><span class="w">
</span><span class="c1">#&gt; 8    757015     Parcel 364 HIDDEN VALLEY LD NW HIDDEN VALLEY         LD</span><span class="w">
</span><span class="c1">#&gt; 9    757014     Parcel 348 HIDDEN VALLEY LD NW HIDDEN VALLEY         LD</span><span class="w">
</span><span class="c1">#&gt; ..      ...        ...                     ...           ...        ...</span><span class="w">
</span><span class="c1">#&gt; Variables not shown: STREET_QUA (fctr), HOUSE_NUMB (int), HOUSE_ALPH</span><span class="w">
</span><span class="c1">#&gt;      (fctr), SUITE_NUMB (int), SUITE_ALPH (fctr), LONGITUDE (dbl),</span><span class="w">
</span><span class="c1">#&gt;      LATITUDE (dbl), COMM_NAME (fctr)</span><span class="w">
</span></code></pre></div></div>

<p>First getting URL for dataset through <code class="highlighter-rouge">as_openadd()</code>, then passing to <code class="highlighter-rouge">oa_get()</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as_openadd</span><span class="p">(</span><span class="s2">"us"</span><span class="p">,</span><span class="w"> </span><span class="s2">"nm"</span><span class="p">,</span><span class="w"> </span><span class="s2">"hidalgo"</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; &lt;&lt;OpenAddreses&gt;&gt; </span><span class="w">
</span><span class="c1">#&gt;   &lt;&lt;country&gt;&gt; us</span><span class="w">
</span><span class="c1">#&gt;   &lt;&lt;state&gt;&gt; nm</span><span class="w">
</span><span class="c1">#&gt;   &lt;&lt;city&gt;&gt; hidalgo</span><span class="w">
</span><span class="c1">#&gt;   &lt;&lt;extension&gt;&gt; .csv</span><span class="w">
</span></code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">oa_get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="c1">#&gt; &lt;Openaddresses data&gt; ~/.openadds/us-nm-hidalgo.csv</span><span class="w">
</span><span class="c1">#&gt; Dimensions [170659, 37]</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt;    OBJECTID Shape ADD_NUM ADD_SUF PRE_MOD PRE_DIR PRE_TYPE         ST_NAME</span><span class="w">
</span><span class="c1">#&gt; 1         1    NA     422                       S                      2ND</span><span class="w">
</span><span class="c1">#&gt; 2         2    NA    1413                       S                      4TH</span><span class="w">
</span><span class="c1">#&gt; 3         3    NA     412                       E                 CHAMPION</span><span class="w">
</span><span class="c1">#&gt; 4         4    NA     110                       E                   SAMANO</span><span class="w">
</span><span class="c1">#&gt; 5         5    NA    2608                       W          FREDDY GONZALEZ</span><span class="w">
</span><span class="c1">#&gt; 6         6    NA    2604                       W          FREDDY GONZALEZ</span><span class="w">
</span><span class="c1">#&gt; 7         7    NA    1123                       W                      FAY</span><span class="w">
</span><span class="c1">#&gt; 8         8    NA     417                       S                      2ND</span><span class="w">
</span><span class="c1">#&gt; 9         9    NA    4551                       E                    TEXAS</span><span class="w">
</span><span class="c1">#&gt; 10       10    NA     810                                        DRIFTWOOD</span><span class="w">
</span><span class="c1">#&gt; ..      ...   ...     ...     ...     ...     ...      ...             ...</span><span class="w">
</span><span class="c1">#&gt; Variables not shown: ST_TYPE (chr), POS_DIR (chr), POS_MOD (chr), ESN</span><span class="w">
</span><span class="c1">#&gt;      (int), MSAG_COMM (chr), PARCEL_ID (chr), PLACE_TYPE (chr), LANDMARK</span><span class="w">
</span><span class="c1">#&gt;      (chr), BUILDING (chr), UNIT (chr), ROOM (chr), FLOOR (int), LOC_NOTES</span><span class="w">
</span><span class="c1">#&gt;      (chr), ST_ALIAS (chr), FULL_ADDR (chr), ZIP (chr), POSTAL_COM (chr),</span><span class="w">
</span><span class="c1">#&gt;      MUNICIPAL (chr), COUNTY (chr), STATE (chr), SOURCE (chr), REGION</span><span class="w">
</span><span class="c1">#&gt;      (chr), EXCH (chr), LAT (dbl), LONG (dbl), PICTURE (chr), OA:x (dbl),</span><span class="w">
</span><span class="c1">#&gt;      OA:y (dbl), OA:geom (chr)</span><span class="w">
</span></code></pre></div></div>

<h2 id="combine-multiple-datasets">Combine multiple datasets</h2>

<p><code class="highlighter-rouge">combine</code> attemps to guess lat/long and address columns, but definitely more work to do to make 
this work for most cases. Lat/long and address columns vary among every dataset - some datasets
have no lat/long data, some have no address data.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">out2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_get</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="m">32</span><span class="p">])</span><span class="w">
</span><span class="p">(</span><span class="n">alldat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_combine</span><span class="p">(</span><span class="n">out1</span><span class="p">,</span><span class="w"> </span><span class="n">out2</span><span class="p">))</span><span class="w">
</span><span class="c1">#&gt; Source: local data frame [418,623 x 4]</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt;          lon      lat                 address           dataset</span><span class="w">
</span><span class="c1">#&gt; 1  -114.1303 51.17188  249 SAGE MEADOWS CI NW ca-ab-calgary.zip</span><span class="w">
</span><span class="c1">#&gt; 2  -114.0190 51.03168           2506 17 ST SE ca-ab-calgary.zip</span><span class="w">
</span><span class="c1">#&gt; 3  -114.1175 51.17497     305 EVANSPARK GD NW ca-ab-calgary.zip</span><span class="w">
</span><span class="c1">#&gt; 4  -114.1175 51.17461     321 EVANSPARK GD NW ca-ab-calgary.zip</span><span class="w">
</span><span class="c1">#&gt; 5  -114.1212 51.16268   204 EVANSBROOKE LD NW ca-ab-calgary.zip</span><span class="w">
</span><span class="c1">#&gt; 6  -114.1213 51.16264   200 EVANSBROOKE LD NW ca-ab-calgary.zip</span><span class="w">
</span><span class="c1">#&gt; 7  -114.1107 51.14784 219 HIDDEN VALLEY LD NW ca-ab-calgary.zip</span><span class="w">
</span><span class="c1">#&gt; 8  -114.1108 51.14768 211 HIDDEN VALLEY LD NW ca-ab-calgary.zip</span><span class="w">
</span><span class="c1">#&gt; 9  -114.1121 51.14780 364 HIDDEN VALLEY LD NW ca-ab-calgary.zip</span><span class="w">
</span><span class="c1">#&gt; 10 -114.1117 51.14800 348 HIDDEN VALLEY LD NW ca-ab-calgary.zip</span><span class="w">
</span><span class="c1">#&gt; ..       ...      ...                     ...               ...</span><span class="w">
</span></code></pre></div></div>

<h2 id="map-data">Map data</h2>

<p>Get some data</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_get</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="m">400</span><span class="p">]))</span><span class="w">
</span><span class="c1">#&gt; &lt;Openaddresses data&gt; ~/.openadds/us-ca-sonoma_county.zip</span><span class="w">
</span><span class="c1">#&gt; Dimensions [217243, 5]</span><span class="w">
</span><span class="c1">#&gt; </span><span class="w">
</span><span class="c1">#&gt;          LON      LAT  NUMBER          STREET POSTCODE</span><span class="w">
</span><span class="c1">#&gt; 1  -122.5327 38.29779 3771  A       Cory Lane       NA</span><span class="w">
</span><span class="c1">#&gt; 2  -122.5422 38.30354   18752 White Oak Drive       NA</span><span class="w">
</span><span class="c1">#&gt; 3  -122.5412 38.30327   18749 White Oak Drive       NA</span><span class="w">
</span><span class="c1">#&gt; 4  -122.3997 38.26122    3552       Napa Road       NA</span><span class="w">
</span><span class="c1">#&gt; 5  -122.5425 38.30404    3998 White Oak Court       NA</span><span class="w">
</span><span class="c1">#&gt; 6  -122.5429 38.30434    4026 White Oak Court       NA</span><span class="w">
</span><span class="c1">#&gt; 7  -122.5430 38.30505    4039 White Oak Court       NA</span><span class="w">
</span><span class="c1">#&gt; 8  -122.5417 38.30504    4017 White Oak Court       NA</span><span class="w">
</span><span class="c1">#&gt; 9  -122.5409 38.30436   18702 White Oak Drive       NA</span><span class="w">
</span><span class="c1">#&gt; 10 -122.5403 38.30392   18684 White Oak Drive       NA</span><span class="w">
</span><span class="c1">#&gt; ..       ...      ...     ...             ...      ...</span><span class="w">
</span></code></pre></div></div>

<p>Make an interactive map (not all data)</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"leaflet"</span><span class="p">)</span><span class="w">

</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_get</span><span class="p">(</span><span class="n">oa_search</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"us"</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"boulder"</span><span class="p">)[</span><span class="m">1</span><span class="p">,]</span><span class="o">$</span><span class="n">url</span><span class="p">)</span><span class="w">
</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">oa_get</span><span class="p">(</span><span class="n">oa_search</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"us"</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gunnison"</span><span class="p">)[</span><span class="m">1</span><span class="p">,]</span><span class="o">$</span><span class="n">url</span><span class="p">)</span><span class="w">
</span><span class="n">oa_combine</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">leaflet</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addTiles</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">addCircles</span><span class="p">(</span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">lng</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">lon</span><span class="p">,</span><span class="w"> </span><span class="n">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">address</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><img src="/public/img/2015-05-18-openadds/map.png" alt="image" /></p>

<h2 id="to-do">To do</h2>

<ul>
  <li>Surely there are many datasets that wonâ€™t work in <code class="highlighter-rouge">oa_combine()</code> - gotta go through many more.</li>
  <li>An easy viz function wrapping <code class="highlighter-rouge">leaflet</code></li>
  <li>Since you can get a lot of spatial data quickly, easy way to visualize big data, maybe marker clusters?</li>
</ul>
:ET