--- 
name: good-riddance-to-excel-pivot-tables
layout: blog-post
title: Good riddance to Excel pivot tables
time: 2011-01-30 22:36:00.002000 -06:00
tags: 
- plyr
- reshape2
- R
---
Excel pivot tables have been how I have reorganized data...up until now. These are just a couple of examples why R is superior to Excel for reorganizing data:<br /><br />UPDATE: I fixed the code to use 'dcast' instead of 'cast'. And library(ggplot2) instead of library(plyr) [plyr is called along with ggplot2]. Thanks Bob!<br /><br />Also, see another post on this topic:<br />-<a href="http://news.mrdwab.com/2010/08/08/using-the-reshape-packagein-r/">http://news.mrdwab.com/2010/08/08/using-the-reshape-packagein-r/</a><br /><br /><br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><span style="color: #666666; font-style: italic;">################ Good riddance to pivot tables ############</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span>reshape2<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(<span class="Apple-style-span" style="color: black;">ggplot2</span>)</span>&nbsp;<br />dataset &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>var1 = <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"a"</span><span style="color: #339933;">,</span><span style="color: blue;">"b"</span><span style="color: #339933;">,</span><span style="color: blue;">"c"</span><span style="color: #339933;">,</span><span style="color: blue;">"d"</span><span style="color: #339933;">,</span><span style="color: blue;">"e"</span><span style="color: #339933;">,</span><span style="color: blue;">"f"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> each = <span style="color: #cc66cc;">4</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> <br /> var2 = <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"level1"</span><span style="color: #339933;">,</span><span style="color: blue;">"level1"</span><span style="color: #339933;">,</span><span style="color: blue;">"level2"</span><span style="color: #339933;">,</span><span style="color: blue;">"level2"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">6</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> <br /> var3 = <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"h"</span><span style="color: #339933;">,</span><span style="color: blue;">"m"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">12</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> meas = <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">12</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a><br /><br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="color: #666666; font-family: monospace; font-style: italic;"># simply pivot table</span><br />dcast<span style="color: #009900; font-family: monospace;">(</span>dataset<span style="color: #339933; font-family: monospace;">,</span> var1 <span style="font-family: monospace;">~</span> var2 <span style="font-family: monospace;">+</span> var3<span style="color: #009900; font-family: monospace;">)</span><br />Using meas as value column.  Use the value argument to cast to override this choice<br />  var1 level1_h level1_m level2_h level2_m<br />1    a        1        2        3        4<br />2    b        5        6        7        8<br />3    c        9       10       11       12<br />4    d        1        2        3        4<br />5    e        5        6        7        8<br />6    f        9       10       11       12</pre><pre class="r geshifilter-R" style="font-family: monospace;">&nbsp;<br /><span style="color: #666666; font-style: italic;"># mean by var1 and var2</span><br />dcast<span style="color: #009900;">(</span>dataset<span style="color: #339933;">,</span> var1 ~ var2<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/mean"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900;">)</span></pre><pre class="r geshifilter-R">Using meas as value column.  Use the value argument to cast to override this choice<br />  var1 level1 level2<br />1    a    1.5    3.5<br />2    b    5.5    7.5<br />3    c    9.5   11.5<br />4    d    1.5    3.5<br />5    e    5.5    7.5<br />6    f    9.5   11.5<br /><br />&nbsp;<br /><span style="color: #666666; font-family: monospace; font-style: italic;"># mean by var1 and var3</span><br />dcast<span style="color: #009900; font-family: monospace;">(</span>dataset<span style="color: #339933; font-family: monospace;">,</span> var1 <span style="font-family: monospace;">~</span> var3<span style="color: #339933; font-family: monospace;">,</span> <a href="http://inside-r.org/r-doc/base/mean" style="font-family: monospace;"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900; font-family: monospace;">)</span><br />Using meas as value column.  Use the value argument to cast to override this choice<br />  var1  h  m<br />1    a  2  3<br />2    b  6  7<br />3    c 10 11<br />4    d  2  3<br />5    e  6  7<br />6    f 10 11</pre><pre class="r geshifilter-R">&nbsp;<br /><span style="color: #666666; font-family: monospace; font-style: italic;"># mean by var1, var2 and var3 (version 1)</span><br />dcast<span style="color: #009900; font-family: monospace;">(</span>dataset<span style="color: #339933; font-family: monospace;">,</span> var1 <span style="font-family: monospace;">~</span> var2 <span style="font-family: monospace;">+</span> var3<span style="color: #339933; font-family: monospace;">,</span> <a href="http://inside-r.org/r-doc/base/mean" style="font-family: monospace;"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900; font-family: monospace;">)</span></pre><pre class="r geshifilter-R"><span style="color: #009900; font-family: monospace;"></span>Using meas as value column.  Use the value argument to cast to override this choice<br />  var1 level1_h level1_m level2_h level2_m<br />1    a        1        2        3        4<br />2    b        5        6        7        8<br />3    c        9       10       11       12<br />4    d        1        2        3        4<br />5    e        5        6        7        8<br />6    f        9       10       11       12<br />&nbsp;<br /><span style="color: #666666; font-family: monospace; font-style: italic;"># mean by var1, var2 and var3 (version 2)</span><br />dcast<span style="color: #009900; font-family: monospace;">(</span>dataset<span style="color: #339933; font-family: monospace;">,</span> var1 <span style="font-family: monospace;">+</span> var2 <span style="font-family: monospace;">~</span> var3<span style="color: #339933; font-family: monospace;">,</span> <a href="http://inside-r.org/r-doc/base/mean" style="font-family: monospace;"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900; font-family: monospace;">)</span></pre><pre class="r geshifilter-R">Using meas as value column.  Use the value argument to cast to override this choice<br />   var1   var2  h  m<br />1     a level1  1  2<br />2     a level2  3  4<br />3     b level1  5  6<br />4     b level2  7  8<br />5     c level1  9 10<br />6     c level2 11 12<br />7     d level1  1  2<br />8     d level2  3  4<br />9     e level1  5  6<br />10    e level2  7  8<br />11    f level1  9 10<br />12    f level2 11 12<br /><br />&nbsp;<br /><span style="color: #666666; font-family: monospace; font-style: italic;"># use package plyr to create flexible data frames...</span><br />dataset_plyr <span style="font-family: monospace;">&lt;-</span> ddply<span style="color: #009900; font-family: monospace;">(</span>dataset<span style="color: #339933; font-family: monospace;">,</span> .<span style="color: #009900; font-family: monospace;">(</span>var1<span style="color: #339933; font-family: monospace;">,</span> var2<span style="color: #009900; font-family: monospace;">)</span><span style="color: #339933; font-family: monospace;">,</span> summarise<span style="color: #339933; font-family: monospace;">,</span> <br /> <a href="http://inside-r.org/r-doc/base/mean" style="font-family: monospace;"><span style="color: #003399; font-weight: bold;">mean</span></a> = <a href="http://inside-r.org/r-doc/base/mean" style="font-family: monospace;"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #009900; font-family: monospace;">(</span>meas<span style="color: #009900; font-family: monospace;">)</span><span style="color: #339933; font-family: monospace;">,</span> <br /> se = <a href="http://inside-r.org/r-doc/stats/sd" style="font-family: monospace;"><span style="color: #003399; font-weight: bold;">sd</span></a><span style="color: #009900; font-family: monospace;">(</span>meas<span style="color: #009900; font-family: monospace;">)</span><span style="color: #339933; font-family: monospace;">,</span><br /> CV = <a href="http://inside-r.org/r-doc/stats/sd" style="font-family: monospace;"><span style="color: #003399; font-weight: bold;">sd</span></a><span style="color: #009900; font-family: monospace;">(</span>meas<span style="color: #009900; font-family: monospace;">)</span><span style="font-family: monospace;">/</span>mean<span style="color: #009900; font-family: monospace;">(</span>meas<span style="color: #009900; font-family: monospace;">)</span><br /><span style="color: #009900; font-family: monospace;">)</span><br />&gt; dataset_plyr<br />   var1   var2 mean        se         CV<br />1     a level1  1.5 0.7071068 0.47140452<br />2     a level2  3.5 0.7071068 0.20203051<br />3     b level1  5.5 0.7071068 0.12856487<br />4     b level2  7.5 0.7071068 0.09428090<br />5     c level1  9.5 0.7071068 0.07443229<br />6     c level2 11.5 0.7071068 0.06148755<br />7     d level1  1.5 0.7071068 0.47140452<br />8     d level2  3.5 0.7071068 0.20203051<br />9     e level1  5.5 0.7071068 0.12856487<br />10    e level2  7.5 0.7071068 0.09428090<br />11    f level1  9.5 0.7071068 0.07443229<br />12    f level2 11.5 0.7071068 0.06148755</pre><pre class="r geshifilter-R"></pre><pre class="r geshifilter-R">&nbsp;<br /><span style="color: #666666; font-family: monospace; font-style: italic;"># ...to use for plotting</span><br />qplot<span style="color: #009900; font-family: monospace;">(</span>var1<span style="color: #339933; font-family: monospace;">,</span> <a href="http://inside-r.org/r-doc/base/mean" style="font-family: monospace;"><span style="color: #003399; font-weight: bold;">mean</span></a><span style="color: #339933; font-family: monospace;">,</span> colour = var2<span style="color: #339933; font-family: monospace;">,</span> size = CV<span style="color: #339933; font-family: monospace;">,</span> <a href="http://inside-r.org/r-doc/utils/data" style="font-family: monospace;"><span style="color: #003399; font-weight: bold;">data</span></a> = dataset_plyr<span style="color: #339933; font-family: monospace;">,</span> geom = <span style="color: blue; font-family: monospace;">"point"</span><span style="color: #009900; font-family: monospace;">)</span></pre><pre class="r geshifilter-R"><span style="color: #009900; font-family: monospace;"><br /></span></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_fANWq796z-w/TUY7U_DgoOI/AAAAAAAAEYs/f3xQFdRk6sI/s1600/pivottable1.jpeg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="381" src="http://2.bp.blogspot.com/_fANWq796z-w/TUY7U_DgoOI/AAAAAAAAEYs/f3xQFdRk6sI/s400/pivottable1.jpeg" width="400" /></a></div><pre class="r geshifilter-R"><span style="color: #009900; font-family: monospace;"><br /></span></pre><pre class="r geshifilter-R"><span style="color: #009900; font-family: monospace;"><br /></span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a>
